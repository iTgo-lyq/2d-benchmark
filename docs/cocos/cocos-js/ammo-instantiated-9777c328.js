System.register([],(function(e,t){"use strict";return{execute:async function(){e({A:void 0,B:void 0,E:void 0,F:void 0,G:void 0,K:void 0,L:void 0,S:void 0,T:void 0,_:$,a2:void 0,a8:Ws,a9:ja,aC:de,aD:_e,aJ:ae,aK:ie,aO:se,aP:void 0,aQ:ls,aU:function(e,t,n,i,r){void 0===n&&(n=ra.R32F),void 0===i&&(i=0),void 0===r&&(r=0);var o=ka[n];r||(r=o.size);for(var a="set"+eC(o),s=o.size/o.count,c=Math.floor(t.length/o.count),l=Vv.isLittleEndian,u=0;u<c;++u)for(var h=i+r*u,_=0;_<o.count;++_){var f=h+s*_;e[a](f,t[o.count*u+_],l)}},aV:void 0,aW:OI,aX:tC,aZ:St,a_:function(e){return Nh(Dh({formerlySerializedAs:e}))},ac:void 0,ad:oe,ag:void 0,ai:void 0,al:void 0,an:Ya,ao:b,ap:g,at:void 0,au:function(e,t,n,i,r,o){void 0===t&&(t=ra.R32F),void 0===n&&(n=0),void 0===i&&(i=e.byteLength-n),void 0===r&&(r=0),void 0===o&&(o=[]);var a=ka[t];r||(r=a.size);for(var s="get"+eC(a),c=a.size/a.count,l=Math.floor(i/r),u=Vv.isLittleEndian,h=0;h<l;++h)for(var _=n+r*h,f=0;f<a.count;++f){var d=_+c*f;o[a.count*h+f]=e[s](d,u)}return o},av:Tt,ax:Et,b:gP,b$:void 0,b0:n_,b2:void 0,bA:uD,bB:lD,bD:void 0,bF:void 0,bL:void 0,bM:void 0,bT:Ve,bV:H,bW:et,bd:void 0,be:void 0,bh:void 0,bs:In,bt:df,bu:void 0,bw:function(e,t,n){for(ai.identity(n);e!==t;)ai.fromRTS(vD,e.rotation,e.position,e.scale),ai.multiply(n,vD,n),e=e.parent;return n},bz:hD,c$:Nn,c1:void 0,c2:void 0,c3:wt,c4:void 0,cE:bn,cH:Ft,cM:wn,cT:Rn,cX:void 0,cY:zn,cZ:Mn,cb:Cn,cj:void 0,cp:void 0,cs:Gt,ct:$e,cu:C,cw:void 0,cz:void 0,d0:Pn,d1:he,d3:Bn,d5:aT,d7:Sn,d9:j_,dA:void 0,dB:vn,dE:_t,dK:fi,dL:Xn,dM:mi,dN:ri,dQ:gi,dR:xi,dS:jn,dU:An,dV:Dn,dW:Ln,dX:Fn,dY:Un,dZ:Gn,d_:xt,dc:Hn,dd:be,de:ne,df:Ie,dg:Nh,dj:Ht,dk:kt,dl:M,dn:q,dp:v,dq:bR,dr:li,dw:F_,e:bP,e4:function(e){e>0&&(Te=e)},e5:void 0,e6:XS,e7:KS,eD:void 0,eF:void 0,eG:void 0,eH:void 0,eI:void 0,eJ:void 0,eK:void 0,eL:void 0,eM:void 0,ea:qf,en:x,eo:P,ep:D,eq:L,er:void 0,fB:TD,fC:SD,fD:AD,fE:YP,fF:eM,fJ:iM,fK:rM,fN:function(e,t){for(var n=e,i="";null!==n&&n!==t;)i=n.name+"/"+i,n=n.parent;return i.slice(0,-1)},fP:PD,i:vP,l:Z,o:void 0,q:void 0,r:R,t:Va,u:void 0,v:void 0,w:y,x:void 0,y:void 0,z:void 0});const n=e("af",!1),i=e("cW",!1),r=e("cL",!1),o=e("cJ",!1),a=e("cK",!1);var s="undefined"==typeof window?global:window,c=e("as",{_global:s});c.internal={},s.CC_BUILD=!0,s.CC_TEST=!1,s.CC_EDITOR=i,s.CC_PREVIEW=!1,s.CC_DEV=!1,s.CC_DEBUG=!0,s.CC_JSB=a,s.CC_BYTEDANCE=!1,s.CC_WECHAT=n,s.CC_ALIPAY=!1,s.CC_XIAOMI=!1,s.CC_BAIDU=!1,s.CC_COCOSPLAY=!1,s.CC_HUAWEI=!1,s.CC_OPPO=!1,s.CC_VIVO=!1,s.CC_MINIGAME=o,s.CC_RUNTIME_BASED=r,s.CC_SUPPORT_JIT=!0;var l=e("dt","3.0.0");s.CocosEngine=c.ENGINE_VERSION=l,s.cc=c;var u={1100:"Expected 'data' dict, but not found. Config file: %s",1101:"Please load the resource first : %s",1200:"cocos2d: Director: Error in gettimeofday",1204:"Running scene should not be null",1205:"The scene should not be null",1206:"loadScene: The scene index to load (%s) is out of range.",1207:"loadScene: Unknown name type to load: '%s'",1208:"loadScene: Failed to load scene '%s' because '%s' is already being loaded.",1209:"loadScene: Can not load the scene '%s' because it was not in the build settings before playing.",1210:"Failed to preload '%s', %s",1211:"loadScene: The scene index to load (%s) is out of range.",1212:"loadScene: Unknown name type to load: '%s'",1213:"loadScene: Failed to load scene '%s' because '%s' is already loading",1214:"loadScene: Can not load the scene '%s' because it was not in the build settings before playing.",1215:"Failed to preload '%s', %s",1216:"Director.runSceneImmediate: scene is not valid",1217:"Director._initOnEngineInitialized: renderer root initialization failed",1300:"%s is not in the model pool and cannot be destroyed by destroyModel.",1400:"'%s' is deprecated, please use '%s' instead.",1404:"cc.spriteFrameCache is removed, please use cc.loader to load and cache sprite frames of atlas format.",1406:"'%s.%s' is removed",1408:"'%s' is removed",1409:"element type is wrong!",1502:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",1503:"cc.Scheduler.pauseTarget():target should be non-null",1504:"cc.Scheduler.resumeTarget():target should be non-null",1505:"cc.Scheduler.isTargetPaused():target should be non-null",1506:"warning: you CANNOT change update priority in scheduled function",1507:"scheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",1508:"Argument callback must not be empty",1509:"Argument target must be non-nullptr",1510:"cc.Scheduler: Illegal target which doesn't have id, you should do Scheduler.enableForTarget(target) before all scheduler API usage on target",1511:"cc.Scheduler: pause state of the scheduled task doesn't match the element pause state in Scheduler, the given paused state will be ignored.",1513:"cc.Scheduler: scheduler stopped using `__instanceId` as id since v2.0, you should do Scheduler.enableForTarget(target) before all scheduler API usage on target",1607:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",1619:"callback function must be non-null",1620:"interval must be positive",1623:"Set '%s' to normal node (not persist root node).",1624:"Replacing with the same sgNode",1625:"The replacement sgNode should not contain any child.",1626:"Should not set alpha via 'color', set 'opacity' please.",1627:"Not support for asynchronous creating node in SG",1632:"Node name can not include '/'.",1633:"Internal error, should not remove unknown node from parent.",1635:"reorderChild: this child is not in children list.",1636:"Node's zIndex value can't be greater than cc.macro.MAX_ZINDEX, setting to the maximum value",1637:"Node's zIndex value can't be smaller than cc.macro.MIN_ZINDEX, setting to the minimum value",1638:"Private node's zIndex can't be set, it will keep cc.macro.MIN_ZINDEX as its value",1800:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",1801:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",1802:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",1803:"cc._EventListenerAcceleration.checkAvailable():_onAccelerationEvent must be non-nil",1900:"Invalid parameter.",2200:"Design resolution not valid",2201:"should set resolutionPolicy",2300:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s",2402:"Forward pipeline startup failed!",3103:"cc.Texture.addImage(): path should be non-null",3119:"Lazy init texture with image element failed due to image loading failure: %s",3120:"Loading texture with unsupported type: '%s'. Add '%s' into 'cc.macro.SUPPORT_TEXTURE_FORMATS' please.",3121:"Can't find a texture format supported by the current platform! Please add a fallback format in the editor.",3300:"Rect width exceeds maximum margin: %s",3301:"Rect height exceeds maximum margin: %s",3500:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",3501:"Invalid listener type!",3502:"Can't set fixed priority with scene graph based listener.",3503:"Invalid parameters.",3504:"listener must be a cc.EventListener object when adding a fixed priority listener",3505:"The listener has been registered, please don't register it again.",3506:"Unsupported listener target.",3507:"Invalid scene graph priority!",3508:"If program goes here, there should be event in dispatch.",3509:"_inDispatch should be 1 here.",3510:"%s's scene graph node not contains in the parent's children",3511:"event is undefined",3512:"Event manager only support scene graph priority for ui nodes which contain UIComponent",3520:"Device Motion Event request permission: %s",3521:"Device Motion Event request permission failed: %s",3601:"The editor property 'playOnFocus' should be used with 'executeInEditMode' in class '%s'",3602:"Unknown editor property '%s' in class '%s'.",3603:"Use 'cc.Float' or 'cc.Integer' instead of 'cc.Number' please.",3604:"Can only indicate one type attribute for %s.",3605:"The default value of %s is not instance of %s.",3606:"No needs to indicate the '%s' attribute for %s, which its default value is type of %s.",3607:"The default value of %s must be an empty string.",3608:"The type of %s must be CCString, not String.",3609:"The type of %s must be CCBoolean, not Boolean.",3610:"The type of %s must be CCFloat or CCInteger, not Number.",3611:"Can not indicate the '%s' attribute for %s, which its default value is type of %s.",3612:"%s Just set the default value to 'new %s()' and it will be handled properly.",3613:"'No need to use 'serializable: false' or 'editorOnly: true' for the getter of '%s.%s', every getter is actually non-serialized.",3614:"Should not define constructor for cc.Component %s.",3615:"Each script can have at most one Component.",3616:"Should not specify class name %s for Component which defines in project.",3618:"ctor of '%s' can not be another CCClass",3623:"Can not use 'editor' attribute, '%s' not inherits from Components.",3625:"[isChildClassOf] superclass should be function type, not",3626:"Can't remove '%s' because '%s' depends on it.",3627:"Should not add renderer component (%s) to a Canvas node.",3628:"Should not add %s to a node which size is already used by its other component.",3633:"Properties function of '%s' should return an object!",3634:"Disallow to use '.' in property name",3637:"Can not declare %s.%s, it is already defined in the prototype of %s",3639:"Can not apply the specified attribute to the getter of '%s.%s', attribute index: %s",3640:"'%s': the setter of '%s' is already defined!",3641:"Can not construct %s because it contains object property.",3644:"Please define 'type' parameter of %s.%s as the actual constructor.",3645:"Please define 'type' parameter of %s.%s as the constructor of %s.",3646:"Unknown 'type' parameter of %s.%sï¼š%s",3647:"The length of range array must be equal or greater than 2",3648:"Can not declare %s.%s method, it is already defined in the properties of %s.",3652:"Failed to `new %s()` under the hood, %s\nIt is used for getting default values declared in TypeScript in the first place.\nPlease ensure the constructor can be called during the script's initialization.",3653:'Please do not specifiy "default" attribute in decorator of "%s" property in "%s" class.\nDefault value must be initialized at their declaration:\n\n \n// Before:\n@property({\n  type: cc.SpriteFrame\n  default: null  // <--\n})\nmyProp;\n// After:\n@property({\n  type: cc.SpriteFrame\n})\nmyProp = null;   // <--',3654:'Please specifiy a default value for "%s.%s" property at its declaration:\n\n \n// Before:\n@property(...)\nmyProp;\n// After:\n@property(...)\nmyProp = 0;',3655:'Can not specifiy "get" or "set"  attribute in decorator for "%s" property in "%s" class.\nPlease use:\n\n \n@property(...)\nget %s () {\n    ...\n}\n@property\nset %s (value) {\n    ...\n}',3659:"Violation error: extending enumerations shall have non-overlaped member names or member values",3660:"You are explicitly specifying `undefined` type to cc property \"%s\" of cc class \"%s\".\nIs this intended? If not, this may indicate a circular reference.\nFor example:\n\n \n// foo.ts\nimport { _decorator } from 'cc';\nimport { Bar } from './bar';  // Given that './bar' also reference 'foo.ts'.\n                              // When importing './bar', execution of './bar' is hung on to wait execution of 'foo.ts',\n                              // the `Bar` imported here is `undefined` until './bar' finish its execution.\n                              // It leads to that\n@_decorator.ccclass           //  â†“\nexport class Foo {            //  â†“\n    @_decorator.type(Bar)     //  â†’ is equivalent to `@_decorator.type(undefined)`\n    public bar: Bar;          // To eliminate this error, either:\n                              // - Refactor your module structure(recommended), or\n                              // - specify the type as cc class name: `@_decorator.type('Bar'/* or any name you specified for `Bar` */)`\n}",3700:"internal error: _prefab is undefined",3701:"Failed to load prefab asset for node '%s'",3800:"The target can not be made persist because it's not a cc.Node or it doesn't have _id property.",3801:"The node can not be made persist because it's not under root node.",3802:"The node can not be made persist because it's not in current scene.",3803:"The target can not be made persist because it's not a cc.Node or it doesn't have _id property.",3804:"getComponent: Type must be non-nil",3805:"Can't add component '%s' because %s already contains the same component.",3806:"Can't add component '%s' to %s because it conflicts with the existing '%s' derived component.",3807:"addComponent: Failed to get class '%s'",3808:"addComponent: Should not add component ('%s') when the scripts are still loading.",3809:"addComponent: The component to add must be a constructor",3810:"addComponent: The component to add must be child class of cc.Component",3811:"_addComponentAt: The component to add must be a constructor",3812:"_addComponentAt: Index out of range",3813:"removeComponent: Component must be non-nil",3814:"Argument must be non-nil",3815:"Component not owned by this entity",3816:"Node '%s' is already activating",3817:"Sorry, the component of '%s' which with an index of %s is corrupted! It has been removed.",3818:"Failed to read or parse project.json",3819:"Warning: target element is not a DIV or CANVAS",3820:"The renderer doesn't support the renderMode %s",3821:"Cannot change hierarchy while activating or deactivating the parent.",3822:"addComponent: Cannot add any component to the scene.",3900:"Invalid clip to add",3901:"Invalid clip to remove",3902:"clip is defaultClip, set force to true to force remove clip and animation state",3903:"animation state is playing, set force to true to force stop and remove clip and animation state",3904:"motion path of target [%s] in prop [%s] frame [%s] is not valid",3905:"sprite frames must be an Array.",3906:"Can't find easing type [%s]",3907:"animator not added or already removed",3912:"already-playing",4003:"Label font size can't be shirnked less than 0!",4004:"force notify all fonts loaded!",4011:"Property spriteFrame of Font '%s' is invalid. Using system font instead.",4012:"The texture of Font '%s' must be already loaded on JSB. Using system font instead.",4013:"Sorry, lineHeight of system font not supported on JSB.",4200:"MaskType: IMAGE_STENCIL only support WebGL mode.",4201:"The alphaThreshold invalid in Canvas Mode.",4202:"The inverted invalid in Canvas Mode.",4300:"Can not found the %s page.",4301:"Can not add a page without UITransform.",4302:"Can not set the scroll view content when it hasn't UITransform or its parent hasn't UITransform.",4400:"Invalid RichText img tag! The sprite frame name can't be found in the ImageAtlas!",4500:"Graphics: There is no model in %s.",4600:"Script attached to '%s' is missing or invalid.",4700:"The dom control is not created!",4800:"unknown asset type",4901:"loadRes: should not specify the extname in %s %s",4902:"No need to release non-cached asset.",4914:"Resources url '%s' does not exist.",4915:"Pack indices and data do not match in size",4916:"Failed to download package for %s",4921:"Invalid pipe or invalid index provided!",4922:"The pipe to be inserted is already in the pipeline!",4923:"Uuid Loader: Parse asset [ %s ] failed : %s",4924:"JSON Loader: Input item doesn't contain string content",4925:"Uuid Loader: Deserialize asset [ %s ] failed : %s",4926:"Audio Downloader: no web audio context.",4927:"Audio Downloader: audio not supported on this browser!",4928:"Load %s failed!",4929:"Load Webp ( %s ) failed",4930:"Load image ( %s ) failed",4932:'Since v1.10, for any atlas ("%s") in the "resources" directory, it is not possible to find the contained SpriteFrames via `loadRes`, `getRes` or `releaseRes`. Load the SpriteAtlas first and then use `spriteAtlas.getSpriteFrame(name)` instead please.',4933:"Download Font [ %s ] failed, using Arial or system default font instead",4934:"Please assure that the full path of sub asset is correct!",4935:"Failed to skip prefab asset while deserializing PrefabInfo",5e3:"You are trying to destroy a object twice or more.",5001:"object not yet destroyed",5100:"Not a plist file!",5200:"Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option",5201:"browser don't support web audio",5202:"This feature supports WebGL render mode only.",5300:"Type of target to deserialize not matched with data: target is %s, data is %s",5301:"Can not find script '%s'",5302:"Can not find class '%s'",5303:"Failed to deserialize %s, missing _deserialize function.",5304:"Unable to deserialize version %s data.",5402:"cc.js.addon called on non-object:",5403:"cc.js.mixin: arguments must be type object:",5404:"The base class to extend from must be non-nil",5405:"The class to extend must be non-nil",5406:"Class should be extended before assigning any prototype members.",5500:"'notify' can not be used in 'get/set' !",5501:"'notify' must be used with 'default' !",5507:"The 'default' attribute of '%s.%s' must be an array",5508:"Invalid type of %s.%s",5510:"The 'type' attribute of '%s.%s' can not be 'Number', use cc.Float or cc.Integer instead please.",5511:"The 'type' attribute of '%s.%s' is undefined when loading script",5512:"Can not serialize '%s.%s' because the specified type is anonymous, please provide a class name or set the 'serializable' attribute of '%s.%s' to 'false'.",5513:"The 'default' value of '%s.%s' should not be used with a 'get' function.",5514:"The 'default' value of '%s.%s' should not be used with a 'set' function.",5515:"The 'default' value of '%s.%s' can not be an constructor. Set default to null please.",5517:"'%s.%s' hides inherited property '%s.%s'. To make the current property override that implementation, add the `override: true` attribute please.",5601:"Can not get current scene.",5602:"Scene is destroyed",5603:"reference node is destroyed",5700:"no %s or %s on %s",5800:"%s.lerp not yet implemented.",5801:"%s.clone not yet implemented.",5802:"%s.equals not yet implemented.",5900:"MotionStreak only support WebGL mode.",5901:"cc.MotionStreak.getOpacity has not been supported.",5902:"cc.MotionStreak.setOpacity has not been supported.",6e3:"Custom should not be false if file is not specified.",6001:"The new %s must not be NaN",6017:"Incomplete or corrupt PNG file",6018:"Invalid filter algorithm: %s",6019:"Invalid byte order value.",6020:"You forgot your towel!",6021:"Unknown Field Tag: %s",6022:"Too many bits requested",6023:"No bits requested",6024:"Cannot recover from missing StripByteCounts",6025:"Cannot handle sub-byte bits per sample",6026:"Cannot handle sub-byte bits per pixel",6027:"Palette image missing color map",6028:"Unknown Photometric Interpretation: %s",6029:"Unkown error",6030:"cc.ParticleSystem: error decoding or ungzipping textureImageData",6031:"cc.ParticleSystem: unknown image format with Data",6032:"cc.ParticleSystem.initWithDictionary() : error loading the texture",6400:"asset.url is not usable in core process",6402:"AssetLibrary has already been initialized!",6500:"Widget target must be one of the parent nodes of it",6600:"collider not added or already removed",6601:"Can't find testFunc for (%s, $s).",6700:"Can't init canvas '%s' because it conflicts with the existing '%s', the scene should only have one active canvas at the same time.",6705:"Argument must be non-nil",6706:"Priority can't be set in RenderRoot2D node",6800:"Callback of event must be non-nil",6801:"The message must be provided",6900:"The thing you want to instantiate must be an object",6901:"The thing you want to instantiate is nil",6902:"The thing you want to instantiate is destroyed",6903:"The instantiate method for given asset do not implemented",6904:"Can not instantiate array",6905:"Can not instantiate DOM element",7100:"%s already defined in Enum.",7101:"Sorry, 'cc.Enum' not available on this platform, please report this error here: <https://github.com/cocos-creator/engine/issues/new>",7200:"Method 'initWithTMXFile' is no effect now, please set property 'tmxAsset' instead.",7201:"Method 'initWithXML' is no effect now, please set property 'tmxAsset' instead.",7202:"Add component TiledLayer into node failed.",7203:"Property 'mapLoaded' is unused now. Please write the logic to the callback 'start'.",7210:"TMX Hexa zOrder not supported",7211:"TMX invalid value",7215:"cocos2d: Warning: TMX Layer %s has no tiles",7216:"cocos2d: TMXFormat: Unsupported TMX version: %s",7217:"cocos2d: TMXFomat: Unsupported orientation: %s",7218:"cc.TMXMapInfo.parseXMLFile(): unsupported compression method",7219:"cc.TMXMapInfo.parseXMLFile(): Only base64 and/or gzip/zlib maps are supported",7221:"cc.TMXMapInfo.parseXMLFile(): Texture '%s' not found.",7222:"Parse %s failed.",7236:"cc.TMXLayer.getTileAt(): TMXLayer: the tiles map has been released",7237:"cc.TMXLayer.getTileGIDAt(): TMXLayer: the tiles map has been released",7238:"cc.TMXLayer.setTileGID(): TMXLayer: the tiles map has been released",7239:"cc.TMXLayer.setTileGID(): invalid gid: %s",7240:"cc.TMXLayer.getTileFlagsAt(): TMXLayer: the tiles map has been released",7241:"cc.TiledMap.initWithXML(): Map not found. Please check the filename.",7401:"Failed to set _defaultArmatureIndex for '%s' because the index is out of range.",7402:"Failed to set _animationIndex for '%s' because the index is out of range.",7501:"Failed to set _defaultSkinIndex for '%s' because the index is out of range.",7502:"Failed to set _animationIndex for '%s' because its skeletonData is invalid.",7503:"Failed to set _animationIndex for '%s' because the index is out of range.",7504:"Can not render dynamic created SkeletonData",7506:"Failed to load spine atlas '$s'",7507:"Please re-import '%s' because its textures is not initialized! (This workflow will be improved in the future.)",7508:"The atlas asset of '%s' is not exists!",7509:"Spine: Animation not found: %s",7510:"Spine: Animation not found: %s",7600:"The context of RenderTexture is invalid.",7601:"cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;",7602:"Could not attach texture to the framebuffer",7603:"clearDepth isn't supported on Cocos2d-Html5",7604:"saveToFile isn't supported on Cocos2d-Html5",7605:"newCCImage isn't supported on Cocos2d-Html5",7700:"On the web is always keep the aspect ratio",7701:"Can't know status",7702:"Video player's duration is not ready to get now!",7703:"Video Downloader: video not supported on this browser!",7800:"Web does not support loading",7801:"Web does not support query history",7802:"Web does not support query history",7803:"The current browser does not support the GoBack",7804:"The current browser does not support the GoForward",7805:"Web does not support zoom",7900:"cc.math.Matrix3.assign(): current matrix equals matIn",7901:"cc.math.mat4Assign(): pOut equals pIn",7902:"cc.mat.Matrix4.assignFrom(): mat4 equals current matrix",7903:"cc.math.Matrix4 equal: pMat1 and pMat2 are same object.",7904:"cc.math.Matrix4.extractPlane: Invalid plane index",7905:"cc.math.mat4Assign(): pOut equals pIn",7906:"cc.mat.Matrix4.assignFrom(): mat4 equals current matrix",7907:"cc.math.Matrix4 equals: pMat1 and pMat2 are same object.",7908:"Invalid matrix mode specified",7909:"current quaternion is an invalid value",8e3:"Can't handle this field type or size",8001:"No bytes requested",8002:"Too many bytes requested",8003:"Missing StripByteCounts!",8100:"cocos2d: ERROR: Failed to compile shader:\n %s",8101:"cocos2d: ERROR: Failed to compile vertex shader",8102:"cocos2d: ERROR: Failed to compile fragment shader",8103:"cc.GLProgram.link(): Cannot link invalid program",8104:"cocos2d: ERROR: Failed to link program: %s",8105:"cocos2d: cc.shaderCache._loadDefaultShader, error shader type",8106:"Please load the resource firset : %s",8107:"cc.GLProgram.getUniformLocationForName(): uniform name should be non-null",8108:"cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized",8109:"modelView matrix is undefined.",8200:"Please set node's active instead of rigidbody's enabled.",8300:"Should only one camera exists, please check your project.",8301:"Camera does not support Canvas Mode.",8400:"Wrong type arguments, 'filePath' must be a String.",9e3:"Stencil manager does not support level bigger than %d in this device.",9001:"Stencil manager is already empty, cannot pop any mask",9100:"texture size exceeds current device limits %d/%d",9300:"The current buffer beyond the limit in ui static component, please reduce the amount",9301:"The UI has not been initialized",9302:"Can't getGFXSampler with out device",9600:"[Physics]: please check to see if physics modules are included",9610:"[Physics]: cannon.js physics system doesn't support capsule collider",9611:"[Physics]: builtin physics system doesn't support mesh collider",9612:"[Physics]: builtin physics system doesn't support cylinder collider",9620:"[Physics][Ammo]: changing the mesh is not supported after the initialization is completed",10001:"The sub-mesh contains %d vertices, which beyonds the capability (%d vertices most) of renderer of your platform.",10002:"Sub-mesh may include at most %d morph targets, but you specified %d.",11e3:"WebGL context lost.",12001:"BlendFactors are disabled when using custom material, please modify the blend state in the material instead.",12002:"Can't add renderable component to this node because it already have one.","0100":"%s not yet implemented.","0200":"You should specify a valid DOM canvas element."},h=null,_=console.log.bind(console),f=_,d=_,m=function(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];console.log("ASSERT: "+p.apply(void 0,[t].concat(i)))}};function p(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return c.js.formatStr.apply(null,[e].concat(n))}function v(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return _.apply(void 0,[e].concat(n))}function g(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return f.apply(void 0,[e].concat(n))}function y(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return d.apply(void 0,[e].concat(n))}function x(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return m.apply(void 0,[e,t].concat(i))}function E(e){if(_=f=d=m=function(){},e!==O.NONE){if(e>O.ERROR){var t=function(e){if(c.game.canvas){if(!h){var t=document.createElement("Div");t.setAttribute("id","logInfoDiv"),t.setAttribute("width","200"),t.setAttribute("height",c.game.canvas.height);var n=t.style;n.zIndex="99999",n.position="absolute",n.top=n.left="0",(h=document.createElement("textarea")).setAttribute("rows","20"),h.setAttribute("cols","30"),h.setAttribute("disabled","true");var i=h.style;i.backgroundColor="transparent",i.borderBottom="1px solid #cccccc",i.borderTopWidth=i.borderLeftWidth=i.borderRightWidth="0px",i.borderTopStyle=i.borderLeftStyle=i.borderRightStyle="none",i.padding="0px",i.margin="0px",t.appendChild(h),c.game.canvas.parentNode.appendChild(t)}h.value=h.value+e+"\r\n",h.scrollTop=h.scrollHeight}};d=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t("ERROR :  "+p.apply(void 0,[e].concat(i)))},m=function(e,n){if(!e){for(var i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];t("ASSERT: "+p.apply(void 0,[n].concat(r)))}},e!==O.ERROR_FOR_WEB_PAGE&&(f=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t("WARN :  "+p.apply(void 0,[e].concat(i)))}),e===O.INFO_FOR_WEB_PAGE&&(_=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t(p.apply(void 0,[e].concat(i)))})}else console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),d=console.error.bind?console.error.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.error.apply(console,[e].concat(n))},m=function(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var o=p.apply(void 0,[t].concat(i));throw new Error(o)}});e!==O.ERROR&&(f=console.warn.bind?console.warn.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.warn.apply(console,[e].concat(n))}),e===O.INFO&&(_=console.log.bind?console.log.bind(console):function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return console.log.apply(console,[e].concat(n))})}}function T(e){y(e.stack||e)}function S(e){return function(e){for(var t=u[e]||"unknown id",n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return 0===i.length?t:p.apply(void 0,[t].concat(i))}}var A=S();function C(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];v(A.apply(void 0,[e].concat(n)))}var w=S();function b(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];g(w.apply(void 0,[e].concat(n)))}var I=S();function R(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];y(I.apply(void 0,[e].concat(n)))}var O,N=S();function P(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];x(!1,N.apply(void 0,[t].concat(i)))}}function M(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return I.apply(void 0,[e].concat(n))}function D(){return!!c.profiler&&c.profiler.isShowingStats()}function L(e){c.profiler&&(e?c.profiler.showStats():c.profiler.hideStats(),c.game.config.showFPS=!!e)}!function(e){e[e.NONE=0]="NONE",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.INFO_FOR_WEB_PAGE=4]="INFO_FOR_WEB_PAGE",e[e.WARN_FOR_WEB_PAGE=5]="WARN_FOR_WEB_PAGE",e[e.ERROR_FOR_WEB_PAGE=6]="ERROR_FOR_WEB_PAGE"}(O||(O=e("er",{})));var F=Object.freeze({__proto__:null,log:v,warn:g,error:y,assert:x,_resetDebugSetting:E,_throw:T,logID:C,warnID:b,errorID:R,assertID:P,get DebugMode(){return O},getError:M,isDisplayStats:D,setDisplayStats:L}),z=/(\.[^\.\/\?\\]*)(\?.*)?$/,B=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,U=/[^\.\/]+\/\.\.\//;function G(){for(var e="",t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];e=(e+(""===e?"":"/")+a).replace(/(\/|\\\\)$/,"")}return e}function H(e){var t=z.exec(e);return t?t[1]:""}function k(e){if(e){var t=e.lastIndexOf(".");if(-1!==t)return e.substring(0,t)}return e}function V(e,t){var n=e.indexOf("?");n>0&&(e=e.substring(0,n));var i=/(\/|\\)([^\/\\]+)$/g.exec(e.replace(/(\/|\\)$/,""));if(!i)return e;var r=i[2];return t&&e.substring(e.length-t.length).toLowerCase()===t.toLowerCase()?r.substring(0,r.length-t.length):r}function j(e){var t=B.exec(e);return t?t[2]:""}function W(e,t){t=t||"";var n=e.indexOf("?"),i="";return n>0&&(i=e.substring(n),e=e.substring(0,n)),(n=e.lastIndexOf("."))<0?e+t+i:e.substring(0,n)+t+i}function q(e,t,n){if(0===t.indexOf("."))return W(e,t);var i=e.indexOf("?"),r="",o=n?H(e):"";return i>0&&(r=e.substring(i),e=e.substring(0,i)),i=(i=e.lastIndexOf("/"))<=0?0:i+1,e.substring(0,i)+t+o+r}function Y(e){var t=e=String(e);do{t=e,e=e.replace(U,"")}while(t.length!==e.length);return e}function X(e){return e.replace(/[\/\\]$/,"")}function K(){return c.sys.os===c.sys.OS_WINDOWS?"\\":"/"}function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Z(e,t,n){return t&&Q(e.prototype,t),n&&Q(e,n),e}function J(){return(J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function $(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function te(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function ne(t,n,i){return(ne=te()?e("de",Reflect.construct):e("de",(function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&ee(r,n.prototype),r}))).apply(null,arguments)}function ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function oe(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?re(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function ae(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function se(e,t,n,i,r){var o={};return Object.keys(i).forEach((function(e){o[e]=i[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}e("e2",Object.freeze({__proto__:null,join:G,extname:H,mainFileName:k,basename:V,dirname:j,changeExtname:W,changeBasename:q,_normalize:Y,stripSep:X,getSeperator:K})),c.log=v,c.warn=g,c.error=y,c.assert=x,c._throw=T,c.logID=C,c.warnID=b,c.errorID=R,c.assertID=P,c.debug=F,c.path={join:G,extname:H,mainFileName:k,basename:V,dirname:j,changeExtname:W,changeBasename:q,_normalize:Y,stripSep:X,get sep(){return K()}};var ce=0,le={},ue=e("d4",2147483647);function he(e){return(e>0)-(e<0)}function _e(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function fe(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}function de(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)}var me=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,i=t,r=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--r;e[t]=i<<r&255}}(me);var pe=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:ue,INT_MIN:-2147483648,sign:he,abs:function(e){var t=e>>31;return(e^t)-t},min:function(e,t){return t^(e^t)&-(e<t)},max:function(e,t){return e^(e^t)&-(e<t)},isPow2:function(e){return!(e&e-1||!e)},log2:_e,log10:function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},popCount:function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},countTrailingZeros:fe,nextPow2:de,prevPow2:function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},parity:function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1},reverse:function(e){return me[255&e]<<24|me[e>>>8&255]<<16|me[e>>>16&255]<<8|me[e>>>24&255]},interleave2:function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},deinterleave2:function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},interleave3:function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},deinterleave3:function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},nextCombination:function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>fe(e)+1}});e("dJ",pe);var ve,ge,ye,xe,Ee,Te=10,Se=0,Ae=new Map;ye=function(e,t,n,i,r,o){var a=Ae.get(o);a&&a.logTimes>a.count&&(r("'%s' is deprecated, please use '%s' instead.",e+"."+t,n+"."+i),a.count++)},ve=e("bd",(function(e,t,n){null!=e&&n.forEach((function(n){var i=Se++;Ae.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:Te});var r=null!=n.target?n.target:e,o=null!=n.newName?n.newName:n.name,a=null!=n.targetName?n.targetName:t,s=r==e;if(null!=n.customFunction)e[n.name]=function(){var e;return ye(t,n.name,a,o,g,i),(e=n.customFunction).call.apply(e,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=n.customSetter||null!=n.customGetter){var c=null!=n.customSetter,l=null!=n.customGetter;c&&l?Object.defineProperty(e,n.name,{get:function(){return ye(t,n.name,a,o,g,i),n.customGetter.call(this)},set:function(e){ye(t,n.name,a,o,g,i),n.customSetter.call(this,e)},enumerable:!1}):c?Object.defineProperty(e,n.name,{set:function(e){ye(t,n.name,a,o,g,i),n.customSetter.call(this,e)},enumerable:!1}):l&&Object.defineProperty(e,n.name,{get:function(){return ye(t,n.name,a,o,g,i),n.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(e,n.name,{get:function(){return ye(t,n.name,a,o,g,i),s?this[o]:r[o]},set:function(e){ye(t,n.name,a,o,g,i),s?this[o]=e:r[o]=e},enumerable:!1})}))})),Ee=function(e,t,n,i,r){var o=Ae.get(i),a=void 0===r?"":"("+r+")";o&&o.logTimes>o.count&&(n("'%s' has been removed. "+a,e+"."+t),o.count++)},ge=e("be",(function(e,t,n){null!=e&&n.forEach((function(n){var i=Se++;Ae.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:Te}),Object.defineProperty(e,n.name,{get:function(){return Ee(t,n.name,y,i,n.suggest)},set:function(){Ee(t,n.name,y,i,n.suggest)},enumerable:!1})}))})),xe=function(e,t,n,i,r){var o=Ae.get(i),a=void 0===r?"":"("+r+")";o&&o.logTimes>o.count&&(n("'%s' is deprecated. "+a,e+"."+t),o.count++)},e("e5",(function(e,t,n){if(null!=e){var i=function(e,t,n,i,r,o){if(e.get){var a=e.get();e.get=function(){return xe(t,n,i,r,o),a.call(this)}}if(e.set){var s=Object.create(e.set);e.set=function(e){xe(t,n,i,r,o),s.call(this,e)}}};n.forEach((function(n){var r=n.name,o=Object.getOwnPropertyDescriptor(e,r);if(o){var a=Se++;if(Ae.set(a,{id:a,count:0,logTimes:void 0!==n.logTimes?n.logTimes:Te}),null!=o.value)if("function"==typeof o.value){var s=o.value;e[r]=function(){return xe(t,r,g,a,n.suggest),s.call.apply(s,[this].concat(Array.prototype.slice.call(arguments)))}}else i(o,t,r,g,a,n.suggest);else i(o,t,r,g,a,n.suggest);Object.defineProperty(e,r,{enumerable:!1})}}))}}));var Ce=function(){function e(e){this.i=0,this.array=e}var t=e.prototype;return t.remove=function(e){var t=this.array.indexOf(e);t>=0&&this.removeAt(t)},t.removeAt=function(e){this.array.splice(e,1),e<=this.i&&--this.i},t.fastRemove=function(e){var t=this.array.indexOf(e);t>=0&&this.fastRemoveAt(t)},t.fastRemoveAt=function(e){var t=this.array;t[e]=t[t.length-1],--t.length,e<=this.i&&--this.i},t.push=function(e){this.array.push(e)},Z(e,[{key:"length",get:function(){return this.array.length},set:function(e){this.array.length=e,this.i>=e&&(this.i=e-1)}}]),e}();function we(e,t){e.splice(t,1)}function be(e,t){var n=e.length;t<0||t>=n||(e[t]=e[n-1],e.length=n-1)}function Ie(e,t){var n=e.indexOf(t);return n>=0&&(we(e,n),!0)}function Re(e,t){return e.indexOf(t)>=0}var Oe=Object.freeze({__proto__:null,removeAt:we,fastRemoveAt:be,remove:Ie,fastRemove:function(e,t){var n=e.indexOf(t);n>=0&&(e[n]=e[e.length-1],--e.length)},removeIf:function(e,t){var n=e.findIndex(t);if(n>=0){var i=e[n];return we(e,n),i}},verifyType:function(e,t){if(e&&e.length>0)for(var n,i=oe(e);!(n=i()).done;)if(!(n.value instanceof t))return C(1300),!1;return!0},removeArray:function(e,t){for(var n=0,i=t.length;n<i;n++)Ie(e,t[n])},appendObjectsAt:function(e,t,n){return e.splice.apply(e,[n,0].concat(t)),e},contains:Re,copy:function(e){for(var t=e.length,n=new Array(t),i=0;i<t;i+=1)n[i]=e[i];return n},MutableForwardIterator:Ce}),Ne=function(){function e(e){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=e?e+".":""}return e.prototype.getNewId=function(){return this.prefix+ ++this.id},e}();Ne.global=new Ne("global");var Pe=new Ne("TmpCId."),Me="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),De="__cid__";function Le(e){return"number"==typeof e||e instanceof Number}function Fe(e){return"string"==typeof e||e instanceof String}function ze(e){for(var t in e)return!1;return!0}var Be,Ue=(Be={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(e,t,n,i,r){Be.value=n,Be.writable=i,Be.enumerable=r,Object.defineProperty(e,t,Be),Be.value=void 0}),Ge=function(){var e={get:void 0,set:void 0,enumerable:!1};return function(t,n,i,r,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1),"boolean"==typeof r&&(o=r,r=void 0),e.get=i,e.set=r,e.enumerable=o,e.configurable=a,Object.defineProperty(t,n,e),e.get=void 0,e.set=void 0}}(),He=function(){var e={get:void 0,enumerable:!1,configurable:!1};return function(t,n,i,r,o){e.get=i,e.enumerable=r,e.configurable=o,Object.defineProperty(t,n,e),e.get=void 0}}(),ke=function(){var e={set:void 0,enumerable:!1,configurable:!1};return function(t,n,i,r,o){e.set=i,e.enumerable=r,e.configurable=o,Object.defineProperty(t,n,e),e.set=void 0}}();function Ve(e){var t=Object.create(null);return e&&(t["."]=1,t["/"]=1,delete t["."],delete t["/"]),t}function je(e){if("function"==typeof e){var t=e.prototype;if(t&&t.hasOwnProperty("__classname__")&&t.__classname__)return t.__classname__;var n="";if(e.name&&(n=e.name),e.toString){var i,r=e.toString();(i="["===r.charAt(0)?r.match(/\[\w+\s*(\w+)\]/):r.match(/function\s*(\w+)/))&&2===i.length&&(n=i[1])}return"Object"!==n?n:""}return e&&e.constructor?je(e.constructor):""}function We(e,t,n,i){var r=/([^.]+)$/,o=r.exec(t)[0],a=r.exec(n)[0];function s(){return this[a]}i?Ge(e,o,s,(function(e){this[a]=e})):He(e,o,s)}function qe(e,t,n,i){for(var r in n)We(e,t+"."+r,n[r],i)}var Ye=/(%d)|(%s)/,Xe=/%s/;function Ke(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(0===arguments.length)return"";if(0===n.length)return""+e;var r="string"==typeof e&&Ye.test(e);if(r)for(var o,a=oe(n);!(o=a()).done;){var s=o.value,c="number"==typeof s?Ye:Xe;if(c.test(e)){var l=""+s;e=e.replace(c,l)}else e+=" "+s}else for(var u,h=oe(n);!(u=h()).done;){var _=u.value;e+=" "+_}return e}function Qe(){for(var e=arguments.length-1,t=new Array(e),n=0;n<e;++n)t[n]=arguments[n+1];return t}function Ze(e,t){for(;e;){var n=Object.getOwnPropertyDescriptor(e,t);if(n)return n;e=Object.getPrototypeOf(e)}return null}function Je(e,t,n){var i=Ze(t,e);i&&Object.defineProperty(n,e,i)}function $e(e){e=e||{};for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];if(a){if("object"!=typeof a){R(5402,a);continue}for(var s in a)s in e||Je(s,a,e)}}return e}function et(e){e=e||{};for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,o=n;r<o.length;r++){var a=o[r];if(a){if("object"!=typeof a){R(5403,a);continue}for(var s in a)Je(s,a,e)}}return e}function tt(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e.prototype=Object.create(t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),e}function nt(e){var t=e.prototype,n=t&&Object.getPrototypeOf(t);return n&&n.constructor}function it(e,t){if(e&&t){if("function"!=typeof e)return!1;if("function"!=typeof t)return!1;if(e===t)return!0;for(;;){if(!(e=nt(e)))return!1;if(e===t)return!0}}return!1}function rt(e){for(var t=0,n=Object.keys(e);t<n.length;t++)delete e[n[t]]}function ot(e){return"string"!=typeof e||e.startsWith(Pe.prefix)}var at=Ve(!0),st=Ve(!0);function ct(e,t){return function(n,i){if(i.prototype.hasOwnProperty(e)&&delete t[i.prototype[e]],Ue(i.prototype,e,n),n){var r=t[n];r&&r!==i?y("A Class already exists with the same "+e+' : "'+n+'".'):t[n]=i}}}var lt=ct("__cid__",at),ut=ct("__classname__",st);function ht(e,t){if(ut(e,t),!t.prototype.hasOwnProperty(De)){var n=e||Pe.getNewId();n&&lt(n,t)}}function _t(e,t){var n=st[t],i=at[t],r=!0;if(n&&n!==e&&(y('"'+t+'" has already been set as name or alias of another class.'),r=!1),i&&i!==e&&(y('"'+t+'" has already been set as id or alias of another class.'),r=!1),r){var o=e[Me];o||(o=[],e[Me]=o),o.push(t),st[t]=e,at[t]=e}}function ft(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0,r=t;i<r.length;i++){var o=r[i],a=o.prototype,s=a.__cid__;s&&delete at[s];var c=a.__classname__;c&&delete st[c];var l=a[Me];if(l)for(var u=0;u<l.length;++u){var h=l[u];delete st[h],delete at[h]}}}function dt(e){return at[e]}function mt(e){return st[e]}function pt(e,t){var n;if(t=void 0===t||t,"function"==typeof e&&e.prototype.hasOwnProperty(De))return n=e.prototype.__cid__,!t&&i&&ot(n)?"":n;if(e&&e.constructor){var r=e.constructor.prototype;if(r&&r.hasOwnProperty(De))return n=e.__cid__,!t&&i&&ot(n)?"":n}return""}var vt=e("bX",function(){var e=t.prototype;function t(e,t){this.count=void 0,this._pool=void 0,this._cleanup=void 0;var n=void 0===t?e:t,i=void 0===t?null:e;this.count=0,this._pool=new Array(n),this._cleanup=i}return e.get=function(){return this._get()},e._get=function(){if(this.count>0){--this.count;var e=this._pool[this.count];return this._pool[this.count]=null,e}return null},e.put=function(e){var t=this._pool;if(this.count<t.length){if(this._cleanup&&!1===this._cleanup(e))return;t[this.count]=e,++this.count}},e.resize=function(e){e>=0&&(this._pool.length=e,this.count>e&&(this.count=e))},t}()),gt=e("cR",Oe),yt=e("bg",{IDGenerator:Ne,Pool:vt,array:Oe,isNumber:Le,isString:Fe,isEmptyObject:ze,getPropertyDescriptor:Ze,addon:$e,mixin:et,extend:tt,getSuper:nt,isChildClassOf:it,clear:rt,value:Ue,getset:Ge,get:He,set:ke,unregisterClass:ft,getClassName:je,setClassName:ht,setClassAlias:_t,getClassByName:mt,get _registeredClassNames(){return J({},st)},set _registeredClassNames(e){rt(st),Object.assign(st,e)},get _registeredClassIds(){return J({},at)},set _registeredClassIds(e){rt(at),Object.assign(at,e)},_getClassId:pt,_setClassId:lt,_getClassById:dt,obsolete:We,obsoletes:qe,formatStr:Ke,shiftArguments:Qe,createMap:Ve});function xt(e){if("__bitmask__"in e)return e;Ue(e,"__bitmask__",null,!0);for(var t=-1,n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],o=e[r];if(-1===o)o=++t,e[r]=o;else if("number"==typeof o)t=o;else if("string"==typeof o&&Number.isInteger(parseFloat(r)))continue;var a=""+o;r!==a&&Ue(e,a,r)}return e}function Et(e,t){Tt(!(null==e),t)}function Tt(e,t){if(!e)throw new Error("Assertion failed: "+(null!=t?t:"<no-message>"))}function St(e){return"__enums__"in e?e:(Ue(e,"__enums__",null,!0),St.update(e))}function At(e){Tt(e.hasOwnProperty("__enums__"))}function Ct(e){At(e);var t=e.__enums__||[];for(var n in t.length=0,e){var i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort((function(e,t){return e.value-t.value})),e.__enums__=t,t}function wt(e){"__enums__"in e||Ue(e,"__enums__",null,!0)}c.js=yt,e("e0",Object.freeze({__proto__:null,array:gt,js:yt,IDGenerator:Ne,Pool:vt,isNumber:Le,isString:Fe,isEmptyObject:ze,value:Ue,getset:Ge,get:He,set:ke,createMap:Ve,getClassName:je,obsolete:We,obsoletes:qe,formatStr:Ke,shiftArguments:Qe,getPropertyDescriptor:Ze,addon:$e,mixin:et,extend:tt,getSuper:nt,isChildClassOf:it,clear:rt,_idToClass:at,_nameToClass:st,_setClassId:lt,setClassName:ht,setClassAlias:_t,unregisterClass:ft,_getClassById:dt,getClassByName:mt,_getClassId:pt})),xt.isBitMask=function(e){return e&&e.hasOwnProperty("__bitmask__")},xt.getList=function(e){if(e.__bitmask__)return e.__bitmask__;var t=e.__bitmask__=[];for(var n in e){var i=e[n];Number.isInteger(i)&&t.push({name:n,value:i})}return t.sort((function(e,t){return e.value-t.value})),t},c.BitMask=xt,St.update=function(e){for(var t=-1,n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],o=e[r];if(-1===o)o=++t,e[r]=o;else if("number"==typeof o)t=o;else if("string"==typeof o&&Number.isInteger(parseFloat(r)))continue;var a=""+o;r!==a&&Ue(e,a,r)}return Array.isArray(e.__enums__)&&Ct(e),e},St||(St=e("aZ",{})),St.isEnum=function(e){return e&&e.hasOwnProperty("__enums__")},St.getList=function(e){return At(e),e.__enums__?e.__enums__:Ct(e)},c.Enum=St;var bt=e("d$",function(){function e(){}var t=e.prototype;return t.clone=function(){return R(100,je(this)+".clone"),this},t.equals=function(e){return!1},t.set=function(e){R(100,je(this)+".set")},t.toString=function(){return""+{}},e}());ht("cc.ValueType",bt),c.ValueType=bt;var It=e("ab",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20});c.macro=It;for(var Rt=/^(?:cc|dragonBones|sp|ccsg)\..+/,Ot=new Array(123),Nt=0;Nt<123;++Nt)Ot[Nt]=64;for(var Pt=0;Pt<64;++Pt)Ot["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(Pt)]=Pt;var Mt=Ot;function Dt(e,t,n){function i(e,t,n,i){var r=Object.getOwnPropertyDescriptor(e,t);if(r)r.get&&(e[n]=r.get),r.set&&i&&(e[i]=r.set);else{var o=e[n];Ge(e,t,o,e[i])}}for(var r,o=e.prototype,a=0;a<t.length;a++){var s=(r=t[a])[0].toUpperCase()+r.slice(1);i(o,r,"get"+s,"set"+s)}for(r in n){var c=n[r];i(o,r,c[0],c[1])}}function Lt(e,t,n,i){var r=e[t];r?Array.isArray(r)?i?(r.push(r[0]),r[0]=n):r.push(n):e[t]=i?[n,r]:[r,n]:e[t]=n}function Ft(e,t){if("function"==typeof e.contains)return e.contains(t);if("function"==typeof e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));var n=t.parentNode;if(n)do{if(n===e)return!0;n=n.parentNode}while(null!==n);return!1}function zt(e){return"object"==typeof window&&"function"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName}function Bt(e,t,n){e&&setTimeout((function(){e(t,n)}),0)}function Ut(e){return!(!e||e.constructor!==Object)&&ze(e)}function Gt(e,t,n){if(t>n){var i=t;t=n,n=i}return e<t?t:e<n?e:n}function Ht(e){return e*It.RAD}function kt(e){return e*It.DEG}c.misc={BUILTIN_CLASSID_RE:Rt,BASE64_VALUES:Mt,propertyDefine:Dt,pushToMap:Lt,contains:Ft,isDomNode:zt,callInNextTick:Bt,isPlainEmptyObj_DEV:Ut,clampf:Gt,degreesToRadians:Ht,radiansToDegrees:kt},e("e1",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:Rt,BASE64_VALUES:Mt,propertyDefine:Dt,pushToMap:Lt,contains:Ft,isDomNode:zt,callInNextTick:Bt,tryCatchFunctor_EDITOR:function(e){return Function("target","try {\n  target."+e+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")},isPlainEmptyObj_DEV:Ut,clampf:Gt,degreesToRadians:Ht,radiansToDegrees:kt}));var Vt="$_$";function jt(e,t){var n=t?Object.create(t):{};return Ue(e,"__attrs__",n),n}function Wt(e){if("function"!=typeof e)return jt(e,Yt(e.constructor));for(var t,n=c.Class.getInheritanceChain(e),i=n.length-1;i>=0;i--){var r=n[i];r.hasOwnProperty("__attrs__")&&r.__attrs__||jt(r,(t=n[i+1])&&t.__attrs__)}return jt(e,(t=n[0])&&t.__attrs__),e.__attrs__}function qt(e,t){var n=Yt(e),i=t+Vt,r={};for(var o in n)o.startsWith(i)&&(r[o.slice(i.length)]=n[o]);return r}function Yt(e){return e.hasOwnProperty("__attrs__")&&e.__attrs__||Wt(e)}function Xt(e,t,n,i){Yt(e)[t+Vt+n]=i}var Kt=function(){function e(e,t){this.name=void 0,this.default=void 0,this.name=e,this.default=t}return e.prototype.toString=function(){return this.name},e}(),Qt=e("dy",new Kt("Integer",0));c.Integer=Qt,c.CCInteger=Qt;var Zt=e("ec",new Kt("Float",0));c.Float=Zt,c.CCFloat=Zt;var Jt=e("dv",new Kt("Boolean",!1));c.Boolean=Jt,c.CCBoolean=Jt;var $t=e("bf",new Kt("String",""));function en(e,t){return function(n,i){var r='"'+je(n)+"."+i+'"',o=qt(n,i),a=o.type;if(a===Qt||a===Zt?a="Number":a!==$t&&a!==Jt||(a=""+a),a===e){if(o.hasOwnProperty("default")){var s=o.default;if(void 0!==s&&!Array.isArray(s)&&!Ut(s)){var c=typeof s,l=e.toLowerCase();if(c===l)if("object"===l){if(!s||s instanceof o.ctor)return;b(3605,r,je(o.ctor))}else"Number"!==e&&b(3606,t,r,e);else{if("function"===c)return;e===$t.default&&null==s?b(3607,r):b(3611,t,r,c)}delete o.type}}}else b(3604,r)}}c.String=$t,c.CCString=$t;var tn=Object.freeze({__proto__:null,DELIMETER:Vt,createAttrsSingle:jt,createAttrs:Wt,attr:qt,getClassAttrs:Yt,setClassAttr:Xt,PrimitiveType:Kt,CCInteger:Qt,CCFloat:Zt,CCBoolean:Jt,CCString:$t,getTypeChecker_ET:en,getObjTypeChecker_ET:function(e){return function(t,n){en("Object","type")(t,n);var i=Yt(t)[n+Vt+"default"],r=c.Class.getDefault(i);if(!Array.isArray(r)&&it(e,c.ValueType)){var o=je(e),a=Ke('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',je(t),n,o);i?v(a):b(3612,a,o,je(t),n,o)}}}}),nn={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function rn(e,t,n,i){if(!e.get&&!e.set&&e.hasOwnProperty("default")){var r="_N$"+t;e.get=function(){return this[r]},e.set=function(e){var t=this[r];this[r]=e,n.call(this,t)};var o={};for(var a in i[r]=o,nn){var s=nn[a];e.hasOwnProperty(a)&&(o[a]=e[a],s.canUsedInGet||delete e[a])}}}function on(e,t,n,i){if(Array.isArray(t)){if(!(t.length>0))return R(5508,n,i);e.type=t=t[0]}"function"==typeof t&&(t===String?e.type=c.String:t===Boolean?e.type=c.Boolean:t===Number&&(e.type=c.Float))}function an(e,t,n){var i=e?{_short:!0}:{_short:!0,default:t};return n&&(i.type=n),i}function sn(e,t){if(!e||e.constructor!==Object){if(Array.isArray(e)&&e.length>0)return an(t,[],e);if("function"==typeof e){var n=e;return an(t,it(n,c.ValueType)?new n:null,n)}return an(t,e instanceof Kt?e.default:e)}return null}var cn=[];function ln(){return cn[cn.length-1]}c._RF={push:function(e,t,n,i){void 0===n&&(n=t,t=""),cn.push({uuid:t,script:n,module:e,exports:e.exports,beh:null,importMeta:i})},pop:function(){var e=cn.pop(),t=e.module,n=t.exports;if(n===e.exports){for(var i in n)return;t.exports=n=e.cls}},peek:ln};var un=Vt,hn={datas:null,push:function(e){if(this.datas)this.datas.push(e);else{this.datas=[e];var t=this;setTimeout((function(){t.init()}),0)}},init:function(){var e=this.datas;if(e){for(var t=0;t<e.length;++t){var n=e[t],i=n.cls,r=n.props;"function"==typeof r&&(r=r());var o=je(i);r?pn(i,o,r,i.$super,n.mixins):R(3633,o)}this.datas=null}}};function _n(e,t,n,i){!function(e,t){!function(e,t){e.indexOf(t)<0&&e.push(t)}(e.__props__,t)}(e,n),yn(e,i,t,n)}function fn(e,t,n,i){var r=i.get;i.set,r&&(yn(e,i,t,n),Xt(e,n,"serializable",!1))}function dn(e){return"function"==typeof e?e():e}function mn(e,t,n){for(var i in t)e.hasOwnProperty(i)||n&&!n(i)||Object.defineProperty(e,i,Ze(t,i))}function pn(e,t,n,i,r){if(e.__props__=[],i&&i.__props__&&(e.__props__=i.__props__.slice()),r)for(var o=0;o<r.length;++o){var a=r[o];a.__props__&&(e.__props__=e.__props__.concat(a.__props__.filter((function(t){return e.__props__.indexOf(t)<0}))))}if(n)for(var s in function(e,t,n){for(var i in e){var r=e[i],o=sn(r,!1);if(o&&(r=e[i]=o),r){var a=r.notify;a&&rn(r,i,a,e),"type"in r&&on(r,r.type,t,i)}}}(n,t),n){var c=n[s];c.get||c.set?fn(e,t,s,c):_n(e,t,s,c)}var l=Yt(e);e.__values__=e.__props__.filter((function(e){return!1!==l[e+un+"serializable"]}))}function vn(e){var t=e.name,n=e.extends,i=e.mixins,r=function(e,t,n,i){var r=c.Component,o=ln();if(o&&it(t,r)){if(it(o.cls,r))return R(3615),null;e=e||o.script}var a=function(e,t,n,i){var r=i.ctor,o=[r],a=r;Ue(a,"__ctors__",o.length>0?o:null,!0);var s=a.prototype;if(t&&(a.$super=t),n){for(var c=n.length-1;c>=0;c--){var l=n[c];mn(s,l.prototype),vn._isCCClass(l)&&mn(Yt(a),Yt(l))}s.constructor=a}return ht(e,a),a}(e,t,n,i);if(o)if(it(t,r)){var s=o.uuid;s&&lt(s,a),o.cls=a}else it(o.cls,r)||(o.cls=a);return a}(t,n,i,e);t||(t=c.js.getClassName(r)),r._sealed=!0,n&&(n._sealed=!1);var o=e.properties;"function"==typeof o||n&&null===n.__props__||i&&i.some((function(e){return null===e.__props__}))?(hn.push({cls:r,props:o,mixins:i}),r.__props__=r.__values__=null):pn(r,t,o,n,e.mixins);var a=e.editor;return a&&it(n,c.Component)&&c.Component._registerEditorProps(r,a),r}vn._isCCClass=function(e){var t;return null==e||null===(t=e.hasOwnProperty)||void 0===t?void 0:t.call(e,"__ctors__")},vn.fastDefine=function(e,t,n){ht(e,t);for(var i=t.__props__=t.__values__=Object.keys(n),r=Yt(t),o=0;o<i.length;o++){var a=i[o];r[a+un+"visible"]=!1,r[a+un+"default"]=n[a]}},vn.Attr=tn,vn.attr=qt,vn.getInheritanceChain=function(e){for(var t=[];e=nt(e);)e!==Object&&t.push(e);return t};var gn={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function yn(e,t,n,i,r){var o=null,a="";function s(){return a=i+un,o=Yt(e)}"type"in t&&void 0===t.type&&b(3660,i,n);var c=t.type;c&&(gn[c]?(o||s())[a+"type"]=c:"Object"===c||("object"==typeof c?St.isEnum(c)?((o||s())[a+"type"]="Enum",o[a+"enumList"]=St.getList(c)):xt.isBitMask(c)&&((o||s())[a+"type"]="BitMask",o[a+"bitmaskList"]=xt.getList(c)):"function"==typeof c&&((o||s())[a+"type"]="Object",o[a+"ctor"]=c))),"default"in t&&((o||s())[a+"default"]=t.default);var l,u=function(e,n){if(e in t){var i=t[e];typeof i===n&&((o||s())[a+e]=i)}};t.editorOnly&&((o||s())[a+"editorOnly"]=!0),t.__noImplicit?(o||s())[a+"serializable"]=null!==(l=t.serializable)&&void 0!==l&&l:!1===t.serializable&&((o||s())[a+"serializable"]=!1),u("formerlySerializedAs","string");var h=t.range;h&&Array.isArray(h)&&h.length>=2&&((o||s())[a+"min"]=h[0],o[a+"max"]=h[1],h.length>2&&(o[a+"step"]=h[2])),u("min","number"),u("max","number"),u("step","number")}vn.isArray=function(e){return e=dn(e),Array.isArray(e)},vn.getDefault=dn,vn.escapeForJS=function(e){return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},vn.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,vn.getNewValueTypeCode=function(e){for(var t=je(e),n=e.constructor,i="new "+t+"(",r=0;r<n.__props__.length;r++)i+=e[n.__props__[r]],r<n.__props__.length-1&&(i+=",");return i+")"},c.Class=vn;var xn=Math.PI/180,En=180/Math.PI,Tn=e("dT",1e-6);function Sn(e,t){return Math.abs(e-t)<=Tn*Math.max(1,Math.abs(e),Math.abs(t))}function An(e,t,n){return n=n||Tn,Math.abs(e-t)<=n}function Cn(e,t,n){if(t>n){var i=t;t=n,n=i}return e<t?t:e>n?n:e}function wn(e){return e<0?0:e>1?1:e}function bn(e,t,n){return e+(t-e)*n}function In(e){return e*xn}function Rn(e){return e*En}var On=e("c_",Math.random);function Nn(e,t){return Math.random()*(t-e)+e}function Pn(e,t){return Math.floor(Nn(e,t))}function Mn(e){return(e=(9301*e+49297)%233280)/233280}function Dn(e,t,n){return Mn(e)*(n-t)+t}function Ln(e,t,n){return Math.floor(Dn(e,t,n))}function Fn(e){return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function zn(e,t){return e-Math.floor(e/t)*t}function Bn(e,t){return e=zn(e,2*t),t-Math.abs(e-t)}function Un(e,t,n){return(n-e)/(t-e)}function Gn(e){return Math.abs(e.x)>Math.abs(e.y)?Math.abs(e.x)>Math.abs(e.z)?e.x:e.z:Math.abs(e.y)>Math.abs(e.z)?e.y:e.z}function Hn(e,t){return Math.abs(e)>Math.abs(t)?e:t}var kn=1/255,Vn=e("bm",function(e){function t(t,n,i,r){var o;return(o=e.call(this)||this)._val=0,"string"==typeof t?o.fromHEX(t):void 0!==n?o.set(t,n,i,r):o.set(t),o}$(t,e),t.clone=function(e){var n=new t;return e._val?n._val=e._val:n._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,n},t.copy=function(e,t){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,e},t.set=function(e,t,n,i,r){return e.r=t,e.g=n,e.b=i,e.a=r,e},t.fromHEX=function(e,t){return t=0===t.indexOf("#")?t.substring(1):t,e.r=parseInt(t.substr(0,2),16)||0,e.g=parseInt(t.substr(2,2),16)||0,e.b=parseInt(t.substr(4,2),16)||0,e.a=parseInt(t.substr(6,2),16)||255,e._val=(e.a<<24>>>0)+(e.b<<16)+(e.g<<8)+e.r,e},t.add=function(e,t,n){return e.r=t.r+n.r,e.g=t.g+n.g,e.b=t.b+n.b,e.a=t.a+n.a,e},t.subtract=function(e,t,n){return e.r=t.r-n.r,e.g=t.g-n.g,e.b=t.b-n.b,e.a=t.a-n.a,e},t.multiply=function(e,t,n){return e.r=t.r*n.r,e.g=t.g*n.g,e.b=t.b*n.b,e.a=t.a*n.a,e},t.divide=function(e,t,n){return e.r=t.r/n.r,e.g=t.g/n.g,e.b=t.b/n.b,e.a=t.a/n.a,e},t.scale=function(e,t,n){return e.r=t.r*n,e.g=t.g*n,e.b=t.b*n,e.a=t.a*n,e},t.lerp=function(e,t,n,i){var r=t.r,o=t.g,a=t.b,s=t.a;return r+=(n.r-r)*i,o+=(n.g-o)*i,a+=(n.b-a)*i,s+=(n.a-s)*i,e._val=Math.floor((s<<24>>>0)+(a<<16)+(o<<8)+r),e},t.toArray=function(e,n,i){void 0===i&&(i=0);var r=n instanceof t||n.a>1?1/255:1;return e[i+0]=n.r*r,e[i+1]=n.g*r,e[i+2]=n.b*r,e[i+3]=n.a*r,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),t.r=255*e[n+0],t.g=255*e[n+1],t.b=255*e[n+2],t.a=255*e[n+3],t},t.strictEquals=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a},t.equals=function(e,t,n){return void 0===n&&(n=Tn),Math.abs(e.r-t.r)<=n*Math.max(1,Math.abs(e.r),Math.abs(t.r))&&Math.abs(e.g-t.g)<=n*Math.max(1,Math.abs(e.g),Math.abs(t.g))&&Math.abs(e.b-t.b)<=n*Math.max(1,Math.abs(e.b),Math.abs(t.b))&&Math.abs(e.a-t.a)<=n*Math.max(1,Math.abs(e.a),Math.abs(t.a))},t.hex=function(e){return(255*e.r<<24|255*e.g<<16|255*e.b<<8|255*e.a)>>>0},Z(t,[{key:"r",get:function(){return 255&this._val},set:function(e){e=~~Cn(e,0,255),this._val=(4294967040&this._val|e)>>>0}},{key:"g",get:function(){return(65280&this._val)>>8},set:function(e){e=~~Cn(e,0,255),this._val=(4294902015&this._val|e<<8)>>>0}},{key:"b",get:function(){return(16711680&this._val)>>16},set:function(e){e=~~Cn(e,0,255),this._val=(4278255615&this._val|e<<16)>>>0}},{key:"a",get:function(){return(4278190080&this._val)>>>24},set:function(e){e=~~Cn(e,0,255),this._val=(16777215&this._val|e<<24)>>>0}},{key:"x",get:function(){return this.r*kn},set:function(e){this.r=255*e}},{key:"y",get:function(){return this.g*kn},set:function(e){this.g=255*e}},{key:"z",get:function(){return this.b*kn},set:function(e){this.b=255*e}},{key:"w",get:function(){return this.a*kn},set:function(e){this.a=255*e}}]);var n=t.prototype;return n.clone=function(){var e=new t;return e._val=this._val,e},n.equals=function(e){return e&&this._val===e._val},n.lerp=function(e,t){var n=this.r,i=this.g,r=this.b,o=this.a;return n+=(e.r-n)*t,i+=(e.g-i)*t,r+=(e.b-r)*t,o+=(e.a-o)*t,this._val=Math.floor((o<<24>>>0)+(r<<16)+(i<<8)+n),this},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.toCSS=function(e){return void 0===e&&(e="rgba"),"rgba"===e?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*kn).toFixed(2)+")":"rgb"===e?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(e)},n.fromHEX=function(e){e=0===e.indexOf("#")?e.substring(1):e;var t=parseInt(e.substr(0,2),16)||0,n=parseInt(e.substr(2,2),16)||0,i=parseInt(e.substr(4,2),16)||0,r=parseInt(e.substr(6,2),16)||255;return this._val=(r<<24>>>0)+(i<<16)+(n<<8)+(0|t),this},n.toHEX=function(e){void 0===e&&(e="#rrggbb");var t="0",n=[(this.r<16?t:"")+this.r.toString(16),(this.g<16?t:"")+this.g.toString(16),(this.b<16?t:"")+this.b.toString(16)];return"#rgb"===e?(n[0]=n[0][0],n[1]=n[1][0],n[2]=n[2][0]):"#rrggbbaa"===e&&n.push((this.a<16?t:"")+this.a.toString(16)),n.join("")},n.toRGBValue=function(){return 16777215&this._val},n.fromHSV=function(e,t,n){var i=0,r=0,o=0;if(0===t)i=r=o=n;else if(0===n)i=r=o=0;else{1===e&&(e=0),e*=6;var a=Math.floor(e),s=e-a,c=n*(1-t),l=n*(1-t*s),u=n*(1-t*(1-s));switch(a){case 0:i=n,r=u,o=c;break;case 1:i=l,r=n,o=c;break;case 2:i=c,r=n,o=u;break;case 3:i=c,r=l,o=n;break;case 4:i=u,r=c,o=n;break;case 5:i=n,r=c,o=l}}return i*=255,r*=255,o*=255,this._val=(this.a<<24>>>0)+(o<<16)+(r<<8)+(0|i),this},n.toHSV=function(){var e=this.r*kn,t=this.g*kn,n=this.b*kn,i={h:0,s:0,v:0},r=Math.max(e,t,n),o=Math.min(e,t,n),a=0;return i.v=r,i.s=r?(r-o)/r:0,i.s?(a=r-o,i.h=e===r?(t-n)/a:t===r?2+(n-e)/a:4+(e-t)/a,i.h/=6,i.h<0&&(i.h+=1)):i.h=0,i},n.set=function(e,t,n,i){return"object"==typeof e?null!=e._val?this._val=e._val:(t=e.g||0,n=e.b||0,i="number"==typeof e.a?e.a:255,e=e.r||0,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)):(e=e||0,t=t||0,n=n||0,i="number"==typeof i?i:255,this._val=(i<<24>>>0)+(n<<16)+(t<<8)+(0|e)),this},n.multiply=function(e){var t=(255&this._val)*e.r>>8,n=(65280&this._val)*e.g>>8,i=(16711680&this._val)*e.b>>8,r=((4278190080&this._val)>>>8)*e.a;return this._val=4278190080&r|16711680&i|65280&n|255&t,this},n._set_r_unsafe=function(e){return this._val=(4294967040&this._val|e)>>>0,this},n._set_g_unsafe=function(e){return this._val=(4294902015&this._val|e<<8)>>>0,this},n._set_b_unsafe=function(e){return this._val=(4278255615&this._val|e<<16)>>>0,this},n._set_a_unsafe=function(e){return this._val=(16777215&this._val|e<<24)>>>0,this},t}(bt));function jn(e,t,n,i){return new Vn(e,t,n,i)}Vn.WHITE=Object.freeze(new Vn(255,255,255,255)),Vn.GRAY=Object.freeze(new Vn(127,127,127,255)),Vn.BLACK=Object.freeze(new Vn(0,0,0,255)),Vn.TRANSPARENT=Object.freeze(new Vn(0,0,0,0)),Vn.RED=Object.freeze(new Vn(255,0,0,255)),Vn.GREEN=Object.freeze(new Vn(0,255,0,255)),Vn.BLUE=Object.freeze(new Vn(0,0,255,255)),Vn.CYAN=Object.freeze(new Vn(0,255,255,255)),Vn.MAGENTA=Object.freeze(new Vn(255,0,255,255)),Vn.YELLOW=Object.freeze(new Vn(255,255,0,255)),vn.fastDefine("cc.Color",Vn,{r:0,g:0,b:0,a:255}),c.Color=Vn,c.color=jn;var Wn=e("aH",function(e){function t(t,n,i){var r;return r=e.call(this)||this,t&&"object"==typeof t?(r.x=t.x,r.y=t.y,r.z=t.z):(r.x=t||0,r.y=n||0,r.z=i||0),r}$(t,e),t.zero=function(e){return e.x=0,e.y=0,e.z=0,e},t.clone=function(e){return new t(e.x,e.y,e.z)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e},t.set=function(e,t,n,i){return e.x=t,e.y=n,e.z=i,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return Math.sqrt(n*n+i*i+r*r)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z;return n*n+i*i+r*r},t.len=function(e){var t=e.x,n=e.y,i=e.z;return Math.sqrt(t*t+n*n+i*i)},t.lengthSqr=function(e){var t=e.x,n=e.y,i=e.z;return t*t+n*n+i*i},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e},t.invert=function(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e},t.invertSafe=function(e,t){var n=t.x,i=t.y,r=t.z;return Math.abs(n)<Tn?e.x=0:e.x=1/n,Math.abs(i)<Tn?e.y=0:e.y=1/i,Math.abs(r)<Tn?e.z=0:e.z=1/r,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=t.z,o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),e.x=n*o,e.y=i*o,e.z=r*o),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.cross=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.x,s=n.y,c=n.z;return e.x=r*c-o*s,e.y=o*a-i*c,e.z=i*s-r*a,e},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e},t.random=function(e,t){t=t||1;var n=2*On()*Math.PI,i=2*On()-1,r=Math.sqrt(1-i*i);return e.x=r*Math.cos(n)*t,e.y=r*Math.sin(n)*t,e.z=i*t,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.m03*i+n.m07*r+n.m11*o+n.m15;return a=a?Math.abs(1/a):1,e.x=(n.m00*i+n.m04*r+n.m08*o+n.m12)*a,e.y=(n.m01*i+n.m05*r+n.m09*o+n.m13)*a,e.z=(n.m02*i+n.m06*r+n.m10*o+n.m14)*a,e},t.transformMat4Normal=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.m03*i+n.m07*r+n.m11*o;return a=a?Math.abs(1/a):1,e.x=(n.m00*i+n.m04*r+n.m08*o)*a,e.y=(n.m01*i+n.m05*r+n.m09*o)*a,e.z=(n.m02*i+n.m06*r+n.m10*o)*a,e},t.transformMat3=function(e,t,n){var i=t.x,r=t.y,o=t.z;return e.x=i*n.m00+r*n.m03+o*n.m06,e.y=i*n.m01+r*n.m04+o*n.m07,e.z=i*n.m02+r*n.m05+o*n.m08,e},t.transformAffine=function(e,t,n){var i=t.x,r=t.y,o=t.z;return e.x=n.m00*i+n.m04*r+n.m08*o+n.m12,e.y=n.m01*i+n.m05*r+n.m09*o+n.m13,e.x=n.m02*i+n.m06*r+n.m10*o+n.m14,e},t.transformQuat=function(e,t,n){var i=n.w*t.x+n.y*t.z-n.z*t.y,r=n.w*t.y+n.z*t.x-n.x*t.z,o=n.w*t.z+n.x*t.y-n.y*t.x,a=-n.x*t.x-n.y*t.y-n.z*t.z;return e.x=i*n.w+a*-n.x+r*-n.z-o*-n.y,e.y=r*n.w+a*-n.y+o*-n.x-i*-n.z,e.z=o*n.w+a*-n.z+i*-n.y-r*-n.x,e},t.transformRTS=function(e,t,n,i,r){var o=t.x*r.x,a=t.y*r.y,s=t.z*r.z,c=n.w*o+n.y*s-n.z*a,l=n.w*a+n.z*o-n.x*s,u=n.w*s+n.x*a-n.y*o,h=-n.x*o-n.y*a-n.z*s;return e.x=c*n.w+h*-n.x+l*-n.z-u*-n.y+i.x,e.y=l*n.w+h*-n.y+u*-n.x-c*-n.z+i.y,e.z=u*n.w+h*-n.z+c*-n.y-l*-n.x+i.z,e},t.transformInverseRTS=function(e,t,n,i,r){var o=t.x-i.x,a=t.y-i.y,s=t.z-i.z,c=n.w*o-n.y*s+n.z*a,l=n.w*a-n.z*o+n.x*s,u=n.w*s-n.x*a+n.y*o,h=n.x*o+n.y*a+n.z*s;return e.x=(c*n.w+h*n.x+l*n.z-u*n.y)/r.x,e.y=(l*n.w+h*n.y+u*n.x-c*n.z)/r.y,e.z=(u*n.w+h*n.z+c*n.y-l*n.x)/r.z,e},t.rotateX=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r,u=o*s-a*c,h=o*c+a*s;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.rotateY=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=a*c+r*s,u=o,h=a*s-r*c;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.rotateZ=function(e,t,n,i){var r=t.x-n.x,o=t.y-n.y,a=t.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r*s-o*c,u=r*c+o*s,h=a;return e.x=l+n.x,e.y=u+n.y,e.z=h+n.z,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z},t.equals=function(e,t,n){void 0===n&&(n=Tn);var i=e.x,r=e.y,o=e.z,a=t.x,s=t.y,c=t.z;return Math.abs(i-a)<=n*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-s)<=n*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-c)<=n*Math.max(1,Math.abs(o),Math.abs(c))},t.angle=function(e,n){t.normalize(qn,e),t.normalize(Yn,n);var i=t.dot(qn,Yn);return i>1?0:i<-1?Math.PI:Math.acos(i)},t.projectOnPlane=function(e,n,i){return t.subtract(e,n,t.project(e,n,i))},t.project=function(e,n,i){var r=t.lengthSqr(i);return r<1e-6?t.set(e,0,0,0):t.multiplyScalar(e,i,t.dot(n,i)/r)};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z)},n.set=function(e,t,n){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e||0,this.y=t||0,this.z=n||0),this},n.equals=function(e,t){return void 0===t&&(t=Tn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))},n.equals3f=function(e,t,n,i){return void 0===i&&(i=Tn),Math.abs(this.x-e)<=i*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=i*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-n)<=i*Math.max(1,Math.abs(this.z),Math.abs(n))},n.strictEquals=function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},n.strictEquals3f=function(e,t,n){return this.x===e&&this.y===t&&this.z===n},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},n.lerp=function(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this.z+=t*(e.z-this.z),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},n.add3f=function(e,t,n){return this.x+=e,this.y+=t,this.z+=n,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},n.subtract3f=function(e,t,n){return this.x-=e,this.y-=t,this.z-=n,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x*=e,this.y*=e,this.z*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this.z*=e.z,this},n.multiply3f=function(e,t,n){return this.x*=e,this.y*=t,this.z*=n,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},n.divide3f=function(e,t,n){return this.x/=e,this.y/=t,this.z/=n,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.clampf=function(e,t){return this.x=Cn(this.x,e.x,t.x),this.y=Cn(this.y,e.y,t.y),this.z=Cn(this.z,e.z,t.z),this},n.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},n.cross=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-i*o,this.y=i*r-t*a,this.z=t*o-n*r,this},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.normalize=function(){var e=this.x,t=this.y,n=this.z,i=e*e+t*t+n*n;return i>0&&(i=1/Math.sqrt(i),this.x=e*i,this.y=t*i,this.z=n*i),this},n.transformMat4=function(e){var t=this.x,n=this.y,i=this.z,r=e.m03*t+e.m07*n+e.m11*i+e.m15;return r=r?1/r:1,this.x=(e.m00*t+e.m04*n+e.m08*i+e.m12)*r,this.y=(e.m01*t+e.m05*n+e.m09*i+e.m13)*r,this.z=(e.m02*t+e.m06*n+e.m10*i+e.m14)*r,this},t}(bt));Wn.UNIT_X=Object.freeze(new Wn(1,0,0)),Wn.UNIT_Y=Object.freeze(new Wn(0,1,0)),Wn.UNIT_Z=Object.freeze(new Wn(0,0,1)),Wn.RIGHT=Object.freeze(new Wn(1,0,0)),Wn.UP=Object.freeze(new Wn(0,1,0)),Wn.FORWARD=Object.freeze(new Wn(0,0,-1)),Wn.ZERO=Object.freeze(new Wn(0,0,0)),Wn.ONE=Object.freeze(new Wn(1,1,1)),Wn.NEG_ONE=Object.freeze(new Wn(-1,-1,-1));var qn=new Wn,Yn=new Wn;function Xn(e,t,n){return new Wn(e,t,n)}vn.fastDefine("cc.Vec3",Wn,{x:0,y:0,z:0}),c.Vec3=Wn,c.v3=Xn;var Kn=e("dO",function(e){function t(t,n,i,r,o,a,s,c,l){var u;return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),u=e.call(this)||this,"object"==typeof t?(u.m00=t.m00,u.m01=t.m01,u.m02=t.m02,u.m03=t.m03,u.m04=t.m04,u.m05=t.m05,u.m06=t.m06,u.m07=t.m07,u.m08=t.m08):(u.m00=t,u.m01=n,u.m02=i,u.m03=r,u.m04=o,u.m05=a,u.m06=s,u.m07=c,u.m08=l),u}$(t,e),t.clone=function(e){return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08)},t.copy=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e},t.set=function(e,t,n,i,r,o,a,s,c,l){return e.m00=t,e.m01=n,e.m02=i,e.m03=r,e.m04=o,e.m05=a,e.m06=s,e.m07=c,e.m08=l,e},t.identity=function(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.transpose=function(e,t){if(e===t){var n=t.m01,i=t.m02,r=t.m05;e.m01=t.m03,e.m02=t.m06,e.m03=n,e.m05=t.m07,e.m06=i,e.m07=r}else e.m00=t.m00,e.m01=t.m03,e.m02=t.m06,e.m03=t.m01,e.m04=t.m04,e.m05=t.m07,e.m06=t.m02,e.m07=t.m05,e.m08=t.m08;return e},t.invert=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=u*a-s*l,_=-u*o+s*c,f=l*o-a*c,d=n*h+i*_+r*f;return 0===d?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e):(d=1/d,e.m00=h*d,e.m01=(-u*i+r*l)*d,e.m02=(s*i-r*a)*d,e.m03=_*d,e.m04=(u*n-r*c)*d,e.m05=(-s*n+r*o)*d,e.m06=f*d,e.m07=(-l*n+i*c)*d,e.m08=(a*n-i*o)*d,e)},t.determinant=function(e){var t=e.m00,n=e.m01,i=e.m02,r=e.m03,o=e.m04,a=e.m05,s=e.m06,c=e.m07,l=e.m08;return t*(l*o-a*c)+n*(-l*r+a*s)+i*(c*r-o*s)},t.multiply=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.m00,f=n.m01,d=n.m02,m=n.m03,p=n.m04,v=n.m05,g=n.m06,y=n.m07,x=n.m08;return e.m00=_*i+f*a+d*l,e.m01=_*r+f*s+d*u,e.m02=_*o+f*c+d*h,e.m03=m*i+p*a+v*l,e.m04=m*r+p*s+v*u,e.m05=m*o+p*c+v*h,e.m06=g*i+y*a+x*l,e.m07=g*r+y*s+x*u,e.m08=g*o+y*c+x*h,e},t.multiplyMat4=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.m00,f=n.m01,d=n.m02,m=n.m04,p=n.m05,v=n.m06,g=n.m08,y=n.m09,x=n.m10;return e.m00=_*i+f*a+d*l,e.m01=_*r+f*s+d*u,e.m02=_*o+f*c+d*h,e.m03=m*i+p*a+v*l,e.m04=m*r+p*s+v*u,e.m05=m*o+p*c+v*h,e.m06=g*i+y*a+x*l,e.m07=g*r+y*s+x*u,e.m08=g*o+y*c+x*h,e},t.transform=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=n.x,f=n.y;return e.m00=i,e.m01=r,e.m02=o,e.m03=a,e.m04=s,e.m05=c,e.m06=_*i+f*a+l,e.m07=_*r+f*s+u,e.m08=_*o+f*c+h,e},t.scale=function(e,t,n){var i=n.x,r=n.y;return e.m00=i*t.m00,e.m01=i*t.m01,e.m02=i*t.m02,e.m03=r*t.m03,e.m04=r*t.m04,e.m05=r*t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e},t.rotate=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=Math.sin(n),f=Math.cos(n);return e.m00=f*i+_*a,e.m01=f*r+_*s,e.m02=f*o+_*c,e.m03=f*a-_*i,e.m04=f*s-_*r,e.m05=f*c-_*o,e.m06=l,e.m07=u,e.m08=h,e},t.fromMat4=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m04,e.m04=t.m05,e.m05=t.m06,e.m06=t.m08,e.m07=t.m09,e.m08=t.m10,e},t.fromViewUp=function(e,n,i){return Wn.lengthSqr(n)<Tn*Tn?(t.identity(e),e):(i=i||Wn.UNIT_Y,Wn.normalize(Qn,Wn.cross(Qn,i,n)),Wn.lengthSqr(Qn)<Tn*Tn?(t.identity(e),e):(Wn.cross(Zn,n,Qn),t.set(e,Qn.x,Qn.y,Qn.z,Zn.x,Zn.y,Zn.z,n.x,n.y,n.z),e))},t.fromTranslation=function(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=1,e.m05=0,e.m06=t.x,e.m07=t.y,e.m08=1,e},t.fromScaling=function(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=t.y,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=-n,e.m04=i,e.m05=0,e.m06=0,e.m07=0,e.m08=1,e},t.fromQuat=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n+n,s=i+i,c=r+r,l=n*a,u=i*a,h=i*s,_=r*a,f=r*s,d=r*c,m=o*a,p=o*s,v=o*c;return e.m00=1-h-d,e.m03=u-v,e.m06=_+p,e.m01=u+v,e.m04=1-l-d,e.m07=f-m,e.m02=_-p,e.m05=f+m,e.m08=1-l-h,e},t.inverseTransposeMat4=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,d=t.m12,m=t.m13,p=t.m14,v=t.m15,g=n*s-i*a,y=n*c-r*a,x=n*l-o*a,E=i*c-r*s,T=i*l-o*s,S=r*l-o*c,A=u*m-h*d,C=u*p-_*d,w=u*v-f*d,b=h*p-_*m,I=h*v-f*m,R=_*v-f*p,O=g*R-y*I+x*b+E*w-T*C+S*A;return O?(O=1/O,e.m00=(s*R-c*I+l*b)*O,e.m01=(c*w-a*R-l*C)*O,e.m02=(a*I-s*w+l*A)*O,e.m03=(r*I-i*R-o*b)*O,e.m04=(n*R-r*w+o*C)*O,e.m05=(i*w-n*I-o*A)*O,e.m06=(m*S-p*T+v*E)*O,e.m07=(p*x-d*S-v*y)*O,e.m08=(d*T-m*x+v*g)*O,e):null},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e},t.add=function(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e},t.subtract=function(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e},t.multiplyScalar=function(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e.m00=n.m00*i+t.m00,e.m01=n.m01*i+t.m01,e.m02=n.m02*i+t.m02,e.m03=n.m03*i+t.m03,e.m04=n.m04*i+t.m04,e.m05=n.m05*i+t.m05,e.m06=n.m06*i+t.m06,e.m07=n.m07*i+t.m07,e.m08=n.m08*i+t.m08,e},t.strictEquals=function(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08},t.equals=function(e,t,n){return void 0===n&&(n=Tn),Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))};var n=t.prototype;return n.clone=function(){var e=this;return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08)},n.set=function(e,t,n,i,r,o,a,s,c){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=1),"object"==typeof e?(this.m00=e.m00,this.m01=e.m01,this.m02=e.m02,this.m03=e.m03,this.m04=e.m04,this.m05=e.m05,this.m06=e.m06,this.m07=e.m07,this.m08=e.m08):(this.m00=e,this.m01=t,this.m02=n,this.m03=i,this.m04=r,this.m05=o,this.m06=a,this.m07=s,this.m08=c),this},n.equals=function(e,t){return void 0===t&&(t=Tn),Math.abs(this.m00-e.m00)<=t*Math.max(1,Math.abs(this.m00),Math.abs(e.m00))&&Math.abs(this.m01-e.m01)<=t*Math.max(1,Math.abs(this.m01),Math.abs(e.m01))&&Math.abs(this.m02-e.m02)<=t*Math.max(1,Math.abs(this.m02),Math.abs(e.m02))&&Math.abs(this.m03-e.m03)<=t*Math.max(1,Math.abs(this.m03),Math.abs(e.m03))&&Math.abs(this.m04-e.m04)<=t*Math.max(1,Math.abs(this.m04),Math.abs(e.m04))&&Math.abs(this.m05-e.m05)<=t*Math.max(1,Math.abs(this.m05),Math.abs(e.m05))&&Math.abs(this.m06-e.m06)<=t*Math.max(1,Math.abs(this.m06),Math.abs(e.m06))&&Math.abs(this.m07-e.m07)<=t*Math.max(1,Math.abs(this.m07),Math.abs(e.m07))&&Math.abs(this.m08-e.m08)<=t*Math.max(1,Math.abs(this.m08),Math.abs(e.m08))},n.strictEquals=function(e){return this.m00===e.m00&&this.m01===e.m01&&this.m02===e.m02&&this.m03===e.m03&&this.m04===e.m04&&this.m05===e.m05&&this.m06===e.m06&&this.m07===e.m07&&this.m08===e.m08},n.toString=function(){var e=this;return"[\n"+e.m00+", "+e.m01+", "+e.m02+",\n"+e.m03+",\n"+e.m04+", "+e.m05+",\n"+e.m06+", "+e.m07+",\n"+e.m08+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this},n.transpose=function(){var e=this.m01,t=this.m02,n=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=e,this.m05=this.m07,this.m06=t,this.m07=n,this},n.invert=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=c*r-o*s,u=-c*i+o*a,h=s*i-r*a,_=e*l+t*u+n*h;return 0===_?(this.set(0,0,0,0,0,0,0,0,0),this):(_=1/_,this.m00=l*_,this.m01=(-c*t+n*s)*_,this.m02=(o*t-n*r)*_,this.m03=u*_,this.m04=(c*e-n*a)*_,this.m05=(-o*e+n*i)*_,this.m06=h*_,this.m07=(-s*e+t*a)*_,this.m08=(r*e-t*i)*_,this)},n.determinant=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08;return e*(c*r-o*s)+t*(-c*i+o*a)+n*(s*i-r*a)},n.add=function(e){return this.m00+=e.m00,this.m01+=e.m01,this.m02+=e.m02,this.m03+=e.m03,this.m04+=e.m04,this.m05+=e.m05,this.m06+=e.m06,this.m07+=e.m07,this.m08+=e.m08,this},n.subtract=function(e){return this.m00-=e.m00,this.m01-=e.m01,this.m02-=e.m02,this.m03-=e.m03,this.m04-=e.m04,this.m05-=e.m05,this.m06-=e.m06,this.m07-=e.m07,this.m08-=e.m08,this},n.multiply=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=e.m00,h=e.m01,_=e.m02,f=e.m03,d=e.m04,m=e.m05,p=e.m06,v=e.m07,g=e.m08;return this.m00=u*t+h*r+_*s,this.m01=u*n+h*o+_*c,this.m02=u*i+h*a+_*l,this.m03=f*t+d*r+m*s,this.m04=f*n+d*o+m*c,this.m05=f*i+d*a+m*l,this.m06=p*t+v*r+g*s,this.m07=p*n+v*o+g*c,this.m08=p*i+v*a+g*l,this},n.multiplyScalar=function(e){return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=e,this.m05*=e,this.m06*=e,this.m07*=e,this.m08*=e,this},n.scale=function(e){var t=e.x,n=e.y;return this.m00=t*this.m00,this.m01=t*this.m01,this.m02=t*this.m02,this.m03=n*this.m03,this.m04=n*this.m04,this.m05=n*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this},n.rotate=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=Math.sin(e),h=Math.cos(e);return this.m00=h*t+u*r,this.m01=h*n+u*o,this.m02=h*i+u*a,this.m03=h*r-u*t,this.m04=h*o-u*n,this.m05=h*a-u*i,this.m06=s,this.m07=c,this.m08=l,this},n.fromQuat=function(e){var t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,a=n+n,s=i+i,c=t*o,l=n*o,u=n*a,h=i*o,_=i*a,f=i*s,d=r*o,m=r*a,p=r*s;return this.m00=1-u-f,this.m03=l-p,this.m06=h+m,this.m01=l+p,this.m04=1-c-f,this.m07=_-d,this.m02=h-m,this.m05=_+d,this.m08=1-c-u,this},t}(bt));Kn.IDENTITY=Object.freeze(new Kn);var Qn=new Wn,Zn=new Wn;vn.fastDefine("cc.Mat3",Kn,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),c.Mat3=Kn;var Jn=e("aM",function(e){function t(t,n,i,r){var o;return o=e.call(this)||this,t&&"object"==typeof t?(o.x=t.x,o.y=t.y,o.z=t.z,o.w=t.w):(o.x=t||0,o.y=n||0,o.z=i||0,o.w=null!=r?r:1),o}$(t,e),t.clone=function(e){return new t(e.x,e.y,e.z,e.w)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},t.set=function(e,t,n,i,r){return e.x=t,e.y=n,e.z=i,e.w=r,e},t.identity=function(e){return e.x=0,e.y=0,e.z=0,e.w=1,e},t.rotationTo=function(e,n,i){var r=Wn.dot(n,i);return r<-.999999?(Wn.cross(ti,Wn.UNIT_X,n),ti.length()<1e-6&&Wn.cross(ti,Wn.UNIT_Y,n),Wn.normalize(ti,ti),t.fromAxisAngle(e,ti,Math.PI),e):r>.999999?(e.x=0,e.y=0,e.z=0,e.w=1,e):(Wn.cross(ti,n,i),e.x=ti.x,e.y=ti.y,e.z=ti.z,e.w=1+r,t.normalize(e,e))},t.getAxisAngle=function(e,t){var n=2*Math.acos(t.w),i=Math.sin(n/2);return 0!==i?(e.x=t.x/i,e.y=t.y/i,e.z=t.z/i):(e.x=1,e.y=0,e.z=0),n},t.multiply=function(e,t,n){var i=t.x*n.w+t.w*n.x+t.y*n.z-t.z*n.y,r=t.y*n.w+t.w*n.y+t.z*n.x-t.x*n.z,o=t.z*n.w+t.w*n.z+t.x*n.y-t.y*n.x,a=t.w*n.w-t.x*n.x-t.y*n.y-t.z*n.z;return e.x=i,e.y=r,e.z=o,e.w=a,e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e},t.rotateX=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r+c*i,e.y=a*r+s*i,e.z=s*r-a*i,e.w=c*r-o*i,e},t.rotateY=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r-s*i,e.y=a*r+c*i,e.z=s*r+o*i,e.w=c*r-a*i,e},t.rotateZ=function(e,t,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),o=t.x,a=t.y,s=t.z,c=t.w;return e.x=o*r+a*i,e.y=a*r-o*i,e.z=s*r+c*i,e.w=c*r-s*i,e},t.rotateAround=function(e,n,i,r){return t.invert($n,n),Wn.transformQuat(ti,i,$n),t.fromAxisAngle($n,ti,r),t.multiply(e,n,$n),e},t.rotateAroundLocal=function(e,n,i,r){return t.fromAxisAngle($n,i,r),t.multiply(e,n,$n),e},t.calculateW=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=Math.sqrt(Math.abs(1-t.x*t.x-t.y*t.y-t.z*t.z)),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e},t.slerp=function(e,t,n,i){var r=0,o=0,a=n.x,s=n.y,c=n.z,l=n.w,u=t.x*n.x+t.y*n.y+t.z*n.z+t.w*n.w;if(u<0&&(u=-u,a=-a,s=-s,c=-c,l=-l),1-u>1e-6){var h=Math.acos(u),_=Math.sin(h);r=Math.sin((1-i)*h)/_,o=Math.sin(i*h)/_}else r=1-i,o=i;return e.x=r*t.x+o*a,e.y=r*t.y+o*s,e.z=r*t.z+o*c,e.w=r*t.w+o*l,e},t.sqlerp=function(e,n,i,r,o,a){return t.slerp($n,n,o,a),t.slerp(ei,i,r,a),t.slerp(e,$n,ei,2*a*(1-a)),e},t.invert=function(e,t){var n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w,i=n?1/n:0;return e.x=-t.x*i,e.y=-t.y*i,e.z=-t.z*i,e.w=t.w*i,e},t.conjugate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=t.w,e},t.len=function(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w)},t.lengthSqr=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},t.normalize=function(e,t){var n=t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w;return n>0&&(n=1/Math.sqrt(n),e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n),e},t.fromAxes=function(e,n,i,r){return Kn.set(ni,n.x,n.y,n.z,i.x,i.y,i.z,r.x,r.y,r.z),t.normalize(e,t.fromMat3(e,ni))},t.fromViewUp=function(e,n,i){return Kn.fromViewUp(ni,n,i),t.normalize(e,t.fromMat3(e,ni))},t.fromAxisAngle=function(e,t,n){n*=.5;var i=Math.sin(n);return e.x=i*t.x,e.y=i*t.y,e.z=i*t.z,e.w=Math.cos(n),e},t.fromMat3=function(e,t){var n=t.m00,i=t.m03,r=t.m06,o=t.m01,a=t.m04,s=t.m07,c=t.m02,l=t.m05,u=t.m08,h=n+a+u;if(h>0){var _=.5/Math.sqrt(h+1);e.w=.25/_,e.x=(l-s)*_,e.y=(r-c)*_,e.z=(o-i)*_}else if(n>a&&n>u){var f=2*Math.sqrt(1+n-a-u);e.w=(l-s)/f,e.x=.25*f,e.y=(i+o)/f,e.z=(r+c)/f}else if(a>u){var d=2*Math.sqrt(1+a-n-u);e.w=(r-c)/d,e.x=(i+o)/d,e.y=.25*d,e.z=(s+l)/d}else{var m=2*Math.sqrt(1+u-n-a);e.w=(o-i)/m,e.x=(r+c)/m,e.y=(s+l)/m,e.z=.25*m}return e},t.fromEuler=function(e,t,n,i){t*=ii,n*=ii,i*=ii;var r=Math.sin(t),o=Math.cos(t),a=Math.sin(n),s=Math.cos(n),c=Math.sin(i),l=Math.cos(i);return e.x=r*s*l+o*a*c,e.y=o*a*l+r*s*c,e.z=o*s*c-r*a*l,e.w=o*s*l-r*a*c,e},t.fromAngleZ=function(e,t){return t*=ii,e.x=e.y=0,e.z=Math.sin(t),e.w=Math.cos(t),e},t.toAxisX=function(e,t){var n=2*t.y,i=2*t.z;return e.x=1-n*t.y-i*t.z,e.y=n*t.x+i*t.w,e.z=i*t.x+n*t.w,e},t.toAxisY=function(e,t){var n=2*t.x,i=2*t.y,r=2*t.z;return e.x=i*t.x-r*t.w,e.y=1-n*t.x-r*t.z,e.z=r*t.y+n*t.w,e},t.toAxisZ=function(e,t){var n=2*t.x,i=2*t.y,r=2*t.z;return e.x=r*t.x-i*t.w,e.y=r*t.y-n*t.w,e.z=1-n*t.x-i*t.y,e},t.toEuler=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w,s=0,c=0,l=0,u=i*r+o*a;if(u>.499999)s=0,c=Rn(2*Math.atan2(i,a)),l=90;else if(u<-.499999)s=0,c=-Rn(2*Math.atan2(i,a)),l=-90;else{var h=i*i,_=r*r,f=o*o;s=Rn(Math.atan2(2*i*a-2*r*o,1-2*h-2*f)),c=Rn(Math.atan2(2*r*a-2*i*o,1-2*_-2*f)),l=Rn(Math.asin(2*u)),n&&(s=-180*Math.sign(s+1e-6)+s,c=-180*Math.sign(c+1e-6)+c,l=180*Math.sign(l+1e-6)-l)}return e.x=s,e.y=c,e.z=l,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},t.equals=function(e,t,n){return void 0===n&&(n=Tn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z,this.w)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=null!=i?i:1),this},n.equals=function(e,t){return void 0===t&&(t=Tn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))&&Math.abs(this.w-e.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(e.w))},n.strictEquals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},n.getEulerAngles=function(e){return t.toEuler(e,this)},n.lerp=function(e,t){return this.x+=t*(e.x-this.x),this.y+=t*(e.y-this.y),this.z+=t*(e.z-this.z),this.w+=t*(e.w-this.w),this},n.slerp=function(e,n){return t.slerp(this,this,e,n)},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t}(bt));Jn.IDENTITY=Object.freeze(new Jn);var $n=new Jn,ei=new Jn,ti=new Wn,ni=new Kn,ii=.5*Math.PI/180;function ri(e,t,n,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),new Jn(e,t,n,i)}vn.fastDefine("cc.Quat",Jn,{x:0,y:0,z:0,w:1}),c.Quat=Jn,c.quat=ri;var oi=e("di",Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])])),ai=e("bc",function(e){function t(t,n,i,r,o,a,s,c,l,u,h,_,f,d,m,p){var v;return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=1),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===m&&(m=0),void 0===p&&(p=1),(v=e.call(this)||this).m00=void 0,v.m01=void 0,v.m02=void 0,v.m03=void 0,v.m04=void 0,v.m05=void 0,v.m06=void 0,v.m07=void 0,v.m08=void 0,v.m09=void 0,v.m10=void 0,v.m11=void 0,v.m12=void 0,v.m13=void 0,v.m14=void 0,v.m15=void 0,"object"==typeof t?(v.m00=t.m00,v.m01=t.m01,v.m02=t.m02,v.m03=t.m03,v.m04=t.m04,v.m05=t.m05,v.m06=t.m06,v.m07=t.m07,v.m08=t.m08,v.m09=t.m09,v.m10=t.m10,v.m11=t.m11,v.m12=t.m12,v.m13=t.m13,v.m14=t.m14,v.m15=t.m15):(v.m00=t,v.m01=n,v.m02=i,v.m03=r,v.m04=o,v.m05=a,v.m06=s,v.m07=c,v.m08=l,v.m09=u,v.m10=h,v.m11=_,v.m12=f,v.m13=d,v.m14=m,v.m15=p),v}$(t,e),t.clone=function(e){return new t(e.m00,e.m01,e.m02,e.m03,e.m04,e.m05,e.m06,e.m07,e.m08,e.m09,e.m10,e.m11,e.m12,e.m13,e.m14,e.m15)},t.copy=function(e,t){return e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e},t.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,m,p){return e.m00=t,e.m01=n,e.m02=i,e.m03=r,e.m04=o,e.m05=a,e.m06=s,e.m07=c,e.m08=l,e.m09=u,e.m10=h,e.m11=_,e.m12=f,e.m13=d,e.m14=m,e.m15=p,e},t.identity=function(e){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.transpose=function(e,t){if(e===t){var n=t.m01,i=t.m02,r=t.m03,o=t.m06,a=t.m07,s=t.m11;e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=n,e.m06=t.m09,e.m07=t.m13,e.m08=i,e.m09=o,e.m11=t.m14,e.m12=r,e.m13=a,e.m14=s}else e.m00=t.m00,e.m01=t.m04,e.m02=t.m08,e.m03=t.m12,e.m04=t.m01,e.m05=t.m05,e.m06=t.m09,e.m07=t.m13,e.m08=t.m02,e.m09=t.m06,e.m10=t.m10,e.m11=t.m14,e.m12=t.m03,e.m13=t.m07,e.m14=t.m11,e.m15=t.m15;return e},t.invert=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,d=t.m12,m=t.m13,p=t.m14,v=t.m15,g=n*s-i*a,y=n*c-r*a,x=n*l-o*a,E=i*c-r*s,T=i*l-o*s,S=r*l-o*c,A=u*m-h*d,C=u*p-_*d,w=u*v-f*d,b=h*p-_*m,I=h*v-f*m,R=_*v-f*p,O=g*R-y*I+x*b+E*w-T*C+S*A;return 0===O?(e.m00=0,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=0,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=0,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=0,e):(O=1/O,e.m00=(s*R-c*I+l*b)*O,e.m01=(r*I-i*R-o*b)*O,e.m02=(m*S-p*T+v*E)*O,e.m03=(_*T-h*S-f*E)*O,e.m04=(c*w-a*R-l*C)*O,e.m05=(n*R-r*w+o*C)*O,e.m06=(p*x-d*S-v*y)*O,e.m07=(u*S-_*x+f*y)*O,e.m08=(a*I-s*w+l*A)*O,e.m09=(i*w-n*I-o*A)*O,e.m10=(d*T-m*x+v*g)*O,e.m11=(h*x-u*T-f*g)*O,e.m12=(s*C-a*b-c*A)*O,e.m13=(n*b-i*C+r*A)*O,e.m14=(m*y-d*E-p*g)*O,e.m15=(u*E-h*y+_*g)*O,e)},t.determinant=function(e){var t=e.m00,n=e.m01,i=e.m02,r=e.m03,o=e.m04,a=e.m05,s=e.m06,c=e.m07,l=e.m08,u=e.m09,h=e.m10,_=e.m11,f=e.m12,d=e.m13,m=e.m14,p=e.m15;return(t*a-n*o)*(h*p-_*m)-(t*s-i*o)*(u*p-_*d)+(t*c-r*o)*(u*m-h*d)+(n*s-i*a)*(l*p-_*f)-(n*c-r*a)*(l*m-h*f)+(i*c-r*s)*(l*d-u*f)},t.multiply=function(e,t,n){var i=t.m00,r=t.m01,o=t.m02,a=t.m03,s=t.m04,c=t.m05,l=t.m06,u=t.m07,h=t.m08,_=t.m09,f=t.m10,d=t.m11,m=t.m12,p=t.m13,v=t.m14,g=t.m15,y=n.m00,x=n.m01,E=n.m02,T=n.m03;return e.m00=y*i+x*s+E*h+T*m,e.m01=y*r+x*c+E*_+T*p,e.m02=y*o+x*l+E*f+T*v,e.m03=y*a+x*u+E*d+T*g,y=n.m04,x=n.m05,E=n.m06,T=n.m07,e.m04=y*i+x*s+E*h+T*m,e.m05=y*r+x*c+E*_+T*p,e.m06=y*o+x*l+E*f+T*v,e.m07=y*a+x*u+E*d+T*g,y=n.m08,x=n.m09,E=n.m10,T=n.m11,e.m08=y*i+x*s+E*h+T*m,e.m09=y*r+x*c+E*_+T*p,e.m10=y*o+x*l+E*f+T*v,e.m11=y*a+x*u+E*d+T*g,y=n.m12,x=n.m13,E=n.m14,T=n.m15,e.m12=y*i+x*s+E*h+T*m,e.m13=y*r+x*c+E*_+T*p,e.m14=y*o+x*l+E*f+T*v,e.m15=y*a+x*u+E*d+T*g,e},t.transform=function(e,t,n){var i=n.x,r=n.y,o=n.z;if(t===e)e.m12=t.m00*i+t.m04*r+t.m08*o+t.m12,e.m13=t.m01*i+t.m05*r+t.m09*o+t.m13,e.m14=t.m02*i+t.m06*r+t.m10*o+t.m14,e.m15=t.m03*i+t.m07*r+t.m11*o+t.m15;else{var a=t.m00,s=t.m01,c=t.m02,l=t.m03,u=t.m04,h=t.m05,_=t.m06,f=t.m07,d=t.m08,m=t.m09,p=t.m10,v=t.m11;t.m12,t.m13,t.m14,t.m15,e.m00=a,e.m01=s,e.m02=c,e.m03=l,e.m04=u,e.m05=h,e.m06=_,e.m07=f,e.m08=d,e.m09=m,e.m10=p,e.m11=v,e.m12=a*i+u*r+d*o+t.m12,e.m13=s*i+h*r+m*o+t.m13,e.m14=c*i+_*r+p*o+t.m14,e.m15=l*i+f*r+v*o+t.m15}return e},t.translate=function(e,t,n){return console.warn("function changed"),t===e?(e.m12+=n.x,e.m13+=n.y,e.m14+=n.z):(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12+=n.x,e.m13+=n.y,e.m14+=n.z,e.m15=t.m15),e},t.scale=function(e,t,n){var i=n.x,r=n.y,o=n.z;return e.m00=t.m00*i,e.m01=t.m01*i,e.m02=t.m02*i,e.m03=t.m03*i,e.m04=t.m04*r,e.m05=t.m05*r,e.m06=t.m06*r,e.m07=t.m07*r,e.m08=t.m08*o,e.m09=t.m09*o,e.m10=t.m10*o,e.m11=t.m11*o,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15,e},t.rotate=function(e,t,n,i){var r=i.x,o=i.y,a=i.z,s=Math.sqrt(r*r+o*o+a*a);if(Math.abs(s)<Tn)return null;r*=s=1/s,o*=s,a*=s;var c=Math.sin(n),l=Math.cos(n),u=1-l,h=t.m00,_=t.m01,f=t.m02,d=t.m03,m=t.m04,p=t.m05,v=t.m06,g=t.m07,y=t.m08,x=t.m09,E=t.m10,T=t.m11,S=r*r*u+l,A=o*r*u+a*c,C=a*r*u-o*c,w=r*o*u-a*c,b=o*o*u+l,I=a*o*u+r*c,R=r*a*u+o*c,O=o*a*u-r*c,N=a*a*u+l;return e.m00=h*S+m*A+y*C,e.m01=_*S+p*A+x*C,e.m02=f*S+v*A+E*C,e.m03=d*S+g*A+T*C,e.m04=h*w+m*b+y*I,e.m05=_*w+p*b+x*I,e.m06=f*w+v*b+E*I,e.m07=d*w+g*b+T*I,e.m08=h*R+m*O+y*N,e.m09=_*R+p*O+x*N,e.m10=f*R+v*O+E*N,e.m11=d*R+g*O+T*N,t!==e&&(e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e},t.rotateX=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m04,a=t.m05,s=t.m06,c=t.m07,l=t.m08,u=t.m09,h=t.m10,_=t.m11;return t!==e&&(e.m00=t.m00,e.m01=t.m01,e.m02=t.m02,e.m03=t.m03,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m04=o*r+l*i,e.m05=a*r+u*i,e.m06=s*r+h*i,e.m07=c*r+_*i,e.m08=l*r-o*i,e.m09=u*r-a*i,e.m10=h*r-s*i,e.m11=_*r-c*i,e},t.rotateY=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m00,a=t.m01,s=t.m02,c=t.m03,l=t.m08,u=t.m09,h=t.m10,_=t.m11;return t!==e&&(e.m04=t.m04,e.m05=t.m05,e.m06=t.m06,e.m07=t.m07,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=o*r-l*i,e.m01=a*r-u*i,e.m02=s*r-h*i,e.m03=c*r-_*i,e.m08=o*i+l*r,e.m09=a*i+u*r,e.m10=s*i+h*r,e.m11=c*i+_*r,e},t.rotateZ=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t.m00,a=t.m01,s=t.m02,c=t.m03,l=t.m04,u=t.m05,h=t.m06,_=t.m07;return t!==e&&(e.m08=t.m08,e.m09=t.m09,e.m10=t.m10,e.m11=t.m11,e.m12=t.m12,e.m13=t.m13,e.m14=t.m14,e.m15=t.m15),e.m00=o*r+l*i,e.m01=a*r+u*i,e.m02=s*r+h*i,e.m03=c*r+_*i,e.m04=l*r-o*i,e.m05=u*r-a*i,e.m06=h*r-s*i,e.m07=_*r-c*i,e},t.fromTranslation=function(e,t){return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=t.x,e.m13=t.y,e.m14=t.z,e.m15=1,e},t.fromScaling=function(e,t){return e.m00=t.x,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=t.y,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=t.z,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromRotation=function(e,t,n){var i=n.x,r=n.y,o=n.z,a=Math.sqrt(i*i+r*r+o*o);if(Math.abs(a)<Tn)return null;i*=a=1/a,r*=a,o*=a;var s=Math.sin(t),c=Math.cos(t),l=1-c;return e.m00=i*i*l+c,e.m01=r*i*l+o*s,e.m02=o*i*l-r*s,e.m03=0,e.m04=i*r*l-o*s,e.m05=r*r*l+c,e.m06=o*r*l+i*s,e.m07=0,e.m08=i*o*l+r*s,e.m09=r*o*l-i*s,e.m10=o*o*l+c,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromXRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=1,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=i,e.m06=n,e.m07=0,e.m08=0,e.m09=-n,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromYRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=0,e.m02=-n,e.m03=0,e.m04=0,e.m05=1,e.m06=0,e.m07=0,e.m08=n,e.m09=0,e.m10=i,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromZRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e.m00=i,e.m01=n,e.m02=0,e.m03=0,e.m04=-n,e.m05=i,e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=1,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.fromRT=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w,s=i+i,c=r+r,l=o+o,u=i*s,h=i*c,_=i*l,f=r*c,d=r*l,m=o*l,p=a*s,v=a*c,g=a*l;return e.m00=1-(f+m),e.m01=h+g,e.m02=_-v,e.m03=0,e.m04=h-g,e.m05=1-(u+m),e.m06=d+p,e.m07=0,e.m08=_+v,e.m09=d-p,e.m10=1-(u+f),e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e},t.getTranslation=function(e,t){return e.x=t.m12,e.y=t.m13,e.z=t.m14,e},t.getScaling=function(e,t){var n=ci.m00=t.m00,i=ci.m01=t.m01,r=ci.m02=t.m02,o=ci.m03=t.m04,a=ci.m04=t.m05,s=ci.m05=t.m06,c=ci.m06=t.m08,l=ci.m07=t.m09,u=ci.m08=t.m10;return e.x=Math.sqrt(n*n+i*i+r*r),e.y=Math.sqrt(o*o+a*a+s*s),e.z=Math.sqrt(c*c+l*l+u*u),Kn.determinant(ci)<0&&(e.x*=-1),e},t.getRotation=function(e,t){var n=t.m00+t.m05+t.m10,i=0;return n>0?(i=2*Math.sqrt(n+1),e.w=.25*i,e.x=(t.m06-t.m09)/i,e.y=(t.m08-t.m02)/i,e.z=(t.m01-t.m04)/i):t.m00>t.m05&&t.m00>t.m10?(i=2*Math.sqrt(1+t.m00-t.m05-t.m10),e.w=(t.m06-t.m09)/i,e.x=.25*i,e.y=(t.m01+t.m04)/i,e.z=(t.m08+t.m02)/i):t.m05>t.m10?(i=2*Math.sqrt(1+t.m05-t.m00-t.m10),e.w=(t.m08-t.m02)/i,e.x=(t.m01+t.m04)/i,e.y=.25*i,e.z=(t.m06+t.m09)/i):(i=2*Math.sqrt(1+t.m10-t.m00-t.m05),e.w=(t.m01-t.m04)/i,e.x=(t.m08+t.m02)/i,e.y=(t.m06+t.m09)/i,e.z=.25*i),e},t.toRTS=function(e,t,n,i){i.x=Wn.set(si,e.m00,e.m01,e.m02).length(),ci.m00=e.m00/i.x,ci.m01=e.m01/i.x,ci.m02=e.m02/i.x,i.y=Wn.set(si,e.m04,e.m05,e.m06).length(),ci.m03=e.m04/i.y,ci.m04=e.m05/i.y,ci.m05=e.m06/i.y,i.z=Wn.set(si,e.m08,e.m09,e.m10).length(),ci.m06=e.m08/i.z,ci.m07=e.m09/i.z,ci.m08=e.m10/i.z,Kn.determinant(ci)<0&&(i.x*=-1,ci.m00*=-1,ci.m01*=-1,ci.m02*=-1),Jn.fromMat3(t,ci),Wn.set(n,e.m12,e.m13,e.m14)},t.fromRTS=function(e,t,n,i){var r=t.x,o=t.y,a=t.z,s=t.w,c=r+r,l=o+o,u=a+a,h=r*c,_=r*l,f=r*u,d=o*l,m=o*u,p=a*u,v=s*c,g=s*l,y=s*u,x=i.x,E=i.y,T=i.z;return e.m00=(1-(d+p))*x,e.m01=(_+y)*x,e.m02=(f-g)*x,e.m03=0,e.m04=(_-y)*E,e.m05=(1-(h+p))*E,e.m06=(m+v)*E,e.m07=0,e.m08=(f+g)*T,e.m09=(m-v)*T,e.m10=(1-(h+d))*T,e.m11=0,e.m12=n.x,e.m13=n.y,e.m14=n.z,e.m15=1,e},t.fromRTSOrigin=function(e,t,n,i,r){var o=t.x,a=t.y,s=t.z,c=t.w,l=o+o,u=a+a,h=s+s,_=o*l,f=o*u,d=o*h,m=a*u,p=a*h,v=s*h,g=c*l,y=c*u,x=c*h,E=i.x,T=i.y,S=i.z,A=r.x,C=r.y,w=r.z;return e.m00=(1-(m+v))*E,e.m01=(f+x)*E,e.m02=(d-y)*E,e.m03=0,e.m04=(f-x)*T,e.m05=(1-(_+v))*T,e.m06=(p+g)*T,e.m07=0,e.m08=(d+y)*S,e.m09=(p-g)*S,e.m10=(1-(_+m))*S,e.m11=0,e.m12=n.x+A-(e.m00*A+e.m04*C+e.m08*w),e.m13=n.y+C-(e.m01*A+e.m05*C+e.m09*w),e.m14=n.z+w-(e.m02*A+e.m06*C+e.m10*w),e.m15=1,e},t.fromQuat=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n+n,s=i+i,c=r+r,l=n*a,u=i*a,h=i*s,_=r*a,f=r*s,d=r*c,m=o*a,p=o*s,v=o*c;return e.m00=1-h-d,e.m01=u+v,e.m02=_-p,e.m03=0,e.m04=u-v,e.m05=1-l-d,e.m06=f+m,e.m07=0,e.m08=_+p,e.m09=f-m,e.m10=1-l-h,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e},t.frustum=function(e,t,n,i,r,o,a){var s=1/(n-t),c=1/(r-i),l=1/(o-a);return e.m00=2*o*s,e.m01=0,e.m02=0,e.m03=0,e.m04=0,e.m05=2*o*c,e.m06=0,e.m07=0,e.m08=(n+t)*s,e.m09=(r+i)*c,e.m10=(a+o)*l,e.m11=-1,e.m12=0,e.m13=0,e.m14=a*o*2*l,e.m15=0,e},t.perspective=function(e,t,n,i,r,o,a,s,c){void 0===o&&(o=!0),void 0===a&&(a=-1),void 0===s&&(s=1),void 0===c&&(c=0);var l=1/Math.tan(t/2),u=1/(i-r),h=o?l/n:l,_=(o?l:l*n)*s,f=oi[c];return e.m00=h*f[0],e.m01=h*f[1],e.m02=0,e.m03=0,e.m04=_*f[2],e.m05=_*f[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=(r-a*i)*u,e.m11=-1,e.m12=0,e.m13=0,e.m14=r*i*u*(1-a),e.m15=0,e},t.ortho=function(e,t,n,i,r,o,a,s,c,l){void 0===s&&(s=-1),void 0===c&&(c=1),void 0===l&&(l=0);var u=1/(t-n),h=1/(i-r)*c,_=1/(o-a),f=-2*u,d=-2*h,m=(t+n)*u,p=(r+i)*h,v=oi[l];return e.m00=f*v[0],e.m01=f*v[1],e.m02=0,e.m03=0,e.m04=d*v[2],e.m05=d*v[3],e.m06=0,e.m07=0,e.m08=0,e.m09=0,e.m10=_*(1-s),e.m11=0,e.m12=m*v[0]+p*v[2],e.m13=m*v[1]+p*v[3],e.m14=(o-s*a)*_,e.m15=1,e},t.lookAt=function(e,t,n,i){var r=t.x,o=t.y,a=t.z,s=i.x,c=i.y,l=i.z,u=r-n.x,h=o-n.y,_=a-n.z,f=1/Math.sqrt(u*u+h*h+_*_),d=c*(_*=f)-l*(h*=f),m=l*(u*=f)-s*_,p=s*h-c*u,v=h*(p*=f=1/Math.sqrt(d*d+m*m+p*p))-_*(m*=f),g=_*(d*=f)-u*p,y=u*m-h*d;return e.m00=d,e.m01=v,e.m02=u,e.m03=0,e.m04=m,e.m05=g,e.m06=h,e.m07=0,e.m08=p,e.m09=y,e.m10=_,e.m11=0,e.m12=-(d*r+m*o+p*a),e.m13=-(v*r+g*o+y*a),e.m14=-(u*r+h*o+_*a),e.m15=1,e},t.inverseTranspose=function(e,t){var n=t.m00,i=t.m01,r=t.m02,o=t.m03,a=t.m04,s=t.m05,c=t.m06,l=t.m07,u=t.m08,h=t.m09,_=t.m10,f=t.m11,d=t.m12,m=t.m13,p=t.m14,v=t.m15,g=n*s-i*a,y=n*c-r*a,x=n*l-o*a,E=i*c-r*s,T=i*l-o*s,S=r*l-o*c,A=u*m-h*d,C=u*p-_*d,w=u*v-f*d,b=h*p-_*m,I=h*v-f*m,R=_*v-f*p,O=g*R-y*I+x*b+E*w-T*C+S*A;return O?(O=1/O,e.m00=(s*R-c*I+l*b)*O,e.m01=(c*w-a*R-l*C)*O,e.m02=(a*I-s*w+l*A)*O,e.m03=0,e.m04=(r*I-i*R-o*b)*O,e.m05=(n*R-r*w+o*C)*O,e.m06=(i*w-n*I-o*A)*O,e.m07=0,e.m08=(m*S-p*T+v*E)*O,e.m09=(p*x-d*S-v*y)*O,e.m10=(d*T-m*x+v*g)*O,e.m11=0,e.m12=0,e.m13=0,e.m14=0,e.m15=1,e):null},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.m00,e[n+1]=t.m01,e[n+2]=t.m02,e[n+3]=t.m03,e[n+4]=t.m04,e[n+5]=t.m05,e[n+6]=t.m06,e[n+7]=t.m07,e[n+8]=t.m08,e[n+9]=t.m09,e[n+10]=t.m10,e[n+11]=t.m11,e[n+12]=t.m12,e[n+13]=t.m13,e[n+14]=t.m14,e[n+15]=t.m15,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.m00=t[n+0],e.m01=t[n+1],e.m02=t[n+2],e.m03=t[n+3],e.m04=t[n+4],e.m05=t[n+5],e.m06=t[n+6],e.m07=t[n+7],e.m08=t[n+8],e.m09=t[n+9],e.m10=t[n+10],e.m11=t[n+11],e.m12=t[n+12],e.m13=t[n+13],e.m14=t[n+14],e.m15=t[n+15],e},t.add=function(e,t,n){return e.m00=t.m00+n.m00,e.m01=t.m01+n.m01,e.m02=t.m02+n.m02,e.m03=t.m03+n.m03,e.m04=t.m04+n.m04,e.m05=t.m05+n.m05,e.m06=t.m06+n.m06,e.m07=t.m07+n.m07,e.m08=t.m08+n.m08,e.m09=t.m09+n.m09,e.m10=t.m10+n.m10,e.m11=t.m11+n.m11,e.m12=t.m12+n.m12,e.m13=t.m13+n.m13,e.m14=t.m14+n.m14,e.m15=t.m15+n.m15,e},t.subtract=function(e,t,n){return e.m00=t.m00-n.m00,e.m01=t.m01-n.m01,e.m02=t.m02-n.m02,e.m03=t.m03-n.m03,e.m04=t.m04-n.m04,e.m05=t.m05-n.m05,e.m06=t.m06-n.m06,e.m07=t.m07-n.m07,e.m08=t.m08-n.m08,e.m09=t.m09-n.m09,e.m10=t.m10-n.m10,e.m11=t.m11-n.m11,e.m12=t.m12-n.m12,e.m13=t.m13-n.m13,e.m14=t.m14-n.m14,e.m15=t.m15-n.m15,e},t.multiplyScalar=function(e,t,n){return e.m00=t.m00*n,e.m01=t.m01*n,e.m02=t.m02*n,e.m03=t.m03*n,e.m04=t.m04*n,e.m05=t.m05*n,e.m06=t.m06*n,e.m07=t.m07*n,e.m08=t.m08*n,e.m09=t.m09*n,e.m10=t.m10*n,e.m11=t.m11*n,e.m12=t.m12*n,e.m13=t.m13*n,e.m14=t.m14*n,e.m15=t.m15*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e.m00=t.m00+n.m00*i,e.m01=t.m01+n.m01*i,e.m02=t.m02+n.m02*i,e.m03=t.m03+n.m03*i,e.m04=t.m04+n.m04*i,e.m05=t.m05+n.m05*i,e.m06=t.m06+n.m06*i,e.m07=t.m07+n.m07*i,e.m08=t.m08+n.m08*i,e.m09=t.m09+n.m09*i,e.m10=t.m10+n.m10*i,e.m11=t.m11+n.m11*i,e.m12=t.m12+n.m12*i,e.m13=t.m13+n.m13*i,e.m14=t.m14+n.m14*i,e.m15=t.m15+n.m15*i,e},t.strictEquals=function(e,t){return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08&&e.m09===t.m09&&e.m10===t.m10&&e.m11===t.m11&&e.m12===t.m12&&e.m13===t.m13&&e.m14===t.m14&&e.m15===t.m15},t.equals=function(e,t,n){return void 0===n&&(n=Tn),Math.abs(e.m00-t.m00)<=n*Math.max(1,Math.abs(e.m00),Math.abs(t.m00))&&Math.abs(e.m01-t.m01)<=n*Math.max(1,Math.abs(e.m01),Math.abs(t.m01))&&Math.abs(e.m02-t.m02)<=n*Math.max(1,Math.abs(e.m02),Math.abs(t.m02))&&Math.abs(e.m03-t.m03)<=n*Math.max(1,Math.abs(e.m03),Math.abs(t.m03))&&Math.abs(e.m04-t.m04)<=n*Math.max(1,Math.abs(e.m04),Math.abs(t.m04))&&Math.abs(e.m05-t.m05)<=n*Math.max(1,Math.abs(e.m05),Math.abs(t.m05))&&Math.abs(e.m06-t.m06)<=n*Math.max(1,Math.abs(e.m06),Math.abs(t.m06))&&Math.abs(e.m07-t.m07)<=n*Math.max(1,Math.abs(e.m07),Math.abs(t.m07))&&Math.abs(e.m08-t.m08)<=n*Math.max(1,Math.abs(e.m08),Math.abs(t.m08))&&Math.abs(e.m09-t.m09)<=n*Math.max(1,Math.abs(e.m09),Math.abs(t.m09))&&Math.abs(e.m10-t.m10)<=n*Math.max(1,Math.abs(e.m10),Math.abs(t.m10))&&Math.abs(e.m11-t.m11)<=n*Math.max(1,Math.abs(e.m11),Math.abs(t.m11))&&Math.abs(e.m12-t.m12)<=n*Math.max(1,Math.abs(e.m12),Math.abs(t.m12))&&Math.abs(e.m13-t.m13)<=n*Math.max(1,Math.abs(e.m13),Math.abs(t.m13))&&Math.abs(e.m14-t.m14)<=n*Math.max(1,Math.abs(e.m14),Math.abs(t.m14))&&Math.abs(e.m15-t.m15)<=n*Math.max(1,Math.abs(e.m15),Math.abs(t.m15))};var n=t.prototype;return n.clone=function(){return new t(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},n.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,m){return void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===m&&(m=1),"object"==typeof e?(this.m01=e.m01,this.m02=e.m02,this.m03=e.m03,this.m04=e.m04,this.m05=e.m05,this.m06=e.m06,this.m07=e.m07,this.m08=e.m08,this.m09=e.m09,this.m10=e.m10,this.m11=e.m11,this.m12=e.m12,this.m13=e.m13,this.m14=e.m14,this.m15=e.m15,this.m00=e.m00):(this.m01=t,this.m02=n,this.m03=i,this.m04=r,this.m05=o,this.m06=a,this.m07=s,this.m08=c,this.m09=l,this.m10=u,this.m11=h,this.m12=_,this.m13=f,this.m14=d,this.m15=m,this.m00=e),this},n.equals=function(e,t){return void 0===t&&(t=Tn),Math.abs(this.m00-e.m00)<=t*Math.max(1,Math.abs(this.m00),Math.abs(e.m00))&&Math.abs(this.m01-e.m01)<=t*Math.max(1,Math.abs(this.m01),Math.abs(e.m01))&&Math.abs(this.m02-e.m02)<=t*Math.max(1,Math.abs(this.m02),Math.abs(e.m02))&&Math.abs(this.m03-e.m03)<=t*Math.max(1,Math.abs(this.m03),Math.abs(e.m03))&&Math.abs(this.m04-e.m04)<=t*Math.max(1,Math.abs(this.m04),Math.abs(e.m04))&&Math.abs(this.m05-e.m05)<=t*Math.max(1,Math.abs(this.m05),Math.abs(e.m05))&&Math.abs(this.m06-e.m06)<=t*Math.max(1,Math.abs(this.m06),Math.abs(e.m06))&&Math.abs(this.m07-e.m07)<=t*Math.max(1,Math.abs(this.m07),Math.abs(e.m07))&&Math.abs(this.m08-e.m08)<=t*Math.max(1,Math.abs(this.m08),Math.abs(e.m08))&&Math.abs(this.m09-e.m09)<=t*Math.max(1,Math.abs(this.m09),Math.abs(e.m09))&&Math.abs(this.m10-e.m10)<=t*Math.max(1,Math.abs(this.m10),Math.abs(e.m10))&&Math.abs(this.m11-e.m11)<=t*Math.max(1,Math.abs(this.m11),Math.abs(e.m11))&&Math.abs(this.m12-e.m12)<=t*Math.max(1,Math.abs(this.m12),Math.abs(e.m12))&&Math.abs(this.m13-e.m13)<=t*Math.max(1,Math.abs(this.m13),Math.abs(e.m13))&&Math.abs(this.m14-e.m14)<=t*Math.max(1,Math.abs(this.m14),Math.abs(e.m14))&&Math.abs(this.m15-e.m15)<=t*Math.max(1,Math.abs(this.m15),Math.abs(e.m15))},n.strictEquals=function(e){return this.m00===e.m00&&this.m01===e.m01&&this.m02===e.m02&&this.m03===e.m03&&this.m04===e.m04&&this.m05===e.m05&&this.m06===e.m06&&this.m07===e.m07&&this.m08===e.m08&&this.m09===e.m09&&this.m10===e.m10&&this.m11===e.m11&&this.m12===e.m12&&this.m13===e.m13&&this.m14===e.m14&&this.m15===e.m15},n.toString=function(){return"[\n"+this.m00+", "+this.m01+", "+this.m02+", "+this.m03+",\n"+this.m04+", "+this.m05+", "+this.m06+", "+this.m07+",\n"+this.m08+", "+this.m09+", "+this.m10+", "+this.m11+",\n"+this.m12+", "+this.m13+", "+this.m14+", "+this.m15+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},n.zero=function(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this},n.transpose=function(){var e=this.m01,t=this.m02,n=this.m03,i=this.m06,r=this.m07,o=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=e,this.m06=this.m09,this.m07=this.m13,this.m08=t,this.m09=i,this.m11=this.m14,this.m12=n,this.m13=r,this.m14=o,this},n.invert=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,_=this.m12,f=this.m13,d=this.m14,m=this.m15,p=e*o-t*r,v=e*a-n*r,g=e*s-i*r,y=t*a-n*o,x=t*s-i*o,E=n*s-i*a,T=c*f-l*_,S=c*d-u*_,A=c*m-h*_,C=l*d-u*f,w=l*m-h*f,b=u*m-h*d,I=p*b-v*w+g*C+y*A-x*S+E*T;return 0===I?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(I=1/I,this.m00=(o*b-a*w+s*C)*I,this.m01=(n*w-t*b-i*C)*I,this.m02=(f*E-d*x+m*y)*I,this.m03=(u*x-l*E-h*y)*I,this.m04=(a*A-r*b-s*S)*I,this.m05=(e*b-n*A+i*S)*I,this.m06=(d*g-_*E-m*v)*I,this.m07=(c*E-u*g+h*v)*I,this.m08=(r*w-o*A+s*T)*I,this.m09=(t*A-e*w-i*T)*I,this.m10=(_*x-f*g+m*p)*I,this.m11=(l*g-c*x-h*p)*I,this.m12=(o*S-r*C-a*T)*I,this.m13=(e*C-t*S+n*T)*I,this.m14=(f*v-_*y-d*p)*I,this.m15=(c*y-l*v+u*p)*I,this)},n.determinant=function(){var e=this.m00,t=this.m01,n=this.m02,i=this.m03,r=this.m04,o=this.m05,a=this.m06,s=this.m07,c=this.m08,l=this.m09,u=this.m10,h=this.m11,_=this.m12,f=this.m13,d=this.m14,m=this.m15;return(e*o-t*r)*(u*m-h*d)-(e*a-n*r)*(l*m-h*f)+(e*s-i*r)*(l*d-u*f)+(t*a-n*o)*(c*m-h*_)-(t*s-i*o)*(c*d-u*_)+(n*s-i*a)*(c*f-l*_)},n.add=function(e){return this.m00+=e.m00,this.m01+=e.m01,this.m02+=e.m02,this.m03+=e.m03,this.m04+=e.m04,this.m05+=e.m05,this.m06+=e.m06,this.m07+=e.m07,this.m08+=e.m08,this.m09+=e.m09,this.m10+=e.m10,this.m11+=e.m11,this.m12+=e.m12,this.m13+=e.m13,this.m14+=e.m14,this.m15+=e.m15,this},n.subtract=function(e){return this.m00-=e.m00,this.m01-=e.m01,this.m02-=e.m02,this.m03-=e.m03,this.m04-=e.m04,this.m05-=e.m05,this.m06-=e.m06,this.m07-=e.m07,this.m08-=e.m08,this.m09-=e.m09,this.m10-=e.m10,this.m11-=e.m11,this.m12-=e.m12,this.m13-=e.m13,this.m14-=e.m14,this.m15-=e.m15,this},n.multiply=function(e){var t=this.m00,n=this.m01,i=this.m02,r=this.m03,o=this.m04,a=this.m05,s=this.m06,c=this.m07,l=this.m08,u=this.m09,h=this.m10,_=this.m11,f=this.m12,d=this.m13,m=this.m14,p=this.m15,v=e.m00,g=e.m01,y=e.m02,x=e.m03;return this.m00=v*t+g*o+y*l+x*f,this.m01=v*n+g*a+y*u+x*d,this.m02=v*i+g*s+y*h+x*m,this.m03=v*r+g*c+y*_+x*p,v=e.m04,g=e.m05,y=e.m06,x=e.m07,this.m04=v*t+g*o+y*l+x*f,this.m05=v*n+g*a+y*u+x*d,this.m06=v*i+g*s+y*h+x*m,this.m07=v*r+g*c+y*_+x*p,v=e.m08,g=e.m09,y=e.m10,x=e.m11,this.m08=v*t+g*o+y*l+x*f,this.m09=v*n+g*a+y*u+x*d,this.m10=v*i+g*s+y*h+x*m,this.m11=v*r+g*c+y*_+x*p,v=e.m12,g=e.m13,y=e.m14,x=e.m15,this.m12=v*t+g*o+y*l+x*f,this.m13=v*n+g*a+y*u+x*d,this.m14=v*i+g*s+y*h+x*m,this.m15=v*r+g*c+y*_+x*p,this},n.multiplyScalar=function(e){return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=e,this.m05*=e,this.m06*=e,this.m07*=e,this.m08*=e,this.m09*=e,this.m10*=e,this.m11*=e,this.m12*=e,this.m13*=e,this.m14*=e,this.m15*=e,this},n.translate=function(e){return console.warn("function changed"),this.m12+=e.x,this.m13+=e.y,this.m14+=e.z,this},n.scale=function(e){var t=e.x,n=e.y,i=e.z;return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=n,this.m05*=n,this.m06*=n,this.m07*=n,this.m08*=i,this.m09*=i,this.m10*=i,this.m11*=i,this},n.rotate=function(e,t){var n=t.x,i=t.y,r=t.z,o=Math.sqrt(n*n+i*i+r*r);if(Math.abs(o)<Tn)return null;n*=o=1/o,i*=o,r*=o;var a=Math.sin(e),s=Math.cos(e),c=1-s,l=this.m00,u=this.m01,h=this.m02,_=this.m03,f=this.m04,d=this.m05,m=this.m06,p=this.m07,v=this.m08,g=this.m09,y=this.m10,x=this.m11,E=n*n*c+s,T=i*n*c+r*a,S=r*n*c-i*a,A=n*i*c-r*a,C=i*i*c+s,w=r*i*c+n*a,b=n*r*c+i*a,I=i*r*c-n*a,R=r*r*c+s;return this.m00=l*E+f*T+v*S,this.m01=u*E+d*T+g*S,this.m02=h*E+m*T+y*S,this.m03=_*E+p*T+x*S,this.m04=l*A+f*C+v*w,this.m05=u*A+d*C+g*w,this.m06=h*A+m*C+y*w,this.m07=_*A+p*C+x*w,this.m08=l*b+f*I+v*R,this.m09=u*b+d*I+g*R,this.m10=h*b+m*I+y*R,this.m11=_*b+p*I+x*R,this},n.getTranslation=function(e){return e.x=this.m12,e.y=this.m13,e.z=this.m14,e},n.getScale=function(e){var t=ci.m00=this.m00,n=ci.m01=this.m01,i=ci.m02=this.m02,r=ci.m03=this.m04,o=ci.m04=this.m05,a=ci.m05=this.m06,s=ci.m06=this.m08,c=ci.m07=this.m09,l=ci.m08=this.m10;return e.x=Math.sqrt(t*t+n*n+i*i),e.y=Math.sqrt(r*r+o*o+a*a),e.z=Math.sqrt(s*s+c*c+l*l),Kn.determinant(ci)<0&&(e.x*=-1),e},n.getRotation=function(e){var t=this.m00+this.m05+this.m10,n=0;return t>0?(n=2*Math.sqrt(t+1),e.w=.25*n,e.x=(this.m06-this.m09)/n,e.y=(this.m08-this.m02)/n,e.z=(this.m01-this.m04)/n):this.m00>this.m05&&this.m00>this.m10?(n=2*Math.sqrt(1+this.m00-this.m05-this.m10),e.w=(this.m06-this.m09)/n,e.x=.25*n,e.y=(this.m01+this.m04)/n,e.z=(this.m08+this.m02)/n):this.m05>this.m10?(n=2*Math.sqrt(1+this.m05-this.m00-this.m10),e.w=(this.m08-this.m02)/n,e.x=(this.m01+this.m04)/n,e.y=.25*n,e.z=(this.m06+this.m09)/n):(n=2*Math.sqrt(1+this.m10-this.m00-this.m05),e.w=(this.m01-this.m04)/n,e.x=(this.m08+this.m02)/n,e.y=(this.m06+this.m09)/n,e.z=.25*n),e},n.fromRTS=function(e,t,n){var i=e.x,r=e.y,o=e.z,a=e.w,s=i+i,c=r+r,l=o+o,u=i*s,h=i*c,_=i*l,f=r*c,d=r*l,m=o*l,p=a*s,v=a*c,g=a*l,y=n.x,x=n.y,E=n.z;return this.m00=(1-(f+m))*y,this.m01=(h+g)*y,this.m02=(_-v)*y,this.m03=0,this.m04=(h-g)*x,this.m05=(1-(u+m))*x,this.m06=(d+p)*x,this.m07=0,this.m08=(_+v)*E,this.m09=(d-p)*E,this.m10=(1-(u+f))*E,this.m11=0,this.m12=t.x,this.m13=t.y,this.m14=t.z,this.m15=1,this},n.fromQuat=function(e){var t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,a=n+n,s=i+i,c=t*o,l=n*o,u=n*a,h=i*o,_=i*a,f=i*s,d=r*o,m=r*a,p=r*s;return this.m00=1-u-f,this.m01=l+p,this.m02=h-m,this.m03=0,this.m04=l-p,this.m05=1-c-f,this.m06=_+d,this.m07=0,this.m08=h+m,this.m09=_-d,this.m10=1-c-u,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},t}(bt));ai.IDENTITY=Object.freeze(new ai);var si=new Wn,ci=new Kn;function li(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,m){return new ai(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,m)}vn.fastDefine("cc.Mat4",ai,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),c.Mat4=ai,c.mat4=li;var ui=e("bO",function(e){function t(t,n){var i;return i=e.call(this)||this,t&&"object"==typeof t?(i.x=t.x,i.y=t.y):(i.x=t||0,i.y=n||0),i}$(t,e),t.clone=function(e){return new t(e.x,e.y)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e},t.set=function(e,t,n){return e.x=t,e.y=n,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i},t.len=function(e){var t=e.x,n=e.y;return Math.sqrt(t*t+n*n)},t.lengthSqr=function(e){var t=e.x,n=e.y;return t*t+n*n},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e},t.inverse=function(e,t){return e.x=1/t.x,e.y=1/t.y,e},t.inverseSafe=function(e,t){var n=t.x,i=t.y;return Math.abs(n)<Tn?e.x=0:e.x=1/n,Math.abs(i)<Tn?e.y=0:e.y=1/i,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),e.x=n*r,e.y=i*r),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y},t.cross=function(e,t,n){return e.x=e.y=0,e.z=t.x*n.y-t.y*n.x,e},t.lerp=function(e,t,n,i){var r=t.x,o=t.y;return e.x=r+i*(n.x-r),e.y=o+i*(n.y-o),e},t.random=function(e,t){t=t||1;var n=2*On()*Math.PI;return e.x=Math.cos(n)*t,e.y=Math.sin(n)*t,e},t.transformMat3=function(e,t,n){var i=t.x,r=t.y;return e.x=n.m00*i+n.m03*r+n.m06,e.y=n.m01*i+n.m04*r+n.m07,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y;return e.x=n.m00*i+n.m04*r+n.m12,e.y=n.m01*i+n.m05*r+n.m13,e},t.str=function(e){return"Vec2("+e.x+", "+e.y+")"},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y},t.equals=function(e,t,n){return void 0===n&&(n=Tn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))},t.angle=function(e,n){t.normalize(hi,e),t.normalize(_i,n);var i=t.dot(hi,_i);return i>1?0:i<-1?Math.PI:Math.acos(i)};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y)},n.set=function(e,t){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0),this},n.equals=function(e,t){return void 0===t&&(t=Tn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))},n.equals2f=function(e,t,n){return void 0===n&&(n=Tn),Math.abs(this.x-e)<=n*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=n*Math.max(1,Math.abs(this.y),Math.abs(t))},n.strictEquals=function(e){return e&&this.x===e.x&&this.y===e.y},n.strictEquals2f=function(e,t){return this.x===e&&this.y===t},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},n.lerp=function(e,t){var n=this.x,i=this.y;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this},n.clampf=function(e,t){return this.x=Cn(this.x,e.x,t.x),this.y=Cn(this.y,e.y,t.y),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this},n.add2f=function(e,t){return this.x+=e,this.y+=t,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},n.subtract2f=function(e,t){return this.x-=e,this.y-=t,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=e,this.y*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this},n.multiply2f=function(e,t){return this.x*=e,this.y*=t,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this},n.divide2f=function(e,t){return this.x/=e,this.y/=t,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this},n.dot=function(e){return this.x*e.x+this.y*e.y},n.cross=function(e){return this.x*e.y-this.y*e.x},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y},n.normalize=function(){var e=this.x,t=this.y,n=e*e+t*t;return n>0&&(n=1/Math.sqrt(n),this.x*=n,this.y*=n),this},n.angle=function(e){var t=this.lengthSqr(),n=e.lengthSqr();if(0===t||0===n)return console.warn("Can't get angle between zero vector"),0;var i=this.dot(e)/Math.sqrt(t*n);return i=Cn(i,-1,1),Math.acos(i)},n.signAngle=function(e){var t=this.angle(e);return this.cross(e)<0?-t:t},n.rotate=function(e){var t=this.x,n=this.y,i=Math.sin(e),r=Math.cos(e);return this.x=r*t-i*n,this.y=i*t+r*n,this},n.project=function(e){var t=this.dot(e)/e.dot(e);return this.x=e.x*t,this.y=e.y*t,this},n.transformMat4=function(e){var t=this.x,n=this.y;return this.x=e.m00*t+e.m04*n+e.m12,this.y=e.m01*t+e.m05*n+e.m13,this},t}(bt));ui.ZERO=Object.freeze(new ui(0,0)),ui.ONE=Object.freeze(new ui(1,1)),ui.NEG_ONE=Object.freeze(new ui(-1,-1)),ui.UNIT_X=Object.freeze(new ui(1,0)),ui.UNIT_Y=Object.freeze(new ui(0,1));var hi=new ui,_i=new ui;function fi(e,t){return new ui(e,t)}vn.fastDefine("cc.Vec2",ui,{x:0,y:0}),c.Vec2=ui,c.v2=fi;var di=e("b6",function(e){function t(t,n,i,r){var o;return o=e.call(this)||this,t&&"object"==typeof t?(o.x=t.x,o.y=t.y,o.z=t.z,o.w=t.w):(o.x=t||0,o.y=n||0,o.z=i||0,o.w=r||0),o}$(t,e),t.clone=function(e){return new t(e.x,e.y,e.z,e.w)},t.copy=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},t.set=function(e,t,n,i,r){return e.x=t,e.y=n,e.z=i,e.w=r,e},t.add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e.w=t.w+n.w,e},t.subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e.w=t.w-n.w,e},t.multiply=function(e,t,n){return e.x=t.x*n.x,e.y=t.y*n.y,e.z=t.z*n.z,e.w=t.w*n.w,e},t.divide=function(e,t,n){return e.x=t.x/n.x,e.y=t.y/n.y,e.z=t.z/n.z,e.w=t.w/n.w,e},t.ceil=function(e,t){return e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z),e.w=Math.ceil(t.w),e},t.floor=function(e,t){return e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z),e.w=Math.floor(t.w),e},t.min=function(e,t,n){return e.x=Math.min(t.x,n.x),e.y=Math.min(t.y,n.y),e.z=Math.min(t.z,n.z),e.w=Math.min(t.w,n.w),e},t.max=function(e,t,n){return e.x=Math.max(t.x,n.x),e.y=Math.max(t.y,n.y),e.z=Math.max(t.z,n.z),e.w=Math.max(t.w,n.w),e},t.round=function(e,t){return e.x=Math.round(t.x),e.y=Math.round(t.y),e.z=Math.round(t.z),e.w=Math.round(t.w),e},t.multiplyScalar=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},t.scaleAndAdd=function(e,t,n,i){return e.x=t.x+n.x*i,e.y=t.y+n.y*i,e.z=t.z+n.z*i,e.w=t.w+n.w*i,e},t.distance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z,o=t.w-e.w;return Math.sqrt(n*n+i*i+r*r+o*o)},t.squaredDistance=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=t.z-e.z,o=t.w-e.w;return n*n+i*i+r*r+o*o},t.len=function(e){var t=e.x,n=e.y,i=e.z,r=e.w;return Math.sqrt(t*t+n*n+i*i+r*r)},t.lengthSqr=function(e){var t=e.x,n=e.y,i=e.z,r=e.w;return t*t+n*n+i*i+r*r},t.negate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=-t.w,e},t.inverse=function(e,t){return e.x=1/t.x,e.y=1/t.y,e.z=1/t.z,e.w=1/t.w,e},t.inverseSafe=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w;return Math.abs(n)<Tn?e.x=0:e.x=1/n,Math.abs(i)<Tn?e.y=0:e.y=1/i,Math.abs(r)<Tn?e.z=0:e.z=1/r,Math.abs(o)<Tn?e.w=0:e.w=1/o,e},t.normalize=function(e,t){var n=t.x,i=t.y,r=t.z,o=t.w,a=n*n+i*i+r*r+o*o;return a>0&&(a=1/Math.sqrt(a),e.x=n*a,e.y=i*a,e.z=r*a,e.w=o*a),e},t.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},t.lerp=function(e,t,n,i){return e.x=t.x+i*(n.x-t.x),e.y=t.y+i*(n.y-t.y),e.z=t.z+i*(n.z-t.z),e.w=t.w+i*(n.w-t.w),e},t.random=function(e,t){t=t||1;var n=2*On()*Math.PI,i=2*On()-1,r=Math.sqrt(1-i*i);return e.x=r*Math.cos(n)*t,e.y=r*Math.sin(n)*t,e.z=i*t,e.w=0,e},t.transformMat4=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w;return e.x=n.m00*i+n.m04*r+n.m08*o+n.m12*a,e.y=n.m01*i+n.m05*r+n.m09*o+n.m13*a,e.z=n.m02*i+n.m06*r+n.m10*o+n.m14*a,e.w=n.m03*i+n.m07*r+n.m11*o+n.m15*a,e},t.transformAffine=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=t.w;return e.x=n.m00*i+n.m01*r+n.m02*o+n.m03*a,e.y=n.m04*i+n.m05*r+n.m06*o+n.m07*a,e.x=n.m08*i+n.m09*r+n.m10*o+n.m11*a,e.w=t.w,e},t.transformQuat=function(e,t,n){var i=t.x,r=t.y,o=t.z,a=n.x,s=n.y,c=n.z,l=n.w,u=l*i+s*o-c*r,h=l*r+c*i-a*o,_=l*o+a*r-s*i,f=-a*i-s*r-c*o;return e.x=u*l+f*-a+h*-c-_*-s,e.y=h*l+f*-s+_*-a-u*-c,e.z=_*l+f*-c+u*-s-h*-a,e.w=t.w,e},t.toArray=function(e,t,n){return void 0===n&&(n=0),e[n+0]=t.x,e[n+1]=t.y,e[n+2]=t.z,e[n+3]=t.w,e},t.fromArray=function(e,t,n){return void 0===n&&(n=0),e.x=t[n+0],e.y=t[n+1],e.z=t[n+2],e.w=t[n+3],e},t.strictEquals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},t.equals=function(e,t,n){return void 0===n&&(n=Tn),Math.abs(e.x-t.x)<=n*Math.max(1,Math.abs(e.x),Math.abs(t.x))&&Math.abs(e.y-t.y)<=n*Math.max(1,Math.abs(e.y),Math.abs(t.y))&&Math.abs(e.z-t.z)<=n*Math.max(1,Math.abs(e.z),Math.abs(t.z))&&Math.abs(e.w-t.w)<=n*Math.max(1,Math.abs(e.w),Math.abs(t.w))};var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.z,this.w)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=i||0),this},n.equals=function(e,t){return void 0===t&&(t=Tn),Math.abs(this.x-e.x)<=t*Math.max(1,Math.abs(this.x),Math.abs(e.x))&&Math.abs(this.y-e.y)<=t*Math.max(1,Math.abs(this.y),Math.abs(e.y))&&Math.abs(this.z-e.z)<=t*Math.max(1,Math.abs(this.z),Math.abs(e.z))&&Math.abs(this.w-e.w)<=t*Math.max(1,Math.abs(this.w),Math.abs(e.w))},n.equals4f=function(e,t,n,i,r){return void 0===r&&(r=Tn),Math.abs(this.x-e)<=r*Math.max(1,Math.abs(this.x),Math.abs(e))&&Math.abs(this.y-t)<=r*Math.max(1,Math.abs(this.y),Math.abs(t))&&Math.abs(this.z-n)<=r*Math.max(1,Math.abs(this.z),Math.abs(n))&&Math.abs(this.w-i)<=r*Math.max(1,Math.abs(this.w),Math.abs(i))},n.strictEquals=function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},n.strictEquals4f=function(e,t,n,i){return this.x===e&&this.y===t&&this.z===n&&this.w===i},n.lerp=function(e,t){var n=this.x,i=this.y,r=this.z,o=this.w;return this.x=n+t*(e.x-n),this.y=i+t*(e.y-i),this.z=r+t*(e.z-r),this.w=o+t*(e.w-o),this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},n.clampf=function(e,t){return this.x=Cn(this.x,e.x,t.x),this.y=Cn(this.y,e.y,t.y),this.z=Cn(this.z,e.z,t.z),this.w=Cn(this.w,e.w,t.w),this},n.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},n.add4f=function(e,t,n,i){return this.x+=e,this.y+=t,this.z+=n,this.w+=i,this},n.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},n.subtract4f=function(e,t,n,i){return this.x-=e,this.y-=t,this.z-=n,this.w-=i,this},n.multiplyScalar=function(e){return"object"==typeof e&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},n.multiply=function(e){return"object"!=typeof e&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},n.multiply4f=function(e,t,n,i){return this.x*=e,this.y*=t,this.z*=n,this.w*=i,this},n.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this},n.divide4f=function(e,t,n,i){return this.x/=e,this.y/=t,this.z/=n,this.w/=i,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},n.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},n.cross=function(e){var t=this.x,n=this.y,i=this.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-i*o,this.y=i*r-t*a,this.z=t*o-n*r,this},n.length=function(){var e=this.x,t=this.y,n=this.z,i=this.w;return Math.sqrt(e*e+t*t+n*n+i*i)},n.lengthSqr=function(){var e=this.x,t=this.y,n=this.z,i=this.w;return e*e+t*t+n*n+i*i},n.normalize=function(){var e=this.x,t=this.y,n=this.z,i=this.w,r=e*e+t*t+n*n+i*i;return r>0&&(r=1/Math.sqrt(r),this.x=e*r,this.y=t*r,this.z=n*r,this.w=i*r),this},n.transformMat4=function(e){var t=this.x,n=this.y,i=this.z,r=this.w;return this.x=e.m00*t+e.m04*n+e.m08*i+e.m12*r,this.y=e.m01*t+e.m05*n+e.m09*i+e.m13*r,this.z=e.m02*t+e.m06*n+e.m10*i+e.m14*r,this.w=e.m03*t+e.m07*n+e.m11*i+e.m15*r,this},t}(bt));function mi(e,t,n,i){return new di(e,t,n,i)}di.ZERO=Object.freeze(new di(0,0,0,0)),di.ONE=Object.freeze(new di(1,1,1,1)),di.NEG_ONE=Object.freeze(new di(-1,-1,-1,-1)),vn.fastDefine("cc.Vec4",di,{x:0,y:0,z:0,w:0}),c.Vec4=di,c.v4=mi,ve(ui,"Vec2",[{name:"sub",newName:"subtract",target:ui,targetName:"Vec2"},{name:"mul",newName:"multiply",target:ui,targetName:"Vec2"},{name:"div",newName:"divide",target:ui,targetName:"Vec2"},{name:"dist",newName:"distance",target:ui,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:ui,targetName:"Vec2"},{name:"mag",newName:"len",target:ui,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:ui,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:ui,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:ui,targetName:"Vec2"}]),ve(ui.prototype,"Vec2",[{name:"mag",newName:"length",target:ui.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:ui.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:ui.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:ui.prototype,targetName:"Vec2"}]),ve(Wn,"Vec3",[{name:"sub",newName:"subtract",target:Wn,targetName:"Vec3"},{name:"mul",newName:"multiply",target:Wn,targetName:"Vec3"},{name:"div",newName:"divide",target:Wn,targetName:"Vec3"},{name:"dist",newName:"distance",target:Wn,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:Wn,targetName:"Vec3"},{name:"mag",newName:"len",target:Wn,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:Wn,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Wn,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Wn,targetName:"Vec3"}]),ve(Wn.prototype,"Vec3",[{name:"mag",newName:"length",target:Wn.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:Wn.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Wn.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Wn.prototype,targetName:"Vec3"}]),ve(di,"Vec4",[{name:"sub",newName:"subtract",target:di,targetName:"Vec4"},{name:"mul",newName:"multiply",target:di,targetName:"Vec4"},{name:"div",newName:"divide",target:di,targetName:"Vec4"},{name:"dist",newName:"distance",target:di,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:di,targetName:"Vec4"},{name:"mag",newName:"len",target:di,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:di,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:di,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:di,targetName:"Vec4"}]),ve(di.prototype,"Vec4",[{name:"mag",newName:"length",target:di.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:di.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:di.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:di.prototype,targetName:"Vec4"}]),ve(Jn,"Quat",[{name:"mag",newName:"len",target:Jn,targetName:"Quat"},{name:"mul",newName:"multiply",target:Jn,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:Jn,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:Jn,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Jn,targetName:"Quat"}]),ve(Jn.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:Jn.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:Jn.prototype,targetName:"Quat"}]),ve(Vn,"Color",[{name:"sub",newName:"subtract",target:Vn,targetName:"Color"},{name:"mul",newName:"multiply",target:Vn,targetName:"Color"},{name:"div",newName:"divide",target:Vn,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:Vn,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[1].toString(16);return c.Color.fromHEX(t[0],i)}}]),ve(Kn,"Mat3",[{name:"sub",newName:"subtract",target:Kn,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Kn,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Kn,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:Kn,targetName:"Mat3"}]),ve(Kn.prototype,"Mat3",[{name:"sub",newName:"subtract",target:Kn.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Kn.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:Kn.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Kn.prototype,targetName:"Mat3"}]),ve(ai,"Mat4",[{name:"sub",newName:"subtract",target:ai,targetName:"Mat4"},{name:"mul",newName:"multiply",target:ai,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:ai,targetName:"Mat4"}]),ve(ai.prototype,"Mat4",[{name:"sub",newName:"subtract",target:ai.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:ai.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:ai.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:ai.prototype,targetName:"Mat4"}]);var pi=e("dP",function(){function e(e,t,n,i,r,o){void 0===e&&(e=1),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=0),this.a=e,this.b=t,this.c=n,this.d=i,this.tx=r,this.ty=o}return e.identity=function(){return new e},e.clone=function(t){return new e(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.concat=function(e,t,n){var i=t.a,r=t.b,o=t.c,a=t.d,s=t.tx,c=t.ty;e.a=i*n.a+r*n.c,e.b=i*n.b+r*n.d,e.c=o*n.a+a*n.c,e.d=o*n.b+a*n.d,e.tx=s*n.a+c*n.c+n.tx,e.ty=s*n.b+c*n.d+n.ty},e.invert=function(e,t){var n=1/(t.a*t.d-t.b*t.c);e.a=n*t.d,e.b=-n*t.b,e.c=-n*t.c,e.d=n*t.a,e.tx=n*(t.c*t.ty-t.d*t.tx),e.ty=n*(t.b*t.tx-t.a*t.ty)},e.fromMat4=function(e,t){e.a=t.m00,e.b=t.m01,e.c=t.m04,e.d=t.m05,e.tx=t.m12,e.ty=t.m13},e.transformVec2=function(e,t,n,i){var r,o;void 0===i?(i=n,r=t.x,o=t.y):(r=t,o=n),e.x=i.a*r+i.c*o+i.tx,e.y=i.b*r+i.d*o+i.ty},e.transformSize=function(e,t,n){e.width=n.a*t.width+n.c*t.height,e.height=n.b*t.width+n.d*t.height},e.transformRect=function(e,t,n){var i=t.x+t.width,r=t.y+t.height,o=n.a*t.x+n.c*t.y+n.tx,a=n.b*t.x+n.d*t.y+n.ty,s=n.a*i+n.c*t.y+n.tx,c=n.b*i+n.d*t.y+n.ty,l=n.a*t.x+n.c*r+n.tx,u=n.b*t.x+n.d*r+n.ty,h=n.a*i+n.c*r+n.tx,_=n.b*i+n.d*r+n.ty,f=Math.min(o,s,l,h),d=Math.max(o,s,l,h),m=Math.min(a,c,u,_),p=Math.max(a,c,u,_);e.x=f,e.y=m,e.width=d-f,e.height=p-m},e.transformObb=function(e,t,n,i,r,o){var a=o.a*r.x+o.c*r.y+o.tx,s=o.b*r.x+o.d*r.y+o.ty,c=o.a*r.width,l=o.b*r.width,u=o.c*r.height,h=o.d*r.height;t.x=a,t.y=s,n.x=c+a,n.y=l+s,e.x=u+a,e.y=h+s,i.x=c+u+a,i.y=l+h+s},e}());c.AffineTransform=pi;var vi=e("bS",function(e){function t(t,n){var i;return i=e.call(this)||this,t&&"object"==typeof t?(i.width=t.width,i.height=t.height):(i.width=t||0,i.height=n||0),i}$(t,e),t.lerp=function(e,t,n,i){return e.width=t.width+(n.width-t.width)*i,e.height=t.height+(n.height-t.height)*i,e},Z(t,[{key:"x",set:function(e){this.width=e},get:function(){return this.width}},{key:"y",set:function(e){this.height=e},get:function(){return this.height}}]);var n=t.prototype;return n.clone=function(){return new t(this.width,this.height)},n.set=function(e,t){return e&&"object"==typeof e?(this.height=e.height,this.width=e.width):(this.width=e||0,this.height=t||0),this},n.equals=function(e){return this.width===e.width&&this.height===e.height},n.lerp=function(e,t){return this.width+=(e.width-this.width)*t,this.height+=(e.height-this.height)*t,this},n.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},t}(bt));function gi(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),new vi(e,t)}vi.ZERO=Object.freeze(new vi(0,0)),vi.ONE=Object.freeze(new vi(1,1)),vn.fastDefine("cc.Size",vi,{width:0,height:0}),c.size=gi,c.Size=vi;var yi=e("bR",function(e){function t(t,n,i,r){var o;return(o=e.call(this)||this).T=void 0,t&&"object"==typeof t?(o.y=t.y,o.width=t.width,o.height=t.height,o.x=t.x):(o.x=t||0,o.y=n||0,o.width=i||0,o.height=r||0),o}$(t,e),t.fromMinMax=function(e,t,n){var i=Math.min(t.x,n.x),r=Math.min(t.y,n.y),o=Math.max(t.x,n.x),a=Math.max(t.y,n.y);return e.x=i,e.y=r,e.width=o-i,e.height=a-r,e},t.lerp=function(e,t,n,i){var r=t.x,o=t.y,a=t.width,s=t.height;return e.x=r+(n.x-r)*i,e.y=o+(n.y-o)*i,e.width=a+(n.width-a)*i,e.height=s+(n.height-s)*i,e},t.intersection=function(e,t,n){var i=t.x,r=t.y,o=t.x+t.width,a=t.y+t.height,s=n.x,c=n.y,l=n.x+n.width,u=n.y+n.height;return e.x=Math.max(i,s),e.y=Math.max(r,c),e.width=Math.min(o,l)-e.x,e.height=Math.min(a,u)-e.y,e},t.union=function(e,t,n){var i=t.x,r=t.y,o=t.width,a=t.height,s=n.x,c=n.y,l=n.width,u=n.height;return e.x=Math.min(i,s),e.y=Math.min(r,c),e.width=Math.max(i+o,s+l)-e.x,e.height=Math.max(r+a,c+u)-e.y,e},Z(t,[{key:"xMin",get:function(){return this.x},set:function(e){this.width+=this.x-e,this.x=e}},{key:"yMin",get:function(){return this.y},set:function(e){this.height+=this.y-e,this.y=e}},{key:"xMax",get:function(){return this.x+this.width},set:function(e){this.width=e-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(e){this.height=e-this.y}},{key:"center",get:function(){return new ui(this.x+.5*this.width,this.y+.5*this.height)},set:function(e){this.x=e.x-.5*this.width,this.y=e.y-.5*this.height}},{key:"origin",get:function(){return new ui(this.x,this.y)},set:function(e){this.x=e.x,this.y=e.y}},{key:"size",get:function(){return new vi(this.width,this.height)},set:function(e){this.width=e.width,this.height=e.height}},{key:"z",set:function(e){this.width=e},get:function(){return this.width}},{key:"w",set:function(e){this.height=e},get:function(){return this.height}}]);var n=t.prototype;return n.clone=function(){return new t(this.x,this.y,this.width,this.height)},n.set=function(e,t,n,i){return e&&"object"==typeof e?(this.y=e.y,this.width=e.width,this.height=e.height,this.x=e.x):(this.x=e||0,this.y=t||0,this.width=n||0,this.height=i||0),this},n.equals=function(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height},n.lerp=function(e,t){var n=this.x,i=this.y,r=this.width,o=this.height;return this.x=n+(e.x-n)*t,this.y=i+(e.y-i)*t,this.width=r+(e.width-r)*t,this.height=o+(e.height-o)*t,this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n.intersects=function(e){var t=this.x+this.width,n=this.y+this.height,i=e.x+e.width,r=e.y+e.height;return!(t<e.x||i<this.x||n<e.y||r<this.y)},n.contains=function(e){return this.x<=e.x&&this.x+this.width>=e.x&&this.y<=e.y&&this.y+this.height>=e.y},n.containsRect=function(e){return this.x<=e.x&&this.x+this.width>=e.x+e.width&&this.y<=e.y&&this.y+this.height>=e.y+e.height},n.transformMat4=function(e){var t=this.x,n=this.y,i=t+this.width,r=n+this.height,o=e.m00*t+e.m04*n+e.m12,a=e.m01*t+e.m05*n+e.m13,s=e.m00*i+e.m04*n+e.m12,c=e.m01*i+e.m05*n+e.m13,l=e.m00*t+e.m04*r+e.m12,u=e.m01*t+e.m05*r+e.m13,h=e.m00*i+e.m04*r+e.m12,_=e.m01*i+e.m05*r+e.m13,f=Math.min(o,s,l,h),d=Math.max(o,s,l,h),m=Math.min(a,c,u,_),p=Math.max(a,c,u,_);return this.x=f,this.y=m,this.width=d-f,this.height=p-m,this},n.transformMat4ToPoints=function(e,t,n,i,r){var o=this.x,a=this.y,s=o+this.width,c=a+this.height;t.x=e.m00*o+e.m04*a+e.m12,t.y=e.m01*o+e.m05*a+e.m13,r.x=e.m00*s+e.m04*a+e.m12,r.y=e.m01*s+e.m05*a+e.m13,n.x=e.m00*o+e.m04*c+e.m12,n.y=e.m01*o+e.m05*c+e.m13,i.x=e.m00*s+e.m04*c+e.m12,i.y=e.m01*s+e.m05*c+e.m13},t}(bt));function xi(e,t,n,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),new yi(e,t,n,i)}vn.fastDefine("cc.Rect",yi,{x:0,y:0,width:0,height:0}),c.Rect=yi,c.rect=xi;var Ei=Object.freeze({__proto__:null,bits:pe,Vec2:ui,v2:fi,Vec3:Wn,v3:Xn,Vec4:di,v4:mi,Quat:Jn,quat:ri,Mat3:Kn,Mat4:ai,mat4:li,AffineTransform:pi,Size:vi,size:gi,Rect:yi,rect:xi,Color:Vn,color:jn,EPSILON:Tn,equals:Sn,approx:An,clamp:Cn,clamp01:wn,lerp:bn,toRadian:In,toDegree:Rn,random:On,randomRange:Nn,randomRangeInt:Pn,pseudoRandom:Mn,pseudoRandomRange:Dn,pseudoRandomRangeInt:Ln,nextPow2:Fn,repeat:zn,pingPong:Bn,inverseLerp:Un,absMaxComponent:Gn,absMax:Hn});e("dG",Ei);var Ti,Si,Ai,Ci,wi,bi,Ii,Ri,Oi,Ni,Pi,Mi,Di,Li,Fi,zi,Bi,Ui,Gi,Hi,ki,Vi,ji,Wi,qi=function(){function e(e,t,n){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=n*(1<<t)}return e.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},e}(),Yi=function(e,t){},Xi=function(){function e(e){}var t=e.prototype;return t.alloc=function(e,t){return new ArrayBuffer(t)},t.free=function(e){},e}();!function(e){e[e.UINT32=0]="UINT32",e[e.FLOAT32=1]="FLOAT32",e[e.NEVER=2]="NEVER"}(Wi||(Wi={}));var Ki,Qi=function(){function e(e,t,n,i){void 0===i&&(i=8),this._dataType=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freelists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=n.COUNT,this._entryBits=i,this._dataType=t,this._stride=4*this._elementCount,this._entriesPerChunk=1<<i,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new qi(e,i,this._stride);var r=Wi.NEVER,o=!1,a=!1;for(var s in t){if(o=this._hasFloat32,(a=this._hasUint32)&&o)break;r=t[s],o||r!==Wi.FLOAT32?a||r!==Wi.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var t=e.prototype;return t.alloc=function(){for(var e=0;e<this._freelists.length;e++){var t=this._freelists[e];if(t.length){var n=t[t.length-1];return t.length--,(e<<this._entryBits)+n+this._poolFlag}}for(var i=this._nativePool.allocateNewChunk(),r=[],o=[],a=[],s=this._hasFloat32,c=this._hasUint32,l=0;l<this._entriesPerChunk;l++)s&&r.push(new Float32Array(i,this._stride*l,this._elementCount)),c&&o.push(new Uint32Array(i,this._stride*l,this._elementCount)),l&&a.push(l);return this._arrayBuffers.push(i),c&&this._uint32BufferViews.push(o),s&&this._float32BufferViews.push(r),this._freelists.push(a),(e<<this._entryBits)+this._poolFlag},t.get=function(e,t){var n=(this._chunkMask&e)>>this._entryBits,i=this._entryMask&e,r=this._dataType[t]===Wi.UINT32?this._uint32BufferViews:this._float32BufferViews;return!e||n<0||n>=r.length||i<0||i>=this._entriesPerChunk||this._freelists[n].find((function(e){return e===i}))?(console.warn("invalid buffer pool handle"),0):r[n][i][t]},t.set=function(e,t,n){var i=(this._chunkMask&e)>>this._entryBits,r=this._entryMask&e,o=this._dataType[t]===Wi.UINT32?this._uint32BufferViews:this._float32BufferViews;!e||i<0||i>=o.length||r<0||r>=this._entriesPerChunk||this._freelists[i].find((function(e){return e===r}))?console.warn("invalid buffer pool handle"):o[i][r][t]=n},t.setVec2=function(e,t,n){},t.setVec3=function(e,t,n){},t.setVec4=function(e,t,n){},t.setMat4=function(e,t,n){},t.free=function(e){var t=(this._chunkMask&e)>>this._entryBits,n=this._entryMask&e;!e||t<0||t>=this._freelists.length||n<0||n>=this._entriesPerChunk||this._freelists[t].find((function(e){return e===n}))?console.warn("invalid buffer pool handle"):((this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[t][n].fill(0),this._freelists[t].push(n))},e}(),Zi=function(){function e(e,t,n){this._ctor=void 0,this._dtor=void 0,this._indexMask=void 0,this._poolFlag=void 0,this._array=[],this._freelist=[],this._nativePool=void 0,this._ctor=t,n&&(this._dtor=n),this._poolFlag=1<<29,this._indexMask=~this._poolFlag,this._nativePool=new Yi(e,this._array)}var t=e.prototype;return t.alloc=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this._freelist,r=-1;if(i.length)r=i[i.length-1],i.length--,this._array[r]=this._ctor(arguments,this._array[r]);else{r=this._array.length;var o=this._ctor(arguments);if(!o)return 0;this._array.push(o)}return r+this._poolFlag},t.get=function(e){var t=this._indexMask&e;return!e||t<0||t>=this._array.length||this._freelist.find((function(e){return e===t}))?(console.warn("invalid object pool handle"),null):this._array[t]},t.free=function(e){var t=this._indexMask&e;!e||t<0||t>=this._array.length||this._freelist.find((function(e){return e===t}))?console.warn("invalid object pool handle"):(this._dtor&&(this._array[t]=this._dtor(this._array[t])),this._freelist.push(t))},e}(),Ji=function(){function e(e){this._nativeBufferAllocator=void 0,this._buffers=new Map,this._nextBufferIdx=0,this._poolFlag=void 0,this._bufferIdxMask=void 0,this._poolFlag=1<<30,this._bufferIdxMask=~this._poolFlag,this._nativeBufferAllocator=new Xi(e)}var t=e.prototype;return t.alloc=function(e){var t=this._nextBufferIdx++,n=this._nativeBufferAllocator.alloc(t,e);return this._buffers.set(t,n),t|this._poolFlag},t.free=function(e){var t=this._bufferIdxMask&e;this._buffers.get(t)?(this._nativeBufferAllocator.free(t),this._buffers.delete(t)):console.warn("invalid buffer allocator handle")},t.getBuffer=function(e){var t=this._bufferIdxMask&e;return this._buffers.get(t)||(console.warn("invalid array pool index or invalid array handle"),null)},e}(),$i=function(e){function t(t,n,i,r){var o;return(o=e.call(this,t)||this)._viewCtor=void 0,o._size=void 0,o._step=void 0,o._viewCtor=n,o._size=i*n.BYTES_PER_ELEMENT,o._step=r||i,o}$(t,e);var n=t.prototype;return n.alloc=function(){var e=this._nextBufferIdx++,t=this._nativeBufferAllocator.alloc(e,this._size);return this._buffers.set(e,new this._viewCtor(t)),e|this._poolFlag},n.getBuffer=function(e){return null},n.assign=function(e,t,n){var i=this._bufferIdxMask&e,r=this._buffers.get(i);if(r){var o=t+1;if(o>=r.length){for(var a=r.length;o>=a;)a+=this._step;a*=this._viewCtor.BYTES_PER_ELEMENT;var s=new this._viewCtor(this._nativeBufferAllocator.alloc(i,a));s.set(r),r=s,this._buffers.set(i,r)}r[o]=n;var c=r[0];r[0]=o>c?o:c}else console.warn("invalid array pool handle")},n.erase=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);if(!i||t>=i[0])console.warn("invalid array pool index or invalid array handle");else{for(var r=t+1;r<i[0];++r)i[r]=i[r+1];--i[0]}},n.push=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);i?this.assign(e,i[0],t):console.warn("invalid array pool handle")},n.pop=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);n?0!==n[0]&&--n[0]:console.warn("invalid array pool handle")},n.clear=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);n?n[0]=0:console.warn("invalid array pool handle")},n.get=function(e,t){var n=this._bufferIdxMask&e,i=this._buffers.get(n);return!i||t>=i[0]?(console.warn("invalid array pool handle"),0):i[t+1]},n.length=function(e){var t=this._bufferIdxMask&e,n=this._buffers.get(t);return n?n[0]:(console.warn("invalid array pool handle"),0)},t}(Ji);function er(e,t,n,i){void 0===i&&(i=!0);for(var r=t.length(e),o=0;o<r;o++){var a=t.get(e,o);a&&n.free(a)}i?t.free(e):t.clear(e)}!function(e){e[e.ATTRIBUTE=0]="ATTRIBUTE",e[e.DESCRIPTOR_SETS=1]="DESCRIPTOR_SETS",e[e.SHADER=2]="SHADER",e[e.INPUT_ASSEMBLER=3]="INPUT_ASSEMBLER",e[e.PIPELINE_LAYOUT=4]="PIPELINE_LAYOUT",e[e.FRAMEBUFFER=5]="FRAMEBUFFER",e[e.PASS=100]="PASS",e[e.SUB_MODEL=101]="SUB_MODEL",e[e.MODEL=102]="MODEL",e[e.SCENE=103]="SCENE",e[e.CAMERA=104]="CAMERA",e[e.NODE=105]="NODE",e[e.ROOT=106]="ROOT",e[e.AABB=107]="AABB",e[e.RENDER_WINDOW=108]="RENDER_WINDOW",e[e.FRUSTUM=109]="FRUSTUM",e[e.AMBIENT=110]="AMBIENT",e[e.FOG=111]="FOG",e[e.SKYBOX=112]="SKYBOX",e[e.SHADOW=113]="SHADOW",e[e.LIGHT=114]="LIGHT",e[e.SPHERE=115]="SPHERE",e[e.INSTANCED_ATTRIBUTE=116]="INSTANCED_ATTRIBUTE",e[e.FLAT_BUFFER=117]="FLAT_BUFFER",e[e.SUB_MESH=118]="SUB_MESH",e[e.RASTERIZER_STATE=119]="RASTERIZER_STATE",e[e.DEPTH_STENCIL_STATE=120]="DEPTH_STENCIL_STATE",e[e.BLEND_TARGET=121]="BLEND_TARGET",e[e.BLEND_STATE=122]="BLEND_STATE",e[e.BATCH_2D=123]="BATCH_2D",e[e.SUB_MODEL_ARRAY=200]="SUB_MODEL_ARRAY",e[e.MODEL_ARRAY=201]="MODEL_ARRAY",e[e.ATTRIBUTE_ARRAY=202]="ATTRIBUTE_ARRAY",e[e.FLAT_BUFFER_ARRAY=203]="FLAT_BUFFER_ARRAY",e[e.INSTANCED_BUFFER_ARRAY=204]="INSTANCED_BUFFER_ARRAY",e[e.LIGHT_ARRAY=205]="LIGHT_ARRAY",e[e.BLEND_TARGET_ARRAY=206]="BLEND_TARGET_ARRAY",e[e.BATCH_ARRAY_2D=207]="BATCH_ARRAY_2D",e[e.RAW_BUFFER=300]="RAW_BUFFER",e[e.RAW_OBJECT=400]="RAW_OBJECT"}(Ki||(Ki={}));var tr,nr=e("cm",0),ir=new Zi(Ki.SHADER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createShader(e[1])}),(function(e){return e&&e.destroy(),e})),rr=e("cy",new Zi(Ki.DESCRIPTOR_SETS,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createDescriptorSet(e[1])}),(function(e){return e&&e.destroy(),e}))),or=e("cl",new Zi(Ki.INPUT_ASSEMBLER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createInputAssembler(e[1])}),(function(e){return e&&e.destroy(),e}))),ar=new Zi(Ki.PIPELINE_LAYOUT,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createPipelineLayout(e[1])}),(function(e){return e&&e.destroy(),e})),sr=new Zi(Ki.FRAMEBUFFER,(function(e,t){return t?(t.initialize(e[1]),t):e[0].createFramebuffer(e[1])}),(function(e){return e&&e.destroy(),e})),cr=new $i(Ki.SUB_MODEL_ARRAY,Uint32Array,8,4),lr=new $i(Ki.MODEL_ARRAY,Uint32Array,32,16),ur=new $i(Ki.ATTRIBUTE_ARRAY,Uint32Array,8,4),hr=new $i(Ki.FLAT_BUFFER_ARRAY,Uint32Array,8,4),_r=new $i(Ki.LIGHT_ARRAY,Uint32Array,8,4),fr=new $i(Ki.BLEND_TARGET_ARRAY,Uint32Array,8,4),dr=new $i(Ki.BATCH_ARRAY_2D,Uint32Array,32,16),mr=new Ji(Ki.RAW_BUFFER),pr=new Zi(Ki.RAW_OBJECT,(function(e){return e[0]||{}}),(function(e){}));!function(e){e[e.PRIORITY=0]="PRIORITY",e[e.STAGE=1]="STAGE",e[e.PHASE=2]="PHASE",e[e.BATCHING_SCHEME=3]="BATCHING_SCHEME",e[e.PRIMITIVE=4]="PRIMITIVE",e[e.DYNAMIC_STATES=5]="DYNAMIC_STATES",e[e.HASH=6]="HASH",e[e.RASTERIZER_STATE=7]="RASTERIZER_STATE",e[e.DEPTH_STENCIL_STATE=8]="DEPTH_STENCIL_STATE",e[e.BLEND_STATE=9]="BLEND_STATE",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.PIPELINE_LAYOUT=11]="PIPELINE_LAYOUT",e[e.COUNT=12]="COUNT"}(tr||(tr={}));var vr,gr=((Ti={})[tr.PRIORITY]=Wi.UINT32,Ti[tr.STAGE]=Wi.UINT32,Ti[tr.PHASE]=Wi.UINT32,Ti[tr.BATCHING_SCHEME]=Wi.UINT32,Ti[tr.PRIMITIVE]=Wi.UINT32,Ti[tr.DYNAMIC_STATES]=Wi.UINT32,Ti[tr.HASH]=Wi.UINT32,Ti[tr.RASTERIZER_STATE]=Wi.UINT32,Ti[tr.DEPTH_STENCIL_STATE]=Wi.UINT32,Ti[tr.BLEND_STATE]=Wi.UINT32,Ti[tr.DESCRIPTOR_SET]=Wi.UINT32,Ti[tr.PIPELINE_LAYOUT]=Wi.UINT32,Ti[tr.COUNT]=Wi.NEVER,Ti),yr=e("cr",new Qi(Ki.PASS,gr,tr));!function(e){e[e.PRIORITY=0]="PRIORITY",e[e.PASS_COUNT=1]="PASS_COUNT",e[e.PASS_0=2]="PASS_0",e[e.PASS_1=3]="PASS_1",e[e.PASS_2=4]="PASS_2",e[e.PASS_3=5]="PASS_3",e[e.SHADER_0=6]="SHADER_0",e[e.SHADER_1=7]="SHADER_1",e[e.SHADER_2=8]="SHADER_2",e[e.SHADER_3=9]="SHADER_3",e[e.PLANAR_SHADER=10]="PLANAR_SHADER",e[e.DESCRIPTOR_SET=11]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=12]="INPUT_ASSEMBLER",e[e.SUB_MESH=13]="SUB_MESH",e[e.COUNT=14]="COUNT"}(vr||(vr=e("cw",{})));var xr,Er=((Si={})[vr.PRIORITY]=Wi.UINT32,Si[vr.PASS_COUNT]=Wi.UINT32,Si[vr.PASS_0]=Wi.UINT32,Si[vr.PASS_1]=Wi.UINT32,Si[vr.PASS_2]=Wi.UINT32,Si[vr.PASS_3]=Wi.UINT32,Si[vr.SHADER_0]=Wi.UINT32,Si[vr.SHADER_1]=Wi.UINT32,Si[vr.SHADER_2]=Wi.UINT32,Si[vr.SHADER_3]=Wi.UINT32,Si[vr.PLANAR_SHADER]=Wi.UINT32,Si[vr.DESCRIPTOR_SET]=Wi.UINT32,Si[vr.INPUT_ASSEMBLER]=Wi.UINT32,Si[vr.SUB_MESH]=Wi.UINT32,Si[vr.COUNT]=Wi.NEVER,Si),Tr=e("cv",new Qi(Ki.SUB_MODEL,Er,vr));!function(e){e[e.ENABLED=0]="ENABLED",e[e.VIS_FLAGS=1]="VIS_FLAGS",e[e.CAST_SHADOW=2]="CAST_SHADOW",e[e.RECEIVE_SHADOW=3]="RECEIVE_SHADOW",e[e.WORLD_BOUNDS=4]="WORLD_BOUNDS",e[e.NODE=5]="NODE",e[e.TRANSFORM=6]="TRANSFORM",e[e.SUB_MODEL_ARRAY=7]="SUB_MODEL_ARRAY",e[e.INSTANCED_BUFFER=8]="INSTANCED_BUFFER",e[e.INSTANCED_ATTR_ARRAY=9]="INSTANCED_ATTR_ARRAY",e[e.COUNT=10]="COUNT"}(xr||(xr={}));var Sr,Ar=((Ai={})[xr.ENABLED]=Wi.UINT32,Ai[xr.VIS_FLAGS]=Wi.UINT32,Ai[xr.CAST_SHADOW]=Wi.UINT32,Ai[xr.RECEIVE_SHADOW]=Wi.UINT32,Ai[xr.WORLD_BOUNDS]=Wi.UINT32,Ai[xr.NODE]=Wi.UINT32,Ai[xr.TRANSFORM]=Wi.UINT32,Ai[xr.SUB_MODEL_ARRAY]=Wi.UINT32,Ai[xr.INSTANCED_BUFFER]=Wi.UINT32,Ai[xr.INSTANCED_ATTR_ARRAY]=Wi.UINT32,Ai[xr.COUNT]=Wi.NEVER,Ai),Cr=new Qi(Ki.MODEL,Ar,xr);!function(e){e[e.VIS_FLAGS=0]="VIS_FLAGS",e[e.PASS_COUNT=1]="PASS_COUNT",e[e.PASS_0=2]="PASS_0",e[e.PASS_1=3]="PASS_1",e[e.PASS_2=4]="PASS_2",e[e.PASS_3=5]="PASS_3",e[e.SHADER_0=6]="SHADER_0",e[e.SHADER_1=7]="SHADER_1",e[e.SHADER_2=8]="SHADER_2",e[e.SHADER_3=9]="SHADER_3",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",e[e.COUNT=12]="COUNT"}(Sr||(Sr=e("cp",{})));var wr,br=((Ci={})[Sr.VIS_FLAGS]=Wi.UINT32,Ci[Sr.PASS_COUNT]=Wi.UINT32,Ci[Sr.PASS_0]=Wi.UINT32,Ci[Sr.PASS_1]=Wi.UINT32,Ci[Sr.PASS_2]=Wi.UINT32,Ci[Sr.PASS_3]=Wi.UINT32,Ci[Sr.SHADER_0]=Wi.UINT32,Ci[Sr.SHADER_1]=Wi.UINT32,Ci[Sr.SHADER_2]=Wi.UINT32,Ci[Sr.SHADER_3]=Wi.UINT32,Ci[Sr.DESCRIPTOR_SET]=Wi.UINT32,Ci[Sr.INPUT_ASSEMBLER]=Wi.UINT32,Ci[Sr.COUNT]=Wi.NEVER,Ci),Ir=e("co",new Qi(Ki.BATCH_2D,br,Sr));!function(e){e[e.CENTER=0]="CENTER",e[e.HALF_EXTENSION=3]="HALF_EXTENSION",e[e.COUNT=6]="COUNT"}(wr||(wr=e("bD",{})));var Rr,Or=((wi={})[wr.CENTER]=Wi.FLOAT32,wi[wr.HALF_EXTENSION]=Wi.FLOAT32,wi[wr.COUNT]=Wi.NEVER,wi),Nr=e("bC",new Qi(Ki.AABB,Or,wr));!function(e){e[e.MAIN_LIGHT=0]="MAIN_LIGHT",e[e.MODEL_ARRAY=1]="MODEL_ARRAY",e[e.SPHERE_LIGHT_ARRAY=2]="SPHERE_LIGHT_ARRAY",e[e.SPOT_LIGHT_ARRAY=3]="SPOT_LIGHT_ARRAY",e[e.BATCH_ARRAY_2D=4]="BATCH_ARRAY_2D",e[e.COUNT=5]="COUNT"}(Rr||(Rr={}));var Pr,Mr=((bi={})[Rr.MAIN_LIGHT]=Wi.UINT32,bi[Rr.MODEL_ARRAY]=Wi.UINT32,bi[Rr.SPHERE_LIGHT_ARRAY]=Wi.UINT32,bi[Rr.SPOT_LIGHT_ARRAY]=Wi.UINT32,bi[Rr.BATCH_ARRAY_2D]=Wi.UINT32,bi[Rr.COUNT]=Wi.NEVER,bi),Dr=new Qi(Ki.SCENE,Mr,Rr);!function(e){e[e.WIDTH=0]="WIDTH",e[e.HEIGHT=1]="HEIGHT",e[e.EXPOSURE=2]="EXPOSURE",e[e.CLEAR_FLAG=3]="CLEAR_FLAG",e[e.CLEAR_DEPTH=4]="CLEAR_DEPTH",e[e.CLEAR_STENCIL=5]="CLEAR_STENCIL",e[e.VISIBILITY=6]="VISIBILITY",e[e.NODE=7]="NODE",e[e.SCENE=8]="SCENE",e[e.FRUSTUM=9]="FRUSTUM",e[e.WINDOW=10]="WINDOW",e[e.FORWARD=11]="FORWARD",e[e.POSITION=14]="POSITION",e[e.VIEW_PORT=17]="VIEW_PORT",e[e.CLEAR_COLOR=21]="CLEAR_COLOR",e[e.MAT_VIEW=25]="MAT_VIEW",e[e.MAT_VIEW_PROJ=41]="MAT_VIEW_PROJ",e[e.MAT_VIEW_PROJ_INV=57]="MAT_VIEW_PROJ_INV",e[e.MAT_PROJ=73]="MAT_PROJ",e[e.MAT_PROJ_INV=89]="MAT_PROJ_INV",e[e.COUNT=105]="COUNT"}(Pr||(Pr={}));var Lr,Fr=((Ii={})[Pr.WIDTH]=Wi.UINT32,Ii[Pr.HEIGHT]=Wi.UINT32,Ii[Pr.EXPOSURE]=Wi.FLOAT32,Ii[Pr.CLEAR_FLAG]=Wi.UINT32,Ii[Pr.CLEAR_DEPTH]=Wi.FLOAT32,Ii[Pr.CLEAR_STENCIL]=Wi.UINT32,Ii[Pr.VISIBILITY]=Wi.UINT32,Ii[Pr.NODE]=Wi.UINT32,Ii[Pr.SCENE]=Wi.UINT32,Ii[Pr.FRUSTUM]=Wi.UINT32,Ii[Pr.WINDOW]=Wi.UINT32,Ii[Pr.FORWARD]=Wi.FLOAT32,Ii[Pr.POSITION]=Wi.FLOAT32,Ii[Pr.VIEW_PORT]=Wi.FLOAT32,Ii[Pr.CLEAR_COLOR]=Wi.FLOAT32,Ii[Pr.MAT_VIEW]=Wi.FLOAT32,Ii[Pr.MAT_VIEW_PROJ]=Wi.FLOAT32,Ii[Pr.MAT_VIEW_PROJ_INV]=Wi.FLOAT32,Ii[Pr.MAT_PROJ]=Wi.FLOAT32,Ii[Pr.MAT_PROJ_INV]=Wi.FLOAT32,Ii[Pr.COUNT]=Wi.NEVER,Ii),zr=new Qi(Ki.CAMERA,Fr,Pr);!function(e){e[e.FLAGS_CHANGED=0]="FLAGS_CHANGED",e[e.LAYER=1]="LAYER",e[e.WORLD_SCALE=2]="WORLD_SCALE",e[e.WORLD_POSITION=5]="WORLD_POSITION",e[e.WORLD_ROTATION=8]="WORLD_ROTATION",e[e.WORLD_MATRIX=12]="WORLD_MATRIX",e[e.COUNT=28]="COUNT"}(Lr||(Lr={}));var Br=((Ri={})[Lr.FLAGS_CHANGED]=Wi.UINT32,Ri[Lr.LAYER]=Wi.UINT32,Ri[Lr.WORLD_SCALE]=Wi.FLOAT32,Ri[Lr.WORLD_POSITION]=Wi.FLOAT32,Ri[Lr.WORLD_ROTATION]=Wi.FLOAT32,Ri[Lr.WORLD_MATRIX]=Wi.FLOAT32,Ri[Lr.COUNT]=Wi.NEVER,Ri);delete Lr[Lr.COUNT],Lr[Lr.COUNT=Lr.LAYER+1]="COUNT";var Ur,Gr=new Qi(Ki.NODE,Br,Lr);!function(e){e[e.CUMULATIVE_TIME=0]="CUMULATIVE_TIME",e[e.FRAME_TIME=1]="FRAME_TIME",e[e.COUNT=2]="COUNT"}(Ur||(Ur={}));var Hr,kr=((Oi={})[Ur.CUMULATIVE_TIME]=Wi.FLOAT32,Oi[Ur.FRAME_TIME]=Wi.FLOAT32,Oi[Ur.COUNT]=Wi.NEVER,Oi),Vr=new Qi(Ki.ROOT,kr,Ur,1);!function(e){e[e.HAS_ON_SCREEN_ATTACHMENTS=0]="HAS_ON_SCREEN_ATTACHMENTS",e[e.HAS_OFF_SCREEN_ATTACHMENTS=1]="HAS_OFF_SCREEN_ATTACHMENTS",e[e.FRAMEBUFFER=2]="FRAMEBUFFER",e[e.COUNT=3]="COUNT"}(Hr||(Hr={}));var jr,Wr=((Ni={})[Hr.HAS_ON_SCREEN_ATTACHMENTS]=Wi.UINT32,Ni[Hr.HAS_OFF_SCREEN_ATTACHMENTS]=Wi.UINT32,Ni[Hr.FRAMEBUFFER]=Wi.UINT32,Ni[Hr.COUNT]=Wi.NEVER,Ni),qr=new Qi(Ki.RENDER_WINDOW,Wr,Hr,2);!function(e){e[e.VERTICES=0]="VERTICES",e[e.PLANES=24]="PLANES",e[e.COUNT=48]="COUNT"}(jr||(jr={}));var Yr,Xr=((Pi={})[jr.VERTICES]=Wi.FLOAT32,Pi[jr.PLANES]=Wi.FLOAT32,Pi[jr.COUNT]=Wi.NEVER,Pi),Kr=new Qi(Ki.FRUSTUM,Xr,jr);!function(e){e[e.ENABLE=0]="ENABLE",e[e.ILLUM=1]="ILLUM",e[e.SKY_COLOR=2]="SKY_COLOR",e[e.GROUND_ALBEDO=6]="GROUND_ALBEDO",e[e.COUNT=10]="COUNT"}(Yr||(Yr={}));var Qr=((Mi={})[Yr.ENABLE]=Wi.UINT32,Mi[Yr.ILLUM]=Wi.FLOAT32,Mi[Yr.SKY_COLOR]=Wi.FLOAT32,Mi[Yr.GROUND_ALBEDO]=Wi.FLOAT32,Mi[Yr.COUNT]=Wi.NEVER,Mi);delete Yr[Yr.COUNT],Yr[Yr.COUNT=Yr.ILLUM+1]="COUNT";var Zr,Jr=new Qi(Ki.AMBIENT,Qr,Yr,1);!function(e){e[e.ENABLE=0]="ENABLE",e[e.IS_RGBE=1]="IS_RGBE",e[e.USE_IBL=2]="USE_IBL",e[e.MODEL=3]="MODEL",e[e.COUNT=4]="COUNT"}(Zr||(Zr={}));var $r,eo=((Di={})[Zr.ENABLE]=Wi.UINT32,Di[Zr.IS_RGBE]=Wi.UINT32,Di[Zr.USE_IBL]=Wi.UINT32,Di[Zr.MODEL]=Wi.UINT32,Di[Zr.COUNT]=Wi.NEVER,Di),to=new Qi(Ki.SKYBOX,eo,Zr,1);!function(e){e[e.ENABLE=0]="ENABLE",e[e.TYPE=1]="TYPE",e[e.DENSITY=2]="DENSITY",e[e.START=3]="START",e[e.END=4]="END",e[e.ATTEN=5]="ATTEN",e[e.TOP=6]="TOP",e[e.RANGE=7]="RANGE",e[e.COLOR=8]="COLOR",e[e.COUNT=12]="COUNT"}($r||($r={}));var no=((Li={})[$r.ENABLE]=Wi.UINT32,Li[$r.TYPE]=Wi.UINT32,Li[$r.DENSITY]=Wi.FLOAT32,Li[$r.START]=Wi.FLOAT32,Li[$r.END]=Wi.FLOAT32,Li[$r.ATTEN]=Wi.FLOAT32,Li[$r.TOP]=Wi.FLOAT32,Li[$r.RANGE]=Wi.FLOAT32,Li[$r.COLOR]=Wi.FLOAT32,Li[$r.COUNT]=Wi.NEVER,Li);delete $r[$r.COUNT],$r[$r.COUNT=$r.RANGE+1]="COUNT";var io,ro=new Qi(Ki.FOG,no,$r);!function(e){e[e.ENABLE=0]="ENABLE",e[e.DIRTY=1]="DIRTY",e[e.TYPE=2]="TYPE",e[e.DISTANCE=3]="DISTANCE",e[e.INSTANCE_PASS=4]="INSTANCE_PASS",e[e.PLANAR_PASS=5]="PLANAR_PASS",e[e.NEAR=6]="NEAR",e[e.FAR=7]="FAR",e[e.ASPECT=8]="ASPECT",e[e.PCF_TYPE=9]="PCF_TYPE",e[e.SHADOW_MAP_DIRTY=10]="SHADOW_MAP_DIRTY",e[e.BIAS=11]="BIAS",e[e.ORTHO_SIZE=12]="ORTHO_SIZE",e[e.AUTO_ADAPT=13]="AUTO_ADAPT",e[e.COLOR=14]="COLOR",e[e.SIZE=18]="SIZE",e[e.NORMAL=20]="NORMAL",e[e.MAT_LIGHT=23]="MAT_LIGHT",e[e.COUNT=39]="COUNT"}(io||(io={}));var oo=((Fi={})[io.ENABLE]=Wi.UINT32,Fi[io.DIRTY]=Wi.UINT32,Fi[io.TYPE]=Wi.UINT32,Fi[io.DISTANCE]=Wi.FLOAT32,Fi[io.INSTANCE_PASS]=Wi.UINT32,Fi[io.PLANAR_PASS]=Wi.UINT32,Fi[io.NEAR]=Wi.FLOAT32,Fi[io.FAR]=Wi.FLOAT32,Fi[io.ASPECT]=Wi.FLOAT32,Fi[io.PCF_TYPE]=Wi.UINT32,Fi[io.SHADOW_MAP_DIRTY]=Wi.UINT32,Fi[io.BIAS]=Wi.FLOAT32,Fi[io.ORTHO_SIZE]=Wi.FLOAT32,Fi[io.AUTO_ADAPT]=Wi.UINT32,Fi[io.COLOR]=Wi.FLOAT32,Fi[io.SIZE]=Wi.FLOAT32,Fi[io.NORMAL]=Wi.FLOAT32,Fi[io.MAT_LIGHT]=Wi.FLOAT32,Fi[io.COUNT]=Wi.NEVER,Fi);delete io[io.COUNT],io[io.COUNT=io.AUTO_ADAPT+1]="COUNT";var ao,so=new Qi(Ki.SHADOW,oo,io,1);!function(e){e[e.USE_COLOR_TEMPERATURE=0]="USE_COLOR_TEMPERATURE",e[e.ILLUMINANCE=1]="ILLUMINANCE",e[e.NODE=2]="NODE",e[e.RANGE=3]="RANGE",e[e.TYPE=4]="TYPE",e[e.AABB=5]="AABB",e[e.FRUSTUM=6]="FRUSTUM",e[e.SIZE=7]="SIZE",e[e.SPOT_ANGLE=8]="SPOT_ANGLE",e[e.ASPECT=9]="ASPECT",e[e.DIRECTION=10]="DIRECTION",e[e.COLOR=13]="COLOR",e[e.COLOR_TEMPERATURE_RGB=16]="COLOR_TEMPERATURE_RGB",e[e.POSITION=19]="POSITION",e[e.COUNT=22]="COUNT"}(ao||(ao={}));var co,lo=((zi={})[ao.USE_COLOR_TEMPERATURE]=Wi.UINT32,zi[ao.ILLUMINANCE]=Wi.FLOAT32,zi[ao.NODE]=Wi.UINT32,zi[ao.RANGE]=Wi.FLOAT32,zi[ao.TYPE]=Wi.UINT32,zi[ao.AABB]=Wi.UINT32,zi[ao.FRUSTUM]=Wi.UINT32,zi[ao.SIZE]=Wi.FLOAT32,zi[ao.SPOT_ANGLE]=Wi.FLOAT32,zi[ao.ASPECT]=Wi.FLOAT32,zi[ao.DIRECTION]=Wi.FLOAT32,zi[ao.COLOR]=Wi.FLOAT32,zi[ao.COLOR_TEMPERATURE_RGB]=Wi.FLOAT32,zi[ao.POSITION]=Wi.FLOAT32,zi[ao.COUNT]=Wi.NEVER,zi),uo=new Qi(Ki.LIGHT,lo,ao,3);!function(e){e[e.RADIUS=0]="RADIUS",e[e.CENTER=1]="CENTER",e[e.COUNT=4]="COUNT"}(co||(co={}));var ho=((Bi={})[co.RADIUS]=Wi.FLOAT32,Bi[co.CENTER]=Wi.FLOAT32,Bi[co.COUNT]=Wi.NEVER,Bi);delete co[co.COUNT],co[co.COUNT=co.RADIUS+1]="COUNT";var _o,fo=new Qi(Ki.SPHERE,ho,co,3);!function(e){e[e.STRIDE=0]="STRIDE",e[e.AMOUNT=1]="AMOUNT",e[e.BUFFER=2]="BUFFER",e[e.COUNT=3]="COUNT"}(_o||(_o={}));var mo,po=((Ui={})[_o.STRIDE]=Wi.UINT32,Ui[_o.AMOUNT]=Wi.UINT32,Ui[_o.BUFFER]=Wi.UINT32,Ui[_o.COUNT]=Wi.NEVER,Ui),vo=new Qi(Ki.FLAT_BUFFER,po,_o,3);!function(e){e[e.FLAT_BUFFER_ARRAY=0]="FLAT_BUFFER_ARRAY",e[e.COUNT=1]="COUNT"}(mo||(mo={}));var go,yo=((Gi={})[mo.FLAT_BUFFER_ARRAY]=Wi.UINT32,Gi[mo.COUNT]=Wi.NEVER,Gi),xo=new Qi(Ki.SUB_MESH,yo,mo,3);!function(e){e[e.IS_DISCARD=0]="IS_DISCARD",e[e.POLYGO_MODEL=1]="POLYGO_MODEL",e[e.SHADE_MODEL=2]="SHADE_MODEL",e[e.CULL_MODE=3]="CULL_MODE",e[e.IS_FRONT_FACE_CCW=4]="IS_FRONT_FACE_CCW",e[e.DEPTH_BIAS_ENABLED=5]="DEPTH_BIAS_ENABLED",e[e.DEPTH_BIAS=6]="DEPTH_BIAS",e[e.DEPTH_BIAS_CLAMP=7]="DEPTH_BIAS_CLAMP",e[e.DEPTH_BIAS_SLOP=8]="DEPTH_BIAS_SLOP",e[e.IS_DEPTH_CLIP=9]="IS_DEPTH_CLIP",e[e.IS_MULTI_SAMPLE=10]="IS_MULTI_SAMPLE",e[e.LINE_WIDTH=11]="LINE_WIDTH",e[e.COUNT=12]="COUNT"}(go||(go={}));var Eo,To=((Hi={})[go.IS_DISCARD]=Wi.UINT32,Hi[go.POLYGO_MODEL]=Wi.UINT32,Hi[go.SHADE_MODEL]=Wi.UINT32,Hi[go.CULL_MODE]=Wi.UINT32,Hi[go.IS_FRONT_FACE_CCW]=Wi.UINT32,Hi[go.DEPTH_BIAS_ENABLED]=Wi.UINT32,Hi[go.DEPTH_BIAS]=Wi.FLOAT32,Hi[go.DEPTH_BIAS_CLAMP]=Wi.FLOAT32,Hi[go.DEPTH_BIAS_SLOP]=Wi.FLOAT32,Hi[go.IS_DEPTH_CLIP]=Wi.UINT32,Hi[go.IS_MULTI_SAMPLE]=Wi.UINT32,Hi[go.LINE_WIDTH]=Wi.FLOAT32,Hi[go.COUNT]=Wi.NEVER,Hi),So=new Qi(Ki.RASTERIZER_STATE,To,go,9);!function(e){e[e.DEPTH_TEST=0]="DEPTH_TEST",e[e.DEPTH_WRITE=1]="DEPTH_WRITE",e[e.DEPTH_FUNC=2]="DEPTH_FUNC",e[e.STENCIL_TEST_FRONT=3]="STENCIL_TEST_FRONT",e[e.STENCIL_FUNC_FRONT=4]="STENCIL_FUNC_FRONT",e[e.STENCIL_READ_MASK_FRONT=5]="STENCIL_READ_MASK_FRONT",e[e.STENCIL_WRITE_MASK_FRONT=6]="STENCIL_WRITE_MASK_FRONT",e[e.STENCIL_FAIL_OP_FRONT=7]="STENCIL_FAIL_OP_FRONT",e[e.STENCIL_Z_FAIL_OP_FRONT=8]="STENCIL_Z_FAIL_OP_FRONT",e[e.STENCIL_PASS_OP_FRONT=9]="STENCIL_PASS_OP_FRONT",e[e.STENCIL_REF_FRONT=10]="STENCIL_REF_FRONT",e[e.STENCIL_TEST_BACK=11]="STENCIL_TEST_BACK",e[e.STENCIL_FUNC_BACK=12]="STENCIL_FUNC_BACK",e[e.STENCIL_READ_MADK_BACK=13]="STENCIL_READ_MADK_BACK",e[e.STENCIL_WRITE_MASK_BACK=14]="STENCIL_WRITE_MASK_BACK",e[e.STENCIL_FAIL_OP_BACK=15]="STENCIL_FAIL_OP_BACK",e[e.STENCIL_Z_FAIL_OP_BACK=16]="STENCIL_Z_FAIL_OP_BACK",e[e.STENCIL_PASS_OP_BACK=17]="STENCIL_PASS_OP_BACK",e[e.STENCIL_REF_BACK=18]="STENCIL_REF_BACK",e[e.COUNT=19]="COUNT"}(Eo||(Eo={}));var Ao,Co=((ki={})[Eo.DEPTH_TEST]=Wi.UINT32,ki[Eo.DEPTH_WRITE]=Wi.UINT32,ki[Eo.DEPTH_FUNC]=Wi.UINT32,ki[Eo.STENCIL_TEST_FRONT]=Wi.UINT32,ki[Eo.STENCIL_FUNC_FRONT]=Wi.UINT32,ki[Eo.STENCIL_READ_MASK_FRONT]=Wi.UINT32,ki[Eo.STENCIL_WRITE_MASK_FRONT]=Wi.UINT32,ki[Eo.STENCIL_FAIL_OP_FRONT]=Wi.UINT32,ki[Eo.STENCIL_Z_FAIL_OP_FRONT]=Wi.UINT32,ki[Eo.STENCIL_PASS_OP_FRONT]=Wi.UINT32,ki[Eo.STENCIL_REF_FRONT]=Wi.UINT32,ki[Eo.STENCIL_TEST_BACK]=Wi.UINT32,ki[Eo.STENCIL_FUNC_BACK]=Wi.UINT32,ki[Eo.STENCIL_READ_MADK_BACK]=Wi.UINT32,ki[Eo.STENCIL_WRITE_MASK_BACK]=Wi.UINT32,ki[Eo.STENCIL_FAIL_OP_BACK]=Wi.UINT32,ki[Eo.STENCIL_Z_FAIL_OP_BACK]=Wi.UINT32,ki[Eo.STENCIL_PASS_OP_BACK]=Wi.UINT32,ki[Eo.STENCIL_REF_BACK]=Wi.UINT32,ki[Eo.COUNT]=Wi.NEVER,ki),wo=new Qi(Ki.DEPTH_STENCIL_STATE,Co,Eo,9);!function(e){e[e.BLEND=0]="BLEND",e[e.BLEND_SRC=1]="BLEND_SRC",e[e.BLEND_DST=2]="BLEND_DST",e[e.BLEND_EQ=3]="BLEND_EQ",e[e.BLEND_SRC_ALPHA=4]="BLEND_SRC_ALPHA",e[e.BLEND_DST_ALPHA=5]="BLEND_DST_ALPHA",e[e.BLEND_ALPHA_EQ=6]="BLEND_ALPHA_EQ",e[e.BLEND_COLOR_MASK=7]="BLEND_COLOR_MASK",e[e.COUNT=8]="COUNT"}(Ao||(Ao={})),(Vi={})[Ao.BLEND]=Wi.UINT32,Vi[Ao.BLEND_SRC]=Wi.UINT32,Vi[Ao.BLEND_DST]=Wi.UINT32,Vi[Ao.BLEND_EQ]=Wi.UINT32,Vi[Ao.BLEND_SRC_ALPHA]=Wi.UINT32,Vi[Ao.BLEND_DST_ALPHA]=Wi.UINT32,Vi[Ao.BLEND_ALPHA_EQ]=Wi.UINT32,Vi[Ao.BLEND_COLOR_MASK]=Wi.UINT32,Vi[Ao.COUNT]=Wi.NEVER;var bo,Io=new Qi(Ki.BLEND_TARGET,Co,Ao,9);!function(e){e[e.IS_A2C=0]="IS_A2C",e[e.IS_INDEPEND=1]="IS_INDEPEND",e[e.BLEND_COLOR=2]="BLEND_COLOR",e[e.BLEND_TARGET=6]="BLEND_TARGET",e[e.COUNT=7]="COUNT"}(bo||(bo={}));var Ro=((ji={})[bo.IS_A2C]=Wi.UINT32,ji[bo.IS_INDEPEND]=Wi.UINT32,ji[bo.BLEND_COLOR]=Wi.FLOAT32,ji[bo.BLEND_TARGET]=Wi.UINT32,ji[bo.COUNT]=Wi.NEVER,ji),Oo=new Qi(Ki.BLEND_STATE,Ro,bo,9),No=function(){function e(){this._skyColor=new Vn(51,128,204,1),this._groundAlbedo=new Vn(51,51,51,255),this._albedoArray=Float32Array.from([.2,.2,.2,1]),this._colorArray=Float32Array.from([.2,.5,.8,1]),this._handle=nr,this._handle=Jr.alloc()}Z(e,[{key:"colorArray",get:function(){return this._colorArray}},{key:"albedoArray",get:function(){return this._albedoArray}},{key:"enabled",set:function(e){Jr.set(this._handle,Yr.ENABLE,e?1:0)},get:function(){return Jr.get(this._handle,Yr.ENABLE)}},{key:"skyColor",get:function(){return this._skyColor},set:function(e){this._skyColor.set(e),Vn.toArray(this._colorArray,this._skyColor),Jr.setVec4(this._handle,Yr.SKY_COLOR,this._skyColor)}},{key:"skyIllum",get:function(){return Jr.get(this._handle,Yr.ILLUM)},set:function(e){Jr.set(this._handle,Yr.ILLUM,e)}},{key:"groundAlbedo",get:function(){return this._groundAlbedo},set:function(e){this._groundAlbedo.set(e),Wn.toArray(this._albedoArray,this._groundAlbedo),Jr.setVec4(this._handle,Yr.GROUND_ALBEDO,this._groundAlbedo)}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.initialize=function(e){this._skyColor.set(e.skyColor),this._groundAlbedo.set(e.groundAlbedo),Vn.toArray(this._colorArray,this._skyColor),Wn.toArray(this._albedoArray,this._groundAlbedo),Jr.setVec4(this._handle,Yr.SKY_COLOR,this._skyColor),Jr.setVec4(this._handle,Yr.GROUND_ALBEDO,this._groundAlbedo),Jr.set(this._handle,Yr.ILLUM,e.skyIllum)},t.destroy=function(){this._handle&&(Jr.free(this._handle),this._handle=nr)},e}();No.SUN_ILLUM=65e3,No.SKY_ILLUM=2e4,c.Ambient=No;var Po=new Wn,Mo=new Wn,Do=new Wn,Lo=new Wn,Fo=new Wn,zo=new Wn,Bo=new Array(3),Uo=new Array(3);function Go(e,t){return Wn.dot(t.n,e)-t.d}function Ho(e,t,n){return Wn.copy(e,t),Wn.subtract(Fo,n.center,n.halfExtents),Wn.add(zo,n.center,n.halfExtents),e.x=e.x<Fo.x?Fo.x:e.x,e.y=e.y<Fo.y?Fo.y:e.y,e.z=e.z<Fo.z?Fo.z:e.z,e.x=e.x>zo.x?zo.x:e.x,e.y=e.y>zo.y?zo.y:e.y,e.z=e.z>zo.z?zo.z:e.z,e}function ko(e,t,n){Wn.set(Po,n.orientation.m00,n.orientation.m01,n.orientation.m02),Wn.set(Mo,n.orientation.m03,n.orientation.m04,n.orientation.m05),Wn.set(Do,n.orientation.m06,n.orientation.m07,n.orientation.m08),Bo[0]=Po,Bo[1]=Mo,Bo[2]=Do,Uo[0]=n.halfExtents.x,Uo[1]=n.halfExtents.y,Uo[2]=n.halfExtents.z,Wn.subtract(Lo,t,n.center),Wn.set(e,n.center.x,n.center.y,n.center.z);for(var i=0;i<3;i++){var r=Wn.dot(Lo,Bo[i]);r>Uo[i]&&(r=Uo[i]),r<-Uo[i]&&(r=-Uo[i]),e.x+=r*Bo[i].x,e.y+=r*Bo[i].y,e.z+=r*Bo[i].z}return e}var Vo=Object.freeze({__proto__:null,point_plane:Go,pt_point_plane:function(e,t,n){var i=Go(t,n);return Wn.subtract(e,t,Wn.multiplyScalar(e,n.n,i))},pt_point_aabb:Ho,pt_point_obb:ko,pt_point_line:function(e,t,n,i){Wn.subtract(Po,n,i);var r=Po,o=Wn.lengthSqr(r);if(0==o)Wn.copy(e,n);else{Wn.subtract(Po,t,n);var a=Wn.dot(Po,r)/o;a<0?Wn.copy(e,n):a>1?Wn.copy(e,i):Wn.scaleAndAdd(e,n,r,a)}}}),jo={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512},Wo=function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=jo.SHAPE_LINE,this.s=new Wn(e,t,n),this.e=new Wn(i,r,o)}return e.create=function(t,n,i,r,o,a){return new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.s.x,t.s.y,t.s.z,t.e.x,t.e.y,t.e.z)},e.copy=function(e,t){return Wn.copy(e.s,t.s),Wn.copy(e.e,t.e),e},e.fromPoints=function(e,t,n){return Wn.copy(e.s,t),Wn.copy(e.e,n),e},e.set=function(e,t,n,i,r,o,a){return e.s.x=t,e.s.y=n,e.s.z=i,e.e.x=r,e.e.y=o,e.e.z=a,e},e.len=function(e){return Wn.distance(e.s,e.e)},Z(e,[{key:"type",get:function(){return this._type}}]),e.prototype.length=function(){return Wn.distance(this.s,this.e)},e}(),qo=function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=jo.SHAPE_RAY,this.o=new Wn(e,t,n),this.d=new Wn(i,r,o)}return e.create=function(t,n,i,r,o,a){return void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=1),new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z)},e.copy=function(e,t){return Wn.copy(e.o,t.o),Wn.copy(e.d,t.d),e},e.fromPoints=function(e,t,n){return Wn.copy(e.o,t),Wn.normalize(e.d,Wn.subtract(e.d,n,t)),e},e.set=function(e,t,n,i,r,o,a){return e.o.x=t,e.o.y=n,e.o.z=i,e.d.x=r,e.d.y=o,e.d.z=a,e},Z(e,[{key:"type",get:function(){return this._type}}]),e.prototype.computeHit=function(e,t){Wn.normalize(e,this.d),Wn.scaleAndAdd(e,this.o,e,t)},e}(),Yo=new Wn,Xo=new Wn,Ko=new Wn,Qo=new Wn;function Zo(e){return Math.max(Math.max(e.x,e.y),e.z)}var Jo,$o=e("db",function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),this._center=new Wn(0,0,0),this._poolHandle=nr,this._type=void 0,this._type=jo.SHAPE_SPHERE,this._center=new Wn(e,t,n),this._poolHandle=fo.alloc(),fo.setVec3(this._poolHandle,co.CENTER,this._center),fo.set(this._poolHandle,co.RADIUS,i)}e.create=function(t,n,i,r){return new e(t,n,i,r)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.radius)},e.copy=function(e,t){return Wn.copy(e.center,t.center),e.radius=t.radius,e},e.fromPoints=function(e,t,n){return Wn.multiplyScalar(e.center,Wn.add(Yo,t,n),.5),e.radius=.5*Wn.subtract(Yo,n,t).length(),e},e.set=function(e,t,n,i,r){return e.center.x=t,e.center.y=n,e.center.z=i,e.radius=r,e},e.mergePoint=function(e,t,n){if(t.radius<0)return e.center.set(n),e.radius=0,e;Wn.subtract(Xo,n,t.center);var i=Xo.length();if(i>t.radius){var r=.5*(i-t.radius);e.radius+=r,Wn.multiplyScalar(Xo,Xo,r/i),Wn.add(e.center,e.center,Xo)}return e},e.mergeAABB=function(t,n,i){return i.getBoundary(Ko,Qo),e.mergePoint(t,n,Ko),e.mergePoint(t,n,Qo),t},Z(e,[{key:"center",get:function(){return this._center},set:function(e){this._center=e,fo.setVec3(this._poolHandle,co.CENTER,this._center)}},{key:"radius",get:function(){return fo.get(this._poolHandle,co.RADIUS)},set:function(e){fo.set(this._poolHandle,co.RADIUS,e)}},{key:"handle",get:function(){return this._poolHandle}},{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.destroy=function(){this._poolHandle&&(fo.free(this._poolHandle),this._poolHandle=nr)},t.clone=function(){return e.clone(this)},t.copy=function(t){return e.copy(this,t)},t.getBoundary=function(e,t){Wn.set(e,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),Wn.set(t,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},t.transform=function(e,t,n,i,r){Wn.transformMat4(r.center,this.center,e),r.radius=this.radius*Zo(i)},t.translateAndRotate=function(e,t,n){Wn.transformMat4(n.center,this.center,e)},t.setScale=function(e,t){t.radius=this.radius*Zo(e)},e}()),ea=function(){function e(e,t,n,i,r,o,a,s,c){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=1),void 0===c&&(c=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=jo.SHAPE_TRIANGLE,this.a=new Wn(e,t,n),this.b=new Wn(i,r,o),this.c=new Wn(a,s,c)}return e.create=function(t,n,i,r,o,a,s,c,l){return void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),new e(t,n,i,r,o,a,s,c,l)},e.clone=function(t){return new e(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z)},e.copy=function(e,t){return Wn.copy(e.a,t.a),Wn.copy(e.b,t.b),Wn.copy(e.c,t.c),e},e.fromPoints=function(e,t,n,i){return Wn.copy(e.a,t),Wn.copy(e.b,n),Wn.copy(e.c,i),e},e.set=function(e,t,n,i,r,o,a,s,c,l){return e.a.x=t,e.a.y=n,e.a.z=i,e.b.x=r,e.b.y=o,e.b.z=a,e.c.x=s,e.c.y=c,e.c.z=l,e},Z(e,[{key:"type",get:function(){return this._type}}]),e}(),ta=e("eC",4);!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BUFFER=1]="BUFFER",e[e.TEXTURE=2]="TEXTURE",e[e.RENDER_PASS=3]="RENDER_PASS",e[e.FRAMEBUFFER=4]="FRAMEBUFFER",e[e.SAMPLER=5]="SAMPLER",e[e.SHADER=6]="SHADER",e[e.DESCRIPTOR_SET_LAYOUT=7]="DESCRIPTOR_SET_LAYOUT",e[e.PIPELINE_LAYOUT=8]="PIPELINE_LAYOUT",e[e.PIPELINE_STATE=9]="PIPELINE_STATE",e[e.DESCRIPTOR_SET=10]="DESCRIPTOR_SET",e[e.INPUT_ASSEMBLER=11]="INPUT_ASSEMBLER",e[e.COMMAND_BUFFER=12]="COMMAND_BUFFER",e[e.FENCE=13]="FENCE",e[e.QUEUE=14]="QUEUE",e[e.WINDOW=15]="WINDOW"}(Jo||(Jo=e("eD",{})));var na,ia,ra,oa,aa,sa,ca,la,ua,ha,_a,fa,da,ma,pa,va,ga,ya,xa,Ea,Ta,Sa,Aa,Ca,wa,ba,Ia,Ra,Oa,Na,Pa,Ma,Da,La,Fa,za,Ba,Ua=e("eE",function(){function e(e){this._gfxType=Jo.UNKNOWN,this._gfxType=e}return Z(e,[{key:"gfxType",get:function(){return this._gfxType}}]),e}());!function(e){e.ATTR_POSITION="a_position",e.ATTR_NORMAL="a_normal",e.ATTR_TANGENT="a_tangent",e.ATTR_BITANGENT="a_bitangent",e.ATTR_WEIGHTS="a_weights",e.ATTR_JOINTS="a_joints",e.ATTR_COLOR="a_color",e.ATTR_COLOR1="a_color1",e.ATTR_COLOR2="a_color2",e.ATTR_TEX_COORD="a_texCoord",e.ATTR_TEX_COORD1="a_texCoord1",e.ATTR_TEX_COORD2="a_texCoord2",e.ATTR_TEX_COORD3="a_texCoord3",e.ATTR_TEX_COORD4="a_texCoord4",e.ATTR_TEX_COORD5="a_texCoord5",e.ATTR_TEX_COORD6="a_texCoord6",e.ATTR_TEX_COORD7="a_texCoord7",e.ATTR_TEX_COORD8="a_texCoord8",e.ATTR_BATCH_ID="a_batch_id",e.ATTR_BATCH_UV="a_batch_uv"}(na||(na=e("at",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BOOL=1]="BOOL",e[e.BOOL2=2]="BOOL2",e[e.BOOL3=3]="BOOL3",e[e.BOOL4=4]="BOOL4",e[e.INT=5]="INT",e[e.INT2=6]="INT2",e[e.INT3=7]="INT3",e[e.INT4=8]="INT4",e[e.UINT=9]="UINT",e[e.UINT2=10]="UINT2",e[e.UINT3=11]="UINT3",e[e.UINT4=12]="UINT4",e[e.FLOAT=13]="FLOAT",e[e.FLOAT2=14]="FLOAT2",e[e.FLOAT3=15]="FLOAT3",e[e.FLOAT4=16]="FLOAT4",e[e.MAT2=17]="MAT2",e[e.MAT2X3=18]="MAT2X3",e[e.MAT2X4=19]="MAT2X4",e[e.MAT3X2=20]="MAT3X2",e[e.MAT3=21]="MAT3",e[e.MAT3X4=22]="MAT3X4",e[e.MAT4X2=23]="MAT4X2",e[e.MAT4X3=24]="MAT4X3",e[e.MAT4=25]="MAT4",e[e.SAMPLER1D=26]="SAMPLER1D",e[e.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",e[e.SAMPLER2D=28]="SAMPLER2D",e[e.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",e[e.SAMPLER3D=30]="SAMPLER3D",e[e.SAMPLER_CUBE=31]="SAMPLER_CUBE",e[e.COUNT=32]="COUNT"}(ia||(ia=e("A",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.A8=1]="A8",e[e.L8=2]="L8",e[e.LA8=3]="LA8",e[e.R8=4]="R8",e[e.R8SN=5]="R8SN",e[e.R8UI=6]="R8UI",e[e.R8I=7]="R8I",e[e.R16F=8]="R16F",e[e.R16UI=9]="R16UI",e[e.R16I=10]="R16I",e[e.R32F=11]="R32F",e[e.R32UI=12]="R32UI",e[e.R32I=13]="R32I",e[e.RG8=14]="RG8",e[e.RG8SN=15]="RG8SN",e[e.RG8UI=16]="RG8UI",e[e.RG8I=17]="RG8I",e[e.RG16F=18]="RG16F",e[e.RG16UI=19]="RG16UI",e[e.RG16I=20]="RG16I",e[e.RG32F=21]="RG32F",e[e.RG32UI=22]="RG32UI",e[e.RG32I=23]="RG32I",e[e.RGB8=24]="RGB8",e[e.SRGB8=25]="SRGB8",e[e.RGB8SN=26]="RGB8SN",e[e.RGB8UI=27]="RGB8UI",e[e.RGB8I=28]="RGB8I",e[e.RGB16F=29]="RGB16F",e[e.RGB16UI=30]="RGB16UI",e[e.RGB16I=31]="RGB16I",e[e.RGB32F=32]="RGB32F",e[e.RGB32UI=33]="RGB32UI",e[e.RGB32I=34]="RGB32I",e[e.RGBA8=35]="RGBA8",e[e.BGRA8=36]="BGRA8",e[e.SRGB8_A8=37]="SRGB8_A8",e[e.RGBA8SN=38]="RGBA8SN",e[e.RGBA8UI=39]="RGBA8UI",e[e.RGBA8I=40]="RGBA8I",e[e.RGBA16F=41]="RGBA16F",e[e.RGBA16UI=42]="RGBA16UI",e[e.RGBA16I=43]="RGBA16I",e[e.RGBA32F=44]="RGBA32F",e[e.RGBA32UI=45]="RGBA32UI",e[e.RGBA32I=46]="RGBA32I",e[e.R5G6B5=47]="R5G6B5",e[e.R11G11B10F=48]="R11G11B10F",e[e.RGB5A1=49]="RGB5A1",e[e.RGBA4=50]="RGBA4",e[e.RGB10A2=51]="RGB10A2",e[e.RGB10A2UI=52]="RGB10A2UI",e[e.RGB9E5=53]="RGB9E5",e[e.D16=54]="D16",e[e.D16S8=55]="D16S8",e[e.D24=56]="D24",e[e.D24S8=57]="D24S8",e[e.D32F=58]="D32F",e[e.D32F_S8=59]="D32F_S8",e[e.BC1=60]="BC1",e[e.BC1_ALPHA=61]="BC1_ALPHA",e[e.BC1_SRGB=62]="BC1_SRGB",e[e.BC1_SRGB_ALPHA=63]="BC1_SRGB_ALPHA",e[e.BC2=64]="BC2",e[e.BC2_SRGB=65]="BC2_SRGB",e[e.BC3=66]="BC3",e[e.BC3_SRGB=67]="BC3_SRGB",e[e.BC4=68]="BC4",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5=70]="BC5",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.BC6H_UF16=72]="BC6H_UF16",e[e.BC6H_SF16=73]="BC6H_SF16",e[e.BC7=74]="BC7",e[e.BC7_SRGB=75]="BC7_SRGB",e[e.ETC_RGB8=76]="ETC_RGB8",e[e.ETC2_RGB8=77]="ETC2_RGB8",e[e.ETC2_SRGB8=78]="ETC2_SRGB8",e[e.ETC2_RGB8_A1=79]="ETC2_RGB8_A1",e[e.ETC2_SRGB8_A1=80]="ETC2_SRGB8_A1",e[e.ETC2_RGBA8=81]="ETC2_RGBA8",e[e.ETC2_SRGB8_A8=82]="ETC2_SRGB8_A8",e[e.EAC_R11=83]="EAC_R11",e[e.EAC_R11SN=84]="EAC_R11SN",e[e.EAC_RG11=85]="EAC_RG11",e[e.EAC_RG11SN=86]="EAC_RG11SN",e[e.PVRTC_RGB2=87]="PVRTC_RGB2",e[e.PVRTC_RGBA2=88]="PVRTC_RGBA2",e[e.PVRTC_RGB4=89]="PVRTC_RGB4",e[e.PVRTC_RGBA4=90]="PVRTC_RGBA4",e[e.PVRTC2_2BPP=91]="PVRTC2_2BPP",e[e.PVRTC2_4BPP=92]="PVRTC2_4BPP",e[e.ASTC_RGBA_4x4=93]="ASTC_RGBA_4x4",e[e.ASTC_RGBA_5x4=94]="ASTC_RGBA_5x4",e[e.ASTC_RGBA_5x5=95]="ASTC_RGBA_5x5",e[e.ASTC_RGBA_6x5=96]="ASTC_RGBA_6x5",e[e.ASTC_RGBA_6x6=97]="ASTC_RGBA_6x6",e[e.ASTC_RGBA_8x5=98]="ASTC_RGBA_8x5",e[e.ASTC_RGBA_8x6=99]="ASTC_RGBA_8x6",e[e.ASTC_RGBA_8x8=100]="ASTC_RGBA_8x8",e[e.ASTC_RGBA_10x5=101]="ASTC_RGBA_10x5",e[e.ASTC_RGBA_10x6=102]="ASTC_RGBA_10x6",e[e.ASTC_RGBA_10x8=103]="ASTC_RGBA_10x8",e[e.ASTC_RGBA_10x10=104]="ASTC_RGBA_10x10",e[e.ASTC_RGBA_12x10=105]="ASTC_RGBA_12x10",e[e.ASTC_RGBA_12x12=106]="ASTC_RGBA_12x12",e[e.ASTC_SRGBA_4x4=107]="ASTC_SRGBA_4x4",e[e.ASTC_SRGBA_5x4=108]="ASTC_SRGBA_5x4",e[e.ASTC_SRGBA_5x5=109]="ASTC_SRGBA_5x5",e[e.ASTC_SRGBA_6x5=110]="ASTC_SRGBA_6x5",e[e.ASTC_SRGBA_6x6=111]="ASTC_SRGBA_6x6",e[e.ASTC_SRGBA_8x5=112]="ASTC_SRGBA_8x5",e[e.ASTC_SRGBA_8x6=113]="ASTC_SRGBA_8x6",e[e.ASTC_SRGBA_8x8=114]="ASTC_SRGBA_8x8",e[e.ASTC_SRGBA_10x5=115]="ASTC_SRGBA_10x5",e[e.ASTC_SRGBA_10x6=116]="ASTC_SRGBA_10x6",e[e.ASTC_SRGBA_10x8=117]="ASTC_SRGBA_10x8",e[e.ASTC_SRGBA_10x10=118]="ASTC_SRGBA_10x10",e[e.ASTC_SRGBA_12x10=119]="ASTC_SRGBA_12x10",e[e.ASTC_SRGBA_12x12=120]="ASTC_SRGBA_12x12"}(ra||(ra=e("F",{}))),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.INDEX=4]="INDEX",e[e.VERTEX=8]="VERTEX",e[e.UNIFORM=16]="UNIFORM",e[e.STORAGE=32]="STORAGE",e[e.INDIRECT=64]="INDIRECT"}(oa||(oa=e("B",{}))),function(e){e[e.NONE=0]="NONE",e[e.DEVICE=1]="DEVICE",e[e.HOST=2]="HOST"}(aa||(aa=e("q",{}))),function(e){e[e.NONE=0]="NONE",e[e.BAKUP_BUFFER=4]="BAKUP_BUFFER"}(sa||(sa=e("G",{}))),function(e){e[e.NONE=0]="NONE",e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"}(ca||(ca=e("eF",{}))),function(e){e[e.POINT_LIST=0]="POINT_LIST",e[e.LINE_LIST=1]="LINE_LIST",e[e.LINE_STRIP=2]="LINE_STRIP",e[e.LINE_LOOP=3]="LINE_LOOP",e[e.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",e[e.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",e[e.ISO_LINE_LIST=6]="ISO_LINE_LIST",e[e.TRIANGLE_LIST=7]="TRIANGLE_LIST",e[e.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=9]="TRIANGLE_FAN",e[e.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",e[e.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",e[e.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",e[e.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(la||(la=e("aV",{}))),function(e){e[e.FILL=0]="FILL",e[e.POINT=1]="POINT",e[e.LINE=2]="LINE"}(ua||(ua=e("eG",{}))),function(e){e[e.GOURAND=0]="GOURAND",e[e.FLAT=1]="FLAT"}(ha||(ha=e("eH",{}))),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK"}(_a||(_a=e("v",{}))),function(e){e[e.NEVER=0]="NEVER",e[e.LESS=1]="LESS",e[e.EQUAL=2]="EQUAL",e[e.LESS_EQUAL=3]="LESS_EQUAL",e[e.GREATER=4]="GREATER",e[e.NOT_EQUAL=5]="NOT_EQUAL",e[e.GREATER_EQUAL=6]="GREATER_EQUAL",e[e.ALWAYS=7]="ALWAYS"}(fa||(fa=e("c1",{}))),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=1]="KEEP",e[e.REPLACE=2]="REPLACE",e[e.INCR=3]="INCR",e[e.DECR=4]="DECR",e[e.INVERT=5]="INVERT",e[e.INCR_WRAP=6]="INCR_WRAP",e[e.DECR_WRAP=7]="DECR_WRAP"}(da||(da=e("c2",{}))),function(e){e[e.ADD=0]="ADD",e[e.SUB=1]="SUB",e[e.REV_SUB=2]="REV_SUB",e[e.MIN=3]="MIN",e[e.MAX=4]="MAX"}(ma||(ma=e("dA",{}))),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=2]="SRC_ALPHA",e[e.DST_ALPHA=3]="DST_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",e[e.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",e[e.SRC_COLOR=6]="SRC_COLOR",e[e.DST_COLOR=7]="DST_COLOR",e[e.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",e[e.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=11]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(pa||(pa=e("c4",{}))),function(e){e[e.NONE=0]="NONE",e[e.R=1]="R",e[e.G=2]="G",e[e.B=4]="B",e[e.A=8]="A",e[e.ALL=15]="ALL"}(va||(va=e("u",{}))),function(e){e[e.NONE=0]="NONE",e[e.POINT=1]="POINT",e[e.LINEAR=2]="LINEAR",e[e.ANISOTROPIC=3]="ANISOTROPIC"}(ga||(ga=e("a2",{}))),function(e){e[e.WRAP=0]="WRAP",e[e.MIRROR=1]="MIRROR",e[e.CLAMP=2]="CLAMP",e[e.BORDER=3]="BORDER"}(ya||(ya=e("bu",{}))),function(e){e[e.TEX1D=0]="TEX1D",e[e.TEX2D=1]="TEX2D",e[e.TEX3D=2]="TEX3D",e[e.CUBE=3]="CUBE",e[e.TEX1D_ARRAY=4]="TEX1D_ARRAY",e[e.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(xa||(xa=e("T",{}))),function(e){e[e.NONE=0]="NONE",e[e.TRANSFER_SRC=1]="TRANSFER_SRC",e[e.TRANSFER_DST=2]="TRANSFER_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",e[e.TRANSIENT_ATTACHMENT=64]="TRANSIENT_ATTACHMENT",e[e.INPUT_ATTACHMENT=128]="INPUT_ATTACHMENT"}(Ea||(Ea=e("al",{}))),function(e){e[e.X1=0]="X1",e[e.X2=1]="X2",e[e.X4=2]="X4",e[e.X8=3]="X8",e[e.X16=4]="X16",e[e.X32=5]="X32",e[e.X64=6]="X64"}(Ta||(Ta=e("S",{}))),function(e){e[e.NONE=0]="NONE",e[e.GEN_MIPMAP=1]="GEN_MIPMAP",e[e.CUBEMAP=2]="CUBEMAP",e[e.BAKUP_BUFFER=4]="BAKUP_BUFFER",e[e.IMMUTABLE=8]="IMMUTABLE"}(Sa||(Sa=e("z",{}))),function(e){e[e.NONE=0]="NONE",e[e.VERTEX=1]="VERTEX",e[e.CONTROL=2]="CONTROL",e[e.EVALUATION=4]="EVALUATION",e[e.GEOMETRY=8]="GEOMETRY",e[e.FRAGMENT=16]="FRAGMENT",e[e.COMPUTE=32]="COMPUTE",e[e.ALL=63]="ALL"}(Aa||(Aa=e("E",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",e[e.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",e[e.STORAGE_BUFFER=4]="STORAGE_BUFFER",e[e.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",e[e.SAMPLER=16]="SAMPLER"}(Ca||(Ca=e("eI",{}))),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.SECONDARY=1]="SECONDARY"}(wa||(wa=e("K",{}))),function(e){e[e.LOAD=0]="LOAD",e[e.CLEAR=1]="CLEAR",e[e.DISCARD=2]="DISCARD"}(ba||(ba=e("L",{}))),function(e){e[e.STORE=0]="STORE",e[e.DISCARD=1]="DISCARD"}(Ia||(Ia=e("eJ",{}))),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.GENERAL=1]="GENERAL",e[e.COLOR_ATTACHMENT_OPTIMAL=2]="COLOR_ATTACHMENT_OPTIMAL",e[e.DEPTH_STENCIL_ATTACHMENT_OPTIMAL=3]="DEPTH_STENCIL_ATTACHMENT_OPTIMAL",e[e.DEPTH_STENCIL_READONLY_OPTIMAL=4]="DEPTH_STENCIL_READONLY_OPTIMAL",e[e.SHADER_READONLY_OPTIMAL=5]="SHADER_READONLY_OPTIMAL",e[e.TRANSFER_SRC_OPTIMAL=6]="TRANSFER_SRC_OPTIMAL",e[e.TRANSFER_DST_OPTIMAL=7]="TRANSFER_DST_OPTIMAL",e[e.PREINITIALIZED=8]="PREINITIALIZED",e[e.PRESENT_SRC=9]="PRESENT_SRC"}(Ra||(Ra=e("eK",{}))),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.RAY_TRACING=2]="RAY_TRACING"}(Oa||(Oa=e("eL",{}))),function(e){e[e.NONE=0]="NONE",e[e.VIEWPORT=1]="VIEWPORT",e[e.SCISSOR=2]="SCISSOR",e[e.LINE_WIDTH=4]="LINE_WIDTH",e[e.DEPTH_BIAS=8]="DEPTH_BIAS",e[e.BLEND_CONSTANTS=16]="BLEND_CONSTANTS",e[e.DEPTH_BOUNDS=32]="DEPTH_BOUNDS",e[e.STENCIL_WRITE_MASK=64]="STENCIL_WRITE_MASK",e[e.STENCIL_COMPARE_MASK=128]="STENCIL_COMPARE_MASK"}(Na||(Na=e("x",{}))),function(e){e[e.FRONT=0]="FRONT",e[e.BACK=1]="BACK",e[e.ALL=2]="ALL"}(Pa||(Pa=e("y",{}))),function(e){e[e.GRAPHICS=0]="GRAPHICS",e[e.COMPUTE=1]="COMPUTE",e[e.TRANSFER=2]="TRANSFER"}(Ma||(Ma=e("ai",{}))),function(e){e[e.NONE=0]="NONE",e[e.COLOR=1]="COLOR",e[e.DEPTH=2]="DEPTH",e[e.STENCIL=4]="STENCIL",e[e.DEPTH_STENCIL=6]="DEPTH_STENCIL",e[e.ALL=7]="ALL"}(Da||(Da=e("o",{}))),function(e){e[e.NONE=0]="NONE",e[e.UNORM=1]="UNORM",e[e.SNORM=2]="SNORM",e[e.UINT=3]="UINT",e[e.INT=4]="INT",e[e.UFLOAT=5]="UFLOAT",e[e.FLOAT=6]="FLOAT"}(La||(La=e("aP",{}))),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.GLES2=1]="GLES2",e[e.GLES3=2]="GLES3",e[e.METAL=3]="METAL",e[e.VULKAN=4]="VULKAN",e[e.WEBGL=5]="WEBGL",e[e.WEBGL2=6]="WEBGL2",e[e.WEBGPU=7]="WEBGPU"}(Fa||(Fa=e("ac",{}))),function(e){e[e.IDENTITY=0]="IDENTITY",e[e.ROTATE_90=1]="ROTATE_90",e[e.ROTATE_180=2]="ROTATE_180",e[e.ROTATE_270=3]="ROTATE_270"}(za||(za=e("eM",{}))),function(e){e[e.COLOR_FLOAT=0]="COLOR_FLOAT",e[e.COLOR_HALF_FLOAT=1]="COLOR_HALF_FLOAT",e[e.TEXTURE_FLOAT=2]="TEXTURE_FLOAT",e[e.TEXTURE_HALF_FLOAT=3]="TEXTURE_HALF_FLOAT",e[e.TEXTURE_FLOAT_LINEAR=4]="TEXTURE_FLOAT_LINEAR",e[e.TEXTURE_HALF_FLOAT_LINEAR=5]="TEXTURE_HALF_FLOAT_LINEAR",e[e.FORMAT_R11G11B10F=6]="FORMAT_R11G11B10F",e[e.FORMAT_D16=7]="FORMAT_D16",e[e.FORMAT_D16S8=8]="FORMAT_D16S8",e[e.FORMAT_D24=9]="FORMAT_D24",e[e.FORMAT_D24S8=10]="FORMAT_D24S8",e[e.FORMAT_D32F=11]="FORMAT_D32F",e[e.FORMAT_D32FS8=12]="FORMAT_D32FS8",e[e.FORMAT_ETC1=13]="FORMAT_ETC1",e[e.FORMAT_ETC2=14]="FORMAT_ETC2",e[e.FORMAT_DXT=15]="FORMAT_DXT",e[e.FORMAT_PVRTC=16]="FORMAT_PVRTC",e[e.FORMAT_ASTC=17]="FORMAT_ASTC",e[e.FORMAT_RGB8=18]="FORMAT_RGB8",e[e.MSAA=19]="MSAA",e[e.ELEMENT_INDEX_UINT=20]="ELEMENT_INDEX_UINT",e[e.INSTANCED_ARRAYS=21]="INSTANCED_ARRAYS",e[e.MULTIPLE_RENDER_TARGETS=22]="MULTIPLE_RENDER_TARGETS",e[e.BLEND_MINMAX=23]="BLEND_MINMAX",e[e.DEPTH_BOUNDS=24]="DEPTH_BOUNDS",e[e.LINE_WIDTH=25]="LINE_WIDTH",e[e.STENCIL_WRITE_MASK=26]="STENCIL_WRITE_MASK",e[e.STENCIL_COMPARE_MASK=27]="STENCIL_COMPARE_MASK",e[e.COUNT=28]="COUNT"}(Ba||(Ba=e("ag",{})));var Ga=e("eN",(function(e,t,n,i,r,o,a,s){this.name=e,this.size=t,this.count=n,this.type=i,this.hasAlpha=r,this.hasDepth=o,this.hasStencil=a,this.isCompressed=s})),Ha=e("eO",(function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.bufferSize=e,this.textureSize=t})),ka=e("s",Object.freeze([new Ga("UNKNOWN",0,0,La.NONE,!1,!1,!1,!1),new Ga("A8",1,1,La.UNORM,!0,!1,!1,!1),new Ga("L8",1,1,La.UNORM,!1,!1,!1,!1),new Ga("LA8",1,2,La.UNORM,!0,!1,!1,!1),new Ga("R8",1,1,La.UNORM,!1,!1,!1,!1),new Ga("R8SN",1,1,La.SNORM,!1,!1,!1,!1),new Ga("R8UI",1,1,La.UINT,!1,!1,!1,!1),new Ga("R8I",1,1,La.INT,!1,!1,!1,!1),new Ga("R16F",2,1,La.FLOAT,!1,!1,!1,!1),new Ga("R16UI",2,1,La.UINT,!1,!1,!1,!1),new Ga("R16I",2,1,La.INT,!1,!1,!1,!1),new Ga("R32F",4,1,La.FLOAT,!1,!1,!1,!1),new Ga("R32UI",4,1,La.UINT,!1,!1,!1,!1),new Ga("R32I",4,1,La.INT,!1,!1,!1,!1),new Ga("RG8",2,2,La.UNORM,!1,!1,!1,!1),new Ga("RG8SN",2,2,La.SNORM,!1,!1,!1,!1),new Ga("RG8UI",2,2,La.UINT,!1,!1,!1,!1),new Ga("RG8I",2,2,La.INT,!1,!1,!1,!1),new Ga("RG16F",4,2,La.FLOAT,!1,!1,!1,!1),new Ga("RG16UI",4,2,La.UINT,!1,!1,!1,!1),new Ga("RG16I",4,2,La.INT,!1,!1,!1,!1),new Ga("RG32F",8,2,La.FLOAT,!1,!1,!1,!1),new Ga("RG32UI",8,2,La.UINT,!1,!1,!1,!1),new Ga("RG32I",8,2,La.INT,!1,!1,!1,!1),new Ga("RGB8",3,3,La.UNORM,!1,!1,!1,!1),new Ga("SRGB8",3,3,La.UNORM,!1,!1,!1,!1),new Ga("RGB8SN",3,3,La.SNORM,!1,!1,!1,!1),new Ga("RGB8UI",3,3,La.UINT,!1,!1,!1,!1),new Ga("RGB8I",3,3,La.INT,!1,!1,!1,!1),new Ga("RGB16F",6,3,La.FLOAT,!1,!1,!1,!1),new Ga("RGB16UI",6,3,La.UINT,!1,!1,!1,!1),new Ga("RGB16I",6,3,La.INT,!1,!1,!1,!1),new Ga("RGB32F",12,3,La.FLOAT,!1,!1,!1,!1),new Ga("RGB32UI",12,3,La.UINT,!1,!1,!1,!1),new Ga("RGB32I",12,3,La.INT,!1,!1,!1,!1),new Ga("RGBA8",4,4,La.UNORM,!0,!1,!1,!1),new Ga("BGRA8",4,4,La.UNORM,!0,!1,!1,!1),new Ga("SRGB8_A8",4,4,La.UNORM,!0,!1,!1,!1),new Ga("RGBA8SN",4,4,La.SNORM,!0,!1,!1,!1),new Ga("RGBA8UI",4,4,La.UINT,!0,!1,!1,!1),new Ga("RGBA8I",4,4,La.INT,!0,!1,!1,!1),new Ga("RGBA16F",8,4,La.FLOAT,!0,!1,!1,!1),new Ga("RGBA16UI",8,4,La.UINT,!0,!1,!1,!1),new Ga("RGBA16I",8,4,La.INT,!0,!1,!1,!1),new Ga("RGBA32F",16,4,La.FLOAT,!0,!1,!1,!1),new Ga("RGBA32UI",16,4,La.UINT,!0,!1,!1,!1),new Ga("RGBA32I",16,4,La.INT,!0,!1,!1,!1),new Ga("R5G6B5",2,3,La.UNORM,!1,!1,!1,!1),new Ga("R11G11B10F",4,3,La.FLOAT,!1,!1,!1,!1),new Ga("RGB5A1",2,4,La.UNORM,!0,!1,!1,!1),new Ga("RGBA4",2,4,La.UNORM,!0,!1,!1,!1),new Ga("RGB10A2",2,4,La.UNORM,!0,!1,!1,!1),new Ga("RGB10A2UI",2,4,La.UINT,!0,!1,!1,!1),new Ga("RGB9E5",2,4,La.FLOAT,!0,!1,!1,!1),new Ga("D16",2,1,La.UINT,!1,!0,!1,!1),new Ga("D16S8",3,2,La.UINT,!1,!0,!0,!1),new Ga("D24",3,1,La.UINT,!1,!0,!1,!1),new Ga("D24S8",4,2,La.UINT,!1,!0,!0,!1),new Ga("D32F",4,1,La.FLOAT,!1,!0,!1,!1),new Ga("D32FS8",5,2,La.FLOAT,!1,!0,!0,!1),new Ga("BC1",1,3,La.UNORM,!1,!1,!1,!0),new Ga("BC1_ALPHA",1,4,La.UNORM,!0,!1,!1,!0),new Ga("BC1_SRGB",1,3,La.UNORM,!1,!1,!1,!0),new Ga("BC1_SRGB_ALPHA",1,4,La.UNORM,!0,!1,!1,!0),new Ga("BC2",1,4,La.UNORM,!0,!1,!1,!0),new Ga("BC2_SRGB",1,4,La.UNORM,!0,!1,!1,!0),new Ga("BC3",1,4,La.UNORM,!0,!1,!1,!0),new Ga("BC3_SRGB",1,4,La.UNORM,!0,!1,!1,!0),new Ga("BC4",1,1,La.UNORM,!1,!1,!1,!0),new Ga("BC4_SNORM",1,1,La.SNORM,!1,!1,!1,!0),new Ga("BC5",1,2,La.UNORM,!1,!1,!1,!0),new Ga("BC5_SNORM",1,2,La.SNORM,!1,!1,!1,!0),new Ga("BC6H_UF16",1,3,La.UFLOAT,!1,!1,!1,!0),new Ga("BC6H_SF16",1,3,La.FLOAT,!1,!1,!1,!0),new Ga("BC7",1,4,La.UNORM,!0,!1,!1,!0),new Ga("BC7_SRGB",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ETC_RGB8",1,3,La.UNORM,!1,!1,!1,!0),new Ga("ETC2_RGB8",1,3,La.UNORM,!1,!1,!1,!0),new Ga("ETC2_SRGB8",1,3,La.UNORM,!1,!1,!1,!0),new Ga("ETC2_RGB8_A1",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ETC2_SRGB8_A1",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ETC2_RGBA8",2,4,La.UNORM,!0,!1,!1,!0),new Ga("ETC2_SRGB8_A8",2,4,La.UNORM,!0,!1,!1,!0),new Ga("EAC_R11",1,1,La.UNORM,!1,!1,!1,!0),new Ga("EAC_R11SN",1,1,La.SNORM,!1,!1,!1,!0),new Ga("EAC_RG11",2,2,La.UNORM,!1,!1,!1,!0),new Ga("EAC_RG11SN",2,2,La.SNORM,!1,!1,!1,!0),new Ga("PVRTC_RGB2",2,3,La.UNORM,!1,!1,!1,!0),new Ga("PVRTC_RGBA2",2,4,La.UNORM,!0,!1,!1,!0),new Ga("PVRTC_RGB4",2,3,La.UNORM,!1,!1,!1,!0),new Ga("PVRTC_RGBA4",2,4,La.UNORM,!0,!1,!1,!0),new Ga("PVRTC2_2BPP",2,4,La.UNORM,!0,!1,!1,!0),new Ga("PVRTC2_4BPP",2,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_4x4",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_5x4",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_5x5",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_6x5",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_6x6",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_8x5",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_8x6",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_8x8",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_10x5",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_10x6",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_10x8",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_10x10",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_12x10",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_RGBA_12x12",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_4x4",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_5x4",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_5x5",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_6x5",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_6x6",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_8x5",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_8x6",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_8x8",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_10x5",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_10x6",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_10x8",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_10x10",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_12x10",1,4,La.UNORM,!0,!1,!1,!0),new Ga("ASTC_SRGBA_12x12",1,4,La.UNORM,!0,!1,!1,!0)]));function Va(e,t,n,i){if(!ka[e].isCompressed)return t*n*i*ka[e].size;switch(e){case ra.BC1:case ra.BC1_ALPHA:case ra.BC1_SRGB:case ra.BC1_SRGB_ALPHA:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case ra.BC2:case ra.BC2_SRGB:case ra.BC3:case ra.BC3_SRGB:case ra.BC4:case ra.BC4_SNORM:case ra.BC6H_SF16:case ra.BC6H_UF16:case ra.BC7:case ra.BC7_SRGB:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case ra.BC5:case ra.BC5_SNORM:return Math.ceil(t/4)*Math.ceil(n/4)*32*i;case ra.ETC_RGB8:case ra.ETC2_RGB8:case ra.ETC2_SRGB8:case ra.ETC2_RGB8_A1:case ra.EAC_R11:case ra.EAC_R11SN:return Math.ceil(t/4)*Math.ceil(n/4)*8*i;case ra.ETC2_RGBA8:case ra.ETC2_SRGB8_A1:case ra.EAC_RG11:case ra.EAC_RG11SN:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case ra.PVRTC_RGB2:case ra.PVRTC_RGBA2:case ra.PVRTC2_2BPP:return Math.ceil(Math.max(t,16)*Math.max(n,8)/4)*i;case ra.PVRTC_RGB4:case ra.PVRTC_RGBA4:case ra.PVRTC2_4BPP:return Math.ceil(Math.max(t,8)*Math.max(n,8)/2)*i;case ra.ASTC_RGBA_4x4:case ra.ASTC_SRGBA_4x4:return Math.ceil(t/4)*Math.ceil(n/4)*16*i;case ra.ASTC_RGBA_5x4:case ra.ASTC_SRGBA_5x4:return Math.ceil(t/5)*Math.ceil(n/4)*16*i;case ra.ASTC_RGBA_5x5:case ra.ASTC_SRGBA_5x5:return Math.ceil(t/5)*Math.ceil(n/5)*16*i;case ra.ASTC_RGBA_6x5:case ra.ASTC_SRGBA_6x5:return Math.ceil(t/6)*Math.ceil(n/5)*16*i;case ra.ASTC_RGBA_6x6:case ra.ASTC_SRGBA_6x6:return Math.ceil(t/6)*Math.ceil(n/6)*16*i;case ra.ASTC_RGBA_8x5:case ra.ASTC_SRGBA_8x5:return Math.ceil(t/8)*Math.ceil(n/5)*16*i;case ra.ASTC_RGBA_8x6:case ra.ASTC_SRGBA_8x6:return Math.ceil(t/8)*Math.ceil(n/6)*16*i;case ra.ASTC_RGBA_8x8:case ra.ASTC_SRGBA_8x8:return Math.ceil(t/8)*Math.ceil(n/8)*16*i;case ra.ASTC_RGBA_10x5:case ra.ASTC_SRGBA_10x5:return Math.ceil(t/10)*Math.ceil(n/5)*16*i;case ra.ASTC_RGBA_10x6:case ra.ASTC_SRGBA_10x6:return Math.ceil(t/10)*Math.ceil(n/6)*16*i;case ra.ASTC_RGBA_10x8:case ra.ASTC_SRGBA_10x8:return Math.ceil(t/10)*Math.ceil(n/8)*16*i;case ra.ASTC_RGBA_10x10:case ra.ASTC_SRGBA_10x10:return Math.ceil(t/10)*Math.ceil(n/10)*16*i;case ra.ASTC_RGBA_12x10:case ra.ASTC_SRGBA_12x10:return Math.ceil(t/12)*Math.ceil(n/10)*16*i;case ra.ASTC_RGBA_12x12:case ra.ASTC_SRGBA_12x12:return Math.ceil(t/12)*Math.ceil(n/12)*16*i;default:return 0}}function ja(e,t,n,i,r){for(var o=0,a=0;a<r;++a)o+=Va(e,t,n,i),t=Math.max(t>>1,1),n=Math.max(n>>1,1);return o}var Wa=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function qa(e){return Wa[e]||0}function Ya(e){var t=e.size/e.count;switch(e.type){case La.UNORM:case La.UINT:switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}break;case La.SNORM:case La.INT:switch(t){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}break;case La.FLOAT:return Float32Array}return Float32Array}var Xa=e("p",(function(e,t,n,i,r,o,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),this.vertexCount=e,this.firstVertex=t,this.indexCount=n,this.firstIndex=i,this.vertexOffset=r,this.instanceCount=o,this.firstInstance=a})),Ka=e("cU",28),Qa=e("I",(function(e){void 0===e&&(e=[]),this.drawInfos=e})),Za=e("aB",(function(e,t,n,i,r){void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=sa.NONE),this.usage=e,this.memUsage=t,this.size=n,this.stride=i,this.flags=r})),Ja=e("eB",(function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.buffer=e,this.offset=t,this.range=n})),$a=e("J",function(e){function t(t){var n;return(n=e.call(this,Jo.BUFFER)||this)._device=void 0,n._usage=oa.NONE,n._memUsage=aa.NONE,n._size=0,n._stride=1,n._count=0,n._flags=sa.NONE,n._bakcupBuffer=null,n._indirectBuffer=null,n._isBufferView=!1,n._device=t,n}return $(t,e),Z(t,[{key:"usage",get:function(){return this._usage}},{key:"memUsage",get:function(){return this._memUsage}},{key:"size",get:function(){return this._size}},{key:"stride",get:function(){return this._stride}},{key:"count",get:function(){return this._count}},{key:"flags",get:function(){return this._flags}},{key:"backupBuffer",get:function(){return this._bakcupBuffer}}]),t}(Ua)),es=e("aj",(function(e,t){void 0===t&&(t=wa.PRIMARY),this.queue=e,this.type=t})),ts=e("N",function(e){function t(t){var n;return(n=e.call(this,Jo.COMMAND_BUFFER)||this)._device=void 0,n._queue=null,n._type=wa.PRIMARY,n._numDrawCalls=0,n._numInstances=0,n._numTris=0,n._device=t,n}return $(t,e),Z(t,[{key:"type",get:function(){return this._type}},{key:"queue",get:function(){return this._queue}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}}]),t}(Ua));wt(ra);var ns=e("aq",(function(e,t,n){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=0),this.bufferOffsets=e,this.samplerOffsets=t,this.flexibleSet=n})),is=e("eU",(function(e,t,n,i,r,o,a){void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),void 0===a&&(a=new ns),this.canvasElm=e,this.isAntialias=t,this.isPremultipliedAlpha=n,this.devicePixelRatio=i,this.nativeWidth=r,this.nativeHeight=o,this.bindingMappingInfo=a})),rs=e("ar",function(){function e(){this._canvas=null,this._canvas2D=null,this._gfxAPI=Fa.UNKNOWN,this._transform=za.IDENTITY,this._deviceName="",this._renderer="",this._vendor="",this._version="",this._features=new Array(Ba.COUNT),this._queue=null,this._cmdBuff=null,this._devicePixelRatio=1,this._width=0,this._height=0,this._nativeWidth=0,this._nativeHeight=0,this._maxVertexAttributes=0,this._maxVertexUniformVectors=0,this._maxFragmentUniformVectors=0,this._maxTextureUnits=0,this._maxVertexTextureUnits=0,this._maxUniformBufferBindings=0,this._maxUniformBlockSize=0,this._maxTextureSize=0,this._maxCubeMapTextureSize=0,this._uboOffsetAlignment=1,this._depthBits=0,this._stencilBits=0,this._colorFmt=ra.UNKNOWN,this._depthStencilFmt=ra.UNKNOWN,this._macros=new Map,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new Ha,this._clipSpaceMinZ=-1,this._screenSpaceSignY=1,this._UVSpaceSignY=-1}return e.prototype.hasFeature=function(e){return this._features[e]},Z(e,[{key:"canvas",get:function(){return this._canvas}},{key:"canvas2D",get:function(){return this._canvas2D}},{key:"gfxAPI",get:function(){return this._gfxAPI}},{key:"queue",get:function(){return this._queue}},{key:"commandBuffer",get:function(){return this._cmdBuff}},{key:"devicePixelRatio",get:function(){return this._devicePixelRatio}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"nativeWidth",get:function(){return this._nativeWidth}},{key:"nativeHeight",get:function(){return this._nativeHeight}},{key:"renderer",get:function(){return this._renderer}},{key:"vendor",get:function(){return this._vendor}},{key:"maxVertexAttributes",get:function(){return this._maxVertexAttributes}},{key:"maxVertexUniformVectors",get:function(){return this._maxVertexUniformVectors}},{key:"maxFragmentUniformVectors",get:function(){return this._maxFragmentUniformVectors}},{key:"maxTextureUnits",get:function(){return this._maxTextureUnits}},{key:"maxVertexTextureUnits",get:function(){return this._maxVertexTextureUnits}},{key:"maxUniformBufferBindings",get:function(){return this._maxUniformBufferBindings}},{key:"maxUniformBlockSize",get:function(){return this._maxUniformBlockSize}},{key:"maxTextureSize",get:function(){return this._maxTextureSize}},{key:"maxCubeMapTextureSize",get:function(){return this._maxCubeMapTextureSize}},{key:"uboOffsetAlignment",get:function(){return this._uboOffsetAlignment}},{key:"depthBits",get:function(){return this._depthBits}},{key:"stencilBits",get:function(){return this._stencilBits}},{key:"colorFormat",get:function(){return this._colorFmt}},{key:"depthStencilFormat",get:function(){return this._depthStencilFmt}},{key:"macros",get:function(){return this._macros}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}},{key:"memoryStatus",get:function(){return this._memoryStatus}},{key:"clipSpaceMinZ",get:function(){return this._clipSpaceMinZ}},{key:"screenSpaceSignY",get:function(){return this._screenSpaceSignY}},{key:"UVSpaceSignY",get:function(){return this._UVSpaceSignY}},{key:"surfaceTransform",get:function(){return this._transform}}]),e}()),os=e("eV",(function(e,t,n,i,r){void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=[]),void 0===r&&(r=0),this.renderPass=e,this.colorTextures=t,this.depthStencilTexture=n,this.colorMipmapLevels=i,this.depStencilMipmapLevel=r})),as=e("Q",function(e){function t(t){var n;return(n=e.call(this,Jo.FRAMEBUFFER)||this)._device=void 0,n._renderPass=null,n._colorTextures=[],n._depthStencilTexture=null,n._device=t,n}return $(t,e),Z(t,[{key:"renderPass",get:function(){return this._renderPass}},{key:"colorTextures",get:function(){return this._colorTextures}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}}]),t}(Ua)),ss=String.prototype.charCodeAt;function cs(e){return this[e]}function ls(e,t){for(var n=e.length,i=t^n,r=0,o="string"==typeof e?ss:cs;n>=4;){var a=255&o.call(e,r)|(255&o.call(e,++r))<<8|(255&o.call(e,++r))<<16|(255&o.call(e,++r))<<24;a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),n-=4,++r}switch(n){case 3:i^=(255&o.call(e,r+2))<<16;case 2:i^=(255&o.call(e,r+1))<<8;case 1:i=1540483477*(65535&(i^=255&o.call(e,r)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}var us=e("aR",(function(e,t,n,i,r,o){void 0===e&&(e=""),void 0===t&&(t=ra.UNKNOWN),void 0===n&&(n=!1),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===o&&(o=0),this.name=e,this.format=t,this.isNormalized=n,this.stream=i,this.isInstanced=r,this.location=o})),hs=e("ck",(function(e,t,n,i){void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===n&&(n=null),void 0===i&&(i=null),this.attributes=e,this.vertexBuffers=t,this.indexBuffer=n,this.indirectBuffer=i})),_s=e("W",function(e){function t(t){var n;return(n=e.call(this,Jo.INPUT_ASSEMBLER)||this)._device=void 0,n._attributes=[],n._vertexBuffers=[],n._indexBuffer=null,n._vertexCount=0,n._firstVertex=0,n._indexCount=0,n._firstIndex=0,n._vertexOffset=0,n._instanceCount=0,n._firstInstance=0,n._attributesHash=0,n._indirectBuffer=null,n._device=t,n}$(t,e),Z(t,[{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"attributes",get:function(){return this._attributes}},{key:"attributesHash",get:function(){return this._attributesHash}},{key:"vertexCount",get:function(){return this._vertexCount},set:function(e){this._vertexCount=e}},{key:"firstVertex",get:function(){return this._firstVertex},set:function(e){this._firstVertex=e}},{key:"indexCount",get:function(){return this._indexCount},set:function(e){this._indexCount=e}},{key:"firstIndex",get:function(){return this._firstIndex},set:function(e){this._firstIndex=e}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(e){this._vertexOffset=e}},{key:"instanceCount",get:function(){return this._instanceCount},set:function(e){this._instanceCount=e}},{key:"firstInstance",get:function(){return this._firstInstance},set:function(e){this._firstInstance=e}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}}]);var n=t.prototype;return n.getVertexBuffer=function(e){return void 0===e&&(e=0),e<this._vertexBuffers.length?this._vertexBuffers[e]:null},n.computeAttributesHash=function(){for(var e="attrs",t=0;t<this.attributes.length;++t){var n=this.attributes[t];e+=","+n.name+","+n.format+","+n.isNormalized+","+n.stream+","+n.isInstanced}return ls(e,666)},t}(Ua)),fs=e("n",(function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),void 0===i&&(i=1),this.x=e,this.y=t,this.width=n,this.height=i})),ds=e("V",(function(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=1),this.left=e,this.top=t,this.width=n,this.height=i,this.minDepth=r,this.maxDepth=o})),ms=e("eP",(function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=e,this.y=t,this.z=n,this.w=i})),ps=e("eQ",(function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n})),vs=e("eR",(function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),this.width=e,this.height=t,this.depth=n})),gs=e("eS",(function(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=1),this.mipLevel=e,this.baseArrayLayer=t,this.layerCount=n})),ys=e("eT",(function(e,t,n,i,r){void 0===e&&(e=new gs),void 0===t&&(t=new ps),void 0===n&&(n=new gs),void 0===i&&(i=new ps),void 0===r&&(r=new vs),this.srcSubres=e,this.srcOffset=t,this.dstSubres=n,this.dstOffset=i,this.extent=r})),xs=e("am",(function(e,t,n,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=new ps),void 0===i&&(i=new vs),void 0===r&&(r=new gs),this.buffStride=e,this.buffTexHeight=t,this.texOffset=n,this.texExtent=i,this.texSubres=r})),Es=e("a5",function(){function e(e,t,n,i,r,o,a,s,c,l,u,h){void 0===e&&(e=!1),void 0===t&&(t=ua.FILL),void 0===n&&(n=ha.GOURAND),void 0===i&&(i=_a.BACK),void 0===r&&(r=!0),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=!0),void 0===u&&(u=!1),void 0===h&&(h=1),this.isDiscard=e,this.polygonMode=t,this.shadeModel=n,this.cullMode=i,this.isFrontFaceCCW=r,this.depthBiasEnabled=o,this.depthBias=a,this.depthBiasClamp=s,this.depthBiasSlop=c,this.isDepthClip=l,this.isMultisample=u,this.lineWidth=h}var t=e.prototype;return t.reset=function(){this.isDiscard=!1,this.polygonMode=ua.FILL,this.shadeModel=ha.GOURAND,this.cullMode=_a.BACK,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return nr}}]),e}()),Ts=e("a6",function(){function e(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,m,p,v,g){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=fa.LESS),void 0===i&&(i=!1),void 0===r&&(r=fa.ALWAYS),void 0===o&&(o=65535),void 0===a&&(a=65535),void 0===s&&(s=da.KEEP),void 0===c&&(c=da.KEEP),void 0===l&&(l=da.KEEP),void 0===u&&(u=1),void 0===h&&(h=!1),void 0===_&&(_=fa.ALWAYS),void 0===f&&(f=65535),void 0===d&&(d=65535),void 0===m&&(m=da.KEEP),void 0===p&&(p=da.KEEP),void 0===v&&(v=da.KEEP),void 0===g&&(g=1),this.depthTest=e,this.depthWrite=t,this.depthFunc=n,this.stencilTestFront=i,this.stencilFuncFront=r,this.stencilReadMaskFront=o,this.stencilWriteMaskFront=a,this.stencilFailOpFront=s,this.stencilZFailOpFront=c,this.stencilPassOpFront=l,this.stencilRefFront=u,this.stencilTestBack=h,this.stencilFuncBack=_,this.stencilReadMaskBack=f,this.stencilWriteMaskBack=d,this.stencilFailOpBack=m,this.stencilZFailOpBack=p,this.stencilPassOpBack=v,this.stencilRefBack=g}var t=e.prototype;return t.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=fa.LESS,this.stencilTestFront=!1,this.stencilFuncFront=fa.ALWAYS,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=da.KEEP,this.stencilZFailOpFront=da.KEEP,this.stencilPassOpFront=da.KEEP,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=fa.ALWAYS,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=da.KEEP,this.stencilZFailOpBack=da.KEEP,this.stencilPassOpBack=da.KEEP,this.stencilRefBack=1},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return nr}}]),e}()),Ss=e("c5",function(){function e(e,t,n,i,r,o,a,s){void 0===e&&(e=!1),void 0===t&&(t=pa.ONE),void 0===n&&(n=pa.ZERO),void 0===i&&(i=ma.ADD),void 0===r&&(r=pa.ONE),void 0===o&&(o=pa.ZERO),void 0===a&&(a=ma.ADD),void 0===s&&(s=va.ALL),this.blend=e,this.blendSrc=t,this.blendDst=n,this.blendEq=i,this.blendSrcAlpha=r,this.blendDstAlpha=o,this.blendAlphaEq=a,this.blendColorMask=s}var t=e.prototype;return t.reset=function(){this.blend=!1,this.blendSrc=pa.ONE,this.blendDst=pa.ZERO,this.blendEq=ma.ADD,this.blendSrcAlpha=pa.ONE,this.blendDstAlpha=pa.ZERO,this.blendAlphaEq=ma.ADD,this.blendColorMask=va.ALL},t.assign=function(e){Object.assign(this,e)},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return nr}}]),e}()),As=e("a7",function(){function e(e,t,n,i){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=new ms),void 0===i&&(i=[new Ss]),this.isA2C=e,this.isIndepend=t,this.blendColor=n,this.targets=i}var t=e.prototype;return t.setTarget=function(e,t){var n=this.targets[e];n||(n=this.targets[e]=new Ss),Object.assign(n,t)},t.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},t.destroy=function(){},Z(e,[{key:"handle",get:function(){return nr}}]),e}()),Cs=e("eZ",(function(e){void 0===e&&(e=[]),this.attributes=e})),ws=e("e_",(function(e,t,n,i,r,o,a,s,c){void 0===s&&(s=la.TRIANGLE_LIST),void 0===c&&(c=Na.NONE),this.shader=e,this.pipelineLayout=t,this.renderPass=n,this.inputState=i,this.rasterizerState=r,this.depthStencilState=o,this.blendState=a,this.primitive=s,this.dynamicStates=c})),bs=e("$",function(e){function t(t){var n;return(n=e.call(this,Jo.PIPELINE_STATE)||this)._device=void 0,n._shader=null,n._pipelineLayout=null,n._primitive=la.TRIANGLE_LIST,n._is=null,n._rs=new Es,n._dss=new Ts,n._bs=new As,n._dynamicStates=Na.NONE,n._renderPass=null,n._device=t,n}return $(t,e),Z(t,[{key:"shader",get:function(){return this._shader}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"primitive",get:function(){return this._primitive}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"inputState",get:function(){return this._is}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"renderPass",get:function(){return this._renderPass}}]),t}(Ua)),Is=e("ah",(function(e){void 0===e&&(e=Ma.GRAPHICS),this.type=e})),Rs=e("a0",function(e){function t(t){var n;return(n=e.call(this,Jo.QUEUE)||this)._device=void 0,n._type=Ma.GRAPHICS,n._isAsync=!1,n._device=t,n}return $(t,e),Z(t,[{key:"type",get:function(){return this._type}}]),t.prototype.isAsync=function(){return this._isAsync},t}(Ua)),Os=e("f0",(function(e,t,n,i,r,o){void 0===e&&(e=ra.UNKNOWN),void 0===t&&(t=1),void 0===n&&(n=ba.CLEAR),void 0===i&&(i=Ia.STORE),void 0===r&&(r=Ra.UNDEFINED),void 0===o&&(o=Ra.PRESENT_SRC),this.format=e,this.sampleCount=t,this.loadOp=n,this.storeOp=i,this.beginLayout=r,this.endLayout=o})),Ns=e("f1",(function(e,t,n,i,r,o,a,s){void 0===e&&(e=ra.UNKNOWN),void 0===t&&(t=1),void 0===n&&(n=ba.CLEAR),void 0===i&&(i=Ia.STORE),void 0===r&&(r=ba.CLEAR),void 0===o&&(o=Ia.STORE),void 0===a&&(a=Ra.UNDEFINED),void 0===s&&(s=Ra.DEPTH_STENCIL_ATTACHMENT_OPTIMAL),this.format=e,this.sampleCount=t,this.depthLoadOp=n,this.depthStoreOp=i,this.stencilLoadOp=r,this.stencilStoreOp=o,this.beginLayout=a,this.endLayout=s})),Ps=e("f2",(function(e,t,n,i,r,o){void 0===e&&(e=Oa.GRAPHICS),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=-1),void 0===o&&(o=[]),this.bindPoint=e,this.inputs=t,this.colors=n,this.resolves=i,this.depthStencil=r,this.preserves=o})),Ms=e("f3",(function(e,t,n){void 0===e&&(e=[]),void 0===t&&(t=null),void 0===n&&(n=[]),this.colorAttachments=e,this.depthStencilAttachment=t,this.subPasses=n})),Ds=e("a1",function(e){function t(t){var n;return(n=e.call(this,Jo.RENDER_PASS)||this)._device=void 0,n._colorInfos=[],n._depthStencilInfo=null,n._subPasses=[],n._hash=0,n._device=t,n}return $(t,e),Z(t,[{key:"colorAttachments",get:function(){return this._colorInfos}},{key:"depthStencilAttachment",get:function(){return this._depthStencilInfo}},{key:"subPasses",get:function(){return this._subPasses}},{key:"hash",get:function(){return this._hash}}]),t.prototype.computeHash=function(){var e="";if(this._subPasses.length)for(var t=0;t<this._subPasses.length;++t){var n=this._subPasses[t];if(n.inputs.length){e+="ia";for(var i=0;i<n.inputs.length;++i){var r=this._colorInfos[n.inputs[i]];e+=","+r.format+","+r.sampleCount}}if(n.colors.length){e+="ca";for(var o=0;o<n.inputs.length;++o){var a=this._colorInfos[n.inputs[o]];e+=","+a.format+","+a.sampleCount}}if(n.depthStencil>=0){var s=this._colorInfos[n.depthStencil];e+="ds,"+s.format+","+s.sampleCount}}else{e+="ca";for(var c=0;c<this._colorInfos.length;++c){var l=this._colorInfos[c];e+=","+l.format+","+l.sampleCount}var u=this._depthStencilInfo;u&&(e+="ds,"+u.format+","+u.sampleCount)}return ls(e,666)},t}(Ua)),Ls=e("f4",(function(e,t,n,i,r,o,a,s,c,l,u,h){void 0===e&&(e=ga.LINEAR),void 0===t&&(t=ga.LINEAR),void 0===n&&(n=ga.NONE),void 0===i&&(i=ya.WRAP),void 0===r&&(r=ya.WRAP),void 0===o&&(o=ya.WRAP),void 0===a&&(a=16),void 0===s&&(s=fa.NEVER),void 0===c&&(c=new ms),void 0===l&&(l=0),void 0===u&&(u=0),void 0===h&&(h=0),this.minFilter=e,this.magFilter=t,this.mipFilter=n,this.addressU=i,this.addressV=r,this.addressW=o,this.maxAnisotropy=a,this.cmpFunc=s,this.borderColor=c,this.minLOD=l,this.maxLOD=u,this.mipLODBias=h})),Fs=e("a3",function(e){function t(t){var n;return(n=e.call(this,Jo.SAMPLER)||this)._device=void 0,n._minFilter=ga.LINEAR,n._magFilter=ga.LINEAR,n._mipFilter=ga.NONE,n._addressU=ya.WRAP,n._addressV=ya.WRAP,n._addressW=ya.WRAP,n._maxAnisotropy=16,n._cmpFunc=fa.NEVER,n._borderColor=new ms,n._minLOD=0,n._maxLOD=0,n._mipLODBias=0,n._device=t,n}return $(t,e),Z(t,[{key:"minFilter",get:function(){return this._minFilter}},{key:"magFilter",get:function(){return this._magFilter}},{key:"mipFilter",get:function(){return this._mipFilter}},{key:"addressU",get:function(){return this._addressU}},{key:"addressV",get:function(){return this._addressV}},{key:"addressW",get:function(){return this._addressW}},{key:"maxAnisotropy",get:function(){return this._maxAnisotropy}},{key:"cmpFunc",get:function(){return this._cmpFunc}},{key:"borderColor",get:function(){return this._borderColor}},{key:"minLOD",get:function(){return this._minLOD}},{key:"maxLOD",get:function(){return this._maxLOD}},{key:"mipLODBias",get:function(){return this._mipLODBias}}]),t}(Ua)),zs=e("f5",(function(e,t){void 0===e&&(e=Aa.NONE),void 0===t&&(t=""),this.stage=e,this.source=t})),Bs=e("f6",(function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=ia.UNKNOWN),void 0===n&&(n=1),this.name=e,this.type=t,this.count=n})),Us=e("f7",(function(e,t,n,i,r){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===n&&(n=""),void 0===i&&(i=[]),void 0===r&&(r=1),this.set=e,this.binding=t,this.name=n,this.members=i,this.count=r})),Gs=e("f8",(function(e,t,n,i,r){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===n&&(n=""),void 0===i&&(i=ia.UNKNOWN),void 0===r&&(r=1),this.set=e,this.binding=t,this.name=n,this.type=i,this.count=r})),Hs=e("f9",(function(e,t,n,i,r){void 0===e&&(e=""),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=[]),this.name=e,this.stages=t,this.attributes=n,this.blocks=i,this.samplers=r})),ks=e("a4",function(e){function t(n){var i;return(i=e.call(this,Jo.SHADER)||this)._device=void 0,i._id=void 0,i._name="",i._stages=[],i._attributes=[],i._blocks=[],i._samplers=[],i._device=n,i._id=t._shaderIdGen++,i}return $(t,e),Z(t,[{key:"id",get:function(){return this._id}},{key:"name",get:function(){return this._name}},{key:"attributes",get:function(){return this._attributes}},{key:"blocks",get:function(){return this._blocks}},{key:"samplers",get:function(){return this._samplers}}]),t}(Ua));ks._shaderIdGen=0;var Vs=e("ak",(function(e,t,n,i,r,o,a,s,c,l){void 0===t&&(t=Ea.NONE),void 0===n&&(n=ra.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=Sa.NONE),void 0===a&&(a=1),void 0===s&&(s=1),void 0===c&&(c=Ta.X1),void 0===l&&(l=1),this.type=e,this.usage=t,this.format=n,this.width=i,this.height=r,this.flags=o,this.layerCount=a,this.levelCount=s,this.samples=c,this.depth=l})),js=e("fa",(function(e,t,n,i,r,o,a){void 0===t&&(t=xa.TEX2D),void 0===n&&(n=ra.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=1),void 0===o&&(o=0),void 0===a&&(a=1),this.texture=e,this.type=t,this.format=n,this.baseLevel=i,this.levelCount=r,this.baseLayer=o,this.layerCount=a}));function Ws(e){return e>0&&0==(e&e-1)}var qs=e("aa",function(e){function t(t){var n;return(n=e.call(this,Jo.TEXTURE)||this)._device=void 0,n._type=xa.TEX2D,n._usage=Ea.NONE,n._format=ra.UNKNOWN,n._width=0,n._height=0,n._depth=1,n._layerCount=1,n._levelCount=1,n._samples=Ta.X1,n._flags=Sa.NONE,n._isPowerOf2=!1,n._size=0,n._buffer=null,n._device=t,n}return $(t,e),Z(t,[{key:"type",get:function(){return this._type}},{key:"usage",get:function(){return this._usage}},{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"depth",get:function(){return this._depth}},{key:"layerCount",get:function(){return this._layerCount}},{key:"levelCount",get:function(){return this._levelCount}},{key:"samples",get:function(){return this._samples}},{key:"flags",get:function(){return this._flags}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer}}]),t}(Ua)),Ys={Device:rs,Buffer:$a,Texture:qs,Sampler:Fs,Shader:ks,InputAssembler:_s,RenderPass:Ds,Framebuffer:as,PipelineState:bs,CommandBuffer:ts,Queue:Rs,FormatSize:Va,FormatSurfaceSize:ja,GetTypeSize:qa,getTypedArrayConstructor:Ya,MAX_ATTACHMENTS:ta,ObjectType:Jo,Obj:Ua,AttributeName:na,Type:ia,Format:ra,BufferUsageBit:oa,MemoryUsageBit:aa,BufferFlagBit:sa,BufferAccessBit:ca,PrimitiveMode:la,PolygonMode:ua,ShadeModel:ha,CullMode:_a,ComparisonFunc:fa,StencilOp:da,BlendOp:ma,BlendFactor:pa,ColorMask:va,Filter:ga,Address:ya,TextureType:xa,TextureUsageBit:Ea,SampleCount:Ta,TextureFlagBit:Sa,ShaderStageFlagBit:Aa,DescriptorType:Ca,CommandBufferType:wa,LoadOp:ba,StoreOp:Ia,TextureLayout:Ra,PipelineBindPoint:Oa,DynamicStateFlagBit:Na,StencilFace:Pa,QueueType:Ma,Rect:fs,Viewport:ds,Color:ms,ClearFlag:Da,Offset:ps,Extent:vs,TextureSubres:gs,TextureCopy:ys,BufferTextureCopy:xs,FormatType:La,FormatInfo:Ga,MemoryStatus:Ha,FormatInfos:ka},Xs=e("D",Ca.UNIFORM_BUFFER|Ca.DYNAMIC_UNIFORM_BUFFER|Ca.STORAGE_BUFFER|Ca.DYNAMIC_STORAGE_BUFFER),Ks=e("k",Ca.SAMPLER),Qs=e("cA",(function(e){this.layout=e})),Zs=e("m",function(e){function t(t){var n;return(n=e.call(this,Jo.DESCRIPTOR_SET)||this)._device=void 0,n._layout=null,n._buffers=[],n._textures=[],n._samplers=[],n._isDirty=!1,n._device=t,n}$(t,e),Z(t,[{key:"layout",get:function(){return this._layout}}]);var n=t.prototype;return n.bindBuffer=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&Xs){var o=this._layout.descriptorIndices[e];this._buffers[o+n]!==t&&(this._buffers[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.UNIFORM_BUFFER.")},n.bindSampler=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&Ks){var o=this._layout.descriptorIndices[e];this._samplers[o+n]!==t&&(this._samplers[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},n.bindTexture=function(e,t,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[e],r=this._layout.bindings[i];if(r)if(r.descriptorType&Ks){var o=this._layout.descriptorIndices[e];this._textures[o+n]!==t&&(this._textures[o+n]=t,this._isDirty=!0)}else console.warn("Setting binding is not DescriptorType.SAMPLER.")},n.getBuffer=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._buffers[n+t]},n.getSampler=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._samplers[n+t]},n.getTexture=function(e,t){void 0===t&&(t=0);var n=this._layout.descriptorIndices[e];return this._textures[n+t]},t}(Ua)),Js=e("eW",(function(e,t,n,i,r){void 0===e&&(e=-1),void 0===t&&(t=Ca.UNKNOWN),void 0===n&&(n=0),void 0===i&&(i=Aa.NONE),void 0===r&&(r=[]),this.binding=e,this.descriptorType=t,this.count=n,this.stageFlags=i,this.immutableSamplers=r})),$s=e("eX",(function(e){void 0===e&&(e=[]),this.bindings=e})),ec=e("X",Ca.DYNAMIC_STORAGE_BUFFER|Ca.DYNAMIC_UNIFORM_BUFFER),tc=e("Y",function(e){function t(t){var n;return(n=e.call(this,Jo.DESCRIPTOR_SET_LAYOUT)||this)._device=void 0,n._bindings=[],n._bindingIndices=[],n._descriptorIndices=[],n._device=t,n}return $(t,e),Z(t,[{key:"bindings",get:function(){return this._bindings}},{key:"bindingIndices",get:function(){return this._bindingIndices}},{key:"descriptorIndices",get:function(){return this._descriptorIndices}}]),t}(Ua)),nc=e("eY",(function(e){void 0===e&&(e=[]),this.setLayouts=e})),ic=e("Z",function(e){function t(t){var n;return(n=e.call(this,Jo.PIPELINE_LAYOUT)||this)._device=void 0,n._setLayouts=[],n._device=t,n}return $(t,e),Z(t,[{key:"setLayouts",get:function(){return this._setLayouts}}]),t}(Ua)),rc=e("e$",(function(){})),oc=e("O",function(e){function t(t){var n;return(n=e.call(this,Jo.FENCE)||this)._device=void 0,n._device=t,n}return $(t,e),t}(Ua));ve(c,"cc",[{name:"GFXDynamicState",newName:"DynamicStateFlagBit"},{name:"GFXBindingType",newName:"DescriptorType"},{name:"GFXBindingLayout",newName:"DescriptorSet"}]),ge(ts.prototype,"CommandBuffer.prototype",[{name:"bindBindingLayout",suggest:"Use `bindDescriptorSet` instead"}]);var ac,sc={MAX_ATTACHMENTS:"GFX_MAX_ATTACHMENTS",Obj:"GFXObject",getTypedArrayConstructor:""};for(var cc in Ys){var lc=sc[cc];""!==lc&&(void 0===lc&&(lc="GFX"+cc),ve(c,"cc",[{name:lc,newName:cc,target:c.gfx,targetName:"cc.gfx"}]))}c.gfx=Ys,e("dI",Object.freeze({__proto__:null,DESCRIPTOR_BUFFER_TYPE:Xs,DESCRIPTOR_SAMPLER_TYPE:Ks,DescriptorSetInfo:Qs,DescriptorSet:Zs,DrawInfo:Xa,DRAW_INFO_SIZE:Ka,IndirectBuffer:Qa,BufferInfo:Za,BufferViewInfo:Ja,Buffer:$a,CommandBufferInfo:es,CommandBuffer:ts,MAX_ATTACHMENTS:ta,get ObjectType(){return Jo},Obj:Ua,get AttributeName(){return na},get Type(){return ia},get Format(){return ra},get BufferUsageBit(){return oa},get MemoryUsageBit(){return aa},get BufferFlagBit(){return sa},get BufferAccessBit(){return ca},get PrimitiveMode(){return la},get PolygonMode(){return ua},get ShadeModel(){return ha},get CullMode(){return _a},get ComparisonFunc(){return fa},get StencilOp(){return da},get BlendOp(){return ma},get BlendFactor(){return pa},get ColorMask(){return va},get Filter(){return ga},get Address(){return ya},get TextureType(){return xa},get TextureUsageBit(){return Ea},get SampleCount(){return Ta},get TextureFlagBit(){return Sa},get ShaderStageFlagBit(){return Aa},get DescriptorType(){return Ca},get CommandBufferType(){return wa},get LoadOp(){return ba},get StoreOp(){return Ia},get TextureLayout(){return Ra},get PipelineBindPoint(){return Oa},get DynamicStateFlagBit(){return Na},get StencilFace(){return Pa},get QueueType(){return Ma},get ClearFlag(){return Da},get FormatType(){return La},get API(){return Fa},get SurfaceTransform(){return za},get Feature(){return Ba},FormatInfo:Ga,MemoryStatus:Ha,FormatInfos:ka,FormatSize:Va,FormatSurfaceSize:ja,GetTypeSize:qa,getTypedArrayConstructor:Ya,Rect:fs,Viewport:ds,Color:ms,Offset:ps,Extent:vs,TextureSubres:gs,TextureCopy:ys,BufferTextureCopy:xs,BindingMappingInfo:ns,DeviceInfo:is,Device:rs,FramebufferInfo:os,Framebuffer:as,Attribute:us,InputAssemblerInfo:hs,InputAssembler:_s,DescriptorSetLayoutBinding:Js,DescriptorSetLayoutInfo:$s,DESCRIPTOR_DYNAMIC_TYPE:ec,DescriptorSetLayout:tc,PipelineLayoutInfo:nc,PipelineLayout:ic,RasterizerState:Es,DepthStencilState:Ts,BlendTarget:Ss,BlendState:As,InputState:Cs,PipelineStateInfo:ws,PipelineState:bs,FenceInfo:rc,Fence:oc,QueueInfo:Is,Queue:Rs,ColorAttachment:Os,DepthStencilAttachment:Ns,SubPassInfo:Ps,RenderPassInfo:Ms,RenderPass:Ds,SamplerInfo:Ls,Sampler:Fs,ShaderStage:zs,Uniform:Bs,UniformBlock:Us,UniformSampler:Gs,ShaderInfo:Hs,Shader:ks,TextureInfo:Vs,TextureViewInfo:js,IsPowerOf2:Ws,Texture:qs})),function(e){e[e.ALL=0]="ALL",e[e.CLOSEST=1]="CLOSEST",e[e.ANY=2]="ANY"}(ac||(ac={}));var uc,hc,_c,fc,dc,mc,pc,vc,gc=(uc=new Wn(0,0,0),function(e,t){var n=Wn.dot(e.d,t.n);if(Math.abs(n)<Number.EPSILON)return 0;Wn.multiplyScalar(uc,t.n,t.d);var i=Wn.dot(Wn.subtract(uc,uc,e.o),t.n)/n;return i<0?0:i}),yc=(hc=new Wn(0,0,0),_c=new Wn(0,0,0),fc=new Wn(0,0,0),dc=new Wn(0,0,0),mc=new Wn(0,0,0),function(e,t,n){Wn.subtract(hc,t.b,t.a),Wn.subtract(_c,t.c,t.a),Wn.cross(fc,e.d,_c);var i=Wn.dot(hc,fc);if(i<Number.EPSILON&&(!n||i>-Number.EPSILON))return 0;var r=1/i;Wn.subtract(dc,e.o,t.a);var o=Wn.dot(dc,fc)*r;if(o<0||o>1)return 0;Wn.cross(mc,dc,hc);var a=Wn.dot(e.d,mc)*r;if(a<0||o+a>1)return 0;var s=Wn.dot(_c,mc)*r;return s<0?0:s}),xc=function(){var e=new Wn(0,0,0);return function(t,n){var i=n.radius,r=n.center,o=t.o,a=t.d,s=i*i;Wn.subtract(e,r,o);var c=e.lengthSqr(),l=Wn.dot(e,a),u=s-(c-l*l);if(u<0)return 0;var h=Math.sqrt(u),_=c<s?l+h:l-h;return _<0?0:_}}(),Ec=(pc=new Wn,vc=new Wn,function(e,t){return Wn.subtract(pc,t.center,t.halfExtents),Wn.add(vc,t.center,t.halfExtents),Tc(e,pc,vc)});function Tc(e,t,n){var i=e.o,r=e.d,o=1/r.x,a=1/r.y,s=1/r.z,c=(t.x-i.x)*o,l=(n.x-i.x)*o,u=(t.y-i.y)*a,h=(n.y-i.y)*a,_=(t.z-i.z)*s,f=(n.z-i.z)*s,d=Math.max(Math.max(Math.min(c,l),Math.min(u,h)),Math.min(_,f)),m=Math.min(Math.min(Math.max(c,l),Math.max(u,h)),Math.max(_,f));return m<0||d>m?0:d>0?d:m}var Sc,Ac,Cc,wc,bc=function(){var e=new Wn,t=new Wn,n=new Wn,i=new Wn,r=new Wn,o=new Wn,a=new Wn,s=new Array(3),c=new Array(3),l=new Array(3),u=new Array(6);return function(h,_){s[0]=_.halfExtents.x,s[1]=_.halfExtents.y,s[2]=_.halfExtents.z,e=_.center,t=h.o,n=h.d,Wn.set(i,_.orientation.m00,_.orientation.m01,_.orientation.m02),Wn.set(r,_.orientation.m03,_.orientation.m04,_.orientation.m05),Wn.set(o,_.orientation.m06,_.orientation.m07,_.orientation.m08),Wn.subtract(a,e,t),c[0]=Wn.dot(i,n),c[1]=Wn.dot(r,n),c[2]=Wn.dot(o,n),l[0]=Wn.dot(i,a),l[1]=Wn.dot(r,a),l[2]=Wn.dot(o,a);for(var f=0;f<3;++f){if(0===c[f]){if(-l[f]-s[f]>0||-l[f]+s[f]<0)return 0;c[f]=1e-7}u[2*f+0]=(l[f]+s[f])/c[f],u[2*f+1]=(l[f]-s[f])/c[f]}var d=Math.max(Math.max(Math.min(u[0],u[1]),Math.min(u[2],u[3])),Math.min(u[4],u[5])),m=Math.min(Math.min(Math.max(u[0],u[1]),Math.max(u[2],u[3])),Math.max(u[4],u[5]));return m<0||d>m?0:d>0?d:m}}(),Ic=function(){var e=new Wn,t=new Wn,n=new Wn,i=new Wn,r=new Wn,o=new Wn,a=new Wn,s=new $o;return function(c,l){var u=l.radius*l.radius,h=Wn.normalize(e,c.d),_=l.ellipseCenter0,f=l.ellipseCenter1,d=Wn.subtract(t,f,_);if(d.equals(Wn.ZERO))return s.radius=l.radius,s.center.set(l.ellipseCenter0),_l.raySphere(c,s);var m=c.o,p=Wn.subtract(n,m,_),v=Wn.cross(i,h,d),g=v.lengthSqr();if(0===g){s.radius=l.radius;var y=Wn.subtract(r,f,m);return p.lengthSqr()<y.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),_l.raySphere(c,s)}var x=Wn.cross(r,p,d),E=d.lengthSqr(),T=2*Wn.dot(v,x),S=T*T-4*g*(x.lengthSqr()-u*E);if(S<0)return 0;var A=(-T-Math.sqrt(S))/(2*g);if(A<0){s.radius=l.radius;var C=Wn.subtract(o,f,m);return p.lengthSqr()<C.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),_l.raySphere(c,s)}var w=Wn.scaleAndAdd(o,c.o,h,A),b=Wn.subtract(a,w,_),I=Wn.dot(b,d)/E;return I>=0&&I<=1?A:I<0?(s.radius=l.radius,s.center.set(l.ellipseCenter0),_l.raySphere(c,s)):I>1?(s.radius=l.radius,s.center.set(l.ellipseCenter1),_l.raySphere(c,s)):0}}(),Rc=(Sc=ea.create(),Ac={distance:1/0,doubleSided:!1,mode:ac.ANY},Cc=0,wc=function(e,t,n,i,r,o){e===ac.CLOSEST?(Cc>t||0===Cc)&&(Cc=t,o&&(0===o.length?o.push({distance:t,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}):(o[0].distance=t,o[0].vertexIndex0=n/3,o[0].vertexIndex1=i/3,o[0].vertexIndex2=r/3))):(Cc=t,o&&o.push({distance:t,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}))},function(e,t,n){if(Cc=0,0===t.geometricInfo.positions.length)return Cc;var i=void 0===n?Ac:n;if(Tc(e,t.geometricInfo.boundingBox.min,t.geometricInfo.boundingBox.max)){var r=t.primitiveMode,o=t.geometricInfo;!function(e,t,n,i,r){if(n===la.TRIANGLE_LIST)for(var o=t.length,a=0;a<o;a+=3){var s=3*t[a],c=3*t[a+1],l=3*t[a+2];Wn.set(Sc.a,e[s],e[s+1],e[s+2]),Wn.set(Sc.b,e[c],e[c+1],e[c+2]),Wn.set(Sc.c,e[l],e[l+1],e[l+2]);var u=_l.rayTriangle(i,Sc,r.doubleSided);if(!(0===u||u>r.distance)&&(wc(r.mode,u,s,c,l,r.result),r.mode===ac.ANY))return u}else if(n===la.TRIANGLE_STRIP)for(var h=t.length-2,_=0,f=0;f<h;f+=1){var d=3*t[f-_],m=3*t[f+_+1],p=3*t[f+2];Wn.set(Sc.a,e[d],e[d+1],e[d+2]),Wn.set(Sc.b,e[m],e[m+1],e[m+2]),Wn.set(Sc.c,e[p],e[p+1],e[p+2]),_=~_;var v=_l.rayTriangle(i,Sc,r.doubleSided);if(!(0===v||v>r.distance)&&(wc(r.mode,v,d,m,p,r.result),r.mode===ac.ANY))return v}else if(n===la.TRIANGLE_FAN){var g=t.length-1,y=3*t[0];Wn.set(Sc.a,e[y],e[y+1],e[y+2]);for(var x=1;x<g;x+=1){var E=3*t[x],T=3*t[x+1];Wn.set(Sc.b,e[E],e[E+1],e[E+2]),Wn.set(Sc.c,e[T],e[T+1],e[T+2]);var S=_l.rayTriangle(i,Sc,r.doubleSided);if(!(0===S||S>r.distance)&&(wc(r.mode,S,y,E,T,r.result),r.mode===ac.ANY))return S}}}(o.positions,o.indices,r,e,i)}return Cc}),Oc=function(){var e=0,t={distance:1/0,doubleSided:!1,mode:ac.ANY};return function(n,i,r){e=0;var o=void 0===r?t:r,a=i.renderingSubMeshes.length,s=i.struct.minPosition,c=i.struct.maxPosition;if(s&&c&&!Tc(n,s,c))return e;for(var l=0;l<a;l++){var u=i.renderingSubMeshes[l],h=Rc(n,u,o);if(h)if(o.mode===ac.CLOSEST)(0===e||e>h)&&(e=h,o.subIndices&&(o.subIndices[0]=l));else if(e=h,o.subIndices&&o.subIndices.push(l),o.mode===ac.ANY)return h}return e&&o.mode===ac.CLOSEST&&(o.result&&(o.result[0].distance=e,o.result.length=1),o.subIndices&&(o.subIndices.length=1)),e}}(),Nc=function(){var e=0,t={distance:1/0,doubleSided:!1,mode:ac.ANY},n=new qo,i=new ai;return function(r,o,a){e=0;var s=void 0===a?t:a,c=o.worldBounds;if(c&&!Ec(r,c))return e;qo.copy(n,r),o.node&&(ai.invert(i,o.node.getWorldMatrix(i)),Wn.transformMat4(n.o,r.o,i),Wn.transformMat4Normal(n.d,r.d,i));for(var l=o.subModels,u=0;u<l.length;u++){var h=l[u].subMesh,_=Rc(n,h,s);if(_)if(s.mode===ac.CLOSEST)(0===e||e>_)&&(e=_,s.subIndices&&(s.subIndices[0]=u));else if(e=_,s.subIndices&&s.subIndices.push(u),s.mode===ac.ANY)return _}return e&&s.mode===ac.CLOSEST&&(s.result&&(s.result[0].distance=e,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),e}}(),Pc=function(){var e=new Wn(0,0,0);return function(t,n){Wn.subtract(e,t.e,t.s);var i=(n.d-Wn.dot(t.s,n.n))/Wn.dot(e,n.n);return i<0||i>1?0:i}}(),Mc=function(){var e=new Wn(0,0,0),t=new Wn(0,0,0),n=new Wn(0,0,0),i=new Wn(0,0,0),r=new Wn(0,0,0),o=new Wn(0,0,0);return function(a,s,c){Wn.subtract(e,s.b,s.a),Wn.subtract(t,s.c,s.a),Wn.subtract(n,a.s,a.e),Wn.cross(r,e,t);var l=Wn.dot(n,r);if(l<=0)return 0;Wn.subtract(i,a.s,s.a);var u=Wn.dot(i,r);if(u<0||u>l)return 0;Wn.cross(o,n,i);var h=Wn.dot(t,o);if(h<0||h>l)return 0;var _=-Wn.dot(e,o);if(_<0||h+_>l)return 0;if(c){var f=1/l,d=1-(h*=f)-(_*=f);Wn.set(c,s.a.x*d+s.b.x*h+s.c.x*_,s.a.y*d+s.b.y*h+s.c.y*_,s.a.z*d+s.b.z*h+s.c.z*_)}return 1}}(),Dc=new qo;function Lc(e,t){Dc.o.set(e.s),Wn.subtract(Dc.d,e.e,e.s),Dc.d.normalize();var n=Ec(Dc,t);return n<=e.length()?n:0}function Fc(e,t){Dc.o.set(e.s),Wn.subtract(Dc.d,e.e,e.s),Dc.d.normalize();var n=bc(Dc,t);return n<=e.length()?n:0}function zc(e,t){Dc.o.set(e.s),Wn.subtract(Dc.d,e.e,e.s),Dc.d.normalize();var n=xc(Dc,t);return n<=e.length()?n:0}var Bc,Uc,Gc,Hc,kc=(Bc=new Wn,Uc=new Wn,Gc=new Wn,Hc=new Wn,function(e,t){return Wn.subtract(Bc,e.center,e.halfExtents),Wn.add(Uc,e.center,e.halfExtents),Wn.subtract(Gc,t.center,t.halfExtents),Wn.add(Hc,t.center,t.halfExtents),Bc.x<=Hc.x&&Uc.x>=Gc.x&&Bc.y<=Hc.y&&Uc.y>=Gc.y&&Bc.z<=Hc.z&&Uc.z>=Gc.z});function Vc(e,t,n,i,r,o){Wn.set(o[0],e.x+n.x*t.x+i.x*t.y+r.x*t.z,e.y+n.y*t.x+i.y*t.y+r.y*t.z,e.z+n.z*t.x+i.z*t.y+r.z*t.z),Wn.set(o[1],e.x-n.x*t.x+i.x*t.y+r.x*t.z,e.y-n.y*t.x+i.y*t.y+r.y*t.z,e.z-n.z*t.x+i.z*t.y+r.z*t.z),Wn.set(o[2],e.x+n.x*t.x-i.x*t.y+r.x*t.z,e.y+n.y*t.x-i.y*t.y+r.y*t.z,e.z+n.z*t.x-i.z*t.y+r.z*t.z),Wn.set(o[3],e.x+n.x*t.x+i.x*t.y-r.x*t.z,e.y+n.y*t.x+i.y*t.y-r.y*t.z,e.z+n.z*t.x+i.z*t.y-r.z*t.z),Wn.set(o[4],e.x-n.x*t.x-i.x*t.y-r.x*t.z,e.y-n.y*t.x-i.y*t.y-r.y*t.z,e.z-n.z*t.x-i.z*t.y-r.z*t.z),Wn.set(o[5],e.x+n.x*t.x-i.x*t.y-r.x*t.z,e.y+n.y*t.x-i.y*t.y-r.y*t.z,e.z+n.z*t.x-i.z*t.y-r.z*t.z),Wn.set(o[6],e.x-n.x*t.x+i.x*t.y-r.x*t.z,e.y-n.y*t.x+i.y*t.y-r.y*t.z,e.z-n.z*t.x+i.z*t.y-r.z*t.z),Wn.set(o[7],e.x-n.x*t.x-i.x*t.y+r.x*t.z,e.y-n.y*t.x-i.y*t.y+r.y*t.z,e.z-n.z*t.x-i.z*t.y+r.z*t.z)}function jc(e,t){for(var n=Wn.dot(t,e[0]),i=n,r=1;r<8;++r){var o=Wn.dot(t,e[r]);n=o<n?o:n,i=o>i?o:i}return[n,i]}var Wc,qc,Yc,Xc=function(){for(var e=new Array(15),t=0;t<15;t++)e[t]=new Wn(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Wn(0,0,0),i[r]=new Wn(0,0,0);var o=new Wn,a=new Wn;return function(t,r){Wn.set(e[0],1,0,0),Wn.set(e[1],0,1,0),Wn.set(e[2],0,0,1),Wn.set(e[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Wn.set(e[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Wn.set(e[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var s=0;s<3;++s)Wn.cross(e[6+3*s+0],e[s],e[0]),Wn.cross(e[6+3*s+1],e[s],e[1]),Wn.cross(e[6+3*s+1],e[s],e[2]);Wn.subtract(o,t.center,t.halfExtents),Wn.add(a,t.center,t.halfExtents),function(e,t,n){Wn.set(n[0],e.x,t.y,t.z),Wn.set(n[1],e.x,t.y,e.z),Wn.set(n[2],e.x,e.y,t.z),Wn.set(n[3],e.x,e.y,e.z),Wn.set(n[4],t.x,t.y,t.z),Wn.set(n[5],t.x,t.y,e.z),Wn.set(n[6],t.x,e.y,t.z),Wn.set(n[7],t.x,e.y,e.z)}(o,a,n),Vc(r.center,r.halfExtents,e[3],e[4],e[5],i);for(var c=0;c<15;++c){var l=jc(n,e[c]),u=jc(i,e[c]);if(u[0]>l[1]||l[0]>u[1])return 0}return 1}}(),Kc=function(e,t){var n=e.halfExtents.x*Math.abs(t.n.x)+e.halfExtents.y*Math.abs(t.n.y)+e.halfExtents.z*Math.abs(t.n.z),i=Wn.dot(t.n,e.center);return i+n<t.d?-1:i-n>t.d?0:1},Qc=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===Kc(e,t.planes[n]))return 0;return 1},Zc=function(){for(var e=new Array(8),t=0,n=0,i=0;i<e.length;i++)e[i]=new Wn(0,0,0);return function(i,r){for(var o=0,a=!1,s=0;s<r.planes.length;s++){if(-1===(o=Kc(i,r.planes[s])))return 0;1===o&&(a=!0)}if(!a)return 1;for(var c=0;c<r.vertices.length;c++)Wn.subtract(e[c],r.vertices[c],i.center);t=0,n=0;for(var l=0;l<r.vertices.length;l++)e[l].x>i.halfExtents.x?t++:e[l].x<-i.halfExtents.x&&n++;if(t===r.vertices.length||n===r.vertices.length)return 0;t=0,n=0;for(var u=0;u<r.vertices.length;u++)e[u].y>i.halfExtents.y?t++:e[u].y<-i.halfExtents.y&&n++;if(t===r.vertices.length||n===r.vertices.length)return 0;t=0,n=0;for(var h=0;h<r.vertices.length;h++)e[h].z>i.halfExtents.z?t++:e[h].z<-i.halfExtents.z&&n++;return t===r.vertices.length||n===r.vertices.length?0:1}}(),Jc=(Wc=new Wn(0,0,0),qc=new Kn,function(e,t){return Wn.subtract(Wc,t,e.center),Wn.transformMat3(Wc,Wc,Kn.transpose(qc,e.orientation)),n=Wc,i=e.halfExtents,Math.abs(n.x)<i.x&&Math.abs(n.y)<i.y&&Math.abs(n.z)<i.z;var n,i}),$c=(Yc=function(e,t,n,i){return Math.abs(e.x*t+e.y*n+e.z*i)},function(e,t){var n=e.halfExtents.x*Yc(t.n,e.orientation.m00,e.orientation.m01,e.orientation.m02)+e.halfExtents.y*Yc(t.n,e.orientation.m03,e.orientation.m04,e.orientation.m05)+e.halfExtents.z*Yc(t.n,e.orientation.m06,e.orientation.m07,e.orientation.m08),i=Wn.dot(t.n,e.center);return i+n<t.d?-1:i-n>t.d?0:1}),el=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===$c(e,t.planes[n]))return 0;return 1},tl=function(){for(var e=new Array(8),t=0,n=0,i=0,r=0;r<e.length;r++)e[r]=new Wn(0,0,0);var o=function(e,t,n,i){return e.x*t+e.y*n+e.z*i};return function(r,a){for(var s=0,c=!1,l=0;l<a.planes.length;l++){if(-1===(s=$c(r,a.planes[l])))return 0;1===s&&(c=!0)}if(!c)return 1;for(var u=0;u<a.vertices.length;u++)Wn.subtract(e[u],a.vertices[u],r.center);n=0,i=0;for(var h=0;h<a.vertices.length;h++)(t=o(e[h],r.orientation.m00,r.orientation.m01,r.orientation.m02))>r.halfExtents.x?n++:t<-r.halfExtents.x&&i++;if(n===a.vertices.length||i===a.vertices.length)return 0;n=0,i=0;for(var _=0;_<a.vertices.length;_++)(t=o(e[_],r.orientation.m03,r.orientation.m04,r.orientation.m05))>r.halfExtents.y?n++:t<-r.halfExtents.y&&i++;if(n===a.vertices.length||i===a.vertices.length)return 0;n=0,i=0;for(var f=0;f<a.vertices.length;f++)(t=o(e[f],r.orientation.m06,r.orientation.m07,r.orientation.m08))>r.halfExtents.z?n++:t<-r.halfExtents.z&&i++;return n===a.vertices.length||i===a.vertices.length?0:1}}(),nl=function(){for(var e=new Array(15),t=0;t<15;t++)e[t]=new Wn(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Wn(0,0,0),i[r]=new Wn(0,0,0);return function(t,r){Wn.set(e[0],t.orientation.m00,t.orientation.m01,t.orientation.m02),Wn.set(e[1],t.orientation.m03,t.orientation.m04,t.orientation.m05),Wn.set(e[2],t.orientation.m06,t.orientation.m07,t.orientation.m08),Wn.set(e[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Wn.set(e[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Wn.set(e[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var o=0;o<3;++o)Wn.cross(e[6+3*o+0],e[o],e[0]),Wn.cross(e[6+3*o+1],e[o],e[1]),Wn.cross(e[6+3*o+1],e[o],e[2]);Vc(t.center,t.halfExtents,e[0],e[1],e[2],n),Vc(r.center,r.halfExtents,e[3],e[4],e[5],i);for(var a=0;a<15;++a){var s=jc(n,e[a]),c=jc(i,e[a]);if(c[0]>s[1]||s[0]>c[1])return 0}return 1}}(),il=function(){for(var e=new $o,t=new Wn,n=new Wn,i=new Wn,r=new Array(8),o=0;o<8;o++)r[o]=new Wn;for(var a=new Array(8),s=0;s<8;s++)a[s]=new Wn;return function(o,s){if(0===Wn.squaredDistance(s.ellipseCenter0,s.ellipseCenter1))return e.radius=s.radius,e.center.set(s.ellipseCenter0),_l.sphereOBB(e,o);t.x=o.orientation.m00,t.y=o.orientation.m01,t.z=o.orientation.m02,n.x=o.orientation.m03,n.y=o.orientation.m04,n.z=o.orientation.m05,i.x=o.orientation.m06,i.y=o.orientation.m07,i.z=o.orientation.m08,Vc(o.center,o.halfExtents,t,n,i,r);var c=a,l=Wn.copy(c[0],t),u=Wn.copy(c[1],n),h=Wn.copy(c[2],i);Wn.subtract(c[3],s.center,o.center).normalize();var _=Wn.subtract(c[4],s.ellipseCenter0,s.ellipseCenter1);_.normalize(),Wn.cross(c[5],l,_),Wn.cross(c[6],u,_),Wn.cross(c[7],h,_);for(var f=0;f<8;++f){var d=jc(r,c[f]),m=Wn.dot(c[f],s.ellipseCenter0),p=Wn.dot(c[f],s.ellipseCenter1),v=Math.max(m,p),g=Math.min(m,p)-s.radius,y=v+s.radius;if(g>d[1]||d[0]>y)return 0}return 1}}(),rl=function(e,t){var n=Wn.dot(t.n,e.center),i=e.radius*t.n.length();return n+i<t.d?-1:n-i>t.d?0:1},ol=function(e,t){for(var n=0;n<t.planes.length;n++)if(-1===rl(e,t.planes[n]))return 0;return 1},al=function(){var e=new Wn(0,0,0),t=[1,-1,1,-1,1,-1];return function(n,i){for(var r=0;r<6;r++){var o=i.planes[r],a=n.radius,s=n.center,c=o.n,l=o.d,u=Wn.dot(c,s);if(u+a<l)return 0;if(!(u-a>l)){Wn.add(e,s,Wn.multiplyScalar(e,c,a));for(var h=0;h<6;h++)if(h!==r&&h!==r+t[r]){var _=i.planes[h];if(Wn.dot(_.n,e)<_.d)return 0}}}return 1}}(),sl=function(e,t){var n=e.radius+t.radius;return Wn.squaredDistance(e.center,t.center)<n*n},cl=function(){var e=new Wn;return function(t,n){return Ho(e,t.center,n),Wn.squaredDistance(t.center,e)<t.radius*t.radius}}(),ll=function(){var e=new Wn;return function(t,n){return ko(e,t.center,n),Wn.squaredDistance(t.center,e)<t.radius*t.radius}}(),ul=function(){var e=new Wn,t=new Wn;return function(n,i){var r=n.radius+i.radius,o=r*r,a=Wn.squaredDistance(i.ellipseCenter0,i.ellipseCenter1);if(0===a)return Wn.squaredDistance(n.center,i.center)<o;Wn.subtract(e,n.center,i.ellipseCenter0),Wn.subtract(t,i.ellipseCenter1,i.ellipseCenter0);var s=Wn.dot(e,t)/a;return s<0?Wn.squaredDistance(n.center,i.ellipseCenter0)<o:s>1?Wn.squaredDistance(n.center,i.ellipseCenter1)<o:(Wn.scaleAndAdd(e,i.ellipseCenter0,t,s),Wn.squaredDistance(n.center,e)<o)}}(),hl=function(){var e=new Wn,t=new Wn,n=new Wn,i=new Wn,r=new Wn,o=new Wn;return function(a,s){var c,l,u,h,_=Wn.subtract(e,a.ellipseCenter1,a.ellipseCenter0),f=Wn.subtract(t,s.ellipseCenter1,s.ellipseCenter0),d=Wn.subtract(n,a.ellipseCenter0,s.ellipseCenter0),m=Wn.dot(_,_),p=Wn.dot(_,f),v=Wn.dot(f,f),g=Wn.dot(_,d),y=Wn.dot(f,d),x=m*v-p*p,E=x,T=x;x<Tn?(l=0,E=1,h=y,T=v):(h=m*y-p*g,(l=p*y-v*g)<0?(l=0,h=y,T=v):l>E&&(l=E,h=y+p,T=v)),h<0?(h=0,-g<0?l=0:-g>m?l=E:(l=-g,E=m)):h>T&&(h=T,-g+p<0?l=0:-g+p>m?l=E:(l=-g+p,E=m)),c=Math.abs(l)<Tn?0:l/E,u=Math.abs(h)<Tn?0:h/T;var S=i;S.set(d),S.add(Wn.multiplyScalar(r,_,c)),S.subtract(Wn.multiplyScalar(o,f,u));var A=a.radius+s.radius;return S.lengthSqr()<A*A}}(),_l={raySphere:xc,rayAABB:Ec,rayOBB:bc,rayPlane:gc,rayTriangle:yc,rayCapsule:Ic,raySubMesh:Rc,rayMesh:Oc,rayModel:Nc,lineSphere:zc,lineAABB:Lc,lineOBB:Fc,linePlane:Pc,lineTriangle:Mc,sphereWithSphere:sl,sphereAABB:cl,sphereOBB:ll,spherePlane:rl,sphereFrustum:ol,sphereFrustumAccurate:al,sphereCapsule:ul,aabbWithAABB:kc,aabbWithOBB:Xc,aabbPlane:Kc,aabbFrustum:Qc,aabbFrustumAccurate:Zc,obbWithOBB:nl,obbPlane:$c,obbFrustum:el,obbFrustumAccurate:tl,obbPoint:Jc,obbCapsule:il,capsuleWithCapsule:hl,resolve:function(e,t,n){void 0===n&&(n=null);var i=e._type,r=t._type,o=this[i|r];return i<r?o(e,t,n):o(t,e,n)}};_l[jo.SHAPE_RAY|jo.SHAPE_SPHERE]=xc,_l[jo.SHAPE_RAY|jo.SHAPE_AABB]=Ec,_l[jo.SHAPE_RAY|jo.SHAPE_OBB]=bc,_l[jo.SHAPE_RAY|jo.SHAPE_PLANE]=gc,_l[jo.SHAPE_RAY|jo.SHAPE_TRIANGLE]=yc,_l[jo.SHAPE_RAY|jo.SHAPE_CAPSULE]=Ic,_l[jo.SHAPE_LINE|jo.SHAPE_SPHERE]=zc,_l[jo.SHAPE_LINE|jo.SHAPE_AABB]=Lc,_l[jo.SHAPE_LINE|jo.SHAPE_OBB]=Fc,_l[jo.SHAPE_LINE|jo.SHAPE_PLANE]=Pc,_l[jo.SHAPE_LINE|jo.SHAPE_TRIANGLE]=Mc,_l[jo.SHAPE_SPHERE]=sl,_l[jo.SHAPE_SPHERE|jo.SHAPE_AABB]=cl,_l[jo.SHAPE_SPHERE|jo.SHAPE_OBB]=ll,_l[jo.SHAPE_SPHERE|jo.SHAPE_PLANE]=rl,_l[jo.SHAPE_SPHERE|jo.SHAPE_FRUSTUM]=ol,_l[jo.SHAPE_SPHERE|jo.SHAPE_FRUSTUM_ACCURATE]=al,_l[jo.SHAPE_SPHERE|jo.SHAPE_CAPSULE]=ul,_l[jo.SHAPE_AABB]=kc,_l[jo.SHAPE_AABB|jo.SHAPE_OBB]=Xc,_l[jo.SHAPE_AABB|jo.SHAPE_PLANE]=Kc,_l[jo.SHAPE_AABB|jo.SHAPE_FRUSTUM]=Qc,_l[jo.SHAPE_AABB|jo.SHAPE_FRUSTUM_ACCURATE]=Zc,_l[jo.SHAPE_OBB]=nl,_l[jo.SHAPE_OBB|jo.SHAPE_PLANE]=$c,_l[jo.SHAPE_OBB|jo.SHAPE_FRUSTUM]=el,_l[jo.SHAPE_OBB|jo.SHAPE_FRUSTUM_ACCURATE]=tl,_l[jo.SHAPE_OBB|jo.SHAPE_CAPSULE]=il,_l[jo.SHAPE_CAPSULE]=hl,ve(Wo.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),ge(_l,"intersect",[{name:"line_quad"}]);var fl=new Wn(0,0,0),dl=new Wn(0,0,0),ml=c.mat4(),pl=c.v4(),vl=function(){function e(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=1),void 0===n&&(n=0),void 0===i&&(i=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=jo.SHAPE_PLANE,this.n=new Wn(e,t,n),this.d=i}return e.create=function(t,n,i,r){return new e(t,n,i,r)},e.clone=function(t){return new e(t.n.x,t.n.y,t.n.z,t.d)},e.copy=function(e,t){return Wn.copy(e.n,t.n),e.d=t.d,e},e.fromPoints=function(e,t,n,i){return Wn.subtract(fl,n,t),Wn.subtract(dl,i,t),Wn.normalize(e.n,Wn.cross(e.n,fl,dl)),e.d=Wn.dot(e.n,t),e},e.set=function(e,t,n,i,r){return e.n.x=t,e.n.y=n,e.n.z=i,e.d=r,e},e.fromNormalAndPoint=function(e,t,n){return Wn.copy(e.n,t),e.d=Wn.dot(t,n),e},e.normalize=function(e,t){var n=t.n.length();return Wn.normalize(e.n,t.n),n>0&&(e.d=t.d/n),e},Z(e,[{key:"type",get:function(){return this._type}},{key:"x",set:function(e){this.n.x=e},get:function(){return this.n.x}},{key:"y",set:function(e){this.n.y=e},get:function(){return this.n.y}},{key:"z",set:function(e){this.n.z=e},get:function(){return this.n.z}},{key:"w",set:function(e){this.d=e},get:function(){return this.d}}]),e.prototype.transform=function(e){ai.invert(ml,e),ai.transpose(ml,ml),di.set(pl,this.n.x,this.n.y,this.n.z,this.d),di.transformMat4(pl,pl,ml),Wn.set(this.n,pl.x,pl.y,pl.z),this.d=pl.w},e}(),gl=new Wn,yl=new Wn,xl=new Wn,El=new Wn,Tl=new Kn,Sl=function(e,t,n){Tl.m00=Math.abs(n.m00),Tl.m01=Math.abs(n.m01),Tl.m02=Math.abs(n.m02),Tl.m03=Math.abs(n.m04),Tl.m04=Math.abs(n.m05),Tl.m05=Math.abs(n.m06),Tl.m06=Math.abs(n.m08),Tl.m07=Math.abs(n.m09),Tl.m08=Math.abs(n.m10),Wn.transformMat3(e,t,Tl)},Al=e("aL",function(){function e(e,t,n,i,r,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=jo.SHAPE_AABB,this.center=new Wn(e,t,n),this.halfExtents=new Wn(i,r,o)}e.create=function(t,n,i,r,o,a){return new e(t,n,i,r,o,a)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z)},e.copy=function(e,t){return Wn.copy(e.center,t.center),Wn.copy(e.halfExtents,t.halfExtents),e},e.fromPoints=function(e,t,n){return Wn.add(gl,n,t),Wn.subtract(yl,n,t),Wn.multiplyScalar(e.center,gl,.5),Wn.multiplyScalar(e.halfExtents,yl,.5),e},e.set=function(e,t,n,i,r,o,a){return Wn.set(e.center,t,n,i),Wn.set(e.halfExtents,r,o,a),e},e.merge=function(t,n,i){return Wn.subtract(gl,n.center,n.halfExtents),Wn.subtract(yl,i.center,i.halfExtents),Wn.add(xl,n.center,n.halfExtents),Wn.add(El,i.center,i.halfExtents),Wn.max(El,xl,El),Wn.min(xl,gl,yl),e.fromPoints(t,xl,El)},e.toBoundingSphere=function(e,t){t.getBoundary(gl,yl),e.center.set(gl),e.radius=0,Wn.subtract(xl,yl,e.center);var n=xl.length(),i=.5*n;return e.radius+=i,Wn.multiplyScalar(xl,xl,i/n),Wn.add(e.center,e.center,xl),e},e.transform=function(e,t,n){return Wn.transformMat4(e.center,t.center,n),Sl(e.halfExtents,t.halfExtents,n),e},Z(e,[{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.getBoundary=function(e,t){Wn.subtract(e,this.center,this.halfExtents),Wn.add(t,this.center,this.halfExtents)},t.transform=function(e,t,n,i,r){Wn.transformMat4(r.center,this.center,e),Sl(r.halfExtents,this.halfExtents,e)},t.clone=function(){return e.clone(this)},t.copy=function(t){return e.copy(this,t)},e}()),Cl=new Wn,wl=new Wn,bl=new Kn,Il=function(){function e(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===o&&(o=1),void 0===a&&(a=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===h&&(h=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=jo.SHAPE_OBB,this.center=new Wn(e,t,n),this.halfExtents=new Wn(i,r,o),this.orientation=new Kn(a,s,c,l,u,h,_,f,d)}e.create=function(t,n,i,r,o,a,s,c,l,u,h,_,f,d,m){return new e(t,n,i,r,o,a,s,c,l,u,h,_,f,d,m)},e.clone=function(t){return new e(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z,t.orientation.m00,t.orientation.m01,t.orientation.m02,t.orientation.m03,t.orientation.m04,t.orientation.m05,t.orientation.m06,t.orientation.m07,t.orientation.m08)},e.copy=function(e,t){return Wn.copy(e.center,t.center),Wn.copy(e.halfExtents,t.halfExtents),Kn.copy(e.orientation,t.orientation),e},e.fromPoints=function(e,t,n){return Wn.multiplyScalar(e.center,Wn.add(Cl,t,n),.5),Wn.multiplyScalar(e.halfExtents,Wn.subtract(wl,n,t),.5),Kn.identity(e.orientation),e},e.set=function(e,t,n,i,r,o,a,s,c,l,u,h,_,f,d,m){return Wn.set(e.center,t,n,i),Wn.set(e.halfExtents,r,o,a),Kn.set(e.orientation,s,c,l,u,h,_,f,d,m),e},Z(e,[{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.getBoundary=function(e,t){!function(e,t,n){bl.m00=Math.abs(n.m00),bl.m01=Math.abs(n.m01),bl.m02=Math.abs(n.m02),bl.m03=Math.abs(n.m03),bl.m04=Math.abs(n.m04),bl.m05=Math.abs(n.m05),bl.m06=Math.abs(n.m06),bl.m07=Math.abs(n.m07),bl.m08=Math.abs(n.m08),Wn.transformMat3(e,t,bl)}(Cl,this.halfExtents,this.orientation),Wn.subtract(e,this.center,Cl),Wn.add(t,this.center,Cl)},t.transform=function(e,t,n,i,r){Wn.transformMat4(r.center,this.center,e),Kn.fromQuat(r.orientation,n),Wn.multiply(r.halfExtents,this.halfExtents,i)},t.translateAndRotate=function(e,t,n){Wn.transformMat4(n.center,this.center,e),Kn.fromQuat(n.orientation,t)},t.setScale=function(e,t){Wn.multiply(t.halfExtents,this.halfExtents,e)},e}(),Rl=function(){function e(e,t,n){void 0===e&&(e=.5),void 0===t&&(t=.5),void 0===n&&(n=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=jo.SHAPE_CAPSULE,this.radius=e,this.halfHeight=t,this.axis=n,this.center=new Wn,this.rotation=new Jn,this.ellipseCenter0=new Wn(0,t,0),this.ellipseCenter1=new Wn(0,-t,0),this.updateCache()}Z(e,[{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.transform=function(e,t,n,i,r){var o=i,a=Gn(o);r.radius=this.radius*Math.abs(a);var s=(this.halfHeight+this.radius)*Math.abs(o.y)-r.radius;s<0&&(s=0),r.halfHeight=s,Wn.transformMat4(r.center,this.center,e),Jn.multiply(r.rotation,this.rotation,n),r.updateCache()},t.updateCache=function(){this.updateLocalCenter(),Wn.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),Wn.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},t.updateLocalCenter=function(){var e=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(e,0,0),this.ellipseCenter1.set(-e,0,0);break;case 1:this.ellipseCenter0.set(0,e,0),this.ellipseCenter1.set(0,-e,0);break;case 2:this.ellipseCenter0.set(0,0,e),this.ellipseCenter1.set(0,0,-e)}},e}(),Ol=new Array(8);Ol[0]=new Wn(1,1,1),Ol[1]=new Wn(-1,1,1),Ol[2]=new Wn(-1,-1,1),Ol[3]=new Wn(1,-1,1),Ol[4]=new Wn(1,1,-1),Ol[5]=new Wn(-1,1,-1),Ol[6]=new Wn(-1,-1,-1),Ol[7]=new Wn(1,-1,-1);var Nl,Pl,Ml,Dl=function(){function e(){this._type=void 0,this.planes=void 0,this.vertices=void 0,this._type=jo.SHAPE_FRUSTUM,this.planes=new Array(6);for(var e=0;e<6;++e)this.planes[e]=vl.create(0,0,0,0);this.vertices=new Array(8);for(var t=0;t<8;++t)this.vertices[t]=new Wn}e.create=function(){return new e},e.clone=function(t){return e.copy(new e,t)},e.copy=function(e,t){e._type=t._type;for(var n=0;n<6;++n)vl.copy(e.planes[n],t.planes[n]);for(var i=0;i<8;++i)Wn.copy(e.vertices[i],t.vertices[i]);return e},Z(e,[{key:"accurate",set:function(e){this._type=e?jo.SHAPE_FRUSTUM_ACCURATE:jo.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]);var t=e.prototype;return t.update=function(e,t){if(Wn.set(this.planes[0].n,e.m03+e.m00,e.m07+e.m04,e.m11+e.m08),this.planes[0].d=-(e.m15+e.m12),Wn.set(this.planes[1].n,e.m03-e.m00,e.m07-e.m04,e.m11-e.m08),this.planes[1].d=-(e.m15-e.m12),Wn.set(this.planes[2].n,e.m03+e.m01,e.m07+e.m05,e.m11+e.m09),this.planes[2].d=-(e.m15+e.m13),Wn.set(this.planes[3].n,e.m03-e.m01,e.m07-e.m05,e.m11-e.m09),this.planes[3].d=-(e.m15-e.m13),Wn.set(this.planes[4].n,e.m03+e.m02,e.m07+e.m06,e.m11+e.m10),this.planes[4].d=-(e.m15+e.m14),Wn.set(this.planes[5].n,e.m03-e.m02,e.m07-e.m06,e.m11-e.m10),this.planes[5].d=-(e.m15-e.m14),this._type===jo.SHAPE_FRUSTUM_ACCURATE){for(var n=0;n<6;n++){var i=this.planes[n],r=1/i.n.length();Wn.multiplyScalar(i.n,i.n,r),i.d*=r}for(var o=0;o<8;o++)Wn.transformMat4(this.vertices[o],Ol[o],t)}},t.transform=function(e){if(this._type===jo.SHAPE_FRUSTUM_ACCURATE){for(var t=0;t<8;t++)Wn.transformMat4(this.vertices[t],this.vertices[t],e);vl.fromPoints(this.planes[0],this.vertices[1],this.vertices[5],this.vertices[6]),vl.fromPoints(this.planes[1],this.vertices[3],this.vertices[7],this.vertices[4]),vl.fromPoints(this.planes[2],this.vertices[6],this.vertices[7],this.vertices[3]),vl.fromPoints(this.planes[3],this.vertices[0],this.vertices[4],this.vertices[5]),vl.fromPoints(this.planes[4],this.vertices[2],this.vertices[3],this.vertices[0]),vl.fromPoints(this.planes[0],this.vertices[7],this.vertices[6],this.vertices[5])}},e}();function Ll(e,t){if(t&&e!==nr){for(var n=t.vertices,i=jr.VERTICES,r=0;r<8;++r)Kr.setVec3(e,i,n[r]),i+=3;for(var o=t.planes,a=jr.PLANES,s=0;s<6;s++,a+=4)Kr.setVec4(e,a,o[s])}}Dl.createOrtho=(Nl=new Wn,function(e,t,n,i,r,o){var a=t/2,s=n/2;Wn.set(Nl,a,s,i),Wn.transformMat4(e.vertices[0],Nl,o),Wn.set(Nl,-a,s,i),Wn.transformMat4(e.vertices[1],Nl,o),Wn.set(Nl,-a,-s,i),Wn.transformMat4(e.vertices[2],Nl,o),Wn.set(Nl,a,-s,i),Wn.transformMat4(e.vertices[3],Nl,o),Wn.set(Nl,a,s,r),Wn.transformMat4(e.vertices[4],Nl,o),Wn.set(Nl,-a,s,r),Wn.transformMat4(e.vertices[5],Nl,o),Wn.set(Nl,-a,-s,r),Wn.transformMat4(e.vertices[6],Nl,o),Wn.set(Nl,a,-s,r),Wn.transformMat4(e.vertices[7],Nl,o),vl.fromPoints(e.planes[0],e.vertices[1],e.vertices[6],e.vertices[5]),vl.fromPoints(e.planes[1],e.vertices[3],e.vertices[4],e.vertices[7]),vl.fromPoints(e.planes[2],e.vertices[6],e.vertices[3],e.vertices[7]),vl.fromPoints(e.planes[3],e.vertices[0],e.vertices[5],e.vertices[4]),vl.fromPoints(e.planes[4],e.vertices[2],e.vertices[0],e.vertices[3]),vl.fromPoints(e.planes[0],e.vertices[7],e.vertices[5],e.vertices[6])}),function(e){e[e.Default=0]="Default",e[e.Normal=1]="Normal",e[e.Loop=2]="Loop",e[e.ShouldWrap=4]="ShouldWrap",e[e.Clamp=8]="Clamp",e[e.PingPong=22]="PingPong",e[e.Reverse=36]="Reverse"}(Pl||(Pl={})),function(e){e[e.Default=Pl.Default]="Default",e[e.Normal=Pl.Normal]="Normal",e[e.Reverse=Pl.Reverse]="Reverse",e[e.Loop=Pl.Loop]="Loop",e[e.LoopReverse=Pl.Loop|Pl.Reverse]="LoopReverse",e[e.PingPong=Pl.PingPong]="PingPong",e[e.PingPongReverse=Pl.PingPong|Pl.Reverse]="PingPongReverse"}(Ml||(Ml={})),wt(Ml);var Fl=function(){function e(e){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,e&&this.set(e)}return e.prototype.set=function(e){this.ratio=e.ratio,this.time=e.time,this.direction=e.direction,this.stopped=e.stopped,this.iterations=e.iterations,this.frameIndex=e.frameIndex},e}(),zl=St({Default:Pl.Default,Normal:Pl.Normal,Clamp:Pl.Clamp,Loop:Pl.Loop,PingPong:Pl.PingPong}),Bl=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};vn.fastDefine("cc.Keyframe",Bl,{time:0,value:0,inTangent:0,outTangent:0});var Ul=function(){function e(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return e.prototype.evaluate=function(e){return t=e-this.time,n=this.coefficient,t*(t*(t*n[0]+n[1])+n[2])+n[3];var t,n},e}(),Gl=e("cV",function(){function e(t){void 0===t&&(t=null),this.keyFrames=void 0,this.preWrapMode=zl.Loop,this.postWrapMode=zl.Clamp,this.cachedKey=void 0,this.keyFrames=t||[].concat(e.defaultKF),this.cachedKey=new Ul}var t=e.prototype;return t.addKey=function(e){null==this.keyFrames&&(this.keyFrames=[]),this.keyFrames.push(e)},t.evaluate_slow=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,i=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(n){case zl.Loop:t=zn(e-i,r-i)+i;break;case zl.PingPong:t=Bn(e-i,r-i)+i;break;case zl.Default:case zl.Normal:case zl.Clamp:default:t=Cn(e,i,r)}var o=0;if(t>this.keyFrames[0].time)if(t>=this.keyFrames[this.keyFrames.length-1].time)o=this.keyFrames.length-2;else for(var a=0;a<this.keyFrames.length-1;a++)if(t>=this.keyFrames[0].time&&t<=this.keyFrames[a+1].time){o=a;break}var s=this.keyFrames[o],c=this.keyFrames[o+1],l=Un(s.time,c.time,t),u=c.time-s.time,h=s.outTangent*u,_=c.inTangent*u,f=l*l,d=f*l,m=d-2*f+l,p=d-f,v=-2*d+3*f;return(2*d-3*f+1)*s.value+m*h+p*_+v*c.value},t.evaluate=function(e){var t=e,n=e<0?this.preWrapMode:this.postWrapMode,i=this.keyFrames[0].time,r=this.keyFrames[this.keyFrames.length-1].time;switch(n){case zl.Loop:t=zn(e-i,r-i)+i;break;case zl.PingPong:t=Bn(e-i,r-i)+i;break;case zl.Default:case zl.Normal:case zl.Clamp:default:t=Cn(e,i,r)}if(t>=this.cachedKey.time&&t<this.cachedKey.endTime)return this.cachedKey.evaluate(t);var o=this.findIndex(this.cachedKey,t),a=Math.min(o+1,this.keyFrames.length-1);return this.calcOptimizedKey(this.cachedKey,o,a),this.cachedKey.evaluate(t)},t.calcOptimizedKey=function(e,t,n){var i=this.keyFrames[t],r=this.keyFrames[n];e.index=t,e.time=i.time,e.endTime=r.time;var o=r.time-i.time,a=r.value-i.value,s=1/(o*o),c=i.outTangent*o,l=r.inTangent*o;e.coefficient[0]=(c+l-a-a)*s/o,e.coefficient[1]=(a+a+a-c-c-l)*s,e.coefficient[2]=i.outTangent,e.coefficient[3]=i.value},t.findIndex=function(e,t){var n=e.index;if(-1!==n)if(t>this.keyFrames[n].time)for(var i=0;i<3;i++){var r=n+i;if(r+1<this.keyFrames.length&&this.keyFrames[r+1].time>t)return r}else for(var o=0;o<3;o++){var a=n-o;if(a>=0&&this.keyFrames[a-1].time<=t)return a-1}for(var s,c=0,l=this.keyFrames.length;l-c>1;)s=Math.floor((c+l)/2),this.keyFrames[s].time>=t?l=s:c=s;return c},e}());function Hl(e,t){console.warn(e+" is deprecated, please use "+t+" instead.")}Gl.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],vn.fastDefine("cc.AnimationCurve",Gl,{preWrapMode:zl.Default,postWrapMode:zl.Default,keyFrames:[]}),ve(_l,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var kl=function(e){function t(){var t;return t=e.call(this)||this,Hl("line","Line"),t}return $(t,e),t}(Wo),Vl=function(e){function t(){var t;return t=e.call(this)||this,Hl("plane","Plane"),t}return $(t,e),t}(vl),jl=function(e){function t(){var t;return t=e.call(this)||this,Hl("ray","Ray"),t}return $(t,e),t}(qo),Wl=function(e){function t(){var t;return t=e.call(this)||this,Hl("triangle","Triangle"),t}return $(t,e),t}(ea),ql=function(e){function t(){var t;return t=e.call(this)||this,Hl("sphere","Sphere"),t}return $(t,e),t}($o),Yl=function(e){function t(){var t;return t=e.call(this)||this,Hl("aabb","AABB"),t}return $(t,e),t}(Al),Xl=function(e){function t(){var t;return t=e.call(this)||this,Hl("obb","OBB"),t}return $(t,e),t}(Il),Kl=function(e){function t(){var t;return t=e.call(this)||this,Hl("capsule","Capsule"),t}return $(t,e),t}(Rl),Ql=function(e){function t(){var t;return t=e.call(this)||this,Hl("frustum","Frustum"),t}return $(t,e),t}(Dl),Zl=Object.freeze({__proto__:null,distance:Vo,enums:jo,intersect:_l,Line:Wo,Plane:vl,Ray:qo,Triangle:ea,Sphere:$o,AABB:Al,OBB:Il,Capsule:Rl,Frustum:Dl,Keyframe:Bl,AnimationCurve:Gl,get ERaycastMode(){return ac},line:kl,plane:Vl,ray:jl,triangle:Wl,sphere:ql,aabb:Yl,obb:Xl,capsule:Kl,frustum:Ql});e("dH",Zl);var Jl={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},$l=e("cn",function(){function e(){}return e.makeMaskInclude=function(e){for(var t,n=0,i=oe(e);!(t=i()).done;)n|=t.value;return n},e.makeMaskExclude=function(t){return~e.makeMaskInclude(t)},e.addLayer=function(t,n){void 0!==n?n>19||n<0?console.warn("maximum layers reached."):(e.Enum[t]=1<<n,e.Enum[n]=t,e.BitMask[t]=1<<n,e.BitMask[n]=t):console.warn("bitNum can't be undefined")},e.deleteLayer=function(t){t>19||t<0?console.warn("do not change buildin layers."):(delete e.Enum[e.Enum[t]],delete e.Enum[t],delete e.BitMask[e.BitMask[t]],delete e.BitMask[t])},e}());$l.Enum=St(Jl),$l.BitMask=xt(J({},Jl)),c.Layers=$l;var eu,tu,nu="ForwardFlow",iu="ShadowFlow";!function(e){e[e.DEFAULT=100]="DEFAULT",e[e.UI=200]="UI"}(eu||(eu={})),c.RenderPassStage=eu,function(e){e[e.MIN=0]="MIN",e[e.MAX=255]="MAX",e[e.DEFAULT=128]="DEFAULT"}(tu||(tu=e("cj",{})));var ru,ou={bindings:[],layouts:{}},au={bindings:[],layouts:{}};!function(e){e[e.UBO_GLOBAL=0]="UBO_GLOBAL",e[e.UBO_CAMERA=1]="UBO_CAMERA",e[e.UBO_SHADOW=2]="UBO_SHADOW",e[e.SAMPLER_SHADOWMAP=3]="SAMPLER_SHADOWMAP",e[e.SAMPLER_ENVIRONMENT=4]="SAMPLER_ENVIRONMENT",e[e.SAMPLER_SPOT_LIGHTING_MAP=5]="SAMPLER_SPOT_LIGHTING_MAP",e[e.COUNT=6]="COUNT"}(ru||(ru={}));var su,cu=ru.SAMPLER_SHADOWMAP,lu=ru.COUNT-cu;!function(e){e[e.UBO_LOCAL=0]="UBO_LOCAL",e[e.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",e[e.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",e[e.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",e[e.UBO_MORPH=4]="UBO_MORPH",e[e.SAMPLER_JOINTS=5]="SAMPLER_JOINTS",e[e.SAMPLER_MORPH_POSITION=6]="SAMPLER_MORPH_POSITION",e[e.SAMPLER_MORPH_NORMAL=7]="SAMPLER_MORPH_NORMAL",e[e.SAMPLER_MORPH_TANGENT=8]="SAMPLER_MORPH_TANGENT",e[e.SAMPLER_LIGHTMAP=9]="SAMPLER_LIGHTMAP",e[e.SAMPLER_SPRITE=10]="SAMPLER_SPRITE",e[e.COUNT=11]="COUNT"}(su||(su=e("cz",{})));var uu,hu=su.SAMPLER_JOINTS,_u=su.COUNT-hu;!function(e){e[e.GLOBAL=0]="GLOBAL",e[e.MATERIAL=1]="MATERIAL",e[e.LOCAL=2]="LOCAL"}(uu||(uu={}));var fu=new ns;fu.bufferOffsets=[0,cu+hu,cu],fu.samplerOffsets=[-cu,lu+_u,lu-hu],fu.flexibleSet=1;var du=function(){};du.SIZE=4*(du.COUNT=4+(du.SCREEN_SIZE_OFFSET=4+(du.NATIVE_SIZE_OFFSET=4+(du.TIME_OFFSET=0)))),du.NAME="CCGlobal",du.BINDING=ru.UBO_GLOBAL,du.DESCRIPTOR=new Js(du.BINDING,Ca.UNIFORM_BUFFER,1,Aa.ALL),du.LAYOUT=new Us(uu.GLOBAL,du.BINDING,du.NAME,[new Bs("cc_time",ia.FLOAT4,1),new Bs("cc_screenSize",ia.FLOAT4,1),new Bs("cc_nativeSize",ia.FLOAT4,1)],1),ou.layouts[du.NAME]=du.LAYOUT,ou.bindings[du.BINDING]=du.DESCRIPTOR;var mu=function(){};mu.SIZE=4*(mu.COUNT=4+(mu.GLOBAL_FOG_ADD_OFFSET=4+(mu.GLOBAL_FOG_BASE_OFFSET=4+(mu.GLOBAL_FOG_COLOR_OFFSET=4+(mu.AMBIENT_GROUND_OFFSET=4+(mu.AMBIENT_SKY_OFFSET=4+(mu.MAIN_LIT_COLOR_OFFSET=4+(mu.MAIN_LIT_DIR_OFFSET=4+(mu.EXPOSURE_OFFSET=4+(mu.SCREEN_SCALE_OFFSET=4+(mu.CAMERA_POS_OFFSET=16+(mu.MAT_VIEW_PROJ_INV_OFFSET=16+(mu.MAT_VIEW_PROJ_OFFSET=16+(mu.MAT_PROJ_INV_OFFSET=16+(mu.MAT_PROJ_OFFSET=16+(mu.MAT_VIEW_INV_OFFSET=16+(mu.MAT_VIEW_OFFSET=0))))))))))))))))),mu.NAME="CCCamera",mu.BINDING=ru.UBO_CAMERA,mu.DESCRIPTOR=new Js(mu.BINDING,Ca.UNIFORM_BUFFER,1,Aa.ALL),mu.LAYOUT=new Us(uu.GLOBAL,mu.BINDING,mu.NAME,[new Bs("cc_matView",ia.MAT4,1),new Bs("cc_matViewInv",ia.MAT4,1),new Bs("cc_matProj",ia.MAT4,1),new Bs("cc_matProjInv",ia.MAT4,1),new Bs("cc_matViewProj",ia.MAT4,1),new Bs("cc_matViewProjInv",ia.MAT4,1),new Bs("cc_cameraPos",ia.FLOAT4,1),new Bs("cc_screenScale",ia.FLOAT4,1),new Bs("cc_exposure",ia.FLOAT4,1),new Bs("cc_mainLitDir",ia.FLOAT4,1),new Bs("cc_mainLitColor",ia.FLOAT4,1),new Bs("cc_ambientSky",ia.FLOAT4,1),new Bs("cc_ambientGround",ia.FLOAT4,1),new Bs("cc_fogColor",ia.FLOAT4,1),new Bs("cc_fogBase",ia.FLOAT4,1),new Bs("cc_fogAdd",ia.FLOAT4,1)],1),ou.layouts[mu.NAME]=mu.LAYOUT,ou.bindings[mu.BINDING]=mu.DESCRIPTOR;var pu=function(){};pu.SIZE=4*(pu.COUNT=4+(pu.SHADOW_INFO_OFFSET=4+(pu.SHADOW_COLOR_OFFSET=16+(pu.MAT_LIGHT_VIEW_PROJ_OFFSET=16+(pu.MAT_LIGHT_PLANE_PROJ_OFFSET=0))))),pu.NAME="CCShadow",pu.BINDING=ru.UBO_SHADOW,pu.DESCRIPTOR=new Js(pu.BINDING,Ca.UNIFORM_BUFFER,1,Aa.ALL),pu.LAYOUT=new Us(uu.GLOBAL,pu.BINDING,pu.NAME,[new Bs("cc_matLightPlaneProj",ia.MAT4,1),new Bs("cc_matLightViewProj",ia.MAT4,1),new Bs("cc_shadowColor",ia.FLOAT4,1),new Bs("cc_shadowInfo",ia.FLOAT4,1)],1),ou.layouts[pu.NAME]=pu.LAYOUT,ou.bindings[pu.BINDING]=pu.DESCRIPTOR;var vu=ru.SAMPLER_SHADOWMAP,gu=new Js(vu,Ca.SAMPLER,1,Aa.FRAGMENT),yu=new Gs(uu.GLOBAL,vu,"cc_shadowMap",ia.SAMPLER2D,1);ou.layouts.cc_shadowMap=yu,ou.bindings[vu]=gu;var xu=ru.SAMPLER_ENVIRONMENT,Eu=new Js(xu,Ca.SAMPLER,1,Aa.FRAGMENT),Tu=new Gs(uu.GLOBAL,xu,"cc_environment",ia.SAMPLER_CUBE,1);ou.layouts.cc_environment=Tu,ou.bindings[xu]=Eu;var Su=ru.SAMPLER_SPOT_LIGHTING_MAP,Au=new Js(Su,Ca.SAMPLER,1,Aa.FRAGMENT),Cu=new Gs(uu.GLOBAL,Su,"cc_spotLightingMap",ia.SAMPLER2D,1);ou.layouts.cc_spotLightingMap=Cu,ou.bindings[Su]=Au;var wu=e("cx",(function(){}));wu.MAT_WORLD_OFFSET=0,wu.MAT_WORLD_IT_OFFSET=wu.MAT_WORLD_OFFSET+16,wu.LIGHTINGMAP_UVPARAM=wu.MAT_WORLD_IT_OFFSET+16,wu.COUNT=wu.LIGHTINGMAP_UVPARAM+4,wu.SIZE=4*wu.COUNT,wu.NAME="CCLocal",wu.BINDING=su.UBO_LOCAL,wu.DESCRIPTOR=new Js(wu.BINDING,Ca.UNIFORM_BUFFER,1,Aa.VERTEX),wu.LAYOUT=new Us(uu.LOCAL,wu.BINDING,wu.NAME,[new Bs("cc_matWorld",ia.MAT4,1),new Bs("cc_matWorldIT",ia.MAT4,1),new Bs("cc_lightingMapUVParam",ia.FLOAT4,1)],1),au.layouts[wu.NAME]=wu.LAYOUT,au.bindings[wu.BINDING]=wu.DESCRIPTOR;var bu="a_matWorld0",Iu=function(){};Iu.BATCHING_COUNT=10,Iu.MAT_WORLDS_OFFSET=0,Iu.SIZE=4*(Iu.COUNT=16*Iu.BATCHING_COUNT),Iu.NAME="CCLocalBatched",Iu.BINDING=su.UBO_LOCAL,Iu.DESCRIPTOR=new Js(Iu.BINDING,Ca.UNIFORM_BUFFER,1,Aa.VERTEX),Iu.LAYOUT=new Us(uu.LOCAL,Iu.BINDING,Iu.NAME,[new Bs("cc_matWorlds",ia.MAT4,Iu.BATCHING_COUNT)],1),au.layouts[Iu.NAME]=Iu.LAYOUT,au.bindings[Iu.BINDING]=Iu.DESCRIPTOR;var Ru=function(){};Ru.LIGHTS_PER_PASS=1,Ru.SIZE=4*(Ru.COUNT=(Ru.LIGHT_DIR_OFFSET=(Ru.LIGHT_SIZE_RANGE_ANGLE_OFFSET=(Ru.LIGHT_COLOR_OFFSET=(Ru.LIGHT_POS_OFFSET=0)+4*Ru.LIGHTS_PER_PASS)+4*Ru.LIGHTS_PER_PASS)+4*Ru.LIGHTS_PER_PASS)+4*Ru.LIGHTS_PER_PASS),Ru.NAME="CCForwardLight",Ru.BINDING=su.UBO_FORWARD_LIGHTS,Ru.DESCRIPTOR=new Js(Ru.BINDING,Ca.DYNAMIC_UNIFORM_BUFFER,1,Aa.FRAGMENT),Ru.LAYOUT=new Us(uu.LOCAL,Ru.BINDING,Ru.NAME,[new Bs("cc_lightPos",ia.FLOAT4,Ru.LIGHTS_PER_PASS),new Bs("cc_lightColor",ia.FLOAT4,Ru.LIGHTS_PER_PASS),new Bs("cc_lightSizeRangeAngle",ia.FLOAT4,Ru.LIGHTS_PER_PASS),new Bs("cc_lightDir",ia.FLOAT4,Ru.LIGHTS_PER_PASS)],1),au.layouts[Ru.NAME]=Ru.LAYOUT,au.bindings[Ru.BINDING]=Ru.DESCRIPTOR;var Ou=e("bG",(function(){}));Ou.JOINTS_TEXTURE_INFO_OFFSET=0,Ou.COUNT=Ou.JOINTS_TEXTURE_INFO_OFFSET+4,Ou.SIZE=4*Ou.COUNT,Ou.NAME="CCSkinningTexture",Ou.BINDING=su.UBO_SKINNING_TEXTURE,Ou.DESCRIPTOR=new Js(Ou.BINDING,Ca.UNIFORM_BUFFER,1,Aa.VERTEX),Ou.LAYOUT=new Us(uu.LOCAL,Ou.BINDING,Ou.NAME,[new Bs("cc_jointTextureInfo",ia.FLOAT4,1)],1),au.layouts[Ou.NAME]=Ou.LAYOUT,au.bindings[Ou.BINDING]=Ou.DESCRIPTOR;var Nu=e("by",(function(){}));Nu.JOINTS_ANIM_INFO_OFFSET=0,Nu.COUNT=Nu.JOINTS_ANIM_INFO_OFFSET+4,Nu.SIZE=4*Nu.COUNT,Nu.NAME="CCSkinningAnimation",Nu.BINDING=su.UBO_SKINNING_ANIMATION,Nu.DESCRIPTOR=new Js(Nu.BINDING,Ca.UNIFORM_BUFFER,1,Aa.VERTEX),Nu.LAYOUT=new Us(uu.LOCAL,Nu.BINDING,Nu.NAME,[new Bs("cc_jointAnimInfo",ia.FLOAT4,1)],1),au.layouts[Nu.NAME]=Nu.LAYOUT,au.bindings[Nu.BINDING]=Nu.DESCRIPTOR;var Pu=e("bI","a_jointAnimInfo"),Mu=e("bE",(function(){}));Mu.JOINTS_OFFSET=0,Mu.COUNT=Mu.JOINTS_OFFSET+360,Mu.SIZE=4*Mu.COUNT,Mu.NAME="CCSkinning",Mu.BINDING=su.UBO_SKINNING_TEXTURE,Mu.DESCRIPTOR=new Js(Mu.BINDING,Ca.UNIFORM_BUFFER,1,Aa.VERTEX),Mu.LAYOUT=new Us(uu.LOCAL,Mu.BINDING,Mu.NAME,[new Bs("cc_joints",ia.FLOAT4,90)],1),au.layouts[Mu.NAME]=Mu.LAYOUT,au.bindings[Mu.BINDING]=Mu.DESCRIPTOR;var Du=e("aw",(function(){}));Du.MAX_MORPH_TARGET_COUNT=60,Du.OFFSET_OF_WEIGHTS=0,Du.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*Du.MAX_MORPH_TARGET_COUNT,Du.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=Du.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH+4,Du.OFFSET_OF_VERTICES_COUNT=Du.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT+4,Du.COUNT_BASE_4_BYTES=4*Math.ceil(Du.MAX_MORPH_TARGET_COUNT/4)+4,Du.SIZE=4*Du.COUNT_BASE_4_BYTES,Du.NAME="CCMorph",Du.BINDING=su.UBO_MORPH,Du.DESCRIPTOR=new Js(Du.BINDING,Ca.UNIFORM_BUFFER,1,Aa.VERTEX),Du.LAYOUT=new Us(uu.LOCAL,Du.BINDING,Du.NAME,[new Bs("cc_displacementWeights",ia.FLOAT4,Du.MAX_MORPH_TARGET_COUNT/4),new Bs("cc_displacementTextureInfo",ia.FLOAT4,1)],1),au.layouts[Du.NAME]=Du.LAYOUT,au.bindings[Du.BINDING]=Du.DESCRIPTOR;var Lu=e("bH",su.SAMPLER_JOINTS),Fu=new Js(Lu,Ca.SAMPLER,1,Aa.VERTEX),zu=new Gs(uu.LOCAL,Lu,"cc_jointTexture",ia.SAMPLER2D,1);au.layouts.cc_jointTexture=zu,au.bindings[Lu]=Fu;var Bu=e("aG",su.SAMPLER_MORPH_POSITION),Uu=new Js(Bu,Ca.SAMPLER,1,Aa.VERTEX),Gu=new Gs(uu.LOCAL,Bu,"cc_PositionDisplacements",ia.SAMPLER2D,1);au.layouts.cc_PositionDisplacements=Gu,au.bindings[Bu]=Uu;var Hu=e("aF",su.SAMPLER_MORPH_NORMAL),ku=new Js(Hu,Ca.SAMPLER,1,Aa.VERTEX),Vu=new Gs(uu.LOCAL,Hu,"cc_NormalDisplacements",ia.SAMPLER2D,1);au.layouts.cc_NormalDisplacements=Vu,au.bindings[Hu]=ku;var ju=e("aE",su.SAMPLER_MORPH_TANGENT),Wu=new Js(ju,Ca.SAMPLER,1,Aa.VERTEX),qu=new Gs(uu.LOCAL,ju,"cc_TangentDisplacements",ia.SAMPLER2D,1);au.layouts.cc_TangentDisplacements=qu,au.bindings[ju]=Wu;var Yu=su.SAMPLER_LIGHTMAP,Xu=new Js(Yu,Ca.SAMPLER,1,Aa.FRAGMENT),Ku=new Gs(uu.LOCAL,Yu,"cc_lightingMap",ia.SAMPLER2D,1);au.layouts.cc_lightingMap=Ku,au.bindings[Yu]=Xu;var Qu=su.SAMPLER_SPRITE,Zu=new Js(Qu,Ca.SAMPLER,1,Aa.FRAGMENT),Ju=new Gs(uu.LOCAL,Qu,"cc_spriteTexture",ia.SAMPLER2D,1);au.layouts.cc_spriteTexture=Ju,au.bindings[Qu]=Zu;var $u,eh,th,nh,ih,rh=$l.makeMaskExclude([$l.BitMask.UI_2D,$l.BitMask.GIZMOS,$l.BitMask.EDITOR,$l.BitMask.SCENE_GIZMO,$l.BitMask.PROFILER]),oh=$l.makeMaskExclude([$l.BitMask.UI_2D,$l.BitMask.PROFILER]),ah=$l.Enum.ALL;e("fb",Object.freeze({__proto__:null,PIPELINE_FLOW_FORWARD:nu,PIPELINE_FLOW_SHADOW:iu,PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",get RenderPassStage(){return eu},get RenderPriority(){return tu},globalDescriptorSetLayout:ou,localDescriptorSetLayout:au,get PipelineGlobalBindings(){return ru},get ModelLocalBindings(){return su},get SetIndex(){return uu},bindingMappingInfo:fu,UBOGlobal:du,UBOCamera:mu,UBOShadow:pu,UNIFORM_SHADOWMAP_BINDING:vu,UNIFORM_ENVIRONMENT_BINDING:xu,UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING:Su,UBOLocal:wu,INST_MAT_WORLD:bu,UBOLocalBatched:Iu,UBOForwardLight:Ru,JOINT_UNIFORM_CAPACITY:30,UBOSkinningTexture:Ou,UBOSkinningAnimation:Nu,INST_JOINT_ANIM_INFO:Pu,UBOSkinning:Mu,UBOMorph:Du,UNIFORM_JOINT_TEXTURE_BINDING:Lu,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:Bu,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:Hu,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:ju,UNIFORM_LIGHTMAP_TEXTURE_BINDING:Yu,UNIFORM_SPRITE_TEXTURE_BINDING:Qu,CAMERA_DEFAULT_MASK:rh,CAMERA_EDITOR_MASK:oh,MODEL_ALWAYS_MASK:ah})),function(e){e[e.VERTICAL=0]="VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL"}($u||($u={})),function(e){e[e.ORTHO=0]="ORTHO",e[e.PERSPECTIVE=1]="PERSPECTIVE"}(eh||(eh={})),function(e){e[e.F1_8=0]="F1_8",e[e.F2_0=1]="F2_0",e[e.F2_2=2]="F2_2",e[e.F2_5=3]="F2_5",e[e.F2_8=4]="F2_8",e[e.F3_2=5]="F3_2",e[e.F3_5=6]="F3_5",e[e.F4_0=7]="F4_0",e[e.F4_5=8]="F4_5",e[e.F5_0=9]="F5_0",e[e.F5_6=10]="F5_6",e[e.F6_3=11]="F6_3",e[e.F7_1=12]="F7_1",e[e.F8_0=13]="F8_0",e[e.F9_0=14]="F9_0",e[e.F10_0=15]="F10_0",e[e.F11_0=16]="F11_0",e[e.F13_0=17]="F13_0",e[e.F14_0=18]="F14_0",e[e.F16_0=19]="F16_0",e[e.F18_0=20]="F18_0",e[e.F20_0=21]="F20_0",e[e.F22_0=22]="F22_0"}(th||(th={})),function(e){e[e.ISO100=0]="ISO100",e[e.ISO200=1]="ISO200",e[e.ISO400=2]="ISO400",e[e.ISO800=3]="ISO800"}(nh||(nh={})),function(e){e[e.D1=0]="D1",e[e.D2=1]="D2",e[e.D4=2]="D4",e[e.D8=3]="D8",e[e.D15=4]="D15",e[e.D30=5]="D30",e[e.D60=6]="D60",e[e.D125=7]="D125",e[e.D250=8]="D250",e[e.D500=9]="D500",e[e.D1000=10]="D1000",e[e.D2000=11]="D2000",e[e.D4000=12]="D4000"}(ih||(ih={}));var sh,ch,lh=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],uh=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],hh=[100,200,400,800],_h=new Wn,fh=new Wn,dh=new ai,mh=Da.STENCIL<<1,ph=[],vh=function(){function e(e){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=$u.VERTICAL,this._fov=In(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new ms(.2,.2,.2,1),this._viewport=new yi(0,0,1,1),this._curTransform=za.IDENTITY,this._isProjDirty=!0,this._matView=new ai,this._matViewInv=null,this._matProj=new ai,this._matProjInv=new ai,this._matViewProj=new ai,this._matViewProjInv=new ai,this._frustum=new Dl,this._forward=new Wn,this._position=new Wn,this._priority=0,this._aperture=th.F16_0,this._apertureValue=void 0,this._shutter=ih.D125,this._shutterValue=0,this._iso=nh.ISO100,this._isoValue=0,this._ec=0,this._poolHandle=nr,this._frustumHandle=nr,this._window=null,this._device=e,this._apertureValue=lh[this._aperture],this._shutterValue=uh[this._shutter],this._isoValue=hh[this._iso],this._aspect=this.screenScale=1,!ph.length){var t=e.screenSpaceSignY;ph[za.IDENTITY]=new ai(1,0,0,0,0,t),ph[za.ROTATE_90]=new ai(0,1,0,0,-t,0),ph[za.ROTATE_180]=new ai(-1,0,0,0,0,-t),ph[za.ROTATE_270]=new ai(0,-1,0,0,t,0)}}var t=e.prototype;return t.initialize=function(e){this._name=e.name,this._node=e.node,this._proj=e.projection,this._priority=e.priority||0,this._aspect=this.screenScale=1;var t=this._poolHandle=zr.alloc();zr.set(t,Pr.WIDTH,1),zr.set(t,Pr.HEIGHT,1),zr.set(t,Pr.CLEAR_FLAG,Da.NONE),zr.set(t,Pr.CLEAR_DEPTH,1),zr.set(t,Pr.NODE,this._node.handle),zr.set(t,Pr.VISIBILITY,rh),this._scene&&zr.set(t,Pr.SCENE,this._scene.handle),this.updateExposure(),this.changeTargetWindow(e.window),console.log("Created Camera: "+this._name+" "+zr.get(t,Pr.WIDTH)+"x"+zr.get(t,Pr.HEIGHT))},t.destroy=function(){this._window&&this._window.detachCamera(this),this._name=null,this._poolHandle&&(zr.free(this._poolHandle),this._poolHandle=nr,this._frustumHandle&&(Kr.free(this._frustumHandle),this._frustumHandle=nr))},t.attachToScene=function(e){this._scene=e,this._enabled=!0,zr.set(this._poolHandle,Pr.SCENE,e.handle)},t.detachFromScene=function(){this._scene=null,this._enabled=!1,zr.set(this._poolHandle,Pr.SCENE,0)},t.resize=function(e,t){var n=this._poolHandle;zr.set(n,Pr.WIDTH,e),zr.set(n,Pr.HEIGHT,t),this._aspect=e*this._viewport.width/(t*this._viewport.height),this._isProjDirty=!0},t.setFixedSize=function(e,t){var n=this._poolHandle;zr.set(n,Pr.WIDTH,e),zr.set(n,Pr.HEIGHT,t),this._aspect=e*this._viewport.width/(t*this._viewport.height),this.isWindowSize=!1},t.update=function(e){if(void 0===e&&(e=!1),this._node){var t=!1;(this._node.hasChangedFlags||e)&&(ai.invert(this._matView,this._node.worldMatrix),zr.setMat4(this._poolHandle,Pr.MAT_VIEW,this._matView),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,this._node.getWorldPosition(this._position),zr.setVec3(this._poolHandle,Pr.POSITION,this._position),zr.setVec3(this._poolHandle,Pr.FORWARD,this._forward),t=!0);var n=this._device.surfaceTransform;if(this._isProjDirty||this._curTransform!==n){this._curTransform=n;var i=this._device.screenSpaceSignY;if(this._window&&this._window.hasOffScreenAttachments&&(i*=this._device.UVSpaceSignY,n=za.IDENTITY),this._proj===eh.PERSPECTIVE)ai.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===$u.VERTICAL,this._device.clipSpaceMinZ,i,n);else{var r=this._orthoHeight*this._aspect,o=this._orthoHeight;ai.ortho(this._matProj,-r,r,-o,o,this._nearClip,this._farClip,this._device.clipSpaceMinZ,i,n)}ai.invert(this._matProjInv,this._matProj),zr.setMat4(this._poolHandle,Pr.MAT_PROJ,this._matProj),zr.setMat4(this._poolHandle,Pr.MAT_PROJ_INV,this._matProjInv),t=!0,this._isProjDirty=!1}t&&(ai.multiply(this._matViewProj,this._matProj,this._matView),ai.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv),zr.setMat4(this._poolHandle,Pr.MAT_VIEW_PROJ,this._matViewProj),zr.setMat4(this._poolHandle,Pr.MAT_VIEW_PROJ_INV,this._matViewProjInv),Ll(this._frustumHandle,this._frustum))}},t.changeTargetWindow=function(e){void 0===e&&(e=null),this._window&&this._window.detachCamera(this);var t=e||c.director.root.mainWindow;t&&(t.attachCamera(this),this.resize(t.width,t.height),this._window=t,zr.set(this._poolHandle,Pr.WINDOW,t.handle))},t.detachCamera=function(){this._window&&this._window.detachCamera(this)},t.screenPointToRay=function(e,t,n){if(!this._node)return null;var i=this._poolHandle,r=zr.get(i,Pr.WIDTH),o=zr.get(i,Pr.HEIGHT),a=this._viewport.x*r,s=this._viewport.y*o,c=this._viewport.width*r,l=this._viewport.height*o,u=this._proj===eh.PERSPECTIVE,h=this._device.screenSpaceSignY,_=oi[this._curTransform];Wn.set(_h,(t-a)/c*2-1,(n-s)/l*2-1,u?1:-1);var f=_h.x,d=_h.y;return _h.x=f*_[0]+d*_[2]*h,_h.y=f*_[1]+d*_[3]*h,Wn.transformMat4(u?_h:e.o,_h,this._matViewProjInv),u?(this._node.getWorldPosition(fh),qo.fromPoints(e,fh,_h)):Wn.transformQuat(e.d,Wn.FORWARD,this._node.worldRotation),e},t.screenToWorld=function(e,t){var n=this._poolHandle,i=zr.get(n,Pr.WIDTH),r=zr.get(n,Pr.HEIGHT),o=this._viewport.x*i,a=this._viewport.y*r,s=this._viewport.width*i,c=this._viewport.height*r,l=this._device.screenSpaceSignY,u=oi[this._curTransform];if(this._proj===eh.PERSPECTIVE){Wn.set(e,(t.x-o)/s*2-1,(t.y-a)/c*2-1,1);var h=e.x,_=e.y;e.x=h*u[0]+_*u[2]*l,e.y=h*u[1]+_*u[3]*l,Wn.transformMat4(e,e,this._matViewProjInv),this._node&&this._node.getWorldPosition(_h),Wn.lerp(e,_h,e,bn(this._nearClip/this._farClip,1,t.z))}else{Wn.set(e,(t.x-o)/s*2-1,(t.y-a)/c*2-1,2*t.z-1);var f=e.x,d=e.y;e.x=f*u[0]+d*u[2]*l,e.y=f*u[1]+d*u[3]*l,Wn.transformMat4(e,e,this._matViewProjInv)}return e},t.worldToScreen=function(e,t){var n=this._poolHandle,i=zr.get(n,Pr.WIDTH),r=zr.get(n,Pr.HEIGHT),o=this._viewport.x*i,a=this._viewport.y*r,s=this._viewport.width*i,c=this._viewport.height*r,l=this._device.screenSpaceSignY,u=oi[this._curTransform];Wn.transformMat4(e,t,this._matViewProj);var h=e.x,_=e.y;return e.x=h*u[0]+_*u[2]*l,e.y=h*u[1]+_*u[3]*l,e.x=o+.5*(e.x+1)*s,e.y=a+.5*(e.y+1)*c,e.z=.5*e.z+.5,e},t.worldMatrixToScreen=function(e,t,n,i){ai.multiply(e,this._matViewProj,t),ai.multiply(e,ph[this._curTransform],e);var r=n/2,o=i/2;return ai.identity(dh),ai.transform(dh,dh,Wn.set(_h,r,o,0)),ai.scale(dh,dh,Wn.set(_h,r,o,1)),ai.multiply(e,dh,e),e},t.updateExposure=function(){var e=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);zr.set(this._poolHandle,Pr.EXPOSURE,.833333/Math.pow(2,e))},Z(e,[{key:"node",set:function(e){this._node=e},get:function(){return this._node}},{key:"enabled",set:function(e){this._enabled=e},get:function(){return this._enabled}},{key:"orthoHeight",set:function(e){this._orthoHeight=e,this._isProjDirty=!0},get:function(){return this._orthoHeight}},{key:"projectionType",set:function(e){this._proj=e,this._isProjDirty=!0},get:function(){return this._proj}},{key:"fovAxis",set:function(e){this._fovAxis=e,this._isProjDirty=!0},get:function(){return this._fovAxis}},{key:"fov",set:function(e){this._fov=e,this._isProjDirty=!0},get:function(){return this._fov}},{key:"nearClip",set:function(e){this._nearClip=e,this._isProjDirty=!0},get:function(){return this._nearClip}},{key:"farClip",set:function(e){this._farClip=e,this._isProjDirty=!0},get:function(){return this._farClip}},{key:"clearColor",set:function(e){this._clearColor.x=e.x,this._clearColor.y=e.y,this._clearColor.z=e.z,this._clearColor.w=e.w,zr.setVec4(this._poolHandle,Pr.CLEAR_COLOR,e)},get:function(){return this._clearColor}},{key:"viewport",get:function(){return this._viewport},set:function(e){var t=e.x,n=e.width,i=e.height,r=this._device.screenSpaceSignY<0?1-e.y-i:e.y;switch(this._device.surfaceTransform){case za.ROTATE_90:this._viewport.x=1-r-i,this._viewport.y=t,this._viewport.width=i,this._viewport.height=n;break;case za.ROTATE_180:this._viewport.x=1-t-n,this._viewport.y=1-r-i,this._viewport.width=n,this._viewport.height=i;break;case za.ROTATE_270:this._viewport.x=r,this._viewport.y=1-t-n,this._viewport.width=i,this._viewport.height=n;break;case za.IDENTITY:this._viewport.x=t,this._viewport.y=r,this._viewport.width=n,this._viewport.height=i}zr.setVec4(this._poolHandle,Pr.VIEW_PORT,this._viewport),this.resize(this.width,this.height)}},{key:"scene",get:function(){return this._scene}},{key:"name",get:function(){return this._name}},{key:"width",get:function(){return zr.get(this._poolHandle,Pr.WIDTH)}},{key:"height",get:function(){return zr.get(this._poolHandle,Pr.HEIGHT)}},{key:"aspect",get:function(){return this._aspect}},{key:"matView",set:function(e){this._matView=e,zr.setMat4(this._poolHandle,Pr.MAT_VIEW,this._matView)},get:function(){return this._matView}},{key:"matViewInv",set:function(e){this._matViewInv=e},get:function(){return this._matViewInv||this._node.worldMatrix}},{key:"matProj",set:function(e){this._matProj=e,zr.setMat4(this._poolHandle,Pr.MAT_PROJ,this._matProj)},get:function(){return this._matProj}},{key:"matProjInv",set:function(e){this._matProjInv=e,zr.setMat4(this._poolHandle,Pr.MAT_PROJ_INV,this._matProjInv)},get:function(){return this._matProjInv}},{key:"matViewProj",set:function(e){this._matViewProj=e,zr.setMat4(this._poolHandle,Pr.MAT_VIEW_PROJ,this._matViewProj)},get:function(){return this._matViewProj}},{key:"matViewProjInv",set:function(e){this._matViewProjInv=e,zr.setMat4(this._poolHandle,Pr.MAT_VIEW_PROJ_INV,this._matViewProjInv)},get:function(){return this._matViewProjInv}},{key:"frustum",set:function(e){this._frustum=e,Ll(this._frustumHandle,e)},get:function(){return this._frustum}},{key:"window",set:function(e){this._window=e,e&&zr.set(this._poolHandle,Pr.WINDOW,e.handle)},get:function(){return this._window}},{key:"forward",set:function(e){this._forward=e,zr.setVec3(this._poolHandle,Pr.FORWARD,this._forward)},get:function(){return this._forward}},{key:"position",set:function(e){this._position=e,zr.setVec3(this._poolHandle,Pr.POSITION,this._position)},get:function(){return this._position}},{key:"visibility",set:function(e){zr.set(this._poolHandle,Pr.VISIBILITY,e)},get:function(){return zr.get(this._poolHandle,Pr.VISIBILITY)}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e}},{key:"aperture",set:function(e){this._aperture=e,this._apertureValue=lh[this._aperture],this.updateExposure()},get:function(){return this._aperture}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",set:function(e){this._shutter=e,this._shutterValue=uh[this._shutter],this.updateExposure()},get:function(){return this._shutter}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",set:function(e){this._iso=e,this._isoValue=hh[this._iso],this.updateExposure()},get:function(){return this._iso}},{key:"isoValue",get:function(){return this._isoValue}},{key:"ec",set:function(e){this._ec=e},get:function(){return this._ec}},{key:"exposure",get:function(){return zr.get(this._poolHandle,Pr.EXPOSURE)}},{key:"clearFlag",get:function(){return zr.get(this._poolHandle,Pr.CLEAR_FLAG)},set:function(e){zr.set(this._poolHandle,Pr.CLEAR_FLAG,e)}},{key:"clearDepth",get:function(){return zr.get(this._poolHandle,Pr.CLEAR_DEPTH)},set:function(e){zr.set(this._poolHandle,Pr.CLEAR_DEPTH,e)}},{key:"clearStencil",get:function(){return zr.get(this._poolHandle,Pr.CLEAR_STENCIL)},set:function(e){zr.set(this._poolHandle,Pr.CLEAR_STENCIL,e)}},{key:"handle",get:function(){return this._poolHandle}}]),e}();!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD"}(sh||(sh={})),function(e){e[e.NONE=0]="NONE",e[e.POSITION=1]="POSITION",e[e.ROTATION=2]="ROTATION",e[e.SCALE=4]="SCALE",e[e.RS=e.ROTATION|e.SCALE]="RS",e[e.TRS=e.POSITION|e.ROTATION|e.SCALE]="TRS",e[e.TRS_MASK=~e.TRS]="TRS_MASK"}(ch||(ch=e("b2",{}))),c.internal.TransformBit=ch;var gh=function(){function e(e){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._batches=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._mainLight=null,this._modelId=0,this._scenePoolHandle=nr,this._modelArrayHandle=nr,this._batchArrayHandle=nr,this._sphereLightsHandle=nr,this._spotLightsHandle=nr,this._root=e,this._createHandles()}e.registerCreateFunc=function(t){t._createSceneFun=function(t){return new e(t)}},Z(e,[{key:"root",get:function(){return this._root}},{key:"name",get:function(){return this._name}},{key:"cameras",get:function(){return this._cameras}},{key:"mainLight",get:function(){return this._mainLight}},{key:"sphereLights",get:function(){return this._sphereLights}},{key:"spotLights",get:function(){return this._spotLights}},{key:"models",get:function(){return this._models}},{key:"handle",get:function(){return this._scenePoolHandle}},{key:"batches",get:function(){return this._batches}}]);var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._createHandles(),!0},t.update=function(e){var t=this._mainLight;t&&t.update();for(var n=this._sphereLights,i=0;i<n.length;i++)n[i].update();for(var r=this._spotLights,o=0;o<r.length;o++)r[o].update();for(var a=this._models,s=0;s<a.length;s++){var c=a[s];c.enabled&&(c.updateTransform(e),c.updateUBOs(e))}},t.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeModels(),this._modelArrayHandle&&(lr.free(this._modelArrayHandle),this._modelArrayHandle=nr),this._scenePoolHandle&&(Dr.free(this._scenePoolHandle),this._scenePoolHandle=nr),this._sphereLightsHandle&&(_r.free(this._sphereLightsHandle),this._sphereLightsHandle=nr),this._spotLightsHandle&&(_r.free(this._spotLightsHandle),this._spotLightsHandle=nr),this._batchArrayHandle&&(dr.free(this._batchArrayHandle),this._batchArrayHandle=nr)},t.addCamera=function(e){e.attachToScene(this),this._cameras.push(e)},t.removeCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return this._cameras.splice(t,1),void e.detachFromScene()},t.removeCameras=function(){for(var e,t=oe(this._cameras);!(e=t()).done;)e.value.detachFromScene();this._cameras.splice(0)},t.setMainLight=function(e){this._mainLight=e,Dr.set(this._scenePoolHandle,Rr.MAIN_LIGHT,e.handle)},t.unsetMainLight=function(e){if(this._mainLight===e){var t=this._directionalLights;t.length?(this._mainLight=t[t.length-1],this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=ch.ROTATION)):this._mainLight=null}},t.addDirectionalLight=function(e){e.attachToScene(this),this._directionalLights.push(e)},t.removeDirectionalLight=function(e){for(var t=0;t<this._directionalLights.length;++t)if(this._directionalLights[t]===e)return e.detachFromScene(),void this._directionalLights.splice(t,1)},t.addSphereLight=function(e){e.attachToScene(this),this._sphereLights.push(e),_r.push(this._sphereLightsHandle,e.handle)},t.removeSphereLight=function(e){for(var t=0;t<this._sphereLights.length;++t)if(this._sphereLights[t]===e)return e.detachFromScene(),this._sphereLights.splice(t,1),void _r.erase(this._sphereLightsHandle,t)},t.addSpotLight=function(e){e.attachToScene(this),this._spotLights.push(e),_r.push(this._spotLightsHandle,e.handle)},t.removeSpotLight=function(e){for(var t=0;t<this._spotLights.length;++t)if(this._spotLights[t]===e)return e.detachFromScene(),this._spotLights.splice(t,1),void _r.erase(this._spotLightsHandle,t)},t.removeSphereLights=function(){for(var e=0;e<this._sphereLights.length;++e)this._sphereLights[e].detachFromScene();this._sphereLights.length=0,_r.clear(this._sphereLightsHandle)},t.removeSpotLights=function(){for(var e=0;e<this._spotLights.length;++e)this._spotLights[e].detachFromScene();this._spotLights=[],_r.clear(this._spotLightsHandle)},t.addModel=function(e){e.attachToScene(this),this._models.push(e),lr.push(this._modelArrayHandle,e.handle)},t.removeModel=function(e){for(var t=0;t<this._models.length;++t)if(this._models[t]===e)return e.detachFromScene(),this._models.splice(t,1),void lr.erase(this._modelArrayHandle,t)},t.removeModels=function(){for(var e,t=oe(this._models);!(e=t()).done;){var n=e.value;n.detachFromScene(),n.destroy()}this._models.length=0,lr.clear(this._modelArrayHandle)},t.addBatch=function(e){this._batches.push(e),dr.push(this._batchArrayHandle,e.handle)},t.removeBatch=function(e){for(var t=0;t<this._batches.length;++t)if(this._batches[t]===e)return this._batches.splice(t,1),void dr.erase(this._batchArrayHandle,t)},t.removeBatches=function(){this._batches.length=0,dr.clear(this._batchArrayHandle)},t.onGlobalPipelineStateChanged=function(){for(var e,t=oe(this._models);!(e=t()).done;)e.value.onGlobalPipelineStateChanged()},t.generateModelId=function(){return this._modelId++},t._createHandles=function(){this._modelArrayHandle||(this._modelArrayHandle=lr.alloc(),this._scenePoolHandle=Dr.alloc(),Dr.set(this._scenePoolHandle,Rr.MODEL_ARRAY,this._modelArrayHandle),this._spotLightsHandle=_r.alloc(),Dr.set(this._scenePoolHandle,Rr.SPOT_LIGHT_ARRAY,this._spotLightsHandle),this._sphereLightsHandle=_r.alloc(),Dr.set(this._scenePoolHandle,Rr.SPHERE_LIGHT_ARRAY,this._sphereLightsHandle)),this._batchArrayHandle||(this._batchArrayHandle=dr.alloc(),Dr.set(this._scenePoolHandle,Rr.BATCH_ARRAY_2D,this._batchArrayHandle))},e}(),yh=function(){},xh=function(){return yh},Eh=Th((function(){}));function Th(e){return function(t){return"function"==typeof t?e(t):function(n){return e(n,t)}}}function Sh(e){return function(t){return function(n){!function(e,t,n){var i=Ch(e);if(i){var r=wh(i,"proto");wh(r,"editor")[t]=n}}(n,e,t)}}}var Ah="__ccclassCache__";function Ch(e,t){return wh(e,Ah)}function wh(e,t){return e[t]||(e[t]={})}var bh=e("aI",Th((function(e,t){var n=yt.getSuper(e);n===Object&&(n=null);var i={name:t,extends:n,ctor:e},r=e[Ah];if(r){var o=r.proto;o&&yt.mixin(i,o),e[Ah]=void 0}return vn(i)}))),Ih=e("c6",Sh("requireComponent")),Rh=e("b8",Sh("executionOrder")),Oh=e("b_",Eh);function Nh(e,t,n){var i=null;function r(e,t,n){var r=Ch(e.constructor);if(r){var o=wh(r,"proto"),a=wh(o,"properties");!function(e,t,n,i,r,o){var a,s=r&&(r.get||r.set);i&&(a=sn(i,s));var c=t[n],l=yt.mixin(c||{},a||i||{});if(s)r.get&&(l.get=r.get),r.set&&(l.set=r.set);else if(r)r.initializer&&(l.default=function(e){var t;try{t=e()}catch(t){return e}return"object"!=typeof t||null===t?t:e}(r.initializer));else{var u=o.default||(o.default=function(e){var t;try{t=new e}catch(e){return{}}return t}(e));u.hasOwnProperty(n)&&(l.default=u[n])}t[n]=l}(e.constructor,a,t,i,n,r)}}return void 0===e?Nh({type:void 0}):void 0===t?(i=e,r):void r(e,t,n)}var Ph=e("aT",(function(e,t,n){return Nh(Dh({}))(e,t,n)})),Mh=e("cQ",(function(e,t,n){return Nh({editorOnly:!0})(e,t,n)}));function Dh(e){return e.__noImplicit=!0,"serializable"in e||(e.serializable=!0),e}var Lh=e("b1",Eh),Fh=e("b9",xh),zh=e("dm",Eh),Bh=xh,Uh=xh,Gh=e("b7",xh),Hh=e("a$",yh),kh=e("bb",xh),Vh=(e("da",yh),e("c7",xh)),jh=e("ba",xh),Wh=e("bl",xh),qh=e("cF",xh),Yh=e("cG",xh),Xh=xh,Kh=e("bk",yh),Qh=e("c0",xh),Zh=(e("bo",xh),e("d2",yh),e("c8",yh),e("b5",yh)),Jh=n_(Qt),$h=n_(Zt),e_=n_(Jt),t_=e("bU",n_($t));function n_(e){return Nh({type:e})}var i_=e("bN",(function(e,t,n){return Nh({__noImplicit:!0,override:!0})(e,t,n)})),r_=function(){function e(e){this._map=null,this._count=0,e?(this._map=e,this._count=Object.keys(e).length):(this._map=yt.createMap(!0),this._count=0)}var t=e.prototype;return t.add=function(e,t){return e in this._map||this._count++,this._map[e]=t},t.get=function(e){return this._map[e]},t.has=function(e){return e in this._map},t.remove=function(e){var t=this._map[e];return e in this._map&&(delete this._map[e],this._count--),t},t.clear=function(){0!==this._count&&(this._map=yt.createMap(!0),this._count=0)},t.forEach=function(e){for(var t in this._map)e(this._map[t],t)},t.find=function(e){for(var t in this._map)if(e(this._map[t],t))return this._map[t];return null},t.destroy=function(){this._map=null},Z(e,[{key:"count",get:function(){return this._count}}]),e}(),o_=function(){function e(t,n){this.id=e._pipelineId++,this.name="",this.pipes=[],this.name=t;for(var i=0,r=n.length;i<r;i++)this.pipes.push(n[i])}var t=e.prototype;return t.insert=function(e,t){return t>this.pipes.length?(b(4921),this):(this.pipes.splice(t,0,e),this)},t.append=function(e){return this.pipes.push(e),this},t.remove=function(e){return this.pipes.splice(e,1),this},t.sync=function(e){var t=this.pipes;if(0===t.length)return null;e.isFinish=!1;for(var n=0,i=t.length;n<i;){var r=(0,t[n])(e);if(r)return e.isFinish=!0,r;++n!==i&&(e.input=e.output,e.output=null)}return e.isFinish=!0,e.output},t.async=function(e){0!==this.pipes.length&&(e.isFinish=!1,this._flow(0,e))},t._flow=function(e,t){var n=this;(0,this.pipes[e])(t,(function(i){i?(t.isFinish=!0,t.dispatch("complete",i)):++e<n.pipes.length?(t.input=t.output,t.output=null,n._flow(e,t)):(t.isFinish=!0,t.dispatch("complete",i,t.output))}))},e}();o_._pipelineId=0;var a_,s_=new r_,c_=new r_,l_=new r_,u_=new r_,h_=new o_("normal load",[]),__=new o_("fetch",[]),f_=new o_("transform url",[]);!function(e){e.UUID="uuid",e.PATH="path",e.DIR="dir",e.URL="url",e.SCENE="scene"}(a_||(a_={}));var d_,m_={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(e){e.RESOURCES="resources",e.MAIN="main",e.START_SCENE="start-scene"}(d_||(d_={}));var p_=function(){function e(t){this.id=e._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(t)}e.create=function(t){var n;return 0!==e._deadPool.length?(n=e._deadPool.pop()).set(t):n=new e(t),n};var t=e.prototype;return t.set=function(e){void 0===e&&(e=Object.create(null)),this.onComplete=e.onComplete||null,this.onProgress=e.onProgress||null,this.onError=e.onError||null,this.source=this.input=e.input,this.output=null,this.progress=e.progress,this.options=e.options||Object.create(null)},t.dispatch=function(e,t,n,i,r){switch(e){case"complete":this.onComplete&&this.onComplete(t,n);break;case"progress":this.onProgress&&this.onProgress(t,n,i,r);break;case"error":this.onError&&this.onError(t,n,i,r);break;default:var o="on"+e[0].toUpperCase()+e.substr(1);"function"==typeof this[o]&&this[o](t,n,i,r)}},t.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,e._deadPool.push(this))},e}();p_.MAX_DEAD_NUM=500,p_._taskId=0,p_._deadPool=[];var v_="0123456789abcdef".split(""),g_=["","","",""],y_=g_.concat(g_,"-",g_,"-",g_,"-",g_,"-",g_,g_,g_),x_=y_.map((function(e,t){return"-"===e?NaN:t})).filter(isFinite);function E_(e){var t=e.split("@")[0];if(22!==t.length)return e;y_[0]=e[0],y_[1]=e[1];for(var n=2,i=2;n<22;n+=2){var r=Mt[e.charCodeAt(n)],o=Mt[e.charCodeAt(n+1)];y_[x_[i++]]=v_[r>>2],y_[x_[i++]]=v_[(3&r)<<2|o>>4],y_[x_[i++]]=v_[15&o]}return e.replace(t,y_.join(""))}var T_=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function S_(e){var t=T_.exec(e);return t?t[1]:""}function A_(e,t){(t=t||Object.create(null)).__isNative__=t.isNative,t.ext=t.nativeExt;var n=u_.find((function(t){return!!t.getAssetInfo(e)}));return n&&(t.bundle=n.name),b_(e,t)}function C_(e){return e&&(e instanceof c.SceneAsset||e instanceof c.Scene)}function w_(e){return e&&(46===e.charCodeAt(0)&&47===e.charCodeAt(1)?e=e.slice(2):47===e.charCodeAt(0)&&(e=e.slice(1))),e}function b_(e,t){var n=p_.create({input:e,options:t}),i=[];try{for(var r,o=oe(f_.sync(n));!(r=o()).done;){var a=r.value,s=a.url;a.recycle(),i.push(s)}}catch(e){for(var c,l=oe(n.output);!(c=l()).done;)c.value.recycle();y(e.message,e.stack)}return n.recycle(),i.length>1?i:i[0]}var I_=Object.freeze({__proto__:null,getUuidFromURL:S_,getUrlWithUuid:A_,isScene:C_,normalize:w_,transform:b_,decodeUuid:E_}),R_=e("cO",function(){function e(e,t){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=e,this.bubbles=!!t}var t=e.prototype;return t.unuse=function(){this.type=e.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=e.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},t.reuse=function(e,t){this.type=e,this.bubbles=t||!1},t.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},t.getCurrentTarget=function(){return this.currentTarget},t.getType=function(){return this.type},e}());R_.NO_TYPE="no_type",R_.TOUCH="touch",R_.MOUSE="mouse",R_.KEYBOARD="keyboard",R_.ACCELERATION="acceleration",R_.NONE=0,R_.CAPTURING_PHASE=1,R_.AT_TARGET=2,R_.BUBBLING_PHASE=3,c.Event=R_;var O_=e("P",function(){function e(e,t){this._ctor=void 0,this._elementsPerBatch=void 0,this._nextAvail=void 0,this._freepool=[],this._ctor=e,this._elementsPerBatch=Math.max(t,1),this._nextAvail=this._elementsPerBatch-1;for(var n=0;n<this._elementsPerBatch;++n)this._freepool.push(e())}var t=e.prototype;return t.alloc=function(){if(this._nextAvail<0){for(var e=this._elementsPerBatch,t=0;t<e;t++)this._freepool.push(this._ctor());this._nextAvail=e-1}var n=this._freepool[this._nextAvail--];return this._freepool.length--,n},t.free=function(e){this._freepool.push(e),this._nextAvail++},t.freeArray=function(e){Array.prototype.push.apply(this._freepool,e),this._nextAvail+=e.length},t.destroy=function(e){if(e)for(var t=0;t<=this._nextAvail;t++)e(this._freepool[t]);this._freepool.length=0,this._nextAvail=-1},e}()),N_=e("R",function(){function e(e,t){this._fn=void 0,this._count=0,this._data=void 0,this._fn=e,this._data=new Array(t);for(var n=0;n<t;++n)this._data[n]=e()}var t=e.prototype;return t.reset=function(){this._count=0},t.resize=function(e){if(e>this._data.length)for(var t=this._data.length;t<e;++t)this._data[t]=this._fn()},t.add=function(){return this._count>=this._data.length&&this.resize(2*this._data.length),this._data[this._count++]},t.removeAt=function(e){if(!(e>=this._count)){var t=this._count-1,n=this._data[e];this._data[e]=this._data[t],this._data[t]=n,this._count-=1}},Z(e,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),e}()),P_=e("C",function(){function e(e,t){this.array=void 0,this.length=0,this._compareFn=void 0,this.array=new Array(e),this.length=0,this._compareFn=void 0!==t?t:function(e,t){return e-t}}var t=e.prototype;return t.push=function(e){this.array[this.length++]=e},t.pop=function(){return this.array[--this.length]},t.get=function(e){return this.array[e]},t.clear=function(){this.length=0},t.destroy=function(){this.length=0,this.array.length=0},t.sort=function(){this.array.length=this.length,this.array.sort(this._compareFn)},t.concat=function(e){for(var t=0;t<e.length;++t)this.array[this.length++]=e[t]},t.fastRemove=function(e){if(!(e>=this.length||e<0)){var t=--this.length;this.array[e]=this.array[t]}},t.indexOf=function(e){return this.array.indexOf(e)},e}()),M_=[],D_=e("dh",function(){function e(e){void 0===e&&(e=""),this._objFlags=void 0,this._name=void 0,this._name=e,this._objFlags=0}e._deferredDestroy=function(){for(var e=M_.length,t=0;t<e;++t){var n=M_[t];1&n._objFlags||n._destroyImmediate()}e===M_.length?M_.length=0:M_.splice(0,e)};var t=e.prototype;return t.destroy=function(){return 1&this._objFlags?(b(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,M_.push(this),0))},t._destruct=function(){var e=this.constructor,t=e.__destruct__;t||(t=function(e,t){var n,i=e instanceof c._BaseNode||e instanceof c.Component,r=i?"_id":null,o={};for(n in e)if(e.hasOwnProperty(n)){if(n===r)continue;switch(typeof e[n]){case"string":o[n]="";break;case"object":case"function":o[n]=null}}if(vn._isCCClass(t))for(var a=c.Class.Attr.getClassAttrs(t),s=t.__props__,l=0;l<s.length;l++){var u=(n=s[l])+c.Class.Attr.DELIMETER+"default";if(u in a){if(i&&"_id"===n)continue;switch(typeof a[u]){case"string":o[n]="";break;case"object":case"function":o[n]=null;break;case"undefined":o[n]=void 0}}}var h="";for(n in o){var _;_=vn.IDENTIFIER_RE.test(n)?"o."+n+"=":"o["+vn.escapeForJS(n)+"]=";var f=o[n];""===f&&(f='""'),h+=_+f+";\n"}return Function("o",h)}(this,e),Ue(e,"__destruct__",t,!0)),t(this)},t._destroyImmediate=function(){1&this._objFlags?R(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},Z(e,[{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),e}()),L_=D_.prototype;function F_(e,t){return"object"==typeof e?!(!e||e._objFlags&(t?5:1)):void 0!==e}L_._deserialize=null,L_._onPreDestroy=null,vn.fastDefine("cc.Object",D_,{_name:"",_objFlags:0}),Ue(D_,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20}),c.isValid=F_,c.Object=D_;var z_=gt.fastRemoveAt;function B_(){}var U_=function(){function e(){this.callback=B_,this.target=void 0,this.once=!1}var t=e.prototype;return t.set=function(e,t,n){this.callback=e||B_,this.target=t,this.once=!!n},t.reset=function(){this.target=void 0,this.callback=B_,this.once=!1},t.check=function(){return!(this.target instanceof D_&&!F_(this.target,!0))},e}(),G_=new O_((function(){return new U_}),32),H_=function(){function e(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var t=e.prototype;return t.removeByCallback=function(e){for(var t=0;t<this.callbackInfos.length;++t){var n=this.callbackInfos[t];n&&n.callback===e&&(n.reset(),G_.free(n),z_(this.callbackInfos,t),--t)}},t.removeByTarget=function(e){for(var t=0;t<this.callbackInfos.length;++t){var n=this.callbackInfos[t];n&&n.target===e&&(n.reset(),G_.free(n),z_(this.callbackInfos,t),--t)}},t.cancel=function(e){var t=this.callbackInfos[e];t&&(t.reset(),this.isInvoking?this.callbackInfos[e]=null:z_(this.callbackInfos,e),G_.free(t)),this.containCanceled=!0},t.cancelAll=function(){for(var e=0;e<this.callbackInfos.length;e++){var t=this.callbackInfos[e];t&&(t.reset(),G_.free(t),this.callbackInfos[e]=null)}this.containCanceled=!0},t.purgeCanceled=function(){for(var e=this.callbackInfos.length-1;e>=0;--e)this.callbackInfos[e]||z_(this.callbackInfos,e);this.containCanceled=!1},t.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},e}(),k_=new O_((function(){return new H_}),16),V_=function(){function e(){this._callbackTable=Ve(!0)}var t=e.prototype;return t.on=function(e,t,n,i){if(!this.hasEventListener(e,t,n)){var r=this._callbackTable[e];r||(r=this._callbackTable[e]=k_.alloc());var o=G_.alloc();o.set(t,n,i),r.callbackInfos.push(o)}return t},t.hasEventListener=function(e,t,n){var i=this._callbackTable&&this._callbackTable[e];if(!i)return!1;var r=i.callbackInfos;if(!t){if(i.isInvoking){for(var o=0;o<r.length;++o)if(r[o])return!0;return!1}return r.length>0}for(var a=0;a<r.length;++a){var s=r[a];if(s&&s.check()&&s.callback===t&&s.target===n)return!0}return!1},t.removeAll=function(e){if("string"==typeof e){var t=this._callbackTable&&this._callbackTable[e];t&&(t.isInvoking?t.cancelAll():(t.clear(),k_.free(t),delete this._callbackTable[e]))}else if(e)for(var n in this._callbackTable){var i=this._callbackTable[n];if(i.isInvoking)for(var r=i.callbackInfos,o=0;o<r.length;++o){var a=r[o];a&&a.target===e&&i.cancel(o)}else i.removeByTarget(e)}},t.off=function(e,t,n){var i=this._callbackTable&&this._callbackTable[e];if(i){var r=i.callbackInfos;if(t)for(var o=0;o<r.length;++o){var a=r[o];if(a&&a.callback===t&&a.target===n){i.cancel(o);break}}else this.removeAll(e)}},t.emit=function(e,t,n,i,r,o){var a=this._callbackTable&&this._callbackTable[e];if(a){var s=!a.isInvoking;a.isInvoking=!0;for(var c=a.callbackInfos,l=0,u=c.length;l<u;++l){var h=c[l];if(h){var _=h.callback,f=h.target;h.once&&this.off(e,_,f),h.check()?f?_.call(f,t,n,i,r,o):_(t,n,i,r,o):this.off(e,_,f)}}s&&(a.isInvoking=!1,a.containCanceled&&a.purgeCanceled())}},t.clear=function(){for(var e in this._callbackTable){var t=this._callbackTable[e];t&&(t.clear(),k_.free(t),delete this._callbackTable[e])}},e}();function j_(e){for(var t=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._callbackTable=Ve(!0),t}$(t,e);var n=t.prototype;return n.once=function(e,t,n){return this.on(e,t,n,!0)},n.targetOff=function(e){this.removeAll(e)},t}(e),n=V_.prototype,i=Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n)),r=0;r<i.length;++r){var o=i[r];if(!(o in t.prototype)){var a=Object.getOwnPropertyDescriptor(n,o);a&&Object.defineProperty(t.prototype,o,a)}}return t}var W_,q_,Y_,X_,K_,Q_=e("dC",j_((function(){})));c.EventTarget=Q_;var Z_=e("aN",bh("cc.Asset")((K_=X_=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).loaded=!0,ae(t,"_native",Y_,ie(t)),t._nativeUrl="",t.__onLoadedInvoked__=!1,t.__nativeDepend__=null,t.__asyncLoadAssets__=!1,t.__depends__=null,t._file=null,t._ref=0,Object.defineProperty(ie(t),"_uuid",{value:"",writable:!0}),t}$(t,e),t.deserialize=function(e){return c.deserialize(e)},Z(t,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var e=this._native;if(47===e.charCodeAt(0))return e.slice(1);46===e.charCodeAt(0)?this._nativeUrl=A_(this._uuid,{nativeExt:e,isNative:!0}):this._nativeUrl=A_(this._uuid,{__nativeName__:e,nativeExt:H(e),isNative:!0})}return this._nativeUrl}},{key:"_nativeAsset",get:function(){return this._file},set:function(e){this._file=e}}]);var n=t.prototype;return n.toString=function(){return this.nativeUrl},n.serialize=function(){},n._setRawAsset=function(e,t){void 0===t&&(t=!0),this._native=!1!==t?e||"":"/"+e},n.addRef=function(){return this._ref++,this},n.decRef=function(e){return void 0===e&&(e=!0),this._ref>0&&this._ref--,e&&c.assetManager._releaseManager.tryRelease(this),this},n.onLoaded=function(){},Z(t,[{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),t}(j_(D_)),X_.preventDeferredLoadDependents=!1,X_.preventPreloadNativeObject=!1,Y_=se((q_=K_).prototype,"_native",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),se(q_.prototype,"_nativeAsset",[Nh],Object.getOwnPropertyDescriptor(q_.prototype,"_nativeAsset"),q_.prototype),W_=q_))||W_);Z_.prototype.createNode=null,c.Asset=Z_;var J_,$_,ef,tf,nf,rf,of,af=1024;function sf(e){return c.sys.capabilities.imageBitmap&&e instanceof ImageBitmap}!function(e){e[e.RGB565=ra.R5G6B5]="RGB565",e[e.RGB5A1=ra.RGB5A1]="RGB5A1",e[e.RGBA4444=ra.RGBA4]="RGBA4444",e[e.RGB888=ra.RGB8]="RGB888",e[e.RGB32F=ra.RGB32F]="RGB32F",e[e.RGBA8888=ra.RGBA8]="RGBA8888",e[e.RGBA32F=ra.RGBA32F]="RGBA32F",e[e.A8=ra.A8]="A8",e[e.I8=ra.L8]="I8",e[e.AI8=ra.LA8]="AI8",e[e.RGB_PVRTC_2BPPV1=ra.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",e[e.RGBA_PVRTC_2BPPV1=ra.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",e[e.RGB_A_PVRTC_2BPPV1=af++]="RGB_A_PVRTC_2BPPV1",e[e.RGB_PVRTC_4BPPV1=ra.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",e[e.RGBA_PVRTC_4BPPV1=ra.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",e[e.RGB_A_PVRTC_4BPPV1=af++]="RGB_A_PVRTC_4BPPV1",e[e.RGB_ETC1=ra.ETC_RGB8]="RGB_ETC1",e[e.RGBA_ETC1=af++]="RGBA_ETC1",e[e.RGB_ETC2=ra.ETC2_RGB8]="RGB_ETC2",e[e.RGBA_ETC2=ra.ETC2_RGBA8]="RGBA_ETC2",e[e.RGBA_ASTC_4x4=ra.ASTC_RGBA_4x4]="RGBA_ASTC_4x4",e[e.RGBA_ASTC_5x4=ra.ASTC_RGBA_5x4]="RGBA_ASTC_5x4",e[e.RGBA_ASTC_5x5=ra.ASTC_RGBA_5x5]="RGBA_ASTC_5x5",e[e.RGBA_ASTC_6x5=ra.ASTC_RGBA_6x5]="RGBA_ASTC_6x5",e[e.RGBA_ASTC_6x6=ra.ASTC_RGBA_6x6]="RGBA_ASTC_6x6",e[e.RGBA_ASTC_8x5=ra.ASTC_RGBA_8x5]="RGBA_ASTC_8x5",e[e.RGBA_ASTC_8x6=ra.ASTC_RGBA_8x6]="RGBA_ASTC_8x6",e[e.RGBA_ASTC_8x8=ra.ASTC_RGBA_8x8]="RGBA_ASTC_8x8",e[e.RGBA_ASTC_10x5=ra.ASTC_RGBA_10x5]="RGBA_ASTC_10x5",e[e.RGBA_ASTC_10x6=ra.ASTC_RGBA_10x6]="RGBA_ASTC_10x6",e[e.RGBA_ASTC_10x8=ra.ASTC_RGBA_10x8]="RGBA_ASTC_10x8",e[e.RGBA_ASTC_10x10=ra.ASTC_RGBA_10x10]="RGBA_ASTC_10x10",e[e.RGBA_ASTC_12x10=ra.ASTC_RGBA_12x10]="RGBA_ASTC_12x10",e[e.RGBA_ASTC_12x12=ra.ASTC_RGBA_12x12]="RGBA_ASTC_12x12"}(J_||(J_=e("bM",{}))),function(e){e[e.REPEAT=ya.WRAP]="REPEAT",e[e.CLAMP_TO_EDGE=ya.CLAMP]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=ya.MIRROR]="MIRRORED_REPEAT",e[e.CLAMP_TO_BORDER=ya.BORDER]="CLAMP_TO_BORDER"}($_||($_=e("cX",{}))),function(e){e[e.NONE=ga.NONE]="NONE",e[e.LINEAR=ga.LINEAR]="LINEAR",e[e.NEAREST=ga.POINT]="NEAREST"}(ef||(ef=e("bL",{})));var cf,lf=e("ay",bh("cc.ImageAsset")((of=rf=function(e){function t(t){var n;return(n=e.call(this)||this)._nativeData=void 0,n._tex=void 0,n._exportedExts=void 0,n._format=J_.RGBA8888,n._width=0,n._height=0,n.loaded=!1,n._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==t&&n.reset(t),n}$(t,e),Z(t,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(e){e instanceof HTMLElement||sf(e)||(e.format=e.format||this._format),this.reset(e)}},{key:"data",get:function(){return this._nativeData&&((e=this._nativeData)instanceof HTMLImageElement||e instanceof HTMLCanvasElement||sf(e))?this._nativeData:this._nativeData&&this._nativeData._data;var e}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=J_.RGB_ETC1&&this._format<=J_.RGBA_ASTC_12x12||this._format>=J_.RGB_A_PVRTC_2BPPV1&&this._format<=J_.RGBA_ETC1}},{key:"url",get:function(){return this.nativeUrl}},{key:"_texture",set:function(e){this._tex=e},get:function(){if(!this._tex){var e=new c.Texture2D;e.name=this.nativeUrl,e.image=this,this._tex=e}return this._tex}}]);var n=t.prototype;return n.reset=function(e){var t=this;sf(e)?(this._nativeData=e,this._onDataComplete()):e instanceof HTMLElement?(this._nativeData=e,e.complete||e instanceof HTMLCanvasElement?this._onDataComplete():(this.loaded=!1,e.addEventListener("load",(function(){t._onDataComplete()})),e.addEventListener("error",(function(e){b(3119,e.message)})))):(this._nativeData=e,this._format=e.format,this._onDataComplete())},n.destroy=function(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset("")):sf(this.data)&&this.data.close&&this.data.close(),e.prototype.destroy.call(this)},n._serialize=function(){},n._deserialize=function(e){var n="";"string"==typeof e?n=e:(this._width=e.w,this._height=e.h,n=e.fmt);for(var i,r=c.director.root?c.director.root.device:null,o=n.split("_"),a="",s=Number.MAX_VALUE,l=this._format,u="",h=c.macro.SUPPORT_TEXTURE_FORMATS,_=oe(o);!(i=_()).done;){var f=i.value.split("@"),d=parseInt(f[0],void 0),m=t.extnames[d]||f[0],p=h.indexOf(m);if(-1!==p&&p<s){var v=f[1]?parseInt(f[1]):this._format;if(!(".astc"!==m||r&&r.hasFeature(Ba.FORMAT_ASTC)))continue;if(!(".pvr"!==m||r&&r.hasFeature(Ba.FORMAT_PVRTC)))continue;if(!(v!==J_.RGB_ETC1&&v!==J_.RGBA_ETC1||r&&r.hasFeature(Ba.FORMAT_ETC1)))continue;if(!(v!==J_.RGB_ETC2&&v!==J_.RGBA_ETC2||r&&r.hasFeature(Ba.FORMAT_ETC2)))continue;if(".webp"===m&&!c.sys.capabilities.webp)continue;s=p,u=m,l=v}else a||(a=m)}u?(this._setRawAsset(u),this._format=l):a?(this._setRawAsset(a),b(3120,a,a)):b(3121)},n._onDataComplete=function(){this.loaded=!0,this.emit("load")},t}(Z_),rf.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],se((nf=of).prototype,"_nativeAsset",[i_],Object.getOwnPropertyDescriptor(nf.prototype,"_nativeAsset"),nf.prototype),tf=nf))||tf);c.ImageAsset=lf,function(e){e[e.minFilter=0]="minFilter",e[e.magFilter=1]="magFilter",e[e.mipFilter=2]="mipFilter",e[e.addressU=3]="addressU",e[e.addressV=4]="addressV",e[e.addressW=5]="addressW",e[e.maxAnisotropy=6]="maxAnisotropy",e[e.cmpFunc=7]="cmpFunc",e[e.minLOD=8]="minLOD",e[e.maxLOD=9]="maxLOD",e[e.mipLODBias=10]="mipLODBias",e[e.total=11]="total"}(cf||(cf={}));var uf=[ga.LINEAR,ga.LINEAR,ga.NONE,ya.WRAP,ya.WRAP,ya.WRAP,8,fa.NEVER,0,0,0],hf=df(uf),_f=new ms,ff=new Ls;function df(e){for(var t=0,n=0,i=0;i<uf.length;i++)switch(t=e[i]||uf[i],i){case cf.minFilter:n|=t;break;case cf.magFilter:n|=t<<2;break;case cf.mipFilter:n|=t<<4;break;case cf.addressU:n|=t<<6;break;case cf.addressV:n|=t<<8;break;case cf.addressW:n|=t<<10;break;case cf.maxAnisotropy:n|=t<<12;break;case cf.cmpFunc:n|=t<<16;break;case cf.minLOD:n|=t<<20;break;case cf.maxLOD:n|=t<<24;break;case cf.mipLODBias:n|=t<<28}return n}var mf,pf,vf,gf,yf,xf,Ef,Tf,Sf,Af,Cf,wf,bf=function(){function e(){this._cache={}}return e.prototype.getSampler=function(e,t){return t||(t=hf),this._cache[t]||(ff.minFilter=3&t,ff.magFilter=t>>2&3,ff.mipFilter=t>>4&3,ff.addressU=t>>6&3,ff.addressV=t>>8&3,ff.addressW=t>>10&3,ff.maxAnisotropy=t>>12&15,ff.cmpFunc=t>>16&15,ff.minLOD=t>>20&15,ff.maxLOD=t>>24&15,ff.mipLODBias=t>>28&15,ff.borderColor=_f,this._cache[t]=e.createSampler(ff))},e}(),If=e("aA",new bf);c.samplerLib=If;var Rf=new Ne("Tex"),Of=e("cc",bh("cc.TextureBase")((wf=Cf=function(e){function t(){var t;return ae(t=e.call(this)||this,"_format",vf,ie(t)),ae(t,"_minFilter",gf,ie(t)),ae(t,"_magFilter",yf,ie(t)),ae(t,"_mipFilter",xf,ie(t)),ae(t,"_wrapS",Ef,ie(t)),ae(t,"_wrapT",Tf,ie(t)),ae(t,"_wrapR",Sf,ie(t)),ae(t,"_anisotropy",Af,ie(t)),t._width=1,t._height=1,t._id=void 0,t._samplerInfo=[],t._samplerHash=0,t._gfxSampler=null,t._gfxDevice=null,t._textureHash=0,t._id=Rf.getNewId(),t.loaded=!1,t._gfxDevice=t._getGFXDevice(),t._textureHash=ls(t._id,666),t}$(t,e),Z(t,[{key:"isCompressed",get:function(){return this._format>=J_.RGB_ETC1&&this._format<=J_.RGBA_ASTC_12x12||this._format>=J_.RGB_A_PVRTC_2BPPV1&&this._format<=J_.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);var n=t.prototype;return n.getId=function(){return this._id},n.getPixelFormat=function(){return this._format},n.getAnisotropy=function(){return this._anisotropy},n.setWrapMode=function(e,t,n){this._wrapS=e,this._samplerInfo[cf.addressU]=e,this._wrapT=t,this._samplerInfo[cf.addressV]=t,void 0!==n&&(this._wrapR=n,this._samplerInfo[cf.addressW]=n),this._samplerHash=df(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=If.getSampler(this._gfxDevice,this._samplerHash))},n.setFilters=function(e,t){this._minFilter=e,this._samplerInfo[cf.minFilter]=e,this._magFilter=t,this._samplerInfo[cf.magFilter]=t,this._samplerHash=df(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=If.getSampler(this._gfxDevice,this._samplerHash))},n.setMipFilter=function(e){this._mipFilter=e,this._samplerInfo[cf.mipFilter]=e,this._samplerInfo[cf.maxLOD]=e===ef.NONE?0:15,this._samplerHash=df(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=If.getSampler(this._gfxDevice,this._samplerHash))},n.setAnisotropy=function(e){this._anisotropy=e,this._samplerInfo[cf.maxAnisotropy]=e,this._samplerHash=df(this._samplerInfo),this._gfxDevice&&(this._gfxSampler=If.getSampler(this._gfxDevice,this._samplerHash))},n.destroy=function(){var t=e.prototype.destroy.call(this);return t&&c.director.root&&c.director.root.batcher2D&&c.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),t},n.getHash=function(){return this._textureHash},n.getGFXTexture=function(){return null},n.getSamplerHash=function(){return this._samplerHash},n.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=If.getSampler(this._gfxDevice,this._samplerHash):R(9302)),this._gfxSampler},n._serialize=function(e){return""},n._deserialize=function(e,t){var n=e.split(",");n.unshift(""),n.length>=5&&(this.setFilters(parseInt(n[1]),parseInt(n[2])),this.setWrapMode(parseInt(n[3]),parseInt(n[4]))),n.length>=7&&(this.setMipFilter(parseInt(n[5])),this.setAnisotropy(parseInt(n[6])))},n._getGFXDevice=function(){return c.director.root?c.director.root.device:null},n._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},n._setGFXFormat=function(e){this._format=void 0===e?J_.RGBA8888:e},n._getGFXPixelFormat=function(e){return e===J_.RGBA_ETC1?e=J_.RGB_ETC1:e===J_.RGB_A_PVRTC_4BPPV1?e=J_.RGB_PVRTC_4BPPV1:e===J_.RGB_A_PVRTC_2BPPV1&&(e=J_.RGB_PVRTC_2BPPV1),e},t}(Z_),Cf.PixelFormat=J_,Cf.WrapMode=$_,Cf.Filter=ef,vf=se((pf=wf).prototype,"_format",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return J_.RGBA8888}}),gf=se(pf.prototype,"_minFilter",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ef.LINEAR}}),yf=se(pf.prototype,"_magFilter",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ef.LINEAR}}),xf=se(pf.prototype,"_mipFilter",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ef.NONE}}),Ef=se(pf.prototype,"_wrapS",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $_.REPEAT}}),Tf=se(pf.prototype,"_wrapT",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $_.REPEAT}}),Sf=se(pf.prototype,"_wrapR",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $_.REPEAT}}),Af=se(pf.prototype,"_anisotropy",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),mf=pf))||mf);c.TextureBase=Of;var Nf=[ui,Wn,di,Jn,Vn,vi,yi,ai];function Pf(e,t){e.x=t[1],e.y=t[2],e.z=t[3],e.w=t[4]}var Mf=[function(e,t){e.x=t[1],e.y=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.z=t[3]},Pf,Pf,function(e,t){e._val=t[1]},function(e,t){e.width=t[1],e.height=t[2]},function(e,t){e.x=t[1],e.y=t[2],e.width=t[3],e.height=t[4]},function(e,t){ai.fromArray(e,t,1)}],Df=e("eb",function(){function e(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null}var t=e.prototype;return t.init=function(e){this.uuidObjList=e[8],this.uuidPropList=e[9],this.uuidList=e[10]},t.reset=function(){this.uuidList=null,this.uuidObjList=null,this.uuidPropList=null},t.push=function(e,t,n){this.uuidObjList.push(e),this.uuidPropList.push(t),this.uuidList.push(n)},e}());function Lf(e,t){for(var n=e[4][t[0]],i=n[0],r=new(0,i[0]),o=i[1],a=i[2],s=n[n.length-1],c=1;c<s;++c)r[o[n[c]]]=t[c];for(;c<t.length;++c){var l=o[n[c]],u=i[n[c]+a];(0,Hf[u])(e,r,l,t[c])}return r}function Ff(e,t,n){var i=new t;return i._deserialize?i._deserialize(n,e[0]):R(5303,je(t)),i}function zf(e,t,n,i){i>=0?t[n]=e[5][i]:e[7][3*~i]=t}function Bf(e){return function(t,n,i,r){n[i]=r;for(var o=0;o<r.length;++o)e(t,r,o,r[o])}}function Uf(e,t,n,i){t[n]=null,e[8][i]=t}function Gf(e,t,n,i){t[n]=Lf(e,i)}Df.pool=new vt((function(e){e.reset()}),5),Df.pool.get=function(){return this._get()||new Df};var Hf=new Array(13);function kf(e,t){return e||qf.reportMissingClass(t),Object}function Vf(e,t,n,i,r,o){var a=e(t);if(!a){if(r)return void(n[i]=function(t,n,i){return function(){var r=e(i)||kf(o,i);return t[n]=r,new r}}(n,i,t));a=kf(o,t)}n[i]=a}function jf(e,t,n){for(var i=n||dt,r=e[3],o=0;o<r.length;++o){var a=r[o];if("string"!=typeof a){if("function"==typeof a[0])throw new Error("Can not deserialize the same JSON data again.");Vf(i,a[0],a,0,t,n)}else Vf(i,a,r,o,t,n)}}function Wf(e){var t=e[4];if(t)for(var n=e[3],i=0;i<t.length;++i){var r=t[i];r[0]=n[r[0]]}}function qf(e,t,n){"string"==typeof e&&(e=JSON.parse(e));var i,r=!t;(t=t||Df.pool.get()).init(e),n=n||{};var o=e[0],a=!1;if("object"==typeof o&&(a=o.preprocessed,o=o.version),o<1)throw new Error(M(5304,o));n._version=o,n.result=t,e[0]=n,a||(jf(e,!1,n.classFinder),Wf(e)),c.game._isCloning=!0;var s=e[5],l=function(e){var t=e[5],n=e[6],i=0===n?0:n.length,r=t[t.length-1],o=t.length-i;"number"!=typeof r?r=0:(r<0&&(r=~r),--o);for(var a=0;a<o;++a)t[a]=Lf(e,t[a]);for(var s=e[3],c=0;c<i;++c,++a){var l=n[c],u=t[a];if(l>=0){var h=s[l];t[a]=Ff(e,h,u)}else(0,Hf[l=~l])(e,t,a,u)}return r}(e);return c.game._isCloning=!1,e[7]&&function(e,t,n){for(var i=e.length-1,r=0,o=3*e[i];r<o;r+=3){var a=e[r],s=t[e[r+2]],c=e[r+1];c>=0?a[n[c]]=s:a[~c]=s}for(;r<i;r+=3){var l=t[e[r]],u=t[e[r+2]],h=e[r+1];h>=0?l[n[h]]=u:l[~h]=u}}(e[7],s,e[2]),function(e){for(var t=e[5],n=e[2],i=e[1],r=e[8],o=e[9],a=e[10],s=0;s<r.length;++s){var c=r[s];"number"==typeof c&&(r[s]=t[c]);var l=o[s];"number"==typeof l&&(l=l>=0?n[l]:~l,o[s]=l);var u=a[s];"number"==typeof u&&(a[s]=i[u])}}(e),i=s[l],r&&Df.pool.put(t),i}Hf[0]=function(e,t,n,i){t[n]=i},Hf[1]=zf,Hf[2]=Bf(zf),Hf[3]=Bf(Uf),Hf[4]=Gf,Hf[5]=function(e,t,n,i){Mf[i[0]](t[n],i)},Hf[6]=Uf,Hf[7]=function(e,t,n,i){t[n].set(i)},Hf[8]=function(e,t,n,i){var r=new Nf[i[0]];Mf[i[0]](r,i),t[n]=r},Hf[9]=Bf(Gf),Hf[10]=function(e,t,n,i){var r=e[3][i[0]];t[n]=Ff(e,r,i[1])},Hf[11]=function(e,t,n,i){var r=i[0];t[n]=r;for(var o=1;o<i.length;o+=3){var a=i[o],s=i[o+1],c=i[o+2];(0,Hf[s])(e,r,a,c)}},Hf[12]=function(e,t,n,i){var r=i[0];t[n]=r;for(var o=0;o<r.length;++o){var a=r[o],s=i[o+1];0!==s&&(0,Hf[s])(e,r,o,a)}},qf.Details=Df,qf.reportMissingClass=function(e){b(5302,e)};var Yf,Xf,Kf,Qf=function(e){this.preprocessed=!0,this.version=e};function Zf(e,t,n){return[1,0,0,[e],0,n?[t,-1]:[t],[0],0,[],[],[]]}c.deserialize=qf;var Jf=e("ek",bh("cc.Script")(Yf=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(Z_))||Yf);c._Script=Jf;var $f=e("el",bh("cc.JavaScript")(Xf=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(Jf))||Xf);c._JavaScript=$f;var ed,td,nd,id,rd,od,ad,sd,cd,ld,ud,hd=e("em",bh("cc.TypeScript")(Kf=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(Jf))||Kf);c._TypeScript=hd;var _d,fd,dd,md,pd=new Ne("Comp"),vd=D_.Flags.IsOnLoadCalled,gd=e("bj",(ed=bh("cc.Component"),td=Vh(),nd=n_(Jf),id=jh(),ed((ud=ld=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"node",ad,ie(t)),ae(t,"_enabled",sd,ie(t)),ae(t,"__prefab",cd,ie(t)),t._sceneGetter=null,t._id=pd.getNewId(),t}$(t,e);var n=t.prototype;return n._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene._renderScene},n.addComponent=function(e){return this.node.addComponent(e)},n.getComponent=function(e){return this.node.getComponent(e)},n.getComponents=function(e){return this.node.getComponents(e)},n.getComponentInChildren=function(e){return this.node.getComponentInChildren(e)},n.getComponentsInChildren=function(e){return this.node.getComponentsInChildren(e)},n.destroy=function(){return!!e.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&c.director._compScheduler.disableComp(this),!0)},n._onPreDestroy=function(){this.unscheduleAllCallbacks(),c.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},n._instantiate=function(e){return e||(e=c.instantiate._clone(this,this)),e.node=null,e},n.schedule=function(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=c.macro.REPEAT_FOREVER),void 0===i&&(i=0),P(e,1619),P((t=t||0)>=0,1620),n=isNaN(n)?c.macro.REPEAT_FOREVER:n,i=i||0;var r=c.director.getScheduler(),o=r.isTargetPaused(this);r.schedule(e,this,t,n,i,o)},n.scheduleOnce=function(e,t){void 0===t&&(t=0),this.schedule(e,0,0,t)},n.unschedule=function(e){e&&c.director.getScheduler().unschedule(e,this)},n.unscheduleAllCallbacks=function(){c.director.getScheduler().unscheduleAllForTarget(this)},Z(t,[{key:"name",get:function(){if(this._name)return this._name;var e=je(this),t=e.lastIndexOf(".");return t>=0&&(e=e.slice(t+1)),this.node.name+"<"+e+">"},set:function(e){this._name=e}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(this._enabled=e,this.node.activeInHierarchy)){var t=c.director._compScheduler;e?t.enableComp(this):t.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&vd}}]),t}(D_),ld.system=null,se((od=ud).prototype,"__scriptAsset",[td,nd,id,Zh],Object.getOwnPropertyDescriptor(od.prototype,"__scriptAsset"),od.prototype),ad=se(od.prototype,"node",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sd=se(od.prototype,"_enabled",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),cd=se(od.prototype,"__prefab",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rd=od))||rd)),yd=gd.prototype;yd.update=null,yd.lateUpdate=null,yd.__preload=null,yd.onLoad=null,yd.start=null,yd.onEnable=null,yd.onDisable=null,yd.onDestroy=null,yd.onFocusInEditor=null,yd.onLostFocusInEditor=null,yd.resetInEditor=null,yd._getLocalBounds=null,yd.onRestore=null,gd._requireComponent=null,gd._executionOrder=0,Ue(gd,"_registerEditorProps",(function(e,t){var n=t.requireComponent;n&&(e._requireComponent=n);var i=t.executionOrder;i&&"number"==typeof i&&(e._executionOrder=i)})),c.Component=gd;var xd=e("fv",bh("cc.MissingScript")(_d=Bh()((md=function(e){function t(){var t;return ae(t=e.call(this)||this,"_$erialized",dd,ie(t)),t}return $(t,e),t.safeFindClass=function(e){var t=dt(e);if(t)return t;c.deserialize.reportMissingClass(e)},t.prototype.onLoad=function(){b(4600,this.node.name)},t}(gd),dd=se((fd=md).prototype,"_$erialized",[Ph,Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_d=fd))||_d)||_d);function Ed(e,t){var n;n=xd.safeFindClass;var i,r=Df.pool.get();try{i=qf(e,r,{classFinder:n,customEnv:t})}catch(e){throw y(e),Df.pool.put(r),e}i._uuid=t.__uuid__||"";for(var o=r.uuidList,a=r.uuidObjList,s=r.uuidPropList,c=[],l=0;l<o.length;l++){var u=o[l];c[l]={uuid:E_(u),owner:a[l],prop:s[l]}}return i.__depends__=c,i._native&&(i.__nativeDepend__=!0),Df.pool.put(r),i}c._MissingScript=xd;var Td,Sd=new(function(){function e(){this._depends=new r_}var t=e.prototype;return t.init=function(){this._depends.clear()},t.getNativeDep=function(e){var t=this._depends.get(e);return t&&t.nativeDep?J({},t.nativeDep):null},t.getDeps=function(e){return this._depends.has(e)?this._depends.get(e).deps:[]},t.getDepsRecursively=function(e){var t=Object.create(null),n=[];return this._descend(e,t,n),n},t.remove=function(e){this._depends.remove(e)},t.parse=function(e,t){var n,i,r=null;if(Array.isArray(t)||t.__type__){if(this._depends.has(e))return this._depends.get(e);if(!Array.isArray(t)||"number"==typeof(i=(n=t[5])[n.length-1])&&i<0)try{var o=Ed(t,{__uuid__:e});(r=this._parseDepsFromAsset(o)).nativeDep&&(r.nativeDep.uuid=e),l_.add(e+"@import",o)}catch(t){c_.remove(e+"@import"),r={deps:[]}}else r={deps:this._parseDepsFromJson(t)}}else{if(this._depends.has(e)&&(r=this._depends.get(e)).parsedFromExistAsset)return r;r=this._parseDepsFromAsset(t)}return this._depends.add(e,r),r},t._parseDepsFromAsset=function(e){for(var t={deps:[],parsedFromExistAsset:!0,preventPreloadNativeObject:e.constructor.preventPreloadNativeObject,preventDeferredLoadDependents:e.constructor.preventDeferredLoadDependents},n=e.__depends__,i=0,r=n.length;i<r;i++)t.deps.push(n[i].uuid);return e.__nativeDepend__&&(t.nativeDep=e._nativeDep),t},t._parseDepsFromJson=function(e){var t=null;return(t=function(e){var t=e[1];return e[10].map((function(e){return t[e]}))}(e)).forEach((function(e,n){return t[n]=E_(e)})),t},t._descend=function(e,t,n){for(var i=this.getDeps(e),r=0;r<i.length;r++){var o=i[r];t[o]||(t[o]=!0,n.push(o),this._descend(o,t,n))}},e}()),Ad=[new xs];function Cd(e){return e&&0==(e&e-1)}var wd,bd,Id,Rd,Od,Nd,Pd=bh("cc.SimpleTexture")(Td=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._gfxTexture=null,t._mipmapLevel=1,t._textureWidth=0,t._textureHeight=0,t}$(t,e);var n=t.prototype;return n.getGFXTexture=function(){return this._gfxTexture},n.destroy=function(){return this._tryDestroyTexture(),e.prototype.destroy.call(this)},n.updateImage=function(){this.updateMipmaps(0)},n.updateMipmaps=function(e,t){},n.uploadData=function(e,t,n){if(void 0===t&&(t=0),void 0===n&&(n=0),this._gfxTexture&&!(this._mipmapLevel<=t)){var i=this._getGFXDevice();if(i){var r=Ad[0];r.texExtent.width=this._textureWidth>>t,r.texExtent.height=this._textureHeight>>t,r.texSubres.mipLevel=t,r.texSubres.baseArrayLayer=n,ArrayBuffer.isView(e)?i.copyBuffersToTexture([e],this._gfxTexture,Ad):i.copyTexImagesToTexture([e],this._gfxTexture,Ad)}}},n._assignImage=function(e,t,n){var i=this,r=function(){var r=e.data;if(r&&(i.uploadData(r,t,n),i._checkTextureLoaded(),It.CLEANUP_IMAGE_CACHE)){var o=Sd.getDeps(i._uuid),a=o.indexOf(e._uuid);-1!==a&&(be(o,a),e.decRef())}};if(e.loaded)r();else{if(e.once("load",(function(){r()})),!this.isCompressed){var o=c.builtinResMgr.get("black-texture").image;this.uploadData(o.data,t,n)}c.assetManager.postLoadNative(e)}},n._checkTextureLoaded=function(){this._textureReady()},n._textureReady=function(){this.loaded=!0,this.emit("load")},n._setMipmapLevel=function(e){this._mipmapLevel=e<1?1:e},n._getGfxTextureCreateInfo=function(e){return null},n._tryReset=function(){if(this._tryDestroyTexture(),0!==this._mipmapLevel){var e=this._getGFXDevice();e&&this._createTexture(e)}},n._createTexture=function(e){if(0!==this._width&&0!==this._height){var t=Sa.NONE;this._mipFilter!==ef.NONE&&function(e,t,n){return!(e.gfxAPI===Fa.WEBGL)||Cd(t)&&Cd(n)}(e,this._width,this._height)&&(this._mipmapLevel=function(e,t){for(var n=Math.max(e,t),i=0;n;)n>>=1,i++;return i}(this._width,this._height),t=Sa.GEN_MIPMAP);var n=this._getGfxTextureCreateInfo({usage:Ea.SAMPLED|Ea.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:t|Sa.IMMUTABLE});if(n){var i=e.createTexture(n);this._textureWidth=n.width,this._textureHeight=n.height,this._gfxTexture=i}}},n._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},Z(t,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),t}(Of))||Td;c.SimpleTexture=Pd;var Md,Dd,Ld,Fd,zd,Bd,Ud=e("az",(wd=bh("cc.Texture2D"),bd=n_([lf]),wd((Nd=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"_mipmaps",Od,ie(t)),t}$(t,e);var n=t.prototype;return n.initialize=function(){this.mipmaps=this._mipmaps},n.onLoaded=function(){this.initialize()},n.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()},n.create=function(e,t,n,i){void 0===n&&(n=J_.RGBA8888),void 0===i&&(i=1),this.reset({width:e,height:t,format:n,mipmapLevel:i})},n.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},n.updateMipmaps=function(e,t){if(void 0===e&&(e=0),!(e>=this._mipmaps.length))for(var n=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e),i=0;i<n;++i){var r=e+i;this._assignImage(this._mipmaps[r],r)}},n.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},n.destroy=function(){return this._mipmaps=[],e.prototype.destroy.call(this)},n.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},n.releaseTexture=function(){this.destroy()},n._serialize=function(e){},n._deserialize=function(t,n){var i=t;e.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r)if(this._mipmaps[r]=new lf,i.mipmaps[r]){var o=i.mipmaps[r];n.result.push(this._mipmaps,""+r,o),this._mipmaps[r]._texture=this}},n._getGfxTextureCreateInfo=function(e){var t=new Vs(xa.TEX2D);return t.width=this._width,t.height=this._height,Object.assign(t,e)},n._checkTextureLoaded=function(){for(var t=!0,n=0;n<this._mipmaps.length;++n)if(!this._mipmaps[n].loaded){t=!1;break}t&&e.prototype._textureReady.call(this)},Z(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){var t=this;if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0];this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(e,n){t._assignImage(e,n)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(Pd),Od=se((Rd=Nd).prototype,"_mipmaps",[bd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Id=Rd))||Id));c.Texture2D=Ud,function(e){e[e.right=0]="right",e[e.left=1]="left",e[e.top=2]="top",e[e.bottom=3]="bottom",e[e.front=4]="front",e[e.back=5]="back"}(Bd||(Bd={}));var Gd=e("ei",bh("cc.TextureCube")((zd=Fd=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"_mipmaps",Ld,ie(t)),t}$(t,e),t.fromTexture2DArray=function(e,n){for(var i=[],r=e.length/6,o=0;o<r;o++){var a=6*o;i.push({front:e[a+Bd.front].image,back:e[a+Bd.back].image,left:e[a+Bd.left].image,right:e[a+Bd.right].image,top:e[a+Bd.top].image,bottom:e[a+Bd.bottom].image})}return(n=n||new t).mipmaps=i,n};var n=t.prototype;return n.onLoaded=function(){this.mipmaps=this._mipmaps,this.loaded=!0,this.emit("load")},n.reset=function(e){this._width=e.width,this._height=e.height,this._setGFXFormat(e.format),this._setMipmapLevel(e.mipmapLevel||1),this._tryReset()},n.updateMipmaps=function(e,t){var n=this;if(void 0===e&&(e=0),!(e>=this._mipmaps.length))for(var i=Math.min(void 0===t?this._mipmaps.length:t,this._mipmaps.length-e),r=function(t){var i=e+t;Hd(n._mipmaps[i],(function(e,t){n._assignImage(e,i,t)}))},o=0;o<i;++o)r(o)},n.destroy=function(){return this._mipmaps=[],e.prototype.destroy.call(this)},n.releaseTexture=function(){this.mipmaps=[]},n._serialize=function(e){},n._deserialize=function(t,n){var i=t;e.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r){this._mipmaps[r]={front:new lf,back:new lf,left:new lf,right:new lf,top:new lf,bottom:new lf};var o=i.mipmaps[r];n.result.push(this._mipmaps[r],"front",o.front),n.result.push(this._mipmaps[r],"back",o.back),n.result.push(this._mipmaps[r],"left",o.left),n.result.push(this._mipmaps[r],"right",o.right),n.result.push(this._mipmaps[r],"top",o.top),n.result.push(this._mipmaps[r],"bottom",o.bottom)}},n._getGfxTextureCreateInfo=function(e){var t=new Vs(xa.CUBE);return t.width=this._width,t.height=this._height,t.layerCount=6,Object.assign(t,e),t.flags|=Sa.CUBEMAP,t},Z(t,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(e){var t=this;if(this._mipmaps=e,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0].front;this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length}),this._mipmaps.forEach((function(e,n){Hd(e,(function(e,i){t._assignImage(e,n,i)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(e){this.mipmaps=e?[e]:[]}}]),t}(Pd),Fd.FaceIndex=Bd,Ld=se((Dd=zd).prototype,"_mipmaps",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Md=Dd))||Md);function Hd(e,t){t(e.front,Bd.front),t(e.back,Bd.back),t(e.left,Bd.left),t(e.right,Bd.right),t(e.top,Bd.top),t(e.bottom,Bd.bottom)}c.TextureCube=Gd;var kd,Vd,jd,Wd=e("fw",[{name:"billboard",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"billboard|vert:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"billboard|vert:vs_main|tinted-fs:add",hash:2143664850,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"builtin",defines:[],binding:1,stageFlags:1,members:[{name:"cc_size_rotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:2,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:3}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"clear-stencil",techniques:[{passes:[{blendState:{targets:[{blend:!0}]},rasterizerState:{cullMode:0},program:"clear-stencil|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"clear-stencil|sprite-vs:vert|sprite-fs:frag",hash:1062464958,builtins:{globals:{blocks:[],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0}]}]},{name:"graphics",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:1,blendDst:4,blendSrcAlpha:1,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"graphics|vs:vert|fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"graphics|vs:vert|fs:frag",hash:3946667351,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_dist",type:13,count:1,defines:[],stageFlags:1,format:11,location:2}]}]},{name:"particle-gpu",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",hash:3696836305,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"COLOR_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"SIZE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"FORCE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"VELOCITY_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"TEXTURE_ANIMATION_MODULE_ENABLE",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"SampleConstants",defines:[],binding:1,stageFlags:1,members:[{name:"u_sampleInfo",type:16,count:1}]},{name:"TickConstants",defines:[],binding:2,stageFlags:1,members:[{name:"u_worldRot",type:16,count:1},{name:"u_timeDelta",type:16,count:1}]},{name:"ColorConstant",defines:["COLOR_OVER_TIME_MODULE_ENABLE"],binding:3,stageFlags:1,members:[{name:"u_color_mode",type:5,count:1}]},{name:"RotationConstant",defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],binding:4,stageFlags:1,members:[{name:"u_rotation_mode",type:5,count:1}]},{name:"SizeConstant",defines:["SIZE_OVER_TIME_MODULE_ENABLE"],binding:5,stageFlags:1,members:[{name:"u_size_mode",type:5,count:1}]},{name:"ForceConstant",defines:["FORCE_OVER_TIME_MODULE_ENABLE"],binding:6,stageFlags:1,members:[{name:"u_force_mode",type:5,count:1},{name:"u_force_space",type:5,count:1}]},{name:"VelocityConstant",defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],binding:7,stageFlags:1,members:[{name:"u_velocity_mode",type:5,count:1},{name:"u_velocity_space",type:5,count:1}]},{name:"AnimationConstant",defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],binding:8,stageFlags:1,members:[{name:"u_anim_info",type:16,count:1}]},{name:"FragConstants",defines:[],binding:9,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"color_over_time_tex0",type:28,count:1,defines:["COLOR_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:10},{name:"rotation_over_time_tex0",type:28,count:1,defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:11},{name:"size_over_time_tex0",type:28,count:1,defines:["SIZE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:12},{name:"force_over_time_tex0",type:28,count:1,defines:["FORCE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:13},{name:"velocity_over_time_tex0",type:28,count:1,defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:14},{name:"texture_animation_tex0",type:28,count:1,defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],stageFlags:1,binding:15},{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:16}],attributes:[{name:"a_position_starttime",type:16,count:1,defines:[],stageFlags:1,format:44,location:0},{name:"a_size_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_rotation_uv",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_dir_life",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_rndSeed",type:13,count:1,defines:[],stageFlags:1,format:11,location:5},{name:"a_texCoord",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_color1",type:16,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:44,location:9}]}]},{name:"particle-trail",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-trail|particle-trail:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},frameTile_velLenScale:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-trail|particle-trail:vs_main|tinted-fs:add",hash:4115155772,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_DRAW_WIRE_FRAME",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:16,count:1,defines:[],stageFlags:1,format:44,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4}]}]},{name:"particle",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",hash:66662317,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord1",type:15,count:1,defines:[],stageFlags:1,format:32,location:2},{name:"a_texCoord2",type:15,count:1,defines:[],stageFlags:1,format:32,location:3},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:4},{name:"a_color1",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:8},{name:"a_texCoord3",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:6},{name:"a_normal",type:15,count:1,defines:["CC_RENDER_MODE"],stageFlags:1,format:32,location:7}]}]},{name:"spine",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"spine|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"spine|sprite-vs:vert|sprite-fs:frag",hash:4078504952,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplers:[{name:"cc_spriteTexture",defines:[]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"TWO_COLORED",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2},{name:"a_color2",type:16,count:1,defines:["TWO_COLORED"],stageFlags:1,format:44,location:3}]}]},{name:"sprite",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"sprite|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"sprite|sprite-vs:vert|sprite-fs:frag",hash:3990469549,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplers:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:2}]}]},{name:"standard",techniques:[{name:"opaque",passes:[{program:"standard|standard-vs:vert|standard-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"standard|standard-vs:vert|standard-fs:frag",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}},{phase:"shadow-caster",propertyIndex:0,rasterizerState:{cullMode:1},program:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},normalStrenth:{value:[1],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,1]},emissiveScaleParam:{type:16,value:[1,1,1,0]},albedoMap:{type:28,value:"grey"}}}]}],shaders:[{name:"standard|standard-vs:vert|standard-fs:frag",hash:2668109714,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"cc_lightingMap",defines:["USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_NORMAL_MAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"NORMAL_UV",type:"string",options:["v_uv","v_uv1"]},{name:"PBR_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_PBR_MAP",type:"boolean"},{name:"USE_METALLIC_ROUGHNESS_MAP",type:"boolean"},{name:"USE_OCCLUSION_MAP",type:"boolean"},{name:"USE_EMISSIVE_MAP",type:"boolean"},{name:"EMISSIVE_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplers:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1},{name:"normalMap",type:28,count:1,defines:["USE_NORMAL_MAP"],stageFlags:16,binding:2},{name:"pbrMap",type:28,count:1,defines:["USE_PBR_MAP"],stageFlags:16,binding:3},{name:"metallicRoughnessMap",type:28,count:1,defines:["USE_METALLIC_ROUGHNESS_MAP"],stageFlags:16,binding:4},{name:"occlusionMap",type:28,count:1,defines:["USE_OCCLUSION_MAP"],stageFlags:16,binding:5},{name:"emissiveMap",type:28,count:1,defines:["USE_EMISSIVE_MAP"],stageFlags:16,binding:6}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:14}]},{name:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3020491,builtins:{globals:{blocks:[{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplers:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_texCoord1",type:14,count:1,defines:[],stageFlags:1,format:21,location:13}]}]},{name:"terrain",techniques:[{name:"opaque",passes:[{program:"terrain|terrain-vs:vert|terrain-fs:frag",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal-texture",type:28},normalMap1:{value:"normal-texture",type:28},normalMap2:{value:"normal-texture",type:28},normalMap3:{value:"normal-texture",type:28},lightMap:{value:"grey",type:28}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"terrain|terrain-vs:vert|terrain-fs:frag",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal-texture",type:28},normalMap1:{value:"normal-texture",type:28},normalMap2:{value:"normal-texture",type:28},normalMap3:{value:"normal-texture",type:28},lightMap:{value:"grey",type:28}}},{phase:"shadow-add",propertyIndex:0,rasterizerState:{cullMode:2},program:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"terrain|terrain-vs:vert|terrain-fs:frag",hash:2952542850,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD"]}],samplers:[]}},defines:[{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_NORMALMAP",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"LAYERS",type:"number",range:[0,4]},{name:"USE_PBR",type:"boolean"}],blocks:[{name:"TexCoords",defines:[],binding:0,stageFlags:1,members:[{name:"UVScale",type:16,count:1},{name:"lightMapUVParam",type:16,count:1}]},{name:"PbrParams",defines:[],binding:1,stageFlags:16,members:[{name:"metallic",type:16,count:1},{name:"roughness",type:16,count:1}]}],samplers:[{name:"weightMap",type:28,count:1,defines:[],stageFlags:16,binding:2},{name:"detailMap0",type:28,count:1,defines:[],stageFlags:16,binding:3},{name:"detailMap1",type:28,count:1,defines:[],stageFlags:16,binding:4},{name:"detailMap2",type:28,count:1,defines:[],stageFlags:16,binding:5},{name:"detailMap3",type:28,count:1,defines:[],stageFlags:16,binding:6},{name:"normalMap0",type:28,count:1,defines:[],stageFlags:16,binding:7},{name:"normalMap1",type:28,count:1,defines:[],stageFlags:16,binding:8},{name:"normalMap2",type:28,count:1,defines:[],stageFlags:16,binding:9},{name:"normalMap3",type:28,count:1,defines:[],stageFlags:16,binding:10},{name:"lightMap",type:28,count:1,defines:[],stageFlags:16,binding:11}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]},{name:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3874167763,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplers:[]}},defines:[],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2}]}]},{name:"unlit",techniques:[{name:"opaque",passes:[{program:"unlit|unlit-vs:vert|unlit-fs:frag",properties:{mainTexture:{value:"grey",type:28},tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16},colorScale:{value:[1,1,1],type:15,handleInfo:["colorScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["colorScaleAndCutoff",3,13]},color:{type:16,handleInfo:["mainColor",0,16]},colorScaleAndCutoff:{type:16,value:[1,1,1,.5]}}}]}],shaders:[{name:"unlit|unlit-vs:vert|unlit-fs:frag",hash:3822871803,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r","g","b"]}],blocks:[{name:"TexCoords",defines:["USE_TEXTURE"],binding:0,stageFlags:1,members:[{name:"tilingOffset",type:16,count:1}]},{name:"Constant",defines:[],binding:1,stageFlags:16,members:[{name:"mainColor",type:16,count:1},{name:"colorScaleAndCutoff",type:16,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:["USE_TEXTURE"],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12},{name:"a_color",type:16,count:1,defines:["USE_VERTEX_COLOR"],stageFlags:1,format:44,location:13}]}]},{name:"planar-shadow",techniques:[{passes:[{phase:"planarShadow",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1,stencilTestFront:!0,stencilFuncFront:5,stencilPassOpFront:2,stencilRefBack:128,stencilRefFront:128,stencilReadMaskBack:128,stencilReadMaskFront:128,stencilWriteMaskBack:128,stencilWriteMaskFront:128}}]}],shaders:[{name:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",hash:2901856202,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplers:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplers:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}]}},defines:[{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_SUPPORT_FLOAT_TEXTURE",type:"boolean"},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"}],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3},{name:"a_vertexId",type:13,count:1,defines:["CC_USE_MORPH"],stageFlags:1,format:11,location:6},{name:"a_joints",type:12,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:42,location:4},{name:"a_weights",type:16,count:1,defines:["CC_USE_SKINNING"],stageFlags:1,format:44,location:5},{name:"a_jointAnimInfo",type:16,count:1,defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION","USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:7},{name:"a_matWorld0",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:8},{name:"a_matWorld1",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:9},{name:"a_matWorld2",type:16,count:1,defines:["USE_INSTANCING"],stageFlags:1,format:44,isInstanced:!0,location:10},{name:"a_lightingMapUVParam",type:16,count:1,defines:["USE_INSTANCING","USE_LIGHTMAP"],stageFlags:1,format:44,isInstanced:!0,location:11},{name:"a_dyn_batch_id",type:13,count:1,defines:["!USE_INSTANCING","USE_BATCHING"],stageFlags:1,format:11,location:12}]}]},{name:"skybox",techniques:[{passes:[{rasterizerState:{cullMode:0},program:"skybox|sky-vs:vert|sky-fs:frag",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"skybox|sky-vs:vert|sky-fs:frag",hash:2319917655,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[{name:"cc_environment",defines:[]}]},locals:{blocks:[],samplers:[]}},defines:[{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_RGBE_CUBEMAP",type:"boolean"}],blocks:[],samplers:[],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_normal",type:15,count:1,defines:[],stageFlags:1,format:32,location:1},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:2},{name:"a_tangent",type:16,count:1,defines:[],stageFlags:1,format:44,location:3}]}]},{name:"profiler",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"profiler|profiler-vs:vert|profiler-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"profiler|profiler-vs:vert|profiler-fs:frag",hash:2029303284,builtins:{globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[{name:"CC_USE_HDR",type:"boolean"}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"offset",type:16,count:1}]},{name:"PerFrameInfo",defines:[],binding:1,stageFlags:1,members:[{name:"digits",type:16,count:20}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],attributes:[{name:"a_position",type:15,count:1,defines:[],stageFlags:1,format:32,location:0},{name:"a_color",type:16,count:1,defines:[],stageFlags:1,format:44,location:1}]}]},{name:"splash-screen",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",hash:2106901053,builtins:{globals:{blocks:[],samplers:[]},locals:{blocks:[],samplers:[]}},defines:[],blocks:[{name:"splashFrag",defines:[],binding:0,stageFlags:16,members:[{name:"u_precent",type:13,count:1}]}],samplers:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],attributes:[{name:"a_position",type:14,count:1,defines:[],stageFlags:1,format:21,location:0},{name:"a_texCoord",type:14,count:1,defines:[],stageFlags:1,format:21,location:1}]}]}]),qd=4026531840,Yd=264241152,Xd=3145728,Kd=1032192;!function(e){e[e.UBO=0]="UBO",e[e.SAMPLER=1]="SAMPLER"}(jd||(jd={}));var Qd=function(e,t,n,i,r){return void 0===r&&(r=0),e<<28&qd|i<<22&Yd|t<<20&Xd|n<<14&Kd|16383&r},Zd=function(e){return(e&qd)>>>28},Jd=function(e){return(e&Yd)>>>22},$d=function(e){return(e&Kd)>>>14},em=function(e){return 16383&e},tm=function(e,t){return e&~Yd|t<<22&Yd},nm=((kd={})[ia.UNKNOWN]=function(e,t,n){return console.warn("illegal uniform handle")},kd[ia.INT]=function(e,t,n){return void 0===n&&(n=0),e[n]},kd[ia.INT2]=function(e,t,n){return void 0===n&&(n=0),ui.fromArray(t,e,n)},kd[ia.INT3]=function(e,t,n){return void 0===n&&(n=0),Wn.fromArray(t,e,n)},kd[ia.INT4]=function(e,t,n){return void 0===n&&(n=0),di.fromArray(t,e,n)},kd[ia.FLOAT]=function(e,t,n){return void 0===n&&(n=0),e[n]},kd[ia.FLOAT2]=function(e,t,n){return void 0===n&&(n=0),ui.fromArray(t,e,n)},kd[ia.FLOAT3]=function(e,t,n){return void 0===n&&(n=0),Wn.fromArray(t,e,n)},kd[ia.FLOAT4]=function(e,t,n){return void 0===n&&(n=0),di.fromArray(t,e,n)},kd[ia.MAT3]=function(e,t,n){return void 0===n&&(n=0),Kn.fromArray(t,e,n)},kd[ia.MAT4]=function(e,t,n){return void 0===n&&(n=0),ai.fromArray(t,e,n)},kd),im=((Vd={})[ia.UNKNOWN]=function(e,t,n){return console.warn("illegal uniform handle")},Vd[ia.INT]=function(e,t,n){return void 0===n&&(n=0),e[n]=t},Vd[ia.INT2]=function(e,t,n){return void 0===n&&(n=0),ui.toArray(e,t,n)},Vd[ia.INT3]=function(e,t,n){return void 0===n&&(n=0),Wn.toArray(e,t,n)},Vd[ia.INT4]=function(e,t,n){return void 0===n&&(n=0),di.toArray(e,t,n)},Vd[ia.FLOAT]=function(e,t,n){return void 0===n&&(n=0),e[n]=t},Vd[ia.FLOAT2]=function(e,t,n){return void 0===n&&(n=0),ui.toArray(e,t,n)},Vd[ia.FLOAT3]=function(e,t,n){return void 0===n&&(n=0),Wn.toArray(e,t,n)},Vd[ia.FLOAT4]=function(e,t,n){return void 0===n&&(n=0),di.toArray(e,t,n)},Vd[ia.MAT3]=function(e,t,n){return void 0===n&&(n=0),Kn.toArray(e,t,n)},Vd[ia.MAT4]=function(e,t,n){return void 0===n&&(n=0),ai.toArray(e,t,n)},Vd),rm=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function om(e){switch(e){case ia.BOOL:case ia.INT:case ia.UINT:case ia.FLOAT:return rm[0];case ia.BOOL2:case ia.INT2:case ia.UINT2:case ia.FLOAT2:return rm[1];case ia.BOOL4:case ia.INT4:case ia.UINT4:case ia.FLOAT4:return rm[2];case ia.MAT4:return rm[3];case ia.SAMPLER2D:return"default-texture";case ia.SAMPLER_CUBE:return"default-cube-texture"}return rm[0]}function am(e,t){for(var n=Object.entries(t),i=!1,r=0;r<n.length;r++)e[n[r][0]]!==n[r][1]&&(e[n[r][0]]=n[r][1],i=!0);return i}var sm=new $s;function cm(e){return Math.ceil(Math.log2(Math.max(e,2)))}function lm(e,t){switch(e.type){case"boolean":return"number"==typeof t?t.toString():t?"1":"0";case"string":return void 0!==t?t:e.options[0];case"number":return void 0!==t?t.toString():e.range[0].toString();default:return console.warn("unknown define type '"+e.type+"'"),"-1"}}function um(e,t,n,i,r){for(var o=e.builtins[i],a=[],s=function(e){var t=o.blocks[e],i=n.layouts[t.name],s=i&&n.bindings.find((function(e){return e.binding===i.binding}));if(!(i&&s&&s.descriptorType&Xs))return console.warn("builtin UBO '"+t.name+"' not available!"),"continue";a.push(i),r&&!r.includes(s)&&r.push(s)},c=0;c<o.blocks.length;c++)s(c);Array.prototype.unshift.apply(t.gfxBlocks,a);for(var l=[],u=function(e){var t=o.samplers[e],i=n.layouts[t.name],a=i&&n.bindings.find((function(e){return e.binding===i.binding}));if(!(i&&a&&a.descriptorType&Ks))return console.warn("builtin sampler '"+t.name+"' not available!"),"continue";l.push(i),r&&!r.includes(a)&&r.push(a)},h=0;h<o.samplers.length;h++)u(h);Array.prototype.unshift.apply(t.gfxSamplers,l),r&&r.sort((function(e,t){return e.binding-t.binding}))}function hm(e){return e.members.reduce((function(e,t){return e+qa(t.type)*t.count}),0)}function _m(e,t){for(var n=0;n<e.length;n++){var i=e[n];if("!"===i[0]){if(t[i.slice(1)])return!1}else if(!t[i])return!1}return!0}function fm(e){switch(e.gfxAPI){case Fa.GLES2:case Fa.WEBGL:return"glsl1";case Fa.GLES3:case Fa.WEBGL2:return"glsl3";default:return"glsl4"}}var dm=new(function(){function e(){this._templates={},this._cache={},this._templateInfos={}}var t=e.prototype;return t.register=function(e){for(var t=0;t<e.shaders.length;t++)this.define(e.shaders[t]).effectName=e.name},t.define=function(e){var t=this._templates[e.name];if(t&&t.hash===e.hash)return t;for(var n=J({},e),i=0,r=function(e){var t=n.defines[e],r=1;if("number"===t.type){var o=t.range;r=cm(o[1]-o[0]+1),t._map=function(e){return e-o[0]}}else"string"===t.type?(r=cm(t.options.length),t._map=function(e){return Math.max(0,t.options.findIndex((function(t){return t===e})))}):"boolean"===t.type&&(t._map=function(e){return e?1:0});t._offset=i,i+=r},o=0;o<n.defines.length;o++)r(o);if(i>31&&(n.uber=!0),this._templates[e.name]=n,!this._templateInfos[n.hash]){var a={};a.samplerStartBinding=n.blocks.length,a.gfxBlocks=[],a.gfxSamplers=[],a.bindings=[],a.blockSizes=[];for(var s=0;s<n.blocks.length;s++){var c=n.blocks[s];a.blockSizes.push(hm(c)),a.bindings.push(new Js(c.binding,c.descriptorType||Ca.UNIFORM_BUFFER,1,c.stageFlags)),a.gfxBlocks.push(new Us(uu.MATERIAL,c.binding,c.name,c.members.map((function(e){return new Bs(e.name,e.type,e.count)})),1))}for(var l=0;l<n.samplers.length;l++){var u=n.samplers[l];a.bindings.push(new Js(u.binding,u.descriptorType||Ca.SAMPLER,u.count,u.stageFlags)),a.gfxSamplers.push(new Gs(uu.MATERIAL,u.binding,u.name,u.type,u.count))}a.gfxAttributes=[];for(var h=0;h<n.attributes.length;h++){var _=n.attributes[h];a.gfxAttributes.push(new us(_.name,_.format,_.isNormalized,0,_.isInstanced,_.location))}um(n,a,au,"locals"),a.gfxStages=[],a.gfxStages.push(new zs(Aa.VERTEX,"")),a.gfxStages.push(new zs(Aa.FRAGMENT,"")),a.handleMap=function(e){for(var t={},n=0;n<e.blocks.length;n++)for(var i=e.blocks[n],r=i.members,o=0,a=0;a<r.length;a++){var s=r[a];t[s.name]=Qd(jd.UBO,uu.MATERIAL,i.binding,s.type,o),o+=(qa(s.type)>>2)*s.count}for(var c=0;c<e.samplers.length;c++){var l=e.samplers[c];t[l.name]=Qd(jd.SAMPLER,uu.MATERIAL,l.binding,l.type)}return t}(n),a.hPipelineLayout=nr,a.setLayouts=[],this._templateInfos[n.hash]=a}return n},t.getTemplate=function(e){return this._templates[e]},t.getTemplateInfo=function(e){var t=this._templates[e].hash;return this._templateInfos[t]},t.getDescriptorSetLayout=function(e,t,n){void 0===n&&(n=!1);var i=this._templates[t],r=this._templateInfos[i.hash];return r.setLayouts.length||(sm.bindings=r.bindings,r.setLayouts[uu.MATERIAL]=e.createDescriptorSetLayout(sm),sm.bindings=au.bindings,r.setLayouts[uu.LOCAL]=e.createDescriptorSetLayout(sm)),r.setLayouts[n?uu.LOCAL:uu.MATERIAL]},t.hasProgram=function(e){return void 0!==this._templates[e]},t.getKey=function(e,t){var n=this._templates[e],i=n.defines;if(n.uber){for(var r="",o=0;o<i.length;o++){var a=i[o],s=t[a.name];if(s&&a._map){var c=a._map(s);r+=""+a._offset+c+"|"}}return""+r+n.hash}for(var l=0,u=0;u<i.length;u++){var h=i[u],_=t[h.name];_&&h._map&&(l|=h._map(_)<<h._offset)}return l.toString(16)+"|"+n.hash},t.destroyShaderByDefines=function(e){var t=this,n=Object.keys(e);if(n.length)for(var i=n.map((function(t){var n=e[t];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(""+t+n)})),r=Object.keys(this._cache).filter((function(e){return i.every((function(n){return n.test(ir.get(t._cache[e]).name)}))})),o=0;o<r.length;o++){var a=r[o],s=ir.get(this._cache[a]);console.log("destroyed shader "+s.name),s.destroy(),delete this._cache[a]}},t.getGFXShader=function(e,t,n,i,r){Object.assign(n,i.macros),r||(r=this.getKey(t,n));var o=this._cache[r];if(o)return o;var a=this._templates[t],s=this._templateInfos[a.hash];s.hPipelineLayout||(this.getDescriptorSetLayout(e,t),um(a,s,ou,"globals"),s.setLayouts[uu.GLOBAL]=i.descriptorSetLayout,s.hPipelineLayout=ar.alloc(e,new nc(s.setLayouts)));var c=function(e,t){for(var n=[],i=0;i<t.length;i++){var r=t[i],o=r.name,a=e[o],s=lm(r,a),c=!a||"0"===a;n.push({name:o,value:s,isDefault:c})}return n}(n,a.defines),l=c.reduce((function(e,t){return e+"#define "+t.name+" "+t.value+"\n"}),"")+"\n",u=a.glsl3,h=fm(e);h?u=a[h]:console.error("Invalid GFX API!"),s.gfxStages[0].source=l+u.vert,s.gfxStages[1].source=l+u.frag;var _=function(e,t,n){for(var i=[],r=e.attributes,o=t.gfxAttributes,a=0;a<r.length;a++)_m(r[a].defines,n)&&i.push(o[a]);return i}(a,s,n),f=function(e,t){return e+t.reduce((function(e,t){return t.isDefault?e:e+"|"+t.name+t.value}),"")}(t,c),d=new Hs(f,s.gfxStages,_,s.gfxBlocks,s.gfxSamplers);return this._cache[r]=ir.alloc(e,d)},e}());c.programLib=dm;var mm,pm,vm,gm={glsl1:[[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n  , mat4 viewInv\n) {\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nuniform vec4 cc_size_rotation;\nvec4 vs_main() {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matWorld * pos;\n  vec2 vertOffset = a_texCoord.xy - 0.5;\n  computeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.xy;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nattribute vec3 a_position;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\n  vec4 o = vec4(1.0);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nattribute float a_dist;\nvarying float v_dist;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matViewProj * cc_matWorld * pos;\n  v_color = a_color;\n  v_dist = a_dist;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\nprecision highp float;\nvarying vec4 v_color;\nvarying float v_dist;\nvec4 frag () {\n  vec4 o = v_color;\n    #ifdef GL_OES_standard_derivatives\n      float aa = fwidth(v_dist);\n    #else\n      float aa = 0.05;\n    #endif\n  float alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\n  o.rgb *= o.a;\n  o *= alpha;\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nuniform vec4 u_sampleInfo;\nuniform vec4 u_worldRot;\nuniform vec4 u_timeDelta;\nattribute vec4 a_position_starttime;\nattribute vec4 a_size_uv;\nattribute vec4 a_rotation_uv;\nattribute vec4 a_color;\nattribute vec4 a_dir_life;\nattribute float a_rndSeed;\n#if CC_RENDER_MODE == 4\n  attribute vec3 a_texCoord;\n  attribute vec3 a_texCoord3;\n  attribute vec3 a_normal;\n  attribute vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\n    vec4 a = texture2D(tex, coord);\n    vec4 b = texture2D(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    return mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\n    vec4 a = texture2D(tex, coord);\n    vec4 b = texture2D(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    w = mix(a.w, b.w, c);\n    return mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\n  seed = mod(seed, 233280.);\n  float q = (seed * 9301. + 49297.) / 233280.;\n  return fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D color_over_time_tex0;\n  uniform int u_color_mode;\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D rotation_over_time_tex0;\n  uniform int u_rotation_mode;\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D size_over_time_tex0;\n  uniform int u_size_mode;\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D force_over_time_tex0;\n  uniform int u_force_mode;\nuniform int u_force_space;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D velocity_over_time_tex0;\n  uniform int u_velocity_mode;\nuniform int u_velocity_space;\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\n  uniform sampler2D texture_animation_tex0;\n  uniform vec4 u_anim_info;\n#endif\nfloat repeat (float t, float length) {\n  return t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\n  vec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\n  vec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\n  return vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\n  float activeTime = u_timeDelta.x - a_position_starttime.w;\n  float normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\n  vec2 timeCoord0 = vec2(normalizedTime, 0.);\n  vec2 timeCoord1 = vec2(normalizedTime, 1.);\n  #if CC_RENDER_MODE == 4\n    vec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n  #else\n    vec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n  #endif\n  vec4 velocity = vec4(a_dir_life.xyz, 0.);\n  vec4 pos = vec4(a_position_starttime.xyz, 1.);\n  vec3 size = a_size_uv.xyz;\n  #if SIZE_OVER_TIME_MODULE_ENABLE\n    if (u_size_mode == 1) {\n      size *= unpackCurveData(size_over_time_tex0, timeCoord0);\n    } else {\n      vec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\n      vec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\n      float factor_s = pseudoRandom(a_rndSeed + 39825.);\n      size *= mix(size_0, size_1, factor_s);\n    }\n  #endif\n  vec3 compScale = scale.xyz * size;\n  #if FORCE_OVER_TIME_MODULE_ENABLE\n    vec3 forceAnim = vec3(0.);\n    if (u_force_mode == 1) {\n      forceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n    } else {\n      vec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\n      vec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\n      float factor_f =  pseudoRandom(a_rndSeed + 212165.);\n      forceAnim = mix(force_0, force_1, factor_f);\n    }\n    vec4 forceTrack = vec4(forceAnim, 0.);\n    if (u_force_space == 0) {\n      forceTrack = rotateQuat(forceTrack, u_worldRot);\n    }\n    velocity.xyz += forceTrack.xyz;\n  #endif\n  #if VELOCITY_OVER_TIME_MODULE_ENABLE\n    float speedModifier0 = 1.;\n    float speedModifier1 = 1.;\n    vec3 velocityAnim = vec3(0.);\n    if (u_velocity_mode == 1) {\n      velocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n    } else {\n      vec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n      vec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\n      float factor_v = pseudoRandom(a_rndSeed + 197866.);\n      velocityAnim = mix(vectory_0, vectory_1, factor_v);\n      speedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n    }\n    vec4 velocityTrack = vec4(velocityAnim, 0.);\n    if (u_velocity_space == 0) {\n      velocityTrack = rotateQuat(velocityTrack, u_worldRot);\n    }\n    velocity.xyz += velocityTrack.xyz;\n    velocity.xyz *= speedModifier0;\n  #endif\n  pos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = rotateQuat(velocity, u_worldRot);\n    #endif\n  #endif\n  vec3 rotation = a_rotation_uv.xyz;\n  #if ROTATION_OVER_TIME_MODULE_ENABLE\n    if (u_rotation_mode == 1) {\n      rotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n    } else {\n      vec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\n      vec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\n      float factor_r = pseudoRandom(a_rndSeed + 125292.);\n      rotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n    }\n  #endif\n  #if COLOR_OVER_TIME_MODULE_ENABLE\n    if (u_color_mode == 1) {\n      color = a_color * texture2D(color_over_time_tex0, timeCoord0);\n    } else {\n      vec4 color_0 = texture2D(color_over_time_tex0, timeCoord0);\n      vec4 color_1 = texture2D(color_over_time_tex0, timeCoord1);\n      float factor_c = pseudoRandom(a_rndSeed + 91041.);\n      color = a_color * mix(color_0, color_1, factor_c);\n    }\n  #else\n    color = a_color;\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((vertIdx - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = rotation.xyz;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., rotation.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n      #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n        , cc_matViewInv\n      #endif\n      #if CC_RENDER_MODE == 1\n        , cc_cameraPos.xyz\n        , velocity\n        , frameTile_velLenScale.z\n        , frameTile_velLenScale.w\n        , a_size_uv.w\n      #endif\n    );\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color *= a_color1;\n  #endif\n  pos = cc_matViewProj * pos;\n  float frameIndex = 0.;\n  #if TEXTURE_ANIMATION_MODULE_ENABLE\n    float startFrame = 0.;\n    vec3 frameInfo = vec3(0.);\n    if (int(u_anim_info.x) == 1) {\n      frameInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n    } else {\n      vec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\n      vec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\n      float factor_t = pseudoRandom(a_rndSeed + 90794.);\n      frameInfo = mix(frameInfo0, frameInfo1, factor_t);\n    }\n    startFrame = frameInfo.x / u_anim_info.y;\n    frameIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n  #endif\n  uv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  return pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nuniform vec4 mainTiling_Offset;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nattribute vec3 a_position;\nattribute vec4 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\n  varying vec3 vBarycentric;\n#endif\nvec4 vs_main() {\n  highp vec4 pos = vec4(a_position, 1);\n  vec4 velocity = vec4(a_texCoord1.xyz, 0);\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    velocity = cc_matWorld * velocity;\n  #endif\n  float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\n  vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\n  pos.xyz += camUp * vertOffset;\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\n  color = a_color;\n  #if CC_DRAW_WIRE_FRAME\n    vBarycentric = a_texCoord2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\n  precision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n  varying vec2 uv;\n  varying vec4 color;\n  #if CC_DRAW_WIRE_FRAME\n    varying vec3 vBarycentric;\n  #endif\n  uniform sampler2D mainTexture;\n  uniform vec4 tintColor;\n  vec4 add () {\n    vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\n    if (any(lessThan(vBarycentric, vec3(0.02)))) {\n        col = vec4(0., 1., 1., 1.);\n    }\n#endif\n    return CCFragOutput(col);\n  }\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nattribute vec3 a_position;\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_RENDER_MODE == 1\n  attribute vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\n  attribute vec3 a_texCoord3;\n  attribute vec3 a_normal;\n  attribute vec4 a_color1;\n#endif\nvec4 lpvs_main () {\n  vec3 compScale = scale.xyz * a_texCoord1;\n  vec4 pos = vec4(a_position, 1);\n  #if CC_RENDER_MODE == 1\n    vec4 velocity = vec4(a_color1.xyz, 0);\n  #endif\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = cc_matWorld * velocity;\n    #endif\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = a_texCoord2;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n    #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n      , cc_matViewInv\n    #endif\n    #if CC_RENDER_MODE == 1\n      , cc_cameraPos.xyz\n      , velocity\n      , frameTile_velLenScale.z\n      , frameTile_velLenScale.w\n      , a_texCoord.x\n    #endif\n    );\n    color = a_color;\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color = a_color * a_color1;\n  #endif\n  uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  pos = cc_matViewProj * pos;\n  return pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n  return CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_light;\nvarying vec2 uv0;\n#if TWO_COLORED\n  attribute vec4 a_color2;\n  varying vec4 v_dark;\n#endif\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  pos = cc_matViewProj * pos;\n  uv0 = a_texCoord;\n  v_light = a_color;\n  #if TWO_COLORED\n    v_dark = a_color2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\n  uniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nvarying vec4 v_light;\n#if TWO_COLORED\n  varying vec4 v_dark;\n#endif\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if TWO_COLORED\n    vec4 texColor = vec4(1, 1, 1, 1);\n    texColor *= texture2D(cc_spriteTexture, uv0);\n     o.a = texColor.a * v_light.a;\n    o.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n  #else\n    o *= texture2D(cc_spriteTexture, uv0);\n    o *= v_light;\n  #endif\n  ALPHA_TEST(o);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 color;\nvarying vec2 uv0;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  #if USE_PIXEL_ALIGNMENT\n    pos = cc_matView * pos;\n    pos.xyz = floor(pos.xyz);\n    pos = cc_matProj * pos;\n  #else\n    pos = cc_matViewProj * pos;\n  #endif\n  uv0 = a_texCoord;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\n    return vec4(texture2D(tex, uv).rgb, texture2D(tex, uv + vec2(0.0, 0.5)).r);\n#else\n    return texture2D(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\n  uniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nvarying vec4 color;\n#if USE_TEXTURE\n  varying vec2 uv0;\n  uniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if USE_TEXTURE\n    o *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n    #if IS_GRAY\n      float gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\n      o.r = o.g = o.b = gray;\n    #endif\n  #endif\n  o *= color;\n  ALPHA_TEST(o);\n  return o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\nuniform highp vec4 cc_lightingMapUVParam;\n#endif\nuniform vec4 tilingOffset;\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#if USE_VERTEX_COLOR\n  attribute vec4 a_color;\n  varying vec4 v_color;\n#endif\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_fog_factor;\n#if USE_NORMAL_MAP\n  varying vec3 v_tangent;\n  varying vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  attribute vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  varying vec2 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\n      v_luv = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\n#else\n      v_luv = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\n#endif\n}\n#endif\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 pos = matWorld * In.position;\n  v_position = pos.xyz;\n  v_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n  #if USE_NORMAL_MAP\n    v_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\n    v_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n  #endif\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  v_fog_factor = CC_TRANSFER_FOG(pos);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    CCLightingMapCaclUV();\n  #endif\n    v_shadowPos = cc_matLightViewProj * pos;\n  return cc_matProj * (cc_matView * matWorld) * In.position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform lowp vec4 cc_shadowColor;\nuniform lowp vec4 cc_shadowInfo;\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return texture2DLodEXT(tex, coord, lod);\n    #else\n      return texture2D(tex, coord, lod);\n    #endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return textureCubeLodEXT(tex, coord, lod);\n    #else\n      return textureCube(tex, coord, lod);\n    #endif\n}\n#endif\n#if CC_RECEIVE_SHADOW\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nuniform highp vec4 cc_lightPos[1];\nuniform vec4 cc_lightColor[1];\nuniform vec4 cc_lightSizeRangeAngle[1];\nuniform vec4 cc_lightDir[1];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nuniform vec4 pbrParams;\nuniform vec4 emissive;\nuniform vec4 emissiveScaleParam;\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  varying vec2 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nvarying vec3 v_position;\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying vec3 v_normal;\nvarying float v_fog_factor;\n#if USE_VERTEX_COLOR\n  varying vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\n  varying vec3 v_tangent;\n  varying vec3 v_bitangent;\n  uniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\n  uniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\n  uniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\n  uniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\n  uniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\n  vec4 baseColor = albedo;\n  #if USE_VERTEX_COLOR\n    baseColor *= v_color;\n  #endif\n  #if USE_ALBEDO_MAP\n    vec4 texColor = texture2D(albedoMap, ALBEDO_UV);\n    texColor.rgb = SRGBToLinear(texColor.rgb);\n    baseColor *= texColor;\n  #endif\n  s.albedo = baseColor;\n  s.albedo.rgb *= albedoScaleAndCutoff.xyz;\n  #if USE_ALPHA_TEST\n    if (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture2D(cc_lightingMap, v_luv);\n  #endif\n  s.normal = v_normal;\n  #if USE_NORMAL_MAP\n    vec3 nmmp = texture2D(normalMap, NORMAL_UV).xyz - vec3(0.5);\n    s.normal =\n      (nmmp.x * pbrParams.w) * normalize(v_tangent) +\n      (nmmp.y * pbrParams.w) * normalize(v_bitangent) +\n      nmmp.z * normalize(s.normal);\n  #endif\n  s.position = v_position;\n  vec4 pbr = pbrParams;\n  #if USE_PBR_MAP\n    vec4 res = texture2D(pbrMap, PBR_UV);\n    pbr.x *= res.r;\n    pbr.y *= res.g;\n    pbr.z *= res.b;\n  #endif\n  #if USE_METALLIC_ROUGHNESS_MAP\n    vec4 metallicRoughness = texture2D(metallicRoughnessMap, PBR_UV);\n    pbr.z *= metallicRoughness.b;\n    pbr.y *= metallicRoughness.g;\n  #endif\n  #if USE_OCCLUSION_MAP\n    pbr.x *= texture2D(occlusionMap, PBR_UV).r;\n  #endif\n  s.occlusion = clamp(pbr.x, 0.0, 0.96);\n  s.roughness = clamp(pbr.y, 0.04, 1.0);\n  s.metallic = pbr.z;\n  s.emissive = emissive.rgb * emissiveScaleParam.xyz;\n  #if USE_EMISSIVE_MAP\n    s.emissive *= SRGBToLinear(texture2D(emissiveMap, EMISSIVE_UV).rgb);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nvoid main() { gl_FragColor = frag(); }"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\n#endif\nuniform vec4 tilingOffset;\nuniform highp mat4 cc_matLightViewProj;\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  attribute vec2 a_texCoord1;\n#endif\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_clip_depth;\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 worldPos = matWorld * In.position;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  v_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nvarying vec2 v_uv;\nvarying vec2 v_uv1;\nvarying float v_clip_depth;\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\n  vec4 baseColor = albedo;\n  #if USE_ALBEDO_MAP\n    baseColor *= texture2D(albedoMap, ALBEDO_UV);\n  #endif\n  #if USE_ALPHA_TEST\n    if (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  return packDepthToRGBA(v_clip_depth);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform highp mat4 cc_matWorld;\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\n  varying mediump vec3 v_tangent;\n  varying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec2 luv;\nvarying mediump vec3 diffuse;\nvarying mediump float v_fog_factor;\nuniform vec4 UVScale;\nuniform vec4 lightMapUVParam;\nvec4 vert () {\n  vec3 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  vec4 pos = vec4(worldPos, 1.0);\n  pos = cc_matViewProj * pos;\n  uvw = a_texCoord;\n  uv0 = a_position.xz * UVScale.x;\n  uv1 = a_position.xz * UVScale.y;\n  uv2 = a_position.xz * UVScale.z;\n  uv3 = a_position.xz * UVScale.w;\n  #if USE_LIGHTMAP\n    luv = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\n  #endif\n  v_position = worldPos;\n  v_normal = a_normal;\n  v_fog_factor = CC_TRANSFER_FOG(vec4(worldPos, 1.0));\n  #if USE_NORMALMAP\n    v_tangent = vec3(1.0, 0.0, 0.0);\n    v_binormal = vec3(0.0, 0.0, 1.0);\n    v_binormal = cross(v_tangent, a_normal);\n    v_tangent = cross(a_normal, v_binormal);\n  #endif\n    v_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform lowp vec4 cc_shadowColor;\nuniform lowp vec4 cc_shadowInfo;\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return texture2DLodEXT(tex, coord, lod);\n    #else\n      return texture2D(tex, coord, lod);\n    #endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    #ifdef GL_EXT_shader_texture_lod\n      return textureCubeLodEXT(tex, coord, lod);\n    #else\n      return textureCube(tex, coord, lod);\n    #endif\n}\n#endif\n#if CC_RECEIVE_SHADOW\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture2D(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nuniform highp vec4 cc_lightPos[1];\nuniform vec4 cc_lightColor[1];\nuniform vec4 cc_lightSizeRangeAngle[1];\nuniform vec4 cc_lightDir[1];\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if USE_NORMALMAP\n  varying mediump vec3 v_tangent;\n  varying mediump vec3 v_binormal;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 diffuse;\nvarying mediump vec2 luv;\nvarying mediump float v_fog_factor;\nuniform vec4 metallic;\nuniform vec4 roughness;\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n  #if LAYERS > 1\n    vec4 w = texture2D(weightMap, uvw);\n  #endif\n  vec4 baseColor = vec4(0, 0, 0, 0);\n  #if LAYERS == 1\n    baseColor = texture2D(detailMap0, uv0);\n  #elif LAYERS == 2\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n  #elif LAYERS == 3\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n    baseColor += texture2D(detailMap2, uv2) * w.b;\n  #elif LAYERS == 4\n    baseColor += texture2D(detailMap0, uv0) * w.r;\n    baseColor += texture2D(detailMap1, uv1) * w.g;\n    baseColor += texture2D(detailMap2, uv2) * w.b;\n    baseColor += texture2D(detailMap3, uv3) * w.a;\n  #else\n    baseColor = texture2D(detailMap0, uv0);\n  #endif\n  s.position = v_position;\n  #if USE_NORMALMAP\n    vec4 baseNormal = vec4(0, 0, 0, 0);\n    #if LAYERS == 1\n      baseNormal = texture2D(normalMap0, uv0);\n    #elif LAYERS == 2\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n    #elif LAYERS == 3\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n      baseNormal += texture2D(normalMap2, uv2) * w.b;\n    #elif LAYERS == 4\n      baseNormal += texture2D(normalMap0, uv0) * w.r;\n      baseNormal += texture2D(normalMap1, uv1) * w.g;\n      baseNormal += texture2D(normalMap2, uv2) * w.b;\n      baseNormal += texture2D(normalMap3, uv3) * w.a;\n    #else\n      baseNormal = texture2D(normalMap0, uv0);\n    #endif\n    vec3 nmmp = baseNormal.xyz - vec3(0.5);\n    s.normal =\n      nmmp.x * normalize(v_tangent) +\n      nmmp.y * normalize(v_binormal) +\n      nmmp.z * normalize(v_normal);\n  #else\n    s.normal = v_normal;\n  #endif\n  s.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\n  s.occlusion = 1.0;\n  #if USE_PBR\n    s.roughness = 0.0;\n    #if LAYERS == 1\n      s.roughness = roughness.x;\n    #elif LAYERS == 2\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n    #elif LAYERS == 3\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n    #elif LAYERS == 4\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n      s.roughness += roughness.w * w.a;\n    #else\n      s.roughness = 1.0;\n    #endif\n    s.metallic = 0.0;\n    #if LAYERS == 1\n      s.metallic = metallic.x;\n    #elif LAYERS == 2\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n    #elif LAYERS == 3\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n    #elif LAYERS == 4\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n      s.metallic += metallic.w * w.a;\n    #else\n      s.metallic = 0.0;\n    #endif\n  #else\n    s.roughness = 1.0;\n    s.metallic = 0.0;\n  #endif\n  s.emissive = vec3(0.0, 0.0, 0.0);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture2D(lightMap, luv);\n  #else\n    s.lightmap = vec4(0.0, 0.0, 0.0, 0.0);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nvoid main() { gl_FragColor = frag(); }"},{vert:"\nprecision highp float;\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying vec2 v_clip_depth;\nvec4 vert () {\n  vec4 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  worldPos.w = 1.0;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_clip_depth = clipPos.zw;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nvarying vec2 v_clip_depth;\nvec4 frag () {\n  return packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\n#if USE_VERTEX_COLOR\n  attribute lowp vec4 a_color;\n  varying lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\n  varying vec2 v_uv;\n  uniform vec4 tilingOffset;\n#endif\nvarying float factor_fog;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  #if USE_TEXTURE\n    v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  factor_fog = CC_TRANSFER_FOG(matWorld * position);\n  return cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform mediump vec4 cc_exposure;\nuniform mediump vec4 cc_fogColor;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\n  varying vec2 v_uv;\n  uniform sampler2D mainTexture;\n#endif\nuniform vec4 mainColor;\nuniform vec4 colorScaleAndCutoff;\n#if USE_VERTEX_COLOR\n  varying lowp vec4 v_color;\n#endif\nvarying float factor_fog;\nvec4 frag () {\n  vec4 o = mainColor;\n  o.rgb *= colorScaleAndCutoff.xyz;\n  #if USE_VERTEX_COLOR\n    o *= v_color;\n  #endif\n  #if USE_TEXTURE\n    o *= texture2D(mainTexture, v_uv);\n  #endif\n  #if USE_ALPHA_TEST\n    if (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n  #endif\n  o = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, factor_fog), o.a);\n  return CCFragOutput(o);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_MORPH\n    attribute float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n            int pixelIndex = elementIndex;\n            vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n            vec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\n            return texture2D(tex, uv);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture2D(tex, x)),\n            decode32(texture2D(tex, y)),\n            decode32(texture2D(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  attribute vec4 a_joints;\nattribute vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    attribute highp vec4 a_jointAnimInfo;\n  #endif\n  uniform highp vec4 cc_jointTextureInfo;\n  uniform highp vec4 cc_jointAnimInfo;\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  uniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\n#if USE_INSTANCING\n  attribute vec4 a_matWorld0;\n  attribute vec4 a_matWorld1;\n  attribute vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    attribute vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  attribute float a_dyn_batch_id;\n  uniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\nuniform highp mat4 cc_matLightPlaneProj;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  position = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\n  position.z -= 0.0001;\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform lowp vec4 cc_shadowColor;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvec4 frag () {\n  return CCFragOutput(cc_shadowColor);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\nvarying mediump vec4 viewDir;\nvec4 vert () {\n  viewDir = vec4(a_position, 1.0);\n  mat4 matViewRotOnly = mat4(mat3(cc_matView));\n  mat4 matProj = cc_matProj;\n  if (matProj[3].w > 0.0) {\n    vec2 scale = vec2(48.0, 24.0);\n    matProj[0].xy *= scale;\n    matProj[1].xy *= scale;\n    matProj[2].zw = vec2(-1.0);\n    matProj[3].zw = vec2(0.0);\n  }\n  vec4 pos = matProj * matViewRotOnly * viewDir;\n  pos.z = 0.99999 * pos.w;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_ambientSky;\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nvarying mediump vec4 viewDir;\nvec4 frag () {\n  #if USE_RGBE_CUBEMAP\n    vec3 c = unpackRGBE(textureCube(cc_environment, viewDir.xyz));\n  #else\n    vec3 c = SRGBToLinear(textureCube(cc_environment, viewDir.xyz).rgb);\n  #endif\n  return CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec2 v_uv;\nuniform vec4 offset;\nuniform vec4 digits[20];\nfloat getComponent(vec4 v, float i) {\n  if (i < 1.0) { return v.x; }\n  else if (i < 2.0) { return v.y; }\n  else if (i < 3.0) { return v.z; }\n  else { return v.w; }\n}\nvec4 vert () {\n  vec4 position = cc_matViewProj * vec4(a_position, 1.0);\n  position.xy += offset.xy;\n  v_uv = a_color.xy;\n  if (a_color.z >= 0.0) {\n    float n = getComponent(digits[int(a_color.z)], a_color.w);\n    v_uv += vec2(offset.z * n, 0.0);\n  }\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_exposure;\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\n  return CCFragOutput(texture2D(mainTexture, v_uv));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_uv;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 0, 1);\n  v_uv = a_texCoord;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nuniform float u_precent;\nvec4 frag () {\n  vec4 color = texture2D(mainTexture, v_uv);\n  float precent = clamp(u_precent, 0.0, 1.0);\n  color.xyz *= precent;\n  return color;\n}\nvoid main() { gl_FragColor = frag(); }"}]],glsl3:[[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n  , mat4 viewInv\n) {\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nlayout(std140) uniform builtin {\n  vec4 cc_size_rotation;\n};\nvec4 vs_main() {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matWorld * pos;\n  vec2 vertOffset = a_texCoord.xy - 0.5;\n  computeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.xy;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nin vec3 a_position;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\n  vec4 o = vec4(1.0);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nin float a_dist;\nout float v_dist;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  pos = cc_matViewProj * cc_matWorld * pos;\n  v_color = a_color;\n  v_dist = a_dist;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nin vec4 v_color;\nin float v_dist;\nvec4 frag () {\n  vec4 o = v_color;\n    float aa = fwidth(v_dist);\n  float alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\n  o.rgb *= o.a;\n  o *= alpha;\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(std140) uniform SampleConstants {\n  vec4 u_sampleInfo;\n};\nlayout(std140) uniform TickConstants {\n  vec4 u_worldRot;\n  vec4 u_timeDelta;\n};\nin vec4 a_position_starttime;\nin vec4 a_size_uv;\nin vec4 a_rotation_uv;\nin vec4 a_color;\nin vec4 a_dir_life;\nin float a_rndSeed;\n#if CC_RENDER_MODE == 4\n  in vec3 a_texCoord;\n  in vec3 a_texCoord3;\n  in vec3 a_normal;\n  in vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\n    vec4 a = texture(tex, coord);\n    vec4 b = texture(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    return mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\n    vec4 a = texture(tex, coord);\n    vec4 b = texture(tex, coord + u_sampleInfo.y);\n    float c = fract(coord.x * u_sampleInfo.x);\n    w = mix(a.w, b.w, c);\n    return mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom (float seed) {\n  seed = mod(seed, 233280.);\n  float q = (seed * 9301. + 49297.) / 233280.;\n  return fract(q);\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D color_over_time_tex0;\n  layout(std140) uniform ColorConstant {\n    int u_color_mode;\n  };\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D rotation_over_time_tex0;\n  layout(std140) uniform RotationConstant {\n    int u_rotation_mode;\n  };\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D size_over_time_tex0;\n  layout(std140) uniform SizeConstant {\n    int u_size_mode;\n  };\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D force_over_time_tex0;\n  layout(std140) uniform ForceConstant {\n    int u_force_mode;\n    int u_force_space;\n  };\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\n  uniform sampler2D velocity_over_time_tex0;\n  layout(std140) uniform VelocityConstant {\n    int u_velocity_mode;\n    int u_velocity_space;\n  };\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\n  uniform sampler2D texture_animation_tex0;\n  layout(std140) uniform AnimationConstant {\n    vec4 u_anim_info;\n  };\n#endif\nfloat repeat (float t, float length) {\n  return t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\n  vec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\n  vec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\n  return vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\n  float activeTime = u_timeDelta.x - a_position_starttime.w;\n  float normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\n  vec2 timeCoord0 = vec2(normalizedTime, 0.);\n  vec2 timeCoord1 = vec2(normalizedTime, 1.);\n  #if CC_RENDER_MODE == 4\n    vec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n  #else\n    vec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n  #endif\n  vec4 velocity = vec4(a_dir_life.xyz, 0.);\n  vec4 pos = vec4(a_position_starttime.xyz, 1.);\n  vec3 size = a_size_uv.xyz;\n  #if SIZE_OVER_TIME_MODULE_ENABLE\n    if (u_size_mode == 1) {\n      size *= unpackCurveData(size_over_time_tex0, timeCoord0);\n    } else {\n      vec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\n      vec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\n      float factor_s = pseudoRandom(a_rndSeed + 39825.);\n      size *= mix(size_0, size_1, factor_s);\n    }\n  #endif\n  vec3 compScale = scale.xyz * size;\n  #if FORCE_OVER_TIME_MODULE_ENABLE\n    vec3 forceAnim = vec3(0.);\n    if (u_force_mode == 1) {\n      forceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n    } else {\n      vec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\n      vec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\n      float factor_f =  pseudoRandom(a_rndSeed + 212165.);\n      forceAnim = mix(force_0, force_1, factor_f);\n    }\n    vec4 forceTrack = vec4(forceAnim, 0.);\n    if (u_force_space == 0) {\n      forceTrack = rotateQuat(forceTrack, u_worldRot);\n    }\n    velocity.xyz += forceTrack.xyz;\n  #endif\n  #if VELOCITY_OVER_TIME_MODULE_ENABLE\n    float speedModifier0 = 1.;\n    float speedModifier1 = 1.;\n    vec3 velocityAnim = vec3(0.);\n    if (u_velocity_mode == 1) {\n      velocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n    } else {\n      vec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n      vec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\n      float factor_v = pseudoRandom(a_rndSeed + 197866.);\n      velocityAnim = mix(vectory_0, vectory_1, factor_v);\n      speedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n    }\n    vec4 velocityTrack = vec4(velocityAnim, 0.);\n    if (u_velocity_space == 0) {\n      velocityTrack = rotateQuat(velocityTrack, u_worldRot);\n    }\n    velocity.xyz += velocityTrack.xyz;\n    velocity.xyz *= speedModifier0;\n  #endif\n  pos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = rotateQuat(velocity, u_worldRot);\n    #endif\n  #endif\n  vec3 rotation = a_rotation_uv.xyz;\n  #if ROTATION_OVER_TIME_MODULE_ENABLE\n    if (u_rotation_mode == 1) {\n      rotation += unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\n    } else {\n      vec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\n      vec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\n      float factor_r = pseudoRandom(a_rndSeed + 125292.);\n      rotation += mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n    }\n  #endif\n  #if COLOR_OVER_TIME_MODULE_ENABLE\n    if (u_color_mode == 1) {\n      color = a_color * texture(color_over_time_tex0, timeCoord0);\n    } else {\n      vec4 color_0 = texture(color_over_time_tex0, timeCoord0);\n      vec4 color_1 = texture(color_over_time_tex0, timeCoord1);\n      float factor_c = pseudoRandom(a_rndSeed + 91041.);\n      color = a_color * mix(color_0, color_1, factor_c);\n    }\n  #else\n    color = a_color;\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((vertIdx - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = rotation.xyz;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., rotation.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n      #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n        , cc_matViewInv\n      #endif\n      #if CC_RENDER_MODE == 1\n        , cc_cameraPos.xyz\n        , velocity\n        , frameTile_velLenScale.z\n        , frameTile_velLenScale.w\n        , a_size_uv.w\n      #endif\n    );\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(rotation), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(rotation), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color *= a_color1;\n  #endif\n  pos = cc_matViewProj * pos;\n  float frameIndex = 0.;\n  #if TEXTURE_ANIMATION_MODULE_ENABLE\n    float startFrame = 0.;\n    vec3 frameInfo = vec3(0.);\n    if (int(u_anim_info.x) == 1) {\n      frameInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n    } else {\n      vec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\n      vec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\n      float factor_t = pseudoRandom(a_rndSeed + 90794.);\n      frameInfo = mix(frameInfo0, frameInfo1, factor_t);\n    }\n    startFrame = frameInfo.x / u_anim_info.y;\n    frameIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n  #endif\n  uv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  return pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\n  out vec3 vBarycentric;\n#endif\nvec4 vs_main() {\n  highp vec4 pos = vec4(a_position, 1);\n  vec4 velocity = vec4(a_texCoord1.xyz, 0);\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    velocity = cc_matWorld * velocity;\n  #endif\n  float vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\n  vec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\n  pos.xyz += camUp * vertOffset;\n  pos = cc_matViewProj * pos;\n  uv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\n  color = a_color;\n  #if CC_DRAW_WIRE_FRAME\n    vBarycentric = a_texCoord2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\n  precision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n  in vec2 uv;\n  in vec4 color;\n  #if CC_DRAW_WIRE_FRAME\n    in vec3 vBarycentric;\n  #endif\n  uniform sampler2D mainTexture;\n  layout(std140) uniform FragConstants {\n    vec4 tintColor;\n  };\n  vec4 add () {\n    vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\n    if (any(lessThan(vBarycentric, vec3(0.02)))) {\n        col = vec4(0., 1., 1., 1.);\n    }\n#endif\n    return CCFragOutput(col);\n  }\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\n  mat3 m = mat3(xAxis,yAxis,zAxis);\n  float trace = m[0][0] + m[1][1] + m[2][2];\n  vec4 quat;\n  if (trace > 0.) {\n    float s = 0.5 / sqrt(trace + 1.0);\n    quat.w = 0.25 / s;\n    quat.x = (m[2][1] - m[1][2]) * s;\n    quat.y = (m[0][2] - m[2][0]) * s;\n    quat.z = (m[1][0] - m[0][1]) * s;\n  } else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\n    float s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\n    quat.w = (m[2][1] - m[1][2]) / s;\n    quat.x = 0.25 * s;\n    quat.y = (m[0][1] + m[1][0]) / s;\n    quat.z = (m[0][2] + m[2][0]) / s;\n  } else if (m[1][1] > m[2][2]) {\n    float s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\n    quat.w = (m[0][2] - m[2][0]) / s;\n    quat.x = (m[0][1] + m[1][0]) / s;\n    quat.y = 0.25 * s;\n    quat.z = (m[1][2] + m[2][1]) / s;\n  } else {\n    float s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\n    quat.w = (m[1][0] - m[0][1]) / s;\n    quat.x = (m[0][2] + m[2][0]) / s;\n    quat.y = (m[1][2] + m[2][1]) / s;\n    quat.z = 0.25 * s;\n  }\n  float len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\n  if (len > 0.) {\n    len = 1. / sqrt(len);\n    quat.x = quat.x * len;\n    quat.y = quat.y * len;\n    quat.z = quat.z * len;\n    quat.w = quat.w * len;\n  }\n  return quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\n  float x = angle.x / 2.;\n  float y = angle.y / 2.;\n  float z = angle.z / 2.;\n  float sx = sin(x);\n  float cx = cos(x);\n  float sy = sin(y);\n  float cy = cos(y);\n  float sz = sin(z);\n  float cz = cos(z);\n  vec4 quat = vec4(0);\n  quat.x = sx * cy * cz + cx * sy * sz;\n  quat.y = cx * sy * cz + sx * cy * sz;\n  quat.z = cx * cy * sz - sx * sy * cz;\n  quat.w = cx * cy * cz - sx * sy * sz;\n  return quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\n  float x2 = q.x + q.x;\n  float y2 = q.y + q.y;\n  float z2 = q.z + q.z;\n  float xx = q.x * x2;\n  float xy = q.x * y2;\n  float xz = q.x * z2;\n  float yy = q.y * y2;\n  float yz = q.y * z2;\n  float zz = q.z * z2;\n  float wx = q.w * x2;\n  float wy = q.w * y2;\n  float wz = q.w * z2;\n  return mat4(\n    1. - (yy + zz), xy + wz, xz - wy, 0,\n    xy - wz, 1. - (xx + zz), yz + wx, 0,\n    xz + wy, yz - wx, 1. - (xx + yy), 0,\n    p.x, p.y, p.z, 1\n  );\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\n  float x = q.x, y = q.y, z = q.z, w = q.w;\n  float x2 = x + x;\n  float y2 = y + y;\n  float z2 = z + z;\n  float xx = x * x2;\n  float xy = x * y2;\n  float xz = x * z2;\n  float yy = y * y2;\n  float yz = y * z2;\n  float zz = z * z2;\n  float wx = w * x2;\n  float wy = w * y2;\n  float wz = w * z2;\n  float sx = s.x;\n  float sy = s.y;\n  float sz = s.z;\n  return mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n    (xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n    (xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\n    t.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\n  vec4 quat;\n  quat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\n  quat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\n  quat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\n  quat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\n  return quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\n  float ix = q.w * v.x + q.y * v.z - q.z * v.y;\n  float iy = q.w * v.y + q.z * v.x - q.x * v.z;\n  float iz = q.w * v.z + q.x * v.y - q.y * v.x;\n  float iw = -q.x * v.x - q.y * v.y - q.z * v.z;\n  v.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\n  v.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\n  v.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\n  vec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\n  vec4 rotQuat = quatMultiply(viewQuat, q);\n  rotateVecFromQuat(pos, rotQuat);\n  return pos;\n}\nvoid rotateCorner (inout vec2 corner, float angle){\n  float xOS = cos(angle) * corner.x - sin(angle) * corner.y;\n  float yOS = sin(angle) * corner.x + cos(angle) * corner.y;\n  corner.x = xOS;\n  corner.y = yOS;\n}\nlayout(std140) uniform Constants {\n  vec4 mainTiling_Offset;\n  vec4 frameTile_velLenScale;\n  vec4 scale;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n  , mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n  , vec3 eye\n  , vec4 velocity\n  , float velocityScale\n  , float lengthScale\n  , float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\n  vec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\n  vec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\n  vec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\n  vec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\n  pos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\n  vec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\n  vec3 camX = vec3(1, 0, 0);\n  vec3 camY = vec3(0, 0, -1);\n  pos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\n  vec2 viewSpaceVert = vec2(vertOffset.x * s.x, vertOffset.y * s.y);\n  rotateCorner(viewSpaceVert, q.z);\n  vec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\n  vec3 camY = vec3(0, 1, 0);\n  vec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\n  pos.xyz += offset;\n#else\n  pos.x += vertOffset.x;\n  pos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\n  vec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\n  aniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\n  vertIndex.y = 1. - vertIndex.y;\n#endif\n  return (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nin vec3 a_position;\nin vec3 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_RENDER_MODE == 1\n  in vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\n  in vec3 a_texCoord3;\n  in vec3 a_normal;\n  in vec4 a_color1;\n#endif\nvec4 lpvs_main () {\n  vec3 compScale = scale.xyz * a_texCoord1;\n  vec4 pos = vec4(a_position, 1);\n  #if CC_RENDER_MODE == 1\n    vec4 velocity = vec4(a_color1.xyz, 0);\n  #endif\n  #if !CC_USE_WORLD_SPACE\n    pos = cc_matWorld * pos;\n    #if CC_RENDER_MODE == 1\n      velocity = cc_matWorld * velocity;\n    #endif\n  #endif\n  #if CC_RENDER_MODE != 4\n    vec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n    #if CC_RENDER_MODE == 0\n      vec3 rotEuler = a_texCoord2;\n    #elif CC_RENDER_MODE == 1\n      vec3 rotEuler = vec3(0.);\n    #else\n      vec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n    #endif\n    computeVertPos(pos, cornerOffset, quaternionFromEuler(rotEuler), compScale\n    #if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n      , cc_matViewInv\n    #endif\n    #if CC_RENDER_MODE == 1\n      , cc_cameraPos.xyz\n      , velocity\n      , frameTile_velLenScale.z\n      , frameTile_velLenScale.w\n      , a_texCoord.x\n    #endif\n    );\n    color = a_color;\n  #else\n    mat4 xformNoScale = matrixFromRT(quaternionFromEuler(a_texCoord2), pos.xyz);\n    mat4 xform = matFromRTS(quaternionFromEuler(a_texCoord2), pos.xyz, compScale);\n    pos = xform * vec4(a_texCoord3, 1);\n    vec4 normal = xformNoScale * vec4(a_normal, 0);\n    color = a_color * a_color1;\n  #endif\n  uv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\n  pos = cc_matViewProj * pos;\n  return pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\n  vec4 tintColor;\n};\nvec4 add () {\n  vec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n  return CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 v_light;\nout vec2 uv0;\n#if TWO_COLORED\n  in vec4 a_color2;\n  out vec4 v_dark;\n#endif\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  pos = cc_matViewProj * pos;\n  uv0 = a_texCoord;\n  v_light = a_color;\n  #if TWO_COLORED\n    v_dark = a_color2;\n  #endif\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\n  layout(std140) uniform ALPHA_TEST_DATA {\n    float alphaThreshold;\n  };\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nin vec4 v_light;\n#if TWO_COLORED\n  in vec4 v_dark;\n#endif\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if TWO_COLORED\n    vec4 texColor = vec4(1, 1, 1, 1);\n    texColor *= texture(cc_spriteTexture, uv0);\n     o.a = texColor.a * v_light.a;\n    o.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n  #else\n    o *= texture(cc_spriteTexture, uv0);\n    o *= v_light;\n  #endif\n  ALPHA_TEST(o);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 color;\nout vec2 uv0;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 1);\n  #if USE_LOCAL\n    pos = cc_matWorld * pos;\n  #endif\n  #if USE_PIXEL_ALIGNMENT\n    pos = cc_matView * pos;\n    pos.xyz = floor(pos.xyz);\n    pos = cc_matProj * pos;\n  #else\n    pos = cc_matViewProj * pos;\n  #endif\n  uv0 = a_texCoord;\n  color = a_color;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\n    return vec4(texture(tex, uv).rgb, texture(tex, uv + vec2(0.0, 0.5)).r);\n#else\n    return texture(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\n  layout(std140) uniform ALPHA_TEST_DATA {\n    float alphaThreshold;\n  };\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n  #if USE_ALPHA_TEST\n      if (color.a < alphaThreshold) discard;\n  #endif\n}\nvoid ALPHA_TEST (in float alpha) {\n  #if USE_ALPHA_TEST\n      if (alpha < alphaThreshold) discard;\n  #endif\n}\nin vec4 color;\n#if USE_TEXTURE\n  in vec2 uv0;\n  uniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\n  vec4 o = vec4(1, 1, 1, 1);\n  #if USE_TEXTURE\n    o *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n    #if IS_GRAY\n      float gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\n      o.r = o.g = o.b = gray;\n    #endif\n  #endif\n  o *= color;\n  ALPHA_TEST(o);\n  return o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if USE_VERTEX_COLOR\n  in vec4 a_color;\n  out vec4 v_color;\n#endif\nout vec3 v_position;\nout vec3 v_normal;\nout vec2 v_uv;\nout vec2 v_uv1;\nout float v_fog_factor;\n#if USE_NORMAL_MAP\n  out vec3 v_tangent;\n  out vec3 v_bitangent;\n#endif\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  in vec2 a_texCoord1;\n#endif\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  out vec2 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\n      v_luv = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.zw;\n#else\n      v_luv = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.zw;\n#endif\n}\n#endif\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 pos = matWorld * In.position;\n  v_position = pos.xyz;\n  v_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n  #if USE_NORMAL_MAP\n    v_tangent = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\n    v_bitangent = cross(v_normal, v_tangent) * In.tangent.w;\n  #endif\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  v_fog_factor = CC_TRANSFER_FOG(pos);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    CCLightingMapCaclUV();\n  #endif\n    v_shadowPos = cc_matLightViewProj * pos;\n  return cc_matProj * (cc_matView * matWorld) * In.position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\n#endif\n#if CC_RECEIVE_SHADOW\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nlayout(std140) uniform CCForwardLight {\n  highp vec4 cc_lightPos[1];\n  vec4 cc_lightColor[1];\n  vec4 cc_lightSizeRangeAngle[1];\n  vec4 cc_lightDir[1];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\n#if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n  in vec2 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nin vec3 v_position;\nin vec2 v_uv;\nin vec2 v_uv1;\nin vec3 v_normal;\nin float v_fog_factor;\n#if USE_VERTEX_COLOR\n  in vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\n  in vec3 v_tangent;\n  in vec3 v_bitangent;\n  uniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\n  uniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\n  uniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\n  uniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\n  uniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\n  vec4 baseColor = albedo;\n  #if USE_VERTEX_COLOR\n    baseColor *= v_color;\n  #endif\n  #if USE_ALBEDO_MAP\n    vec4 texColor = texture(albedoMap, ALBEDO_UV);\n    texColor.rgb = SRGBToLinear(texColor.rgb);\n    baseColor *= texColor;\n  #endif\n  s.albedo = baseColor;\n  s.albedo.rgb *= albedoScaleAndCutoff.xyz;\n  #if USE_ALPHA_TEST\n    if (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture(cc_lightingMap, v_luv);\n  #endif\n  s.normal = v_normal;\n  #if USE_NORMAL_MAP\n    vec3 nmmp = texture(normalMap, NORMAL_UV).xyz - vec3(0.5);\n    s.normal =\n      (nmmp.x * pbrParams.w) * normalize(v_tangent) +\n      (nmmp.y * pbrParams.w) * normalize(v_bitangent) +\n      nmmp.z * normalize(s.normal);\n  #endif\n  s.position = v_position;\n  vec4 pbr = pbrParams;\n  #if USE_PBR_MAP\n    vec4 res = texture(pbrMap, PBR_UV);\n    pbr.x *= res.r;\n    pbr.y *= res.g;\n    pbr.z *= res.b;\n  #endif\n  #if USE_METALLIC_ROUGHNESS_MAP\n    vec4 metallicRoughness = texture(metallicRoughnessMap, PBR_UV);\n    pbr.z *= metallicRoughness.b;\n    pbr.y *= metallicRoughness.g;\n  #endif\n  #if USE_OCCLUSION_MAP\n    pbr.x *= texture(occlusionMap, PBR_UV).r;\n  #endif\n  s.occlusion = clamp(pbr.x, 0.0, 0.96);\n  s.roughness = clamp(pbr.y, 0.04, 1.0);\n  s.metallic = pbr.z;\n  s.emissive = emissive.rgb * emissiveScaleParam.xyz;\n  #if USE_EMISSIVE_MAP\n    s.emissive *= SRGBToLinear(texture(emissiveMap, EMISSIVE_UV).rgb);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"},{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if HAS_SECOND_UV || USE_LIGHTMAP\n  in vec2 a_texCoord1;\n#endif\nout vec2 v_uv;\nout vec2 v_uv1;\nout float v_clip_depth;\nvec4 vert () {\n  StandardVertInput In;\n  In.position = vec4(a_position, 1.0);\n  In.normal = a_normal;\n  In.tangent = a_tangent;\n  #if CC_USE_MORPH\n    applyMorph(In);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(In);\n  #endif\n  mat4 matWorld, matWorldIT;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n    matWorldIT = matWorld;\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n    matWorldIT = matWorld;\n  #else\n    matWorld = cc_matWorld;\n    matWorldIT = cc_matWorldIT;\n  #endif\n  vec4 worldPos = matWorld * In.position;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #if HAS_SECOND_UV\n    v_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  v_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform Constants {\n  vec4 tilingOffset;\n  vec4 albedo;\n  vec4 albedoScaleAndCutoff;\n  vec4 pbrParams;\n  vec4 emissive;\n  vec4 emissiveScaleParam;\n};\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nin vec2 v_uv;\nin vec2 v_uv1;\nin float v_clip_depth;\n#if USE_ALBEDO_MAP\n  uniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\n  vec4 baseColor = albedo;\n  #if USE_ALBEDO_MAP\n    baseColor *= texture(albedoMap, ALBEDO_UV);\n  #endif\n  #if USE_ALPHA_TEST\n    if (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n  #endif\n  return packDepthToRGBA(v_clip_depth);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout highp vec3 v_position;\nout mediump vec3 v_normal;\n#if USE_NORMALMAP\n  out mediump vec3 v_tangent;\n  out mediump vec3 v_binormal;\n#endif\nout mediump vec2 uvw;\nout mediump vec2 uv0;\nout mediump vec2 uv1;\nout mediump vec2 uv2;\nout mediump vec2 uv3;\nout mediump vec2 luv;\nout mediump vec3 diffuse;\nout mediump float v_fog_factor;\nlayout(std140) uniform TexCoords {\n  vec4 UVScale;\n  vec4 lightMapUVParam;\n};\nvec4 vert () {\n  vec3 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  vec4 pos = vec4(worldPos, 1.0);\n  pos = cc_matViewProj * pos;\n  uvw = a_texCoord;\n  uv0 = a_position.xz * UVScale.x;\n  uv1 = a_position.xz * UVScale.y;\n  uv2 = a_position.xz * UVScale.z;\n  uv3 = a_position.xz * UVScale.w;\n  #if USE_LIGHTMAP\n    luv = lightMapUVParam.xy + a_texCoord * lightMapUVParam.zw;\n  #endif\n  v_position = worldPos;\n  v_normal = a_normal;\n  v_fog_factor = CC_TRANSFER_FOG(vec4(worldPos, 1.0));\n  #if USE_NORMALMAP\n    v_tangent = vec3(1.0, 0.0, 0.0);\n    v_binormal = vec3(0.0, 0.0, 1.0);\n    v_binormal = cross(v_tangent, a_normal);\n    v_tangent = cross(a_normal, v_binormal);\n  #endif\n    v_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n    return textureLod(tex, coord, lod);\n}\n#endif\n#if CC_RECEIVE_SHADOW\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n  uniform sampler2D cc_shadowMap;\n  uniform sampler2D cc_spotLightingMap;\n  float CCGetShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_shadowMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow / 5.0;\n  }\n  float CCGetShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_shadowMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n  float CCGetDirLightShadowFactorX1 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    float shadow = step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    return shadow;\n  }\n  float CCGetDirLightShadowFactorX5 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    float closestDepth = 0.0;\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x - offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y - offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n    closestDepth = dot(texture(cc_spotLightingMap, vec2(clipPos.x + offsetx, clipPos.y + offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n    return shadow / 5.0;\n  }\n  float CCGetDirLightShadowFactorX9 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -1; i <= 1; i++) {\n      for (int j = -1; j <= 1; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 9.0;\n  }\n  float CCGetDirLightShadowFactorX25 () {\n    vec3 clipPos = v_shadowPos.xyz / v_shadowPos.w * 0.5 + 0.5;\n    if (clipPos.x < 0.0 || clipPos.x > 1.0 ||\n        clipPos.y < 0.0 || clipPos.y > 1.0 ||\n        clipPos.z <-1.0 || clipPos.z > 1.0) { return 0.0; }\n    float offsetx = 1.0 / cc_shadowInfo.x;\n    float offsety = 1.0 / cc_shadowInfo.y;\n    float shadow = 0.0;\n    for (int i = -2; i <= 2; i++) {\n      for (int j = -2; j <= 2; j++) {\n        float closestDepth = dot(texture(cc_spotLightingMap, clipPos.xy + vec2(i, j) * vec2(offsetx, offsety)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 160581375.0));\n        shadow += step(closestDepth, clipPos.z - cc_shadowInfo.w);\n      }\n    }\n    return shadow / 25.0;\n  }\n#endif\n#endif\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\n  vec3 NxH = cross(N, H);\n  float OneMinusNoHSqr = dot(NxH, NxH);\n  float a = roughness * roughness;\n  float n = NoH * a;\n  float p = a / (OneMinusNoHSqr + n * n);\n  return p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\n  return (roughness*0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\n  const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\n  const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\n  vec4 r = roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n  AB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\n  return specular * AB.x + AB.y;\n}\nstruct StandardSurface {\n  vec4 albedo;\n  vec3 position;\n  vec3 normal;\n  vec3 emissive;\n  vec4 lightmap;\n  float roughness;\n  float metallic;\n  float occlusion;\n};\n#if CC_FORWARD_ADD\nlayout(std140) uniform CCForwardLight {\n  highp vec4 cc_lightPos[1];\n  vec4 cc_lightColor[1];\n  vec4 cc_lightSizeRangeAngle[1];\n  vec4 cc_lightDir[1];\n};\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\n  float factor = distSqr * invSqrAttRadius;\n  float smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\n  return smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\n  float attenuation = 1.0 / max(distSqr, 0.01*0.01);\n  attenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\n  return attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\n  float cd = dot(litDir, L);\n  float attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\n  return (attenuation * attenuation);\n}\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 finalColor = vec3(0.0);\n    for (int i = 0; i < 1; i++) {\n      vec3 SLU = cc_lightPos[i].xyz - s.position;\n      vec3 SL = normalize(SLU);\n      vec3 SH = normalize(SL + V);\n      float SNL = max(dot(N, SL), 0.001);\n      float SNH = max(dot(N, SH), 0.0);\n      float distSqr = dot(SLU, SLU);\n      float litRadius = cc_lightSizeRangeAngle[i].x;\n      float litRadiusSqr = litRadius * litRadius;\n      float illum = 3.14159265359 * (litRadiusSqr / max(litRadiusSqr , distSqr));\n      float attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\n      attRadiusSqrInv *= attRadiusSqrInv;\n      float att = GetDistAtt(distSqr, attRadiusSqrInv);\n      vec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\n      if (cc_lightPos[i].w > 0.0) {\n        float cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\n        float cosOuter = cc_lightSizeRangeAngle[i].z;\n        float litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\n        float litAngleOffset = -cosOuter * litAngleScale;\n        att *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n      }\n      vec3 lightColor = cc_lightColor[i].rgb;\n    #if CC_RECEIVE_SHADOW\n      if (cc_lightPos[i].w > 0.0) {\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetDirLightShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetDirLightShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetDirLightShadowFactorX5();\n      else shadowAttenuation = CCGetDirLightShadowFactorX1();\n      lightColor *= 1.0 - shadowAttenuation;\n    }\n      }\n    #endif\n      finalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n    }\n    finalColor = finalColor * s.occlusion;\n    return vec4(finalColor, 0.0);\n  }\n#else\n  vec4 CCStandardShading (StandardSurface s) {\n    vec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\n    vec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\n    vec3 N = normalize(s.normal);\n    vec3 V = normalize(cc_cameraPos.xyz - s.position);\n    float NV = max(abs(dot(N, V)), 0.001);\n    specular = BRDFApprox(specular, s.roughness, NV);\n    vec3 L = normalize(-cc_mainLitDir.xyz);\n    vec3 H = normalize(L+V);\n    float NH = max(dot(N, H), 0.0);\n    float NL = max(dot(N, L), 0.001);\n    vec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\n    #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n      finalColor = s.lightmap.a * s.lightmap.rgb + (1.0 - s.lightmap.a) * finalColor;\n    #endif\n    vec3 diffuseContrib = diffuse / 3.14159265359;\n    vec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\n    finalColor *= (diffuseContrib + specularContrib);\n    float fAmb = 0.5 - N.y * 0.5;\n    vec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb) * cc_ambientSky.w;\n    finalColor += (ambDiff.rgb * diffuse);\n    #if CC_USE_IBL\n      vec3 R = normalize(reflect(-V, N));\n      vec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n      #if CC_USE_IBL == 2\n        vec3 env = unpackRGBE(envmap);\n      #else\n        vec3 env = SRGBToLinear(envmap.rgb);\n      #endif\n      finalColor += env * cc_ambientSky.w * specular;\n    #endif\n    finalColor = finalColor * s.occlusion;\n    #if CC_USE_HDR\n      s.emissive *= cc_exposure.w;\n    #endif\n    finalColor += s.emissive;\n    #if CC_RECEIVE_SHADOW\n    {\n      float pcf = cc_shadowInfo.z + 0.001;\n      float shadowAttenuation = 0.0;\n      if (pcf > 3.0) shadowAttenuation = CCGetShadowFactorX25();\n      else if (3.0 > pcf && pcf > 2.0) shadowAttenuation = CCGetShadowFactorX9();\n      else if (2.0 > pcf && pcf > 1.0) shadowAttenuation = CCGetShadowFactorX5();\n      else shadowAttenuation = CCGetShadowFactorX1();\n      vec3 shadowColor = cc_shadowColor.rgb * cc_shadowColor.a + finalColor.rgb * (1.0 - cc_shadowColor.a);\n      finalColor.rgb = shadowColor.rgb * shadowAttenuation * NL + finalColor.rgb * (1.0 - shadowAttenuation * NL);\n    }\n    #endif\n    return vec4(finalColor, s.albedo.a);\n  }\n#endif\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nin highp vec3 v_position;\nin mediump vec3 v_normal;\n#if USE_NORMALMAP\n  in mediump vec3 v_tangent;\n  in mediump vec3 v_binormal;\n#endif\nin mediump vec2 uvw;\nin mediump vec2 uv0;\nin mediump vec2 uv1;\nin mediump vec2 uv2;\nin mediump vec2 uv3;\nin mediump vec3 diffuse;\nin mediump vec2 luv;\nin mediump float v_fog_factor;\nlayout(std140) uniform PbrParams {\n  vec4 metallic;\n  vec4 roughness;\n};\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n  #if LAYERS > 1\n    vec4 w = texture(weightMap, uvw);\n  #endif\n  vec4 baseColor = vec4(0, 0, 0, 0);\n  #if LAYERS == 1\n    baseColor = texture(detailMap0, uv0);\n  #elif LAYERS == 2\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n  #elif LAYERS == 3\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n    baseColor += texture(detailMap2, uv2) * w.b;\n  #elif LAYERS == 4\n    baseColor += texture(detailMap0, uv0) * w.r;\n    baseColor += texture(detailMap1, uv1) * w.g;\n    baseColor += texture(detailMap2, uv2) * w.b;\n    baseColor += texture(detailMap3, uv3) * w.a;\n  #else\n    baseColor = texture(detailMap0, uv0);\n  #endif\n  s.position = v_position;\n  #if USE_NORMALMAP\n    vec4 baseNormal = vec4(0, 0, 0, 0);\n    #if LAYERS == 1\n      baseNormal = texture(normalMap0, uv0);\n    #elif LAYERS == 2\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n    #elif LAYERS == 3\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n      baseNormal += texture(normalMap2, uv2) * w.b;\n    #elif LAYERS == 4\n      baseNormal += texture(normalMap0, uv0) * w.r;\n      baseNormal += texture(normalMap1, uv1) * w.g;\n      baseNormal += texture(normalMap2, uv2) * w.b;\n      baseNormal += texture(normalMap3, uv3) * w.a;\n    #else\n      baseNormal = texture(normalMap0, uv0);\n    #endif\n    vec3 nmmp = baseNormal.xyz - vec3(0.5);\n    s.normal =\n      nmmp.x * normalize(v_tangent) +\n      nmmp.y * normalize(v_binormal) +\n      nmmp.z * normalize(v_normal);\n  #else\n    s.normal = v_normal;\n  #endif\n  s.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\n  s.occlusion = 1.0;\n  #if USE_PBR\n    s.roughness = 0.0;\n    #if LAYERS == 1\n      s.roughness = roughness.x;\n    #elif LAYERS == 2\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n    #elif LAYERS == 3\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n    #elif LAYERS == 4\n      s.roughness += roughness.x * w.r;\n      s.roughness += roughness.y * w.g;\n      s.roughness += roughness.z * w.b;\n      s.roughness += roughness.w * w.a;\n    #else\n      s.roughness = 1.0;\n    #endif\n    s.metallic = 0.0;\n    #if LAYERS == 1\n      s.metallic = metallic.x;\n    #elif LAYERS == 2\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n    #elif LAYERS == 3\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n    #elif LAYERS == 4\n      s.metallic += metallic.x * w.r;\n      s.metallic += metallic.y * w.g;\n      s.metallic += metallic.z * w.b;\n      s.metallic += metallic.w * w.a;\n    #else\n      s.metallic = 0.0;\n    #endif\n  #else\n    s.roughness = 1.0;\n    s.metallic = 0.0;\n  #endif\n  s.emissive = vec3(0.0, 0.0, 0.0);\n  #if USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\n    s.lightmap = texture(lightMap, luv);\n  #else\n    s.lightmap = vec4(0.0, 0.0, 0.0, 0.0);\n  #endif\n}\nvec4 frag () {\n  StandardSurface s; surf(s);\n  vec4 color = CCStandardShading(s);\n  color = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, color.rgb, v_fog_factor), color.a);\n  return CCFragOutput(color);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"},{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout vec2 v_clip_depth;\nvec4 vert () {\n  vec4 worldPos;\n  worldPos.x = cc_matWorld[3][0] + a_position.x;\n  worldPos.y = cc_matWorld[3][1] + a_position.y;\n  worldPos.z = cc_matWorld[3][2] + a_position.z;\n  worldPos.w = 1.0;\n  vec4 clipPos = cc_matLightViewProj * worldPos;\n  v_clip_depth = clipPos.zw;\n  return clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\n  vec4 ret = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n  ret = fract(ret);\n  ret -= ret.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n  return ret;\n}\nin vec2 v_clip_depth;\nvec4 frag () {\n  return packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nfloat LinearFog(vec4 pos) {\n    vec4 wPos = pos;\n    float cam_dis = distance(cc_cameraPos, wPos);\n    float fogStart = cc_fogBase.x;\n    float fogEnd = cc_fogBase.y;\n    return clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * fogDensity);\n    return f;\n}\nfloat ExpSquaredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float fogDensity = cc_fogBase.z;\n    float cam_dis = distance(cc_cameraPos, wPos) / fogAtten * 4.;\n    float f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\n    return f;\n}\nfloat LayeredFog(vec4 pos) {\n    vec4 wPos = pos;\n    float fogAtten = cc_fogAdd.z;\n    float _FogTop = cc_fogAdd.x;\n    float _FogRange = cc_fogAdd.y;\n    vec3 camWorldProj = cc_cameraPos.xyz;\n    camWorldProj.y = 0.;\n    vec3 worldPosProj = wPos.xyz;\n    worldPosProj.y = 0.;\n    float fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\n    float fDeltaY, fDensityIntegral;\n    if (cc_cameraPos.y > _FogTop) {\n        if (wPos.y < _FogTop) {\n            fDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\n            fDensityIntegral = fDeltaY * fDeltaY * 0.5;\n        } else {\n            fDeltaY = 0.;\n            fDensityIntegral = 0.;\n        }\n    } else {\n        if (wPos.y < _FogTop) {\n            float fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            float fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\n            fDeltaY = abs(fDeltaA - fDeltaB);\n            fDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n        } else {\n            fDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\n            fDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n        }\n    }\n    float fDensity;\n    if (fDeltaY != 0.) {\n        fDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n    } else {\n        fDensity = 0.;\n    }\n    float f = exp(-fDensity);\n    return f;\n}\nfloat CC_TRANSFER_FOG(vec4 pos) {\n    #if CC_USE_FOG == 0\n        return LinearFog(pos);\n\t#elif CC_USE_FOG == 1\n        return ExpFog(pos);\n    #elif CC_USE_FOG == 2\n        return ExpSquaredFog(pos);\n    #elif CC_USE_FOG == 3\n        return LayeredFog(pos);\n    #endif\n    return 1.;\n}\n#if USE_VERTEX_COLOR\n  in lowp vec4 a_color;\n  out lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\n  out vec2 v_uv;\n  layout(std140) uniform TexCoords {\n    vec4 tilingOffset;\n  };\n#endif\nout float factor_fog;\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  #if USE_TEXTURE\n    v_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n  #endif\n  #if USE_VERTEX_COLOR\n    v_color = a_color;\n  #endif\n  factor_fog = CC_TRANSFER_FOG(matWorld * position);\n  return cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\n  in vec2 v_uv;\n  uniform sampler2D mainTexture;\n#endif\nlayout(std140) uniform Constant {\n  vec4 mainColor;\n  vec4 colorScaleAndCutoff;\n};\n#if USE_VERTEX_COLOR\n  in lowp vec4 v_color;\n#endif\nin float factor_fog;\nvec4 frag () {\n  vec4 o = mainColor;\n  o.rgb *= colorScaleAndCutoff.xyz;\n  #if USE_VERTEX_COLOR\n    o *= v_color;\n  #endif\n  #if USE_TEXTURE\n    o *= texture(mainTexture, v_uv);\n  #endif\n  #if USE_ALPHA_TEST\n    if (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n  #endif\n  o = vec4(mix(CC_FORWARD_ADD > 0 ? vec3(0.0) : cc_fogColor.rgb, o.rgb, factor_fog), o.a);\n  return CCFragOutput(o);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nhighp float decode32 (highp vec4 rgba) {\n  rgba = rgba * 255.0;\n  highp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\n  highp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\n  highp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\n  return Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_MORPH\n    in float a_vertexId;\n    int getVertexId() {\n        return int(a_vertexId);\n    }\nlayout(std140) uniform CCMorph {\n    vec4 cc_displacementWeights[15];\n    vec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\n    float pixelIndexF = float(pixelIndex);\n    float x = mod(pixelIndexF, textureResolution.x);\n    float y = floor(pixelIndexF / textureResolution.x);\n    return vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\n    return (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_SUPPORT_FLOAT_TEXTURE\n        vec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\n            ivec2 texSize = textureSize(tex, 0);\n            return texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n        }\n#else\n    vec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\n        int pixelIndex = elementIndex * 4;\n        vec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\n        vec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\n        vec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\n        return vec4(\n            decode32(texture(tex, x)),\n            decode32(texture(tex, y)),\n            decode32(texture(tex, z)),\n            1.0\n        );\n    }\n#endif\nfloat getDisplacementWeight(int index) {\n    int quot = index / 4;\n    int remainder = index - quot * 4;\n    if (remainder == 0) {\n        return cc_displacementWeights[quot].x;\n    } else if (remainder == 1) {\n        return cc_displacementWeights[quot].y;\n    } else if (remainder == 2) {\n        return cc_displacementWeights[quot].z;\n    } else {\n        return cc_displacementWeights[quot].w;\n    }\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\n    return fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\n    vec3 result = vec3(0, 0, 0);\n    int nVertices = int(cc_displacementTextureInfo.z);\n    for (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\n        result += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n    }\n    return result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\n    uniform sampler2D cc_PositionDisplacements;\n    vec3 getPositionDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    uniform sampler2D cc_NormalDisplacements;\n    vec3 getNormalDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n    }\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    uniform sampler2D cc_TangentDisplacements;\n    vec3 getTangentDisplacement(int vertexId) {\n        return getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n    }\n#endif\nvoid applyMorph (inout StandardVertInput attr) {\n    int vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\n    attr.position.xyz = attr.position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\n    attr.normal.xyz = attr.normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\n    attr.tangent.xyz = attr.tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\n    position.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n  in vec4 a_joints;\nin vec4 a_weights;\n#if CC_USE_BAKED_ANIMATION\n  #if USE_INSTANCING\n    in highp vec4 a_jointAnimInfo;\n  #endif\n  layout(std140) uniform CCSkinningTexture {\n    highp vec4 cc_jointTextureInfo;\n  };\n  layout(std140) uniform CCSkinningAnimation {\n    highp vec4 cc_jointAnimInfo;\n  };\n  uniform highp sampler2D cc_jointTexture;\n  #else\n  layout(std140) uniform CCSkinning {\n    highp vec4 cc_joints[30 * 3];\n  };\n#endif\n#if CC_USE_BAKED_ANIMATION\n  #if CC_SUPPORT_FLOAT_TEXTURE\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 3.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 3.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\n      vec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\n      vec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #else\n    mat4 getJointMatrix (float i) {\n    #if USE_INSTANCING\n      highp float j = 12.0 * (a_jointAnimInfo.x * a_jointAnimInfo.y + i) + a_jointAnimInfo.z;\n    #else\n      highp float j = 12.0 * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + i) + cc_jointTextureInfo.z;\n    #endif\n    highp float invSize = cc_jointTextureInfo.w;\n    highp float y = floor(j * invSize);\n    highp float x = j - y * cc_jointTextureInfo.x;\n    y = (y + 0.5) * invSize;\n      vec4 v1 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n      );\n      vec4 v2 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n      );\n      vec4 v3 = vec4(\n        decode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\n        decode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n      );\n      return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n    }\n  #endif\n#else\n  mat4 getJointMatrix (float i) {\n    int idx = int(i);\n    vec4 v1 = cc_joints[idx * 3];\n    vec4 v2 = cc_joints[idx * 3 + 1];\n    vec4 v3 = cc_joints[idx * 3 + 2];\n    return mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n  }\n#endif\nmat4 skinMatrix () {\n  vec4 joints = vec4(a_joints);\n  return getJointMatrix(joints.x) * a_weights.x\n       + getJointMatrix(joints.y) * a_weights.y\n       + getJointMatrix(joints.z) * a_weights.z\n       + getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\n  mat4 m = skinMatrix();\n  position = m * position;\n}\nvoid CCSkin (inout StandardVertInput attr) {\n  mat4 m = skinMatrix();\n  attr.position = m * attr.position;\n  attr.normal = (m * vec4(attr.normal, 0.0)).xyz;\n  attr.tangent.xyz = (m * vec4(attr.tangent.xyz, 0.0)).xyz;\n}\n#endif\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\n#if USE_INSTANCING\n  in vec4 a_matWorld0;\n  in vec4 a_matWorld1;\n  in vec4 a_matWorld2;\n  #if USE_LIGHTMAP\n    in vec4 a_lightingMapUVParam;\n  #endif\n#elif USE_BATCHING\n  in float a_dyn_batch_id;\n  layout(std140) uniform CCLocalBatched {\n    highp mat4 cc_matWorlds[10];\n  };\n#else\nlayout(std140) uniform CCLocal {\n  highp mat4 cc_matWorld;\n  highp mat4 cc_matWorldIT;\n  highp vec4 cc_lightingMapUVParam;\n};\n#endif\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nvec4 vert () {\n  vec4 position;\n  position = vec4(a_position, 1.0);\n  #if CC_USE_MORPH\n    applyMorph(position);\n  #endif\n  #if CC_USE_SKINNING\n    CCSkin(position);\n  #endif\n  mat4 matWorld;\n  #if USE_INSTANCING\n    matWorld = mat4(\n      vec4(a_matWorld0.xyz, 0.0),\n      vec4(a_matWorld1.xyz, 0.0),\n      vec4(a_matWorld2.xyz, 0.0),\n      vec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n    );\n  #elif USE_BATCHING\n    matWorld = cc_matWorlds[int(a_dyn_batch_id)];\n  #else\n    matWorld = cc_matWorld;\n  #endif\n  position = cc_matProj * (cc_matView * cc_matLightPlaneProj * matWorld) * position;\n  position.z -= 0.0001;\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCShadow {\n  highp mat4 cc_matLightPlaneProj;\n  highp mat4 cc_matLightViewProj;\n  lowp  vec4 cc_shadowColor;\n  lowp  vec4 cc_shadowInfo;\n};\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nvec4 frag () {\n  return CCFragOutput(cc_shadowColor);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nstruct StandardVertInput {\n  highp vec4 position;\n  vec3 normal;\n  vec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\nout mediump vec4 viewDir;\nvec4 vert () {\n  viewDir = vec4(a_position, 1.0);\n  mat4 matViewRotOnly = mat4(mat3(cc_matView));\n  mat4 matProj = cc_matProj;\n  if (matProj[3].w > 0.0) {\n    vec2 scale = vec2(48.0, 24.0);\n    matProj[0].xy *= scale;\n    matProj[1].xy *= scale;\n    matProj[2].zw = vec2(-1.0);\n    matProj[3].zw = vec2(0.0);\n  }\n  vec4 pos = matProj * matViewRotOnly * viewDir;\n  pos.z = 0.99999 * pos.w;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\n  return rgbe.rgb * pow(2.0, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\n  color = min(color, vec3(8.0));\n  const float A = 2.51;\n  const float B = 0.03;\n  const float C = 2.43;\n  const float D = 0.59;\n  const float E = 0.14;\n  return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n  #if !CC_USE_HDR\n    color.rgb = sqrt(ACESToneMap(color.rgb));\n  #endif\n  return color;\n}\nin mediump vec4 viewDir;\nvec4 frag () {\n  #if USE_RGBE_CUBEMAP\n    vec3 c = unpackRGBE(texture(cc_environment, viewDir.xyz));\n  #else\n    vec3 c = SRGBToLinear(texture(cc_environment, viewDir.xyz).rgb);\n  #endif\n  return CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec2 v_uv;\nlayout(std140) uniform Constants {\n  vec4 offset;\n};\nlayout(std140) uniform PerFrameInfo {\n  vec4 digits[8 * 10 / 4];\n};\nfloat getComponent(vec4 v, float i) {\n  if (i < 1.0) { return v.x; }\n  else if (i < 2.0) { return v.y; }\n  else if (i < 3.0) { return v.z; }\n  else { return v.w; }\n}\nvec4 vert () {\n  vec4 position = cc_matViewProj * vec4(a_position, 1.0);\n  position.xy += offset.xy;\n  v_uv = a_color.xy;\n  if (a_color.z >= 0.0) {\n    float n = getComponent(digits[int(a_color.z)], a_color.w);\n    v_uv += vec2(offset.z * n, 0.0);\n  }\n  return position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\n  highp   vec4 cc_time;\n  mediump vec4 cc_screenSize;\n  mediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\n  highp   mat4 cc_matView;\n  highp   mat4 cc_matViewInv;\n  highp   mat4 cc_matProj;\n  highp   mat4 cc_matProjInv;\n  highp   mat4 cc_matViewProj;\n  highp   mat4 cc_matViewProjInv;\n  highp   vec4 cc_cameraPos;\n  mediump vec4 cc_screenScale;\n  mediump vec4 cc_exposure;\n  mediump vec4 cc_mainLitDir;\n  mediump vec4 cc_mainLitColor;\n  mediump vec4 cc_ambientSky;\n  mediump vec4 cc_ambientGround;\n  mediump vec4 cc_fogColor;\n  mediump vec4 cc_fogBase;\n  mediump vec4 cc_fogAdd;\n};\nvec3 SRGBToLinear (vec3 gamma) {\n  return gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n  #if CC_USE_HDR\n    color.rgb = mix(color.rgb, SRGBToLinear(color.rgb) * cc_exposure.w, vec3(cc_exposure.z));\n  #endif\n  return color;\n}\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\n  return CCFragOutput(texture(mainTexture, v_uv));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_uv;\nvec4 vert () {\n  vec4 pos = vec4(a_position, 0, 1);\n  v_uv = a_texCoord;\n  return pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nlayout(std140) uniform splashFrag {\n  float u_precent;\n};\nvec4 frag () {\n  vec4 color = texture(mainTexture, v_uv);\n  float precent = clamp(u_precent, 0.0, 1.0);\n  color.xyz *= precent;\n  return color;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}]]},ym=function(){function e(){this._device=null,this._resources={}}var t=e.prototype;return t.initBuiltinRes=function(e){var t=this;this._device=e;var n=this._resources,i=document.createElement("canvas"),r=i.getContext("2d"),o=new lf(i),a=i.width=i.height=2;r.fillStyle="#000",r.fillRect(0,0,a,a);var s=new Ud;s._uuid="black-texture",s.image=o,n[s._uuid]=s,r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,a,a);for(var l=new Uint8Array(16),u=0;u<l.length;++u)l[u]=0;var h=new Ud;h._uuid="empty-texture",h.image=o,h.uploadData(l),n[h._uuid]=h;var _=new Gd;_._uuid="black-cube-texture",_.setMipFilter(Gd.Filter.NEAREST),_.image={front:new lf(i),back:new lf(i),left:new lf(i),right:new lf(i),top:new lf(i),bottom:new lf(i)},n[_._uuid]=_,r.fillStyle="#777",r.fillRect(0,0,a,a);var f=new Ud;f._uuid="grey-texture",f.image=o,n[f._uuid]=f,r.fillStyle="#fff",r.fillRect(0,0,a,a);var d=new Ud;d._uuid="white-texture",d.image=o,n[d._uuid]=d;var m=new Gd;m._uuid="white-cube-texture",m.setMipFilter(Gd.Filter.NEAREST),m.image={front:new lf(i),back:new lf(i),left:new lf(i),right:new lf(i),top:new lf(i),bottom:new lf(i)},n[m._uuid]=m,r.fillStyle="#7f7fff",r.fillRect(0,0,a,a);var p=new Ud;p._uuid="normal-texture",p.image=o,n[p._uuid]=p,i.width=i.height=16,r.fillStyle="#ddd",r.fillRect(0,0,16,16),r.fillStyle="#555",r.fillRect(0,0,8,8),r.fillStyle="#555",r.fillRect(8,8,8,8);var v=new Ud;v._uuid="default-texture",v.image=o,n[v._uuid]=v;var g=new Gd;if(g.setMipFilter(Gd.Filter.NEAREST),g._uuid="default-cube-texture",g.image={front:new lf(i),back:new lf(i),left:new lf(i),right:new lf(i),top:new lf(i),bottom:new lf(i)},n[g._uuid]=g,c.SpriteFrame){var y=new c.SpriteFrame,x=o._texture;y.texture=x,y._uuid="default-spriteframe",n[y._uuid]=y}var E=fm(e);if(!E)return Promise.reject(Error("Failed to initialize builtin shaders: unknown device."));var T=gm[E];return T?Promise.resolve().then((function(){Wd.forEach((function(e,t){var n=Object.assign(new c.EffectAsset,e);n.shaders.forEach((function(e,n){var i=T[t][n];i&&(e[E]=i)})),n.hideInEditor=!0,n.onLoaded()})),t._initMaterials()})):Promise.reject(Error("Current device is requiring builtin shaders of version "+E+" but shaders of that version are not assembled in this build."))},t.get=function(e){return this._resources[e]},t._initMaterials=function(){var e=this._resources,t=[],n=new c.Material;n._uuid="standard-material",n.initialize({effectName:"standard"}),e[n._uuid]=n,t.push(n);var i=new c.Material;i._uuid="missing-effect-material",i.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),i.setProperty("mainColor",c.color("#ffff00")),e[i._uuid]=i,t.push(i);var r=new c.Material;r._uuid="missing-material",r.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),r.setProperty("mainColor",c.color("#ff00ff")),e[r._uuid]=r,t.push(r);var o=new c.Material;o._uuid="default-clear-stencil",o.initialize({defines:{USE_TEXTURE:!1},effectName:"clear-stencil"}),e[o._uuid]=o,t.push(o);var a=new c.Material;a._uuid="ui-base-material",a.initialize({defines:{USE_TEXTURE:!1},effectName:"sprite"}),e[a._uuid]=a,t.push(a);var s=new c.Material;s._uuid="ui-sprite-material",s.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[s._uuid]=s,t.push(s);var l=new c.Material;l._uuid="ui-alpha-test-material",l.initialize({defines:{USE_TEXTURE:!0,USE_ALPHA_TEST:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),e[l._uuid]=l,t.push(l);var u=new c.Material;u._uuid="ui-sprite-gray-material",u.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!0},effectName:"sprite"}),e[u._uuid]=u,t.push(u);var h=new c.Material;h._uuid="ui-sprite-alpha-sep-material",h.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"sprite"}),e[h._uuid]=h,t.push(h);var _=new c.Material;_._uuid="ui-sprite-gray-alpha-sep-material",_.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!0},effectName:"sprite"}),e[_._uuid]=_,t.push(_);var f=new c.Material;f._uuid="ui-graphics-material",f.initialize({effectName:"graphics"}),e[f._uuid]=f,t.push(f);var d=new c.Material;d._uuid="default-particle-material",d.initialize({effectName:"particle"}),e[d._uuid]=d,t.push(d);var m=new c.Material;m._uuid="default-particle-gpu-material",m.initialize({effectName:"particle-gpu"}),e[m._uuid]=m,t.push(m);var p=new c.Material;p._uuid="default-trail-material",p.initialize({effectName:"particle-trail"}),e[p._uuid]=p,t.push(p);var v=new c.Material;v._uuid="default-billboard-material",v.initialize({effectName:"billboard"}),e[v._uuid]=v,t.push(v);var g=new c.Material;g._uuid="default-spine-material",g.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"spine"}),e[g._uuid]=g,t.push(g),c.game.on(c.Game.EVENT_RENDERER_INITED,(function(){for(var e=0;e<t.length;++e)for(var n=t[e],i=0;i<n.passes.length;++i)n.passes[i].tryCompile()}))},e}(),xm=e("b3",c.builtinResMgr=new ym),Em=e("fm",(mm=new Map,pm=0,function(e){return"number"==typeof e?e:(mm.has(e)||(mm.set(e,1<<pm),pm++),mm.get(e))})),Tm=new Za(oa.UNIFORM|oa.TRANSFER_DST,aa.HOST|aa.DEVICE),Sm=new Ja(null),Am=new Qs(null);!function(e){e[e.INSTANCING=1]="INSTANCING",e[e.VB_MERGING=2]="VB_MERGING"}(vm||(vm={}));var Cm=e("cq",function(){function e(e){this._rootBuffer=null,this._rootBufferDirty=!1,this._buffers=[],this._descriptorSet=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._root=void 0,this._device=void 0,this._hShaderDefault=nr,this._handle=nr,this._bs=new As,this._dss=new Ts,this._rs=new Es,this._root=e,this._device=e.device}e.fillPipelineInfo=function(e,t){var n=e.handle;void 0!==t.priority&&yr.set(n,tr.PRIORITY,t.priority),void 0!==t.primitive&&yr.set(n,tr.PRIMITIVE,t.primitive),void 0!==t.stage&&yr.set(n,tr.STAGE,t.stage),void 0!==t.dynamicStates&&yr.set(n,tr.DYNAMIC_STATES,t.dynamicStates),void 0!==t.phase&&yr.set(n,tr.PHASE,Em(t.phase));var i=e._bs;if(t.blendState){var r=t.blendState,o=r.targets;o&&o.forEach((function(e,t){i.setTarget(t,e)})),void 0!==r.isA2C&&(i.isA2C=r.isA2C),void 0!==r.isIndepend&&(i.isIndepend=r.isIndepend),void 0!==r.blendColor&&(i.blendColor=r.blendColor)}e._rs.assign(t.rasterizerState),e._dss.assign(t.depthStencilState)},e.getPassHash=function(e,t){var n,i=e.handle,r=t+","+yr.get(i,tr.PRIMITIVE)+","+yr.get(i,tr.DYNAMIC_STATES);return r+=function(e){for(var t,n=",bs,"+e.isA2C,i=oe(e.targets);!(t=i()).done;){var r=t.value;n+=",bt,"+r.blend+","+r.blendEq+","+r.blendAlphaEq+","+r.blendColorMask,n+=","+r.blendSrc+","+r.blendDst+","+r.blendSrcAlpha+","+r.blendDstAlpha}return n}(e._bs),r+=function(e){var t=",dss,"+e.depthTest+","+e.depthWrite+","+e.depthFunc;return t+=","+e.stencilTestFront+","+e.stencilFuncFront+","+e.stencilRefFront+","+e.stencilReadMaskFront,t+=","+e.stencilFailOpFront+","+e.stencilZFailOpFront+","+e.stencilPassOpFront+","+e.stencilWriteMaskFront,(t+=","+e.stencilTestBack+","+e.stencilFuncBack+","+e.stencilRefBack+","+e.stencilReadMaskBack)+","+e.stencilFailOpBack+","+e.stencilZFailOpBack+","+e.stencilPassOpBack+","+e.stencilWriteMaskBack}(e._dss),ls(r+=",rs,"+(n=e._rs).cullMode+","+n.depthBias+","+n.isFrontFaceCCW,666)};var t=e.prototype;return t.initialize=function(e){this._doInit(e),this.resetUBOs(),this.resetTextures(),this.tryCompile()},t.getHandle=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=ia.UNKNOWN);var i=this._propertyHandleMap[e];return i?(n?i=tm(i,n):t&&(i=tm(i,Jd(i)-t)),i+t):0},t.getBinding=function(t){var n=this.getHandle(t);return n?e.getBindingFromHandle(n):-1},t.setUniform=function(t,n){var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=e.getOffsetFromHandle(t),a=this._blocks[i];im[r](a,n,o),this._rootBufferDirty=!0},t.getUniform=function(t,n){var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=e.getOffsetFromHandle(t),a=this._blocks[i];return nm[r](a,n,o)},t.setUniformArray=function(t,n){for(var i=e.getBindingFromHandle(t),r=e.getTypeFromHandle(t),o=qa(r)>>2,a=this._blocks[i],s=e.getOffsetFromHandle(t),c=0;c<n.length;c++,s+=o)null!==n[c]&&im[r](a,n[c],s);this._rootBufferDirty=!0},t.bindTexture=function(e,t,n){this._descriptorSet.bindTexture(e,t,n||0)},t.bindSampler=function(e,t,n){this._descriptorSet.bindSampler(e,t,n||0)},t.setDynamicState=function(e,t){var n=this._dynamics[e];n&&n.value===t||(n.value=t,n.dirty=!0)},t.overridePipelineStates=function(e,t){console.warn("base pass cannot override states, please use pass instance instead.")},t.update=function(){this._rootBufferDirty&&this._rootBuffer&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()},t.destroy=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++){var t=this._shaderInfo.blocks[e];this._buffers[t.binding].destroy()}this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBlock=null),this._descriptorSet=null,this._rs.destroy(),this._dss.destroy(),this._bs.destroy(),this._handle&&(rr.free(yr.get(this._handle,tr.DESCRIPTOR_SET)),yr.free(this._handle),this._handle=nr)},t.resetUniform=function(t){var n=this.getHandle(t);if(n){var i=e.getTypeFromHandle(n),r=e.getBindingFromHandle(n),o=e.getOffsetFromHandle(n),a=this._blocks[r],s=this._properties[t],c=s&&s.value||om(i);im[i](a,c,o),this._rootBufferDirty=!0}},t.resetTexture=function(t,n){var i=this.getHandle(t);if(i){var r=e.getTypeFromHandle(i),o=e.getBindingFromHandle(i),a=this._properties[t],s=a&&a.value,c=s?s+"-texture":om(r),l=xm.get(c),u=l&&l.getGFXTexture(),h=a&&void 0!==a.samplerHash?a.samplerHash:l&&l.getSamplerHash(),_=If.getSampler(this._device,h);this._descriptorSet.bindSampler(o,_,n),this._descriptorSet.bindTexture(o,u,n)}},t.resetUBOs=function(){for(var e=0;e<this._shaderInfo.blocks.length;e++)for(var t=this._shaderInfo.blocks[e],n=this._blocks[t.binding],i=0,r=0;r<t.members.length;r++){for(var o=t.members[r],a=this._properties[o.name],s=a&&a.value||om(o.type),c=(qa(o.type)>>2)*o.count,l=0;l+s.length<=c;l+=s.length)n.set(s,i+l);i+=c}this._rootBufferDirty=!0},t.resetTextures=function(){for(var e=0;e<this._shaderInfo.samplers.length;e++)for(var t=this._shaderInfo.samplers[e],n=0;n<t.count;n++)this.resetTexture(t.name,n)},t.tryCompile=function(){var t=this._root.pipeline;return!!t&&(this._syncBatchingScheme(),this._hShaderDefault=dm.getGFXShader(this._device,this._programName,this._defines,t),this._hShaderDefault?(yr.set(this._handle,tr.PIPELINE_LAYOUT,dm.getTemplateInfo(this._programName).hPipelineLayout),yr.set(this._handle,tr.HASH,e.getPassHash(this,this._hShaderDefault)),!0):(console.warn("create shader "+this._programName+" failed"),!1))},t.getShaderVariant=function(e){if(void 0===e&&(e=null),!this._hShaderDefault&&!this.tryCompile())return console.warn("pass resources incomplete"),nr;if(!e)return this._hShaderDefault;for(var t=this._root.pipeline,n=0;n<e.length;n++){var i=e[n];this._defines[i.name]=i.value}for(var r=dm.getGFXShader(this._device,this._programName,this._defines,t),o=0;o<e.length;o++){var a=e[o];delete this._defines[a.name]}return r},t.beginChangeStatesSilently=function(){},t.endChangeStatesSilently=function(){},t._doInit=function(t,n){void 0===n&&(n=!1);var i=this._handle=yr.alloc();yr.set(i,tr.PRIORITY,tu.DEFAULT),yr.set(i,tr.STAGE,eu.DEFAULT),yr.set(i,tr.PHASE,Em("default")),yr.set(i,tr.PRIMITIVE,la.TRIANGLE_LIST),yr.set(i,tr.RASTERIZER_STATE,this._rs.handle),yr.set(i,tr.DEPTH_STENCIL_STATE,this._dss.handle),yr.set(i,tr.BLEND_STATE,this._bs.handle),this._passIndex=t.passIndex,this._propertyIndex=void 0!==t.propertyIndex?t.propertyIndex:t.passIndex,this._programName=t.program,this._defines=n?J({},t.defines):t.defines,this._shaderInfo=dm.getTemplate(t.program),this._properties=t.properties||this._properties;var r=this._device;e.fillPipelineInfo(this,t),t.stateOverrides&&e.fillPipelineInfo(this,t.stateOverrides),Am.layout=dm.getDescriptorSetLayout(this._device,t.program);var o=rr.alloc(this._device,Am);yr.set(this._handle,tr.DESCRIPTOR_SET,o),this._descriptorSet=rr.get(o);for(var a=this._shaderInfo.blocks,s=dm.getTemplateInfo(t.program),c=s.blockSizes,l=s.handleMap,u=r.uboOffsetAlignment,h=[],_=0,f=0,d=0;d<a.length;d++){var m=c[d];h.push(f),f+=Math.ceil(m/u)*u,_=m}var p=h[h.length-1]+_;p&&(Tm.size=16*Math.ceil(p/16),this._rootBuffer=r.createBuffer(Tm),this._rootBlock=new ArrayBuffer(p));for(var v=0,g=0;v<a.length;v++){var y=a[v].binding,x=c[v];Sm.buffer=this._rootBuffer,Sm.offset=h[g++],Sm.range=16*Math.ceil(x/16);var E=this._buffers[y]=r.createBuffer(Sm);this._blocks[y]=new Float32Array(this._rootBlock,Sm.offset,x/Float32Array.BYTES_PER_ELEMENT),this._descriptorSet.bindBuffer(y,E)}var T=this._propertyHandleMap=l,S={};for(var A in this._properties){var C=this._properties[A];C.handleInfo&&(S[A]=this.getHandle.apply(this,C.handleInfo))}Object.assign(T,S)},t._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(Ba.INSTANCED_ARRAYS)?yr.set(this._handle,tr.BATCHING_SCHEME,vm.INSTANCING):(this._defines.USE_INSTANCING=!1,yr.set(this._handle,tr.BATCHING_SCHEME,0)):this._defines.USE_BATCHING?yr.set(this._handle,tr.BATCHING_SCHEME,vm.VB_MERGING):yr.set(this._handle,tr.BATCHING_SCHEME,0)},t._destroyHandle=function(){this._handle&&(yr.free(this._handle),this._handle=nr)},t._initPassFromTarget=function(e,t,n,i){yr.set(this.handle,tr.PRIORITY,e.priority),yr.set(this.handle,tr.STAGE,e.stage),yr.set(this.handle,tr.PHASE,e.phase),yr.set(this.handle,tr.BATCHING_SCHEME,e.batchingScheme),yr.set(this.handle,tr.PRIMITIVE,e.primitive),yr.set(this.handle,tr.DYNAMIC_STATES,e.dynamicStates),this._descriptorSet=e.descriptorSet,yr.set(this.handle,tr.DESCRIPTOR_SET,yr.get(e.handle,tr.DESCRIPTOR_SET)),this._bs=n,yr.set(this.handle,tr.BLEND_STATE,n.handle),this._rs=e.rasterizerState,yr.set(this.handle,tr.RASTERIZER_STATE,yr.get(e.handle,tr.RASTERIZER_STATE)),this._dss=t,yr.set(this.handle,tr.DEPTH_STENCIL_STATE,t.handle),this._passIndex=e.passIndex,this._propertyIndex=e.propertyIndex,this._programName=e.program,this._defines=e.defines,this._shaderInfo=e._shaderInfo,this._properties=e._properties,this._blocks=e._blocks,this._dynamics=e._dynamics,this._hShaderDefault=e._hShaderDefault,yr.set(this._handle,tr.PIPELINE_LAYOUT,dm.getTemplateInfo(this._programName).hPipelineLayout);var r=yr.get(e.handle,tr.HASH);yr.set(this._handle,tr.HASH,r^i)},Z(e,[{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return dm.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"handle",get:function(){return this._handle}},{key:"priority",get:function(){return yr.get(this._handle,tr.PRIORITY)}},{key:"primitive",get:function(){return yr.get(this._handle,tr.PRIMITIVE)}},{key:"stage",get:function(){return yr.get(this._handle,tr.STAGE)}},{key:"phase",get:function(){return yr.get(this._handle,tr.PHASE)}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return yr.get(this._handle,tr.DYNAMIC_STATES)}},{key:"batchingScheme",get:function(){return yr.get(this._handle,tr.BATCHING_SCHEME)}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return yr.get(this._handle,tr.HASH)}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}}]),e}());Cm.PropertyType=jd,Cm.getPropertyTypeFromHandle=Zd,Cm.getTypeFromHandle=Jd,Cm.getBindingFromHandle=$d,Cm.getOffsetFromHandle=em,ge(gh.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),ge(gh.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]);var wm={};ge(wm,"CameraVisFlags",[{name:"GENERAL"}]),ve(wm,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:$l.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:$l.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:$l.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:$l.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:$l.BitMask,targetName:"UI_2D"}]),c.CameraVisFlags=wm;var bm,Im={};function Rm(e,t){t<1e3?t=1e3:t>15e3&&(t=15e3);var n=t*t,i=(.860117757+.000154118254*t+1.28641212e-7*n)/(1+.000842420235*t+7.08145163e-7*n),r=(.317398726+422806245e-13*t+4.20481691e-8*n)/(1-289741816e-13*t+1.61456053e-7*n),o=2*i-8*r+4,a=3*i/o,s=2*r/o,c=1/s*a,l=1/s*(1-a-s);e.x=3.2404542*c-1.5371385+-.4985314*l,e.y=-.969266*c+1.8760108+.041556*l,e.z=.0556434*c-.2040259+1.0572252*l}ge(Im,"VisibilityFlags",[{name:"GENERAL"}]),ve(Im,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:$l.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:$l.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:$l.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:$l.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:$l.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:$l.Enum,targetName:"UI_2D"}]),c.VisibilityFlags=Im,ve(Cm.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),ge(vh.prototype,"Camera.prototype",[{name:"getSplitFrustum"}]),function(e){e[e.DIRECTIONAL=0]="DIRECTIONAL",e[e.SPHERE=1]="SPHERE",e[e.SPOT=2]="SPOT",e[e.UNKNOWN=3]="UNKNOWN"}(bm||(bm=e("bh",{})));var Om=e("bq",(function(e){return 4*Math.PI*Math.PI*e*e})),Nm=e("bi",function(){function e(){this._baked=!1,this._color=new Wn(1,1,1),this._colorTemp=6550,this._colorTempRGB=new Wn(1,1,1),this._scene=null,this._node=null,this._name=null,this._handle=nr}var t=e.prototype;return t.initialize=function(){this._handle=uo.alloc(),uo.setVec3(this._handle,ao.COLOR,this._color),uo.setVec3(this._handle,ao.COLOR_TEMPERATURE_RGB,this._colorTempRGB),uo.set(this._handle,ao.TYPE,bm.UNKNOWN)},t.attachToScene=function(e){this._scene=e},t.detachFromScene=function(){this._scene=null},t.destroy=function(){this._name=null,this._node=null,this._handle&&(uo.free(this._handle),this._handle=nr)},t.update=function(){},Z(e,[{key:"baked",get:function(){return this._baked},set:function(e){this._baked=e}},{key:"color",set:function(e){this._color.set(e),uo.setVec3(this._handle,ao.COLOR,e)},get:function(){return this._color}},{key:"useColorTemperature",set:function(e){uo.set(this._handle,ao.USE_COLOR_TEMPERATURE,e?1:0)},get:function(){return 1===uo.get(this._handle,ao.USE_COLOR_TEMPERATURE)}},{key:"colorTemperature",set:function(e){this._colorTemp=e,Rm(this._colorTempRGB,this._colorTemp),uo.setVec3(this._handle,ao.COLOR_TEMPERATURE_RGB,this._colorTempRGB)},get:function(){return this._colorTemp}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"node",set:function(e){this._node=e,this._node&&(this._node.hasChangedFlags|=ch.ROTATION,uo.set(this._handle,ao.NODE,this._node.handle))},get:function(){return this._node}},{key:"type",get:function(){return uo.get(this._handle,ao.TYPE)}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"scene",get:function(){return this._scene}},{key:"handle",get:function(){return this._handle}}]),e}()),Pm=new Wn(0,0,-1),Mm=new Wn,Dm=e("bn",function(e){function t(){var t;return(t=e.call(this)||this)._dir=new Wn(1,-1,-1),t._shadowRange=1e3,t._shadowIntensity=0,t._shadowFadeDistance=0,t._shadowDistance=0,t._fadeStart=.8,t._splits=new di(1,0,0,0),t._biasAutoAdjust=1,t}$(t,e),Z(t,[{key:"shadowRange",set:function(e){this._shadowRange=e},get:function(){return this._shadowRange}},{key:"shadowIntensitywRange",set:function(e){this._shadowIntensity=e}},{key:"shadowIntensity",get:function(){return this._shadowIntensity}},{key:"shadowFadeDistance",set:function(e){this._shadowFadeDistance=e},get:function(){return this._shadowFadeDistance}},{key:"shadowDistance",set:function(e){this._shadowDistance=e},get:function(){return this._shadowDistance}},{key:"fadeStart",set:function(e){this._fadeStart=e},get:function(){return this._fadeStart}},{key:"splits",set:function(e){this._splits=e},get:function(){return this._splits}},{key:"biasAutoAdjust",set:function(e){this._biasAutoAdjust=e},get:function(){return this._biasAutoAdjust}},{key:"direction",set:function(e){Wn.normalize(this._dir,e),uo.setVec3(this._handle,ao.DIRECTION,this._dir)},get:function(){return this._dir}},{key:"illuminance",set:function(e){uo.set(this._handle,ao.ILLUMINANCE,e)},get:function(){return uo.get(this._handle,ao.ILLUMINANCE)}}]);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),uo.set(this._handle,ao.ILLUMINANCE,No.SUN_ILLUM),uo.setVec3(this._handle,ao.DIRECTION,this._dir),uo.set(this._handle,ao.TYPE,bm.DIRECTIONAL)},n.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=Wn.transformQuat(Mm,Pm,this._node.worldRotation))},t}(Nm)),Lm=new Qs(null),Fm=function(){function e(){this._device=null,this._passes=null,this._subMesh=null,this._patches=null,this._handle=nr,this._priority=tu.DEFAULT,this._inputAssembler=null,this._descriptorSet=null}var t=e.prototype;return t.initialize=function(e,t,n){void 0===n&&(n=null),this._device=c.director.root.device,this._subMesh=e,this._patches=n,this._passes=t,this._handle=Tr.alloc(),this._flushPassInfo(),t[0].batchingScheme===vm.VB_MERGING&&this._subMesh.genFlatBuffers(),Lm.layout=t[0].localSetLayout;var i=rr.alloc(this._device,Lm),r=or.alloc(this._device,e.iaInfo);Tr.set(this._handle,vr.PRIORITY,tu.DEFAULT),Tr.set(this._handle,vr.INPUT_ASSEMBLER,r),Tr.set(this._handle,vr.DESCRIPTOR_SET,i),Tr.set(this._handle,vr.SUB_MESH,e.handle),this._inputAssembler=or.get(r),this._descriptorSet=rr.get(i)},t.initPlanarShadowShader=function(){var e=c.director.root.pipeline.shadows.getPlanarShader(this._patches);Tr.set(this._handle,vr.PLANAR_SHADER,e)},t.destroy=function(){rr.free(Tr.get(this._handle,vr.DESCRIPTOR_SET)),or.free(Tr.get(this._handle,vr.INPUT_ASSEMBLER)),Tr.free(this._handle),this._descriptorSet=null,this._inputAssembler=null,this._priority=tu.DEFAULT,this._handle=nr,this._patches=null,this._subMesh=null,this._passes=null},t.update=function(){for(var e=0;e<this._passes.length;++e)this._passes[e].update();this._descriptorSet.update()},t.onPipelineStateChanged=function(){var e=this._passes;if(e){for(var t=0;t<e.length;t++){var n=e[t];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently()}this._flushPassInfo()}},t.onMacroPatchesStateChanged=function(e){this._patches=e;var t=this._passes;if(t){for(var n=0;n<t.length;n++){var i=t[n];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}this._flushPassInfo()}},t._flushPassInfo=function(){var e=this._passes;if(e){Tr.set(this._handle,vr.PASS_COUNT,e.length);for(var t=vr.PASS_0,n=vr.SHADER_0,i=0;i<e.length;i++,t++,n++)Tr.set(this._handle,t,e[i].handle),Tr.set(this._handle,n,e[i].getShaderVariant(this._patches))}},Z(e,[{key:"passes",set:function(e){if(this._passes=e,this._flushPassInfo(),this._descriptorSet){rr.free(Tr.get(this._handle,vr.DESCRIPTOR_SET)),Lm.layout=e[0].localSetLayout;var t=rr.alloc(this._device,Lm);Tr.set(this._handle,vr.DESCRIPTOR_SET,t),this._descriptorSet=rr.get(t)}},get:function(){return this._passes}},{key:"subMesh",set:function(e){this._subMesh=e,this._inputAssembler.destroy(),this._inputAssembler.initialize(e.iaInfo),this._passes[0].batchingScheme===vm.VB_MERGING&&this._subMesh.genFlatBuffers(),Tr.set(this._handle,vr.SUB_MESH,e.handle)},get:function(){return this._subMesh}},{key:"priority",set:function(e){this._priority=e,Tr.set(this._handle,vr.PRIORITY,e)},get:function(){return this._priority}},{key:"handle",get:function(){return this._handle}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"planarShaderHandel",get:function(){return Tr.get(this._handle,vr.PLANAR_SHADER)}}]),e}(),zm=e("fk",function(){function e(e){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=e.device,this.pass=e}e.get=function(t,n){void 0===n&&(n=0);var i=e._buffers;i.has(t)||i.set(t,{});var r=i.get(t);return r[n]||(r[n]=new e(t))};var t=e.prototype;return t.destroy=function(){for(var e=0;e<this.instances.length;++e){var t=this.instances[e];t.vb.destroy(),t.ia.destroy()}this.instances.length=0},t.merge=function(e,t,n,i){var r=t.buffer.length;if(r){for(var o=e.inputAssembler,a=e.descriptorSet.getTexture(Yu),s=Tr.get(e.handle,vr.SHADER_0+n),c=Tr.get(e.handle,vr.DESCRIPTOR_SET),l=0;l<this.instances.length;++l){var u=this.instances[l];if(!(u.ia.indexBuffer!==o.indexBuffer||u.count>=1024)&&u.lightingMap===a){if(u.stride!==r)return;if(u.count>=u.capacity){u.capacity<<=1;var h=u.stride*u.capacity,_=u.data;u.data=new Uint8Array(h),u.data.set(_),u.vb.resize(h)}return u.hShader!==s&&(u.hShader=s),u.hDescriptorSet!==c&&(u.hDescriptorSet=c),u.data.set(t.buffer,u.stride*u.count++),void(this.hasPendingModels=!0)}}for(var f=this._device.createBuffer(new Za(oa.VERTEX|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,32*r,r)),d=new Uint8Array(32*r),m=o.vertexBuffers.slice(),p=o.attributes.slice(),v=o.indexBuffer,g=0;g<t.attributes.length;g++){var y=t.attributes[g],x=new us(y.name,y.format,y.isNormalized,m.length,!0);p.push(x)}d.set(t.buffer),m.push(f);var E=new hs(p,m,v),T=this._device.createInputAssembler(E);this.instances.push({count:1,capacity:32,vb:f,data:d,ia:T,stride:r,hShader:s,hDescriptorSet:c,lightingMap:a}),this.hasPendingModels=!0}},t.uploadBuffers=function(e){for(var t=0;t<this.instances.length;++t){var n=this.instances[t];n.count&&(n.ia.instanceCount=n.count,e.updateBuffer(n.vb,n.data))}},t.clear=function(){for(var e=0;e<this.instances.length;++e)this.instances[e].count=0;this.hasPendingModels=!1},e}());zm._buffers=new Map;var Bm,Um=new Zi(Ki.ATTRIBUTE,(function(e,t){return t||new us})),Gm=new ai,Hm=new O_((function(){return new Fm}),32),km=[{name:"CC_RECEIVE_SHADOW",value:!0}];!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SKINNING=1]="SKINNING",e[e.BAKED_SKINNING=2]="BAKED_SKINNING",e[e.BATCH_2D=3]="BATCH_2D",e[e.PARTICLE_BATCH=4]="PARTICLE_BATCH",e[e.LINE=5]="LINE"}(Bm||(Bm=e("bF",{})));var Vm,jm,Wm,qm,Ym,Xm,Km,Qm,Zm,Jm,$m,ep,tp,np,ip,rp,op,ap,sp=df([ga.LINEAR,ga.LINEAR,ga.NONE,ya.CLAMP,ya.CLAMP,ya.CLAMP]),cp=df([ga.LINEAR,ga.LINEAR,ga.LINEAR,ya.CLAMP,ya.CLAMP,ya.CLAMP]),lp=e("aY",function(){function e(){this.type=Bm.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this.instancedAttributes={buffer:null,views:[],attributes:[]},this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._transformUpdated=!0,this._handle=nr,this._hWorldBounds=nr,this._localData=new Float32Array(wu.COUNT),this._localBuffer=null,this._instMatWorldIdx=-1,this._lightmap=null,this._lightmapUVParam=new di,this._device=c.director.root.device}Z(e,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"isInstancingEnabled",get:function(){return this._instMatWorldIdx>=0}},{key:"receiveShadow",get:function(){return!!Cr.get(this._handle,xr.RECEIVE_SHADOW)},set:function(e){Cr.set(this._handle,xr.RECEIVE_SHADOW,e?1:0),this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return!!Cr.get(this._handle,xr.CAST_SHADOW)},set:function(e){Cr.set(this._handle,xr.CAST_SHADOW,e?1:0)}},{key:"handle",get:function(){return this._handle}},{key:"node",get:function(){return this._node},set:function(e){this._node=e,Cr.set(this._handle,xr.NODE,e.handle)}},{key:"transform",get:function(){return this._transform},set:function(e){this._transform=e,Cr.set(this._handle,xr.TRANSFORM,e.handle)}},{key:"visFlags",get:function(){return Cr.get(this._handle,xr.VIS_FLAGS)},set:function(e){Cr.set(this._handle,xr.VIS_FLAGS,e)}},{key:"enabled",get:function(){return!!Cr.get(this._handle,xr.ENABLED)},set:function(e){Cr.set(this._handle,xr.ENABLED,e?1:0)}}]);var t=e.prototype;return t.initialize=function(){if(!this._inited){this._handle=Cr.alloc();var e=cr.alloc(),t=ur.alloc();Cr.set(this._handle,xr.INSTANCED_ATTR_ARRAY,t),Cr.set(this._handle,xr.SUB_MODEL_ARRAY,e),Cr.set(this._handle,xr.VIS_FLAGS,$l.Enum.NONE),Cr.set(this._handle,xr.ENABLED,1),Cr.set(this._handle,xr.RECEIVE_SHADOW,1),Cr.set(this._handle,xr.CAST_SHADOW,0),this._inited=!0}},t.destroy=function(){for(var e=this._subModels,t=0;t<e.length;t++){var n=this._subModels[t];n.destroy(),Hm.free(n)}if(this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._transformUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1,this._handle){var i=Cr.get(this._handle,xr.SUB_MODEL_ARRAY);i&&cr.free(i);var r=Cr.get(this._handle,xr.INSTANCED_BUFFER);r&&mr.free(r);var o=Cr.get(this._handle,xr.INSTANCED_ATTR_ARRAY);o&&er(o,ur,Um),Cr.free(this._handle),this._handle=nr}this._hWorldBounds&&(Nr.free(this._hWorldBounds),this._hWorldBounds=nr)},t.attachToScene=function(e){this.scene=e},t.detachFromScene=function(){this.scene=null},t.updateTransform=function(e){var t=this.transform;if(t.hasChangedFlags||t._dirtyFlags){t.updateWorldTransform(),this._transformUpdated=!0;var n=this._worldBounds;this._modelBounds&&n&&(this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,n),Nr.setVec3(this._hWorldBounds,wr.CENTER,n.center),Nr.setVec3(this._hWorldBounds,wr.HALF_EXTENSION,n.halfExtents))}},t.updateWorldBound=function(){var e=this.transform;if(null!==e){e.updateWorldTransform(),this._transformUpdated=!0;var t=this._worldBounds;this._modelBounds&&t&&(this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,t),Nr.setVec3(this._hWorldBounds,wr.CENTER,t.center),Nr.setVec3(this._hWorldBounds,wr.HALF_EXTENSION,t.halfExtents))}},t.updateUBOs=function(e){for(var t=this._subModels,n=0;n<t.length;n++)t[n].update();if(this._updateStamp=e,this._transformUpdated){this._transformUpdated=!1;var i=this.transform._mat,r=this._instMatWorldIdx;if(r>=0){var o=this.instancedAttributes.views;!function(e,t,n,i){t[0]=e.m00,t[1]=e.m01,t[2]=e.m02,t[3]=e.m12,n[0]=e.m04,n[1]=e.m05,n[2]=e.m06,n[3]=e.m13,i[0]=e.m08,i[1]=e.m09,i[2]=e.m10,i[3]=e.m14}(i,o[r],o[r+1],o[r+2])}else this._localBuffer&&(ai.toArray(this._localData,i,wu.MAT_WORLD_OFFSET),ai.inverseTranspose(Gm,i),ai.toArray(this._localData,Gm,wu.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData))}},t.createBoundingShape=function(e,t){e&&t&&(this._modelBounds=Al.fromPoints(Al.create(),e,t),this._worldBounds=Al.clone(this._modelBounds),this._hWorldBounds===nr&&(this._hWorldBounds=Nr.alloc(),Cr.set(this._handle,xr.WORLD_BOUNDS,this._hWorldBounds)),Nr.setVec3(this._hWorldBounds,wr.CENTER,this._worldBounds.center),Nr.setVec3(this._hWorldBounds,wr.HALF_EXTENSION,this._worldBounds.halfExtents))},t.initSubModel=function(e,t,n){this.initialize();var i=!1;if(null==this._subModels[e]?(this._subModels[e]=Hm.alloc(),i=!0):this._subModels[e].destroy(),this._subModels[e].initialize(t,n.passes,this.getMacroPatches(e)),this._subModels[e].initPlanarShadowShader(),this._updateAttributesAndBinding(e),i){var r=Cr.get(this._handle,xr.SUB_MODEL_ARRAY);cr.assign(r,e,this._subModels[e].handle)}},t.setSubModelMesh=function(e,t){this._subModels[e]&&(this._subModels[e].subMesh=t)},t.setSubModelMaterial=function(e,t){this._subModels[e]&&(this._subModels[e].passes=t.passes,this._updateAttributesAndBinding(e))},t.onGlobalPipelineStateChanged=function(){for(var e=this._subModels,t=0;t<e.length;t++)e[t].onPipelineStateChanged()},t.onMacroPatchesStateChanged=function(){for(var e=this._subModels,t=0;t<e.length;t++)e[t].onMacroPatchesStateChanged(this.getMacroPatches(t))},t.updateLightingmap=function(e,t){di.toArray(this._localData,t,wu.LIGHTINGMAP_UVPARAM),this._lightmap=e,this._lightmapUVParam=t,null===e&&(e=xm.get("empty-texture"));var n=e.getGFXTexture();if(n)for(var i=If.getSampler(this._device,e.mipmaps.length>1?cp:sp),r=this._subModels,o=0;o<r.length;o++){var a=r[o].descriptorSet;a.bindTexture(Yu,n),a.bindSampler(Yu,i),a.update()}},t.getMacroPatches=function(e){return this.receiveShadow?km:null},t._updateAttributesAndBinding=function(e){var t=this._subModels[e];if(t){this._initLocalDescriptors(e),this._updateLocalDescriptors(e,t.descriptorSet);var n=ir.get(Tr.get(t.handle,vr.SHADER_0));this._updateInstancedAttributes(n.attributes,t.passes[0])}},t._getInstancedAttributeIndex=function(e){for(var t=this.instancedAttributes.attributes,n=0;n<t.length;n++)if(t[n].name===e)return n;return-1},t._updateInstancedAttributes=function(e,t){if(t.device.hasFeature(Ba.INSTANCED_ARRAYS)){var n=Cr.get(this._handle,xr.INSTANCED_BUFFER);n&&mr.free(n);var i=Cr.get(this._handle,xr.INSTANCED_ATTR_ARRAY);i&&er(i,ur,Um,!1);for(var r=0,o=0;o<e.length;o++){var a=e[o];a.isInstanced&&(r+=ka[a.format].size)}var s=mr.alloc(r),c=mr.getBuffer(s);Cr.set(this._handle,xr.INSTANCED_BUFFER,s);var l=this.instancedAttributes;l.buffer=new Uint8Array(c),l.views.length=l.attributes.length=0;for(var u=0,h=0;h<e.length;h++){var _=e[h];if(_.isInstanced){var f=Um.alloc(),d=Um.get(f);d.format=_.format,d.name=_.name,d.isNormalized=_.isNormalized,d.location=_.location,l.attributes.push(d),ur.push(i,f);var m=ka[_.format];l.views.push(new(Ya(m))(c,u,m.count)),u+=m.size}}t.batchingScheme===vm.INSTANCING&&zm.get(t).destroy(),this._instMatWorldIdx=this._getInstancedAttributeIndex(bu),this._transformUpdated=!0}},t._initLocalDescriptors=function(e){this._localBuffer||(this._localBuffer=this._device.createBuffer(new Za(oa.UNIFORM|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,wu.SIZE,wu.SIZE)))},t._updateLocalDescriptors=function(e,t){this._localBuffer&&t.bindBuffer(wu.BINDING,this._localBuffer)},e}()),up=e("du",bh("cc.EffectAsset")((Qm=Km=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"techniques",Wm,ie(t)),ae(t,"shaders",qm,ie(t)),ae(t,"combinations",Ym,ie(t)),ae(t,"hideInEditor",Xm,ie(t)),t}$(t,e),t.register=function(e){t._effects[e.name]=e},t.remove=function(e){if(t._effects[e])delete t._effects[e];else for(var n in t._effects)if(t._effects[n]._uuid===e)return void delete t._effects[n]},t.get=function(e){if(t._effects[e])return t._effects[e];for(var n in t._effects)if(t._effects[n]._uuid===e)return t._effects[n];return null},t.getAll=function(){return t._effects};var n=t.prototype;return n.onLoaded=function(){dm.register(this),t.register(this),c.game.once(c.Game.EVENT_ENGINE_INITED,this._precompile,this)},n._precompile=function(){for(var e=this,t=c.director.root,n=function(n){var i=e.shaders[n],r=e.combinations[n];if(!r)return"continue";Object.keys(r).reduce((function(e,t){return e.reduce((function(e,n){var i=r[t],o=[n].concat([].concat(Array(i.length-1)).map((function(){return J({},n)})));return o.forEach((function(e,n){return e[t]=i[n]})),e.concat(o)}),[])}),[{}]).forEach((function(e){return dm.getGFXShader(t.device,i.name,e,t.pipeline)}))},i=0;i<this.shaders.length;i++)n(i)},n.destroy=function(){return t.remove(this.name),e.prototype.destroy.call(this)},t}(Z_),Km._effects={},Wm=se((jm=Qm).prototype,"techniques",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qm=se(jm.prototype,"shaders",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ym=se(jm.prototype,"combinations",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xm=se(jm.prototype,"hideInEditor",[Ph,Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Vm=jm))||Vm);c.EffectAsset=up;var hp=new Ne("RenderTex"),_p=new Os;_p.endLayout=Ra.SHADER_READONLY_OPTIMAL;var fp,dp,mp,pp,vp,gp,yp,xp,Ep,Tp,Sp=new Ns,Ap=new Ms([_p],Sp),Cp={width:1,height:1,renderPassInfo:Ap},wp=e("ej",(Zm=bh("cc.RenderTexture"),Jm=qh(),$m=Yh(),ep=qh(),tp=Yh(),Zm((ap=function(e){function t(){var t;return ae(t=e.call(this)||this,"_width",rp,ie(t)),ae(t,"_height",op,ie(t)),t._textureHash=0,t._id=void 0,t._window=null,t._id=hp.getNewId(),t._textureHash=ls(t._id,666),t}$(t,e);var n=t.prototype;return n.getHash=function(){return this._textureHash},n.initialize=function(e){this._name=e.name||"",this._width=e.width,this._height=e.height,this._initWindow(e)},n.reset=function(e){this.initialize(e)},n.destroy=function(){return this._window&&(c.director.root.destroyWindow(this._window),this._window=null),e.prototype.destroy.call(this)},n.resize=function(e,t){this._width=e,this._height=t,this._window&&this._window.resize(e,t),this.emit("resize",this._window)},n.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},n.getGFXSampler=function(){var e=c.director.root;return If.getSampler(e.device,hf)},n.getSamplerHash=function(){return hf},n.onLoaded=function(){this._initWindow(),this.loaded=!0,this.emit("load")},n._initWindow=function(e){var t=c.director.root;Cp.title=this._name,Cp.width=this._width,Cp.height=this._height,Cp.renderPassInfo=e&&e.passInfo?e.passInfo:Ap,this._window?(this._window.destroy(),this._window.initialize(t.device,Cp)):this._window=t.createWindow(Cp)},Z(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"window",get:function(){return this._window}}]),t}(Z_),rp=se((ip=ap).prototype,"_width",[Ph,Jm,$m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),op=se(ip.prototype,"_height",[Ph,ep,tp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),np=ip))||np));c.RenderTexture=wp;var bp=e("bK",(fp=bh("cc.Material"),dp=n_(up),fp((Tp=function(e){function t(){var t;return ae(t=e.call(this)||this,"_effectAsset",vp,ie(t)),ae(t,"_techIdx",gp,ie(t)),ae(t,"_defines",yp,ie(t)),ae(t,"_states",xp,ie(t)),ae(t,"_props",Ep,ie(t)),t._passes=[],t._hash=0,t.loaded=!1,t}$(t,e),t.getHash=function(e){for(var t,n=0,i=oe(e.passes);!(t=i()).done;)n^=t.value.hash;return n};var n=t.prototype;return n.initialize=function(e){this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),void 0!==e.technique&&(this._techIdx=e.technique),e.effectAsset?this._effectAsset=e.effectAsset:e.effectName&&(this._effectAsset=up.get(e.effectName)),e.defines&&this._prepareInfo(e.defines,this._defines),e.states&&this._prepareInfo(e.states,this._states),this._update()},n.reset=function(e){this.initialize(e)},n.destroy=function(){return this._doDestroy(),e.prototype.destroy.call(this)},n.recompileShaders=function(e,t){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.overridePipelineStates=function(e,t){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.onLoaded=function(){this._update(),this.loaded=!0,this.emit("load")},n.resetUniforms=function(e){void 0===e&&(e=!0),this._props.length=this._passes.length;for(var t=0;t<this._props.length;t++)this._props[t]={};if(e)for(var n,i=oe(this._passes);!(n=i()).done;){var r=n.value;r.resetUBOs(),r.resetTextures()}},n.setProperty=function(e,t,n){var i=!1;if(void 0===n)for(var r=this._passes,o=r.length,a=0;a<o;a++){var s=r[a];this._uploadProperty(s,e,t)&&(this._props[s.propertyIndex][e]=t,i=!0)}else{if(n>=this._passes.length)return void console.warn("illegal pass index: "+n+".");var c=this._passes[n];this._uploadProperty(c,e,t)&&(this._props[c.propertyIndex][e]=t,i=!0)}i||console.warn("illegal property name: "+e+".")},n.getProperty=function(e,t){if(void 0===t)for(var n=this._props,i=n.length,r=0;r<i;r++){var o=n[r];if(e in o)return o[e]}else{if(t>=this._props.length)return console.warn("illegal pass index: "+t+"."),null;var a=this._props[this._passes[t].propertyIndex];if(e in a)return a[e]}return null},n.copy=function(e){this._techIdx=e._techIdx,this._props.length=e._props.length;for(var t=0;t<e._props.length;t++)this._props[t]=J({},e._props[t]);this._defines.length=e._defines.length;for(var n=0;n<e._defines.length;n++)this._defines[n]=J({},e._defines[n]);this._states.length=e._states.length;for(var i=0;i<e._states.length;i++)this._states[i]=J({},e._states[i]);this._effectAsset=e._effectAsset,this._update()},n._prepareInfo=function(e,t){var n=e;if(!Array.isArray(n)){var i=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(i).fill(n)}for(var r=0;r<n.length;++r)Object.assign(t[r]||(t[r]={}),n[r])},n._createPasses=function(){var e=this._effectAsset.techniques[this._techIdx||0];if(!e)return[];for(var t=e.passes.length,n=[],i=0;i<t;++i){var r=e.passes[i],o=r.passIndex=i,a=r.defines=this._defines[o]||(this._defines[o]={}),s=r.stateOverrides=this._states[o]||(this._states[o]={});if(void 0!==r.propertyIndex&&(Object.assign(a,this._defines[r.propertyIndex]),Object.assign(s,this._states[r.propertyIndex])),void 0!==r.embeddedMacros&&Object.assign(a,r.embeddedMacros),!r.switch||a[r.switch]){var l=new Cm(c.director.root);l.initialize(r),n.push(l)}}return n},n._update=function(e){var n=this;if(void 0===e&&(e=!0),this._effectAsset){if(this._passes&&this._passes.length)for(var i,r=oe(this._passes);!(i=r()).done;)i.value.destroy();this._passes=this._createPasses();var o=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=o,e)this._passes.forEach((function(e,t){var i=n._props[t];for(var r in i||(i=n._props[t]={}),void 0!==e.propertyIndex&&Object.assign(i,n._props[e.propertyIndex]),i)n._uploadProperty(e,r,i[r])}));else for(var a=0;a<this._props.length;a++)this._props[a]={}}else{var s=xm.get("missing-effect-material");s&&(this._passes=s._passes.slice())}this._hash=t.getHash(this)},n._uploadProperty=function(e,t,n){var i=e.getHandle(t);if(!i)return!1;var r=Cm.getPropertyTypeFromHandle(i);if(r===jd.UBO)Array.isArray(n)?e.setUniformArray(i,n):null!==n?e.setUniform(i,n):e.resetUniform(t);else if(r===jd.SAMPLER)if(Array.isArray(n))for(var o=0;o<n.length;o++)this._bindTexture(e,i,n[o],o);else n?this._bindTexture(e,i,n):e.resetTexture(t);return!0},n._bindTexture=function(e,t,n,i){var r=Cm.getBindingFromHandle(t);if(n instanceof qs)e.bindTexture(r,n,i);else if(n instanceof Of||n instanceof wp){var o=n.getGFXTexture();if(!o||!o.width||!o.height)return;e.bindTexture(r,o,i),e.bindSampler(r,n.getGFXSampler(),i)}},n._doDestroy=function(){if(this._passes&&this._passes.length)for(var e,t=oe(this._passes);!(e=t()).done;)e.value.destroy();this._effectAsset=null,this._passes.length=0,this._props.length=0,this._defines.length=0,this._states.length=0},Z(t,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),t}(Z_),vp=se((pp=Tp).prototype,"_effectAsset",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gp=se(pp.prototype,"_techIdx",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yp=se(pp.prototype,"_defines",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xp=se(pp.prototype,"_states",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ep=se(pp.prototype,"_props",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mp=pp))||mp));c.Material=bp;var Ip=St({Planar:0,ShadowMap:1}),Rp=St({HARD:0,FILTER_X5:1,FILTER_X9:2,FILTER_X25:3}),Op=Ip.ShadowMap+1,Np=function(){function e(){this.sphere=new $o(0,0,0,.01),this.maxReceived=4,this._normal=new Wn(0,1,0),this._shadowColor=new Vn(0,0,0,76),this._matLight=new ai,this._material=null,this._instancingMaterial=null,this._size=new ui(512,512),this._handle=nr,this._handle=so.alloc()}Z(e,[{key:"enabled",get:function(){return!!so.get(this._handle,io.ENABLE)},set:function(e){so.set(this._handle,io.ENABLE,e?1:0),e||so.set(this._handle,io.TYPE,Op),this.activate()}},{key:"normal",get:function(){return this._normal},set:function(e){Wn.copy(this._normal,e),so.setVec3(this._handle,io.NORMAL,this._normal)}},{key:"distance",get:function(){return so.get(this._handle,io.DISTANCE)},set:function(e){so.set(this._handle,io.DISTANCE,e)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(e){this._shadowColor=e,so.setVec4(this._handle,io.COLOR,e)}},{key:"type",get:function(){return so.get(this._handle,io.TYPE)},set:function(e){so.set(this._handle,io.TYPE,this.enabled?e:Op),this.activate()}},{key:"near",get:function(){return so.get(this._handle,io.NEAR)},set:function(e){so.set(this._handle,io.NEAR,e)}},{key:"far",get:function(){return so.get(this._handle,io.FAR)},set:function(e){so.set(this._handle,io.FAR,e)}},{key:"aspect",get:function(){return so.get(this._handle,io.ASPECT)},set:function(e){so.set(this._handle,io.ASPECT,e)}},{key:"orthoSize",get:function(){return so.get(this._handle,io.ORTHO_SIZE)},set:function(e){so.set(this._handle,io.ORTHO_SIZE,e)}},{key:"size",get:function(){return this._size},set:function(e){this._size=e,so.setVec2(this._handle,io.SIZE,this._size)}},{key:"pcf",get:function(){return so.get(this._handle,io.PCF_TYPE)},set:function(e){so.set(this._handle,io.PCF_TYPE,e)}},{key:"shadowMapDirty",get:function(){return!!so.get(this._handle,io.SHADOW_MAP_DIRTY)},set:function(e){so.set(this._handle,io.SHADOW_MAP_DIRTY,e?1:0)}},{key:"bias",get:function(){return so.get(this._handle,io.BIAS)},set:function(e){so.set(this._handle,io.BIAS,e)}},{key:"autoAdapt",get:function(){return!!so.get(this._handle,io.AUTO_ADAPT)},set:function(e){so.set(this._handle,io.AUTO_ADAPT,e?1:0)}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.getPlanarShader=function(e){return this._material||(this._material=new bp,this._material.initialize({effectName:"planar-shadow"}),so.set(this._handle,io.PLANAR_PASS,this._material.passes[0].handle)),this._material.passes[0].getShaderVariant(e)},t.initialize=function(e){so.set(this._handle,io.TYPE,e.enabled?e.type:Op),so.set(this._handle,io.NEAR,e.near),so.set(this._handle,io.FAR,e.far),so.set(this._handle,io.ASPECT,e.aspect),so.set(this._handle,io.ORTHO_SIZE,e.orthoSize),this._size=e.shadowMapSize,so.setVec2(this._handle,io.SIZE,this._size),so.set(this._handle,io.PCF_TYPE,e.pcf),Wn.copy(this._normal,e.normal),so.setVec3(this._handle,io.NORMAL,this._normal),so.set(this._handle,io.DISTANCE,e.distance),this._shadowColor.set(e.shadowColor),so.setVec4(this._handle,io.COLOR,this._shadowColor),so.set(this._handle,io.BIAS,e.bias),so.set(this._handle,io.ENABLE,e.enabled?1:0),this.maxReceived=e.maxReceived,so.set(this._handle,io.AUTO_ADAPT,e.autoAdapt?1:0)},t.activate=function(){if(this.enabled)this.type===Ip.ShadowMap?this._updatePipeline():this._updatePlanarInfo();else{var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=0,e.onGlobalPipelineStateChanged()}},t._updatePlanarInfo=function(){this._material||(this._material=new bp,this._material.initialize({effectName:"planar-shadow"}),so.set(this._handle,io.PLANAR_PASS,this._material.passes[0].handle)),this._instancingMaterial||(this._instancingMaterial=new bp,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}),so.set(this._handle,io.INSTANCE_PASS,this._instancingMaterial.passes[0].handle));var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=0,e.onGlobalPipelineStateChanged()},t._updatePipeline=function(){var e=c.director.root;e.pipeline.macros.CC_RECEIVE_SHADOW=1,e.onGlobalPipelineStateChanged()},t.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this._handle&&(so.free(this._handle),this._handle=nr),this.sphere.destroy()},e}();Np.MAX_FAR=2e3,Np.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),c.Shadows=Np;var Pp=function(e){function t(t,n){var i;(i=e.call(this,t.root)||this)._parent=void 0,i._owner=void 0,i._dontNotify=!1,i._parent=t,i._owner=n,i._doInit(i._parent,!0);for(var r=0;r<i._shaderInfo.blocks.length;r++){var o=i._shaderInfo.blocks[r],a=i._blocks[o.binding],s=i._parent.blocks[o.binding];a.set(s)}i._rootBufferDirty=!0;for(var c=i._parent,l=0;l<i._shaderInfo.samplers.length;l++)for(var u=i._shaderInfo.samplers[l],h=0;h<u.count;h++){var _=c._descriptorSet.getSampler(u.binding,h),f=c._descriptorSet.getTexture(u.binding,h);i._descriptorSet.bindSampler(u.binding,_,h),i._descriptorSet.bindTexture(u.binding,f,h)}return e.prototype.tryCompile.call(ie(i)),i}$(t,e),Z(t,[{key:"parent",get:function(){return this._parent}}]);var n=t.prototype;return n.overridePipelineStates=function(e,t){this._bs.reset(),this._rs.reset(),this._dss.reset(),Cm.fillPipelineInfo(this,e),Cm.fillPipelineInfo(this,t),this._onStateChange()},n.tryCompile=function(t){if(t&&!am(this._defines,t))return!1;var n=e.prototype.tryCompile.call(this);return this._onStateChange(),n},n.beginChangeStatesSilently=function(){this._dontNotify=!0},n.endChangeStatesSilently=function(){this._dontNotify=!1},n._syncBatchingScheme=function(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,yr.set(this._handle,tr.BATCHING_SCHEME,0)},n._onStateChange=function(){yr.set(this._handle,tr.HASH,Cm.getPassHash(this,this._hShaderDefault)),this._owner.onPassStateChange(this._dontNotify)},t}(Cm),Mp=e("c9",function(e){function t(t){var n;return(n=e.call(this)||this)._passes=[],n._parent=void 0,n._owner=void 0,n._subModelIdx=0,n._parent=t.parent,n._owner=t.owner||null,n._subModelIdx=t.subModelIdx||0,n.copy(n._parent),n}$(t,e),Z(t,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]);var n=t.prototype;return n.recompileShaders=function(e,t){if(this._passes&&this.effectAsset)if(void 0===t)for(var n,i=oe(this._passes);!(n=i()).done;)n.value.tryCompile(e);else this._passes[t].tryCompile(e)},n.overridePipelineStates=function(e,t){if(this._passes&&this.effectAsset){var n=this.effectAsset.techniques[this.technique].passes;if(void 0===t)for(var i=0;i<this._passes.length;i++){var r=this._passes[i],o=this._states[i]||(this._states[i]={});for(var a in e)o[a]=e[a];r.overridePipelineStates(n[r.passIndex],o)}else{var s=this._states[t]||(this._states[t]={});for(var c in e)s[c]=e[c];this._passes[t].overridePipelineStates(n[t],s)}}},n.destroy=function(){return this._doDestroy(),!0},n.onPassStateChange=function(e){this._hash=bp.getHash(this),!e&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},n._createPasses=function(){var e=[],t=this._parent.passes;if(!t)return e;for(var n=0;n<t.length;++n)e.push(new Pp(t[n],this));return e},t}(bp)),Dp=null,Lp=null,Fp=function(){function e(){this._envmap=null,this._globalDescriptorSet=null,this._model=null,this._default=null,this._handle=nr,this._handle=to.alloc()}Z(e,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return to.get(this._handle,Zr.ENABLE)},set:function(e){e?this.activate():this._updatePipeline(),to.set(this._handle,Zr.ENABLE,e?1:0)}},{key:"useIBL",get:function(){return to.get(this._handle,Zr.USE_IBL)},set:function(e){to.set(this._handle,Zr.USE_IBL,e?1:0),this._updatePipeline()}},{key:"isRGBE",get:function(){return to.get(this._handle,Zr.IS_RGBE)},set:function(e){e&&(Lp&&Lp.recompileShaders({USE_RGBE_CUBEMAP:e}),this._model&&this._model.setSubModelMaterial(0,Lp)),to.set(this._handle,Zr.IS_RGBE,e?1:0),this._updatePipeline()}},{key:"envmap",get:function(){return this._envmap},set:function(e){this._envmap=e||this._default,this._envmap&&(c.director.root.pipeline.ambient.albedoArray[3]=this._envmap.mipmapLevel,this._updateGlobalBinding())}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.initialize=function(e){to.set(this._handle,Zr.ENABLE,e.enabled?1:0),to.set(this._handle,Zr.USE_IBL,e.useIBL?1:0),to.set(this._handle,Zr.IS_RGBE,e.isRGBE?1:0),this._envmap=e.envmap},t.activate=function(){var e=c.director.root.pipeline;if(this._globalDescriptorSet=e.descriptorSet,this._default=xm.get("default-cube-texture"),this._model||(this._model=c.director.root.createModel(c.renderer.scene.Model),this._model._initLocalDescriptors=function(){}),to.set(this._handle,Zr.MODEL,this._model.handle),this._envmap||(this._envmap=this._default),e.ambient.groundAlbedo[3]=this._envmap.mipmapLevel,Lp)Lp.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE});else{var t=new bp;t.initialize({effectName:"skybox",defines:{USE_RGBE_CUBEMAP:this.isRGBE}}),Lp=new Mp({parent:t})}this.enabled&&(Dp||(Dp=c.utils.createMesh(c.primitives.box({width:2,height:2,length:2}))),this._model.initSubModel(0,Dp.renderingSubMeshes[0],Lp)),this._updateGlobalBinding(),this._updatePipeline()},t._updatePipeline=function(){var e=this.useIBL?this.isRGBE?2:1:0,t=c.director.root,n=t.pipeline;n.macros.CC_USE_IBL!==e&&(n.macros.CC_USE_IBL=e,t.onGlobalPipelineStateChanged())},t._updateGlobalBinding=function(){var e=this.envmap.getGFXTexture(),t=If.getSampler(c.director._device,this.envmap.getSamplerHash());this._globalDescriptorSet.bindSampler(xu,t),this._globalDescriptorSet.bindTexture(xu,e)},t.destroy=function(){this._handle&&(to.free(this._handle),this._handle=nr)},e}();c.Skybox=Fp;var zp,Bp,Up=e("bp",function(e){function t(){var t;return(t=e.call(this)||this)._needUpdate=!1,t._pos=void 0,t._aabb=void 0,t._hAABB=nr,t._aabb=Al.create(),t._pos=new Wn,t}$(t,e),Z(t,[{key:"position",get:function(){return this._pos}},{key:"size",set:function(e){uo.set(this._handle,ao.SIZE,e)},get:function(){return uo.get(this._handle,ao.SIZE)}},{key:"range",set:function(e){uo.set(this._handle,ao.RANGE,e),this._needUpdate=!0},get:function(){return uo.get(this._handle,ao.RANGE)}},{key:"luminance",set:function(e){uo.set(this._handle,ao.ILLUMINANCE,e)},get:function(){return uo.get(this._handle,ao.ILLUMINANCE)}},{key:"aabb",get:function(){return this._aabb}}]);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),this._hAABB=Nr.alloc(),uo.set(this._handle,ao.TYPE,bm.SPHERE),uo.set(this._handle,ao.SIZE,.15),uo.set(this._handle,ao.RANGE,1),uo.set(this._handle,ao.AABB,this._hAABB),uo.set(this._handle,ao.ILLUMINANCE,1700/Om(.15))},n.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var e=uo.get(this._handle,ao.RANGE);Al.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,e,e,e),this._needUpdate=!1,uo.setVec3(this._handle,ao.POSITION,this._pos),Nr.setVec3(this._hAABB,wr.CENTER,this._aabb.center),Nr.setVec3(this._hAABB,wr.HALF_EXTENSION,this._aabb.halfExtents)}},n.destroy=function(){return this._hAABB&&(Nr.free(this._hAABB),this._hAABB=nr),e.prototype.destroy.call(this)},t}(Nm)),Gp=new Wn(0,0,-1),Hp=new Jn,kp=new ai,Vp=new ai,jp=new ai,Wp=new ai,qp=e("br",function(e){function t(){var t;return(t=e.call(this)||this)._dir=new Wn(1,-1,-1),t._range=5,t._spotAngle=Math.cos(Math.PI/6),t._pos=void 0,t._aabb=void 0,t._frustum=void 0,t._angle=0,t._needUpdate=!1,t._hAABB=nr,t._hFrustum=nr,t._aabb=Al.create(),t._frustum=Dl.create(),t._pos=new Wn,t}$(t,e),Z(t,[{key:"position",get:function(){return this._pos}},{key:"size",set:function(e){uo.set(this._handle,ao.SIZE,e)},get:function(){return uo.get(this._handle,ao.SIZE)}},{key:"range",set:function(e){this._range=e,uo.set(this._handle,ao.RANGE,e),this._needUpdate=!0},get:function(){return uo.get(this._handle,ao.RANGE)}},{key:"luminance",set:function(e){uo.set(this._handle,ao.ILLUMINANCE,e)},get:function(){return uo.get(this._handle,ao.ILLUMINANCE)}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return uo.get(this._handle,ao.SPOT_ANGLE)},set:function(e){this._angle=e,uo.set(this._handle,ao.SPOT_ANGLE,Math.cos(.5*e)),this._needUpdate=!0}},{key:"aspect",set:function(e){uo.set(this._handle,ao.ASPECT,e),this._needUpdate=!0},get:function(){return uo.get(this._handle,ao.ASPECT)}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}}]);var n=t.prototype;return n.initialize=function(){e.prototype.initialize.call(this),this._hAABB=Nr.alloc(),this._hFrustum=Kr.alloc(),uo.set(this._handle,ao.TYPE,bm.SPOT),uo.set(this._handle,ao.SIZE,.15),uo.set(this._handle,ao.AABB,this._hAABB),uo.set(this._handle,ao.ILLUMINANCE,1700/Om(.15)),uo.set(this._handle,ao.RANGE,Math.cos(Math.PI/6)),uo.set(this._handle,ao.ASPECT,1),uo.setVec3(this._handle,ao.DIRECTION,this._dir)},n.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),Wn.transformQuat(this._dir,Gp,this._node.getWorldRotation(Hp)),Wn.normalize(this._dir,this._dir),uo.setVec3(this._handle,ao.DIRECTION,this._dir),Al.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(kp),ai.invert(kp,kp),ai.perspective(Vp,this._angle,1,.001,this._range),ai.multiply(jp,Vp,kp),this._frustum.update(jp,Wp),this._needUpdate=!1,uo.setVec3(this._handle,ao.POSITION,this._pos),Nr.setVec3(this._hAABB,wr.CENTER,this._aabb.center),Nr.setVec3(this._hAABB,wr.HALF_EXTENSION,this._aabb.halfExtents),Ll(this._hFrustum,this._frustum))},n.destroy=function(){return this._hAABB&&(Nr.free(this._hAABB),this._hAABB=nr),this._hFrustum&&(Kr.free(this._hFrustum),this._hFrustum=nr),e.prototype.destroy.call(this)},t}(Nm)),Yp=Object.freeze({__proto__:null,Ambient:No,get CameraFOVAxis(){return $u},get CameraProjection(){return eh},get CameraAperture(){return th},get CameraISO(){return nh},get CameraShutter(){return ih},SKYBOX_FLAG:mh,Camera:vh,CameraVisFlags:wm,VisibilityFlags:Im,DirectionalLight:Dm,ColorTemperatureToRGB:Rm,get LightType(){return bm},nt2lm:Om,Light:Nm,get ModelType(){return Bm},Model:lp,ShadowType:Ip,PCFType:Rp,Shadows:Np,RenderScene:gh,Skybox:Fp,SphereLight:Up,SpotLight:qp,SubModel:Fm});function Xp(e){return--e,e|=e>>16,e|=e>>8,e|=e>>4,e|=e>>2,e|=e>>1,++e}function Kp(e,t){return Math.ceil(e/t)*t}!function(e){e[e.OPAQUE=0]="OPAQUE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OVERLAY=2]="OVERLAY"}(zp||(zp={})),function(e){e[e.DEFAULT=1]="DEFAULT",e[e.FORWARD=2]="FORWARD",e[e.SHADOWCAST=4]="SHADOWCAST"}(Bp||(Bp={}));var Qp=e("bv",function(){function e(e){this._device=void 0,this._format=ra.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new xs,this._region1=new xs,this._region2=new xs,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=e}var t=e.prototype;return t.initialize=function(e){var t=ka[e.format];this._format=e.format,this._formatSize=t.size,this._channels=t.count,this._bufferViewCtor=Ya(t),this._roundUpFn=e.roundUpFn||null,this._alignment=e.alignment||1,e.inOrderFree&&(this.alloc=this._McDonaldAlloc)},t.destroy=function(){for(var e=0;e<this._chunkCount;++e)this._chunks[e].texture.destroy();this._chunks.length=0,this._handles.length=0},t.alloc=function(e,t){e=Kp(e,this._alignment);var n=-1,i=-1;if(void 0!==t&&(n=t,i=this._findAvailableSpace(e,n)),i<0)for(var r=0;r<this._chunkCount&&(n=r,!((i=this._findAvailableSpace(e,n))>=0));++r);if(i>=0){var o=this._chunks[n];o.start+=e;var a={chunkIdx:n,start:i,end:i+e,texture:o.texture};return this._handles.push(a),a}var s=Math.sqrt(e/this._formatSize),c=this._roundUpFn&&this._roundUpFn(s,this._formatSize)||Math.max(1024,Xp(s)),l=this._chunks[this.createChunk(c)];l.start+=e;var u={chunkIdx:this._chunkCount-1,start:0,end:e,texture:l.texture};return this._handles.push(u),u},t.free=function(e){for(var t=0;t<this._handles.length;++t)if(this._handles[t]===e)return this._chunks[e.chunkIdx].end=e.end,void this._handles.splice(t,1)},t.createChunk=function(e){var t=e*e*this._formatSize;console.info("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+t+", format: "+this._format);var n={texture:this._device.createTexture(new Vs(xa.TEX2D,Ea.SAMPLED|Ea.TRANSFER_DST,this._format,e,e,Sa.IMMUTABLE)),size:t,start:0,end:t};return this._chunks[this._chunkCount]=n,this._chunkCount++},t.update=function(e,t){var n=[],i=[],r=e.start/this._formatSize,o=t.byteLength/this._formatSize,a=r%e.texture.width,s=Math.floor(r/e.texture.width),c=Math.min(e.texture.width-a,o),l=0;a>0&&(this._region0.texOffset.x=a,this._region0.texOffset.y=s,this._region0.texExtent.width=c,this._region0.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region0),a=0,s+=1,o-=c,l+=c),o>0&&(this._region1.texOffset.x=a,this._region1.texOffset.y=s,o>e.texture.width?(this._region1.texExtent.width=e.texture.width,this._region1.texExtent.height=Math.floor(o/e.texture.width),c=this._region1.texExtent.width*this._region1.texExtent.height):(c=o,this._region1.texExtent.width=c,this._region1.texExtent.height=1),n.push(new this._bufferViewCtor(t,l*this._formatSize,c*this._channels)),i.push(this._region1),a=0,s+=this._region1.texExtent.height,o-=c,l+=c),o>0&&(this._region2.texOffset.x=a,this._region2.texOffset.y=s,this._region2.texExtent.width=o,this._region2.texExtent.height=1,n.push(new this._bufferViewCtor(t,l*this._formatSize,o*this._channels)),i.push(this._region2)),this._device.copyBuffersToTexture(n,e.texture,i)},t._findAvailableSpace=function(e,t){var n=this._chunks[t],i=!1,r=n.start;if(r+e<=n.size)i=!0;else{r=0;for(var o=this._handles.filter((function(e){return e.chunkIdx===t})).sort((function(e,t){return e.start-t.start})),a=0;a<o.length;a++){var s=o[a];if(r+e<=s.start){i=!0;break}r=s.end}!i&&r+e<=n.size&&(i=!0)}return i?r:-1},t._McDonaldAlloc=function(e){e=Kp(e,this._alignment);for(var t=0;t<this._chunkCount;++t){var n=this._chunks[t],i=!1,r=n.start;if(r+e<=n.end?i=!0:r>n.end?r+e<=n.size?i=!0:e<=n.end&&(n.start=r=0,i=!0):r===n.end&&(n.start=r=0,n.end=n.size,e<=n.end&&(i=!0)),i){n.start+=e;var o={chunkIdx:t,start:r,end:r+e,texture:n.texture};return this._handles.push(o),o}}var a=Math.sqrt(e/this._formatSize),s=this._roundUpFn&&this._roundUpFn(a,this._formatSize)||Math.max(1024,Xp(a)),c=this._chunks[this.createChunk(s)];c.start+=e;var l={chunkIdx:this._chunkCount,start:0,end:e,texture:c.texture};return this._handles.push(l),l},e}()),Zp=function(e){if(void 0===le[e]){var t=1<<ce;le[e]=t,ce+=1}},Jp=Object.freeze({__proto__:null,addStage:Zp,scene:Yp,createIA:function(e,t){if(!t.positions)return console.error("The data must have positions field"),null;for(var n=[],i=t.positions.length/3,r=0;r<i;++r)n.push(t.positions[3*r],t.positions[3*r+1],t.positions[3*r+2]),t.normals&&n.push(t.normals[3*r],t.normals[3*r+1],t.normals[3*r+2]),t.uvs&&n.push(t.uvs[2*r],t.uvs[2*r+1]),t.colors&&n.push(t.colors[3*r],t.colors[3*r+1],t.colors[3*r+2]);var o=[];o.push(new us(na.ATTR_POSITION,ra.RGB32F)),t.normals&&o.push(new us(na.ATTR_NORMAL,ra.RGB32F)),t.uvs&&o.push(new us(na.ATTR_TEX_COORD,ra.RG32F)),t.colors&&o.push(new us(na.ATTR_COLOR,ra.RGB32F));var a=e.createBuffer(new Za(oa.VERTEX|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,4*n.length,4*n.length/i));a.update(new Float32Array(n));var s=null;return t.indices&&(s=e.createBuffer(new Za(oa.INDEX|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,2*t.indices.length,2))).update(new Uint16Array(t.indices)),e.createInputAssembler(new hs(o,[a],s))},get RenderQueue(){return zp},get PassStage(){return Bp},get PropertyType(){return jd},genHandle:Qd,getPropertyTypeFromHandle:Zd,getTypeFromHandle:Jd,getSetIndexFromHandle:function(e){return(e&Xd)>>>20},getBindingFromHandle:$d,getOffsetFromHandle:em,customizeType:tm,type2reader:nm,type2writer:im,getDefaultFromType:om,overrideMacros:am,get BatchingSchemes(){return vm},Pass:Cm,getDeviceShaderVersion:fm,programLib:dm,get SamplerInfoIndex(){return cf},defaultSamplerHash:hf,genSamplerHash:df,samplerLib:If,nearestPOT:Xp,TextureBufferPool:Qp,MaterialInstance:Mp,PassInstance:Pp,ObjectPool:Zi,freeHandleArray:er,get PoolType(){return Ki},NULL_HANDLE:nr,ShaderPool:ir,DSPool:rr,IAPool:or,PipelineLayoutPool:ar,FramebufferPool:sr,SubModelArrayPool:cr,ModelArrayPool:lr,AttributeArrayPool:ur,FlatBufferArrayPool:hr,LightArrayPool:_r,BlendTargetArrayPool:fr,UIBatchArrayPool:dr,RawBufferPool:mr,RawObjectPool:pr,get PassView(){return tr},PassPool:yr,get SubModelView(){return vr},SubModelPool:Tr,get ModelView(){return xr},ModelPool:Cr,get BatchView2D(){return Sr},BatchPool2D:Ir,get AABBView(){return wr},AABBPool:Nr,get SceneView(){return Rr},ScenePool:Dr,get CameraView(){return Pr},CameraPool:zr,get NodeView(){return Lr},NodePool:Gr,get RootView(){return Ur},RootPool:Vr,get RenderWindowView(){return Hr},RenderWindowPool:qr,get FrustumView(){return jr},FrustumPool:Kr,get AmbientView(){return Yr},AmbientPool:Jr,get SkyboxView(){return Zr},SkyboxPool:to,get FogView(){return $r},FogPool:ro,get ShadowsView(){return io},ShadowsPool:so,get LightView(){return ao},LightPool:uo,get SphereView(){return co},SpherePool:fo,get FlatBufferView(){return _o},FlatBufferPool:vo,get SubMeshView(){return mo},SubMeshPool:xo,get RasterizerStateView(){return go},RasterizerStatePool:So,get DepthStencilStateView(){return Eo},DepthStencilStatePool:wo,get BlendTargetView(){return Ao},BlendTargetPool:Io,get BlendStateView(){return bo},BlendStatePool:Oo});function $p(e){return e*e}function ev(e){return e*(2-e)}function tv(e){return e*e*e}function nv(e){return--e*e*e+1}function iv(e){return e*e*e*e}function rv(e){return 1- --e*e*e*e}function ov(e){return e*e*e*e*e}function av(e){return--e*e*e*e*e+1}function sv(e){return 1-Math.cos(e*Math.PI/2)}function cv(e){return Math.sin(e*Math.PI/2)}function lv(e){return 0===e?0:Math.pow(1024,e-1)}function uv(e){return 1===e?1:1-Math.pow(2,-10*e)}function hv(e){return 1-Math.sqrt(1-e*e)}function _v(e){return Math.sqrt(1- --e*e)}function fv(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4))}function dv(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)}function mv(e){var t=1.70158;return e*e*((t+1)*e-t)}function pv(e){var t=1.70158;return--e*e*((t+1)*e+t)+1}function vv(e){return 1-gv(1-e)}function gv(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}e("dF",Jp);var yv=Rv($p,ev),xv=Rv(tv,nv),Ev=Rv(iv,rv),Tv=Rv(ov,av),Sv=Rv(sv,cv),Av=Rv(lv,uv),Cv=Rv(hv,_v),wv=Rv(fv,dv),bv=Rv(mv,pv),Iv=Rv(vv,gv);function Rv(e,t){return function(n){return n<.5?t(2*n)/2:e(2*n-1)/2+.5}}var Ov,Nv=Object.freeze({__proto__:null,constant:function(){return 0},linear:function(e){return e},quadIn:$p,quadOut:ev,quadInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:tv,cubicOut:nv,cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quartIn:iv,quartOut:rv,quartInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quintIn:ov,quintOut:av,quintInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sineIn:sv,sineOut:cv,sineInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},expoIn:lv,expoOut:uv,expoInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circIn:hv,circOut:_v,circInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:fv,elasticOut:dv,elasticInOut:function(e){var t,n=.1;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=.1):t=.4*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)},backIn:mv,backOut:pv,backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:vv,bounceOut:gv,bounceInOut:function(e){return e<.5?.5*vv(2*e):.5*gv(2*e-1)+.5},smooth:function(e){return e<=0?0:e>=1?1:e*e*(3-2*e)},fade:function(e){return e<=0?0:e>=1?1:e*e*e*(e*(6*e-15)+10)},quadOutIn:yv,cubicOutIn:xv,quartOutIn:Ev,quintOutIn:Tv,sineOutIn:Sv,expoOutIn:Av,circOutIn:Cv,elasticOutIn:wv,backOutIn:bv,bounceOutIn:Iv});e("ds",Nv),function(e){e[e.NONE=0]="NONE",e[e.LAN=1]="LAN",e[e.WWAN=2]="WWAN"}(Ov||(Ov={}));var Pv,Mv,Dv,Lv,Fv,zv,Bv,Uv,Gv,Hv,kv,Vv=e("ae",{NetworkType:Ov,LANGUAGE_ENGLISH:"en",LANGUAGE_CHINESE:"zh",LANGUAGE_FRENCH:"fr",LANGUAGE_ITALIAN:"it",LANGUAGE_GERMAN:"de",LANGUAGE_SPANISH:"es",LANGUAGE_DUTCH:"du",LANGUAGE_RUSSIAN:"ru",LANGUAGE_KOREAN:"ko",LANGUAGE_JAPANESE:"ja",LANGUAGE_HUNGARIAN:"hu",LANGUAGE_PORTUGUESE:"pt",LANGUAGE_ARABIC:"ar",LANGUAGE_NORWEGIAN:"no",LANGUAGE_POLISH:"pl",LANGUAGE_TURKISH:"tr",LANGUAGE_UKRAINIAN:"uk",LANGUAGE_ROMANIAN:"ro",LANGUAGE_BULGARIAN:"bg",LANGUAGE_UNKNOWN:"unknown",OS_IOS:"iOS",OS_ANDROID:"Android",OS_WINDOWS:"Windows",OS_LINUX:"Linux",OS_OSX:"OS X",OS_UNKNOWN:"Unknown",UNKNOWN:-1,WIN32:0,LINUX:1,MACOS:2,ANDROID:3,IPHONE:4,IPAD:5,BLACKBERRY:6,NACL:7,EMSCRIPTEN:8,TIZEN:9,WINRT:10,WP8:11,MOBILE_BROWSER:100,DESKTOP_BROWSER:101,EDITOR_PAGE:102,EDITOR_CORE:103,WECHAT_GAME:104,QQ_PLAY:105,FB_PLAYABLE_ADS:106,BAIDU_MINI_GAME:107,VIVO_MINI_GAME:108,OPPO_MINI_GAME:109,HUAWEI_QUICK_GAME:110,XIAOMI_QUICK_GAME:111,COCOSPLAY:112,ALIPAY_MINI_GAME:113,QTT_MINI_GAME:116,BYTEDANCE_MINI_GAME:117,LINKSURE_MINI_GAME:119,BROWSER_TYPE_WECHAT:"wechat",BROWSER_TYPE_ANDROID:"androidbrowser",BROWSER_TYPE_IE:"ie",BROWSER_TYPE_EDGE:"edge",BROWSER_TYPE_QQ:"qqbrowser",BROWSER_TYPE_MOBILE_QQ:"mqqbrowser",BROWSER_TYPE_UC:"ucbrowser",BROWSER_TYPE_UCBS:"ucbs",BROWSER_TYPE_360:"360browser",BROWSER_TYPE_BAIDU_APP:"baiduboxapp",BROWSER_TYPE_BAIDU:"baidubrowser",BROWSER_TYPE_MAXTHON:"maxthon",BROWSER_TYPE_OPERA:"opera",BROWSER_TYPE_OUPENG:"oupeng",BROWSER_TYPE_MIUI:"miuibrowser",BROWSER_TYPE_FIREFOX:"firefox",BROWSER_TYPE_SAFARI:"safari",BROWSER_TYPE_CHROME:"chrome",BROWSER_TYPE_LIEBAO:"liebao",BROWSER_TYPE_QZONE:"qzone",BROWSER_TYPE_SOUGOU:"sogou",BROWSER_TYPE_HUAWEI:"huawei",BROWSER_TYPE_UNKNOWN:"unknown",isNative:!1,isBrowser:"object"==typeof window&&"object"==typeof document,isMobile:!1,isLittleEndian:(Pv=new ArrayBuffer(2),new DataView(Pv).setInt16(0,256,!0),256===new Int16Array(Pv)[0]),platform:-1,language:"unknown",languageCode:"unknown",os:"Unknown",osVersion:"",osMainVersion:0,browserType:"unknown",browserVersion:"",windowPixelResolution:null,capabilities:null,localStorage:null,__audioSupport:null,__videoSupport:null,getNetworkType:function(){return Ov.LAN},getBatteryLevel:function(){return 1},garbageCollect:function(){},isObjectValid:function(e){return null!=e},dump:function(){var e="";e+="isMobile : "+this.isMobile+"\r\n",e+="language : "+this.language+"\r\n",e+="browserType : "+this.browserType+"\r\n",e+="browserVersion : "+this.browserVersion+"\r\n",e+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",e+="os : "+this.os+"\r\n",e+="osVersion : "+this.osVersion+"\r\n",e+="platform : "+this.platform+"\r\n",v(e+="Using "+(c.game.renderType===c.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(e){window.open(e)},now:function(){return Date.now?Date.now():+new Date},restartVM:function(){},getSafeAreaRect:function(){var e=c.view.getVisibleSize();return c.rect(0,0,e.width,e.height)},__init:function(){var e=window,t=e.navigator,n=document,i=n.documentElement,r=t.userAgent.toLowerCase();Vv.isMobile=/mobile|android|iphone|ipad/.test(r),Vv.platform=Vv.isMobile?Vv.MOBILE_BROWSER:Vv.DESKTOP_BROWSER;var o=t.language;Vv.languageCode=o.toLowerCase(),o=(o=o||t.browserLanguage)?o.split("-")[0]:Vv.LANGUAGE_ENGLISH,Vv.language=o;var a=!1,s=!1,c="",l=0,u=/android\s*(\d+(?:\.\d+)*)/i.exec(r)||/android\s*(\d+(?:\.\d+)*)/i.exec(t.platform);u&&(a=!0,c=u[1]||"",l=parseInt(c)||0),(u=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(r))?(s=!0,c=u[2]||"",l=parseInt(c)||0):(/(iPhone|iPad|iPod)/.exec(t.platform)||"MacIntel"===t.platform&&t.maxTouchPoints&&t.maxTouchPoints>1)&&(s=!0,c="",l=0);var h=Vv.OS_UNKNOWN;-1!==t.appVersion.indexOf("Win")?h=Vv.OS_WINDOWS:s?h=Vv.OS_IOS:-1!==t.appVersion.indexOf("Mac")?h=Vv.OS_OSX:-1!==t.appVersion.indexOf("X11")&&-1===t.appVersion.indexOf("Linux")?h=Vv.OS_UNIX:a?h=Vv.OS_ANDROID:-1===t.appVersion.indexOf("Linux")&&-1===r.indexOf("ubuntu")||(h=Vv.OS_LINUX),Vv.os=h,Vv.osVersion=c,Vv.osMainVersion=l,Vv.browserType=Vv.BROWSER_TYPE_UNKNOWN,function(){var e=/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(r)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(r)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(r),t=e?e[0].toLowerCase():Vv.BROWSER_TYPE_UNKNOWN;("safari"===t&&a||"qq"===t&&/android.*applewebkit/i.test(r))&&(t=Vv.BROWSER_TYPE_ANDROID);var n={micromessenger:Vv.BROWSER_TYPE_WECHAT,trident:Vv.BROWSER_TYPE_IE,edge:Vv.BROWSER_TYPE_EDGE,"360 aphone":Vv.BROWSER_TYPE_360,mxbrowser:Vv.BROWSER_TYPE_MAXTHON,"opr/":Vv.BROWSER_TYPE_OPERA,ubrowser:Vv.BROWSER_TYPE_UC,huaweibrowser:Vv.BROWSER_TYPE_HUAWEI};Vv.browserType=n[t]||t}(),Vv.browserVersion="",function(){var e=/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i.exec(r);e||(e=/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i.exec(r)),Vv.browserVersion=e?e[4]:""}();var _=window.innerWidth||document.documentElement.clientWidth,f=window.innerHeight||document.documentElement.clientHeight,d=window.devicePixelRatio||1;Vv.windowPixelResolution={width:d*_,height:d*f};var m,p=document.createElement("canvas");try{var v=Vv.localStorage=e.localStorage;v.setItem("storage",""),v.removeItem("storage"),v=null}catch(e){var g=function(){b(5200)};Vv.localStorage={getItem:g,setItem:g,removeItem:g,clear:g}}try{m=p.toDataURL("image/webp").startsWith("data:image/webp")}catch(e){m=!1}var y=!!p.getContext("2d"),x=!1;e.WebGLRenderingContext&&(x=!0);var E,T=Vv.capabilities={canvas:y,opengl:x,webp:m,imageBitmap:!1,touches:!1,mouse:!1,keyboard:!1,accelerometer:!1};"undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob&&(p.width=p.height=2,createImageBitmap(p,{}).then((function(e){T.imageBitmap=!0,e.close&&e.close()})).catch((function(e){}))),(void 0!==i.ontouchstart||void 0!==n.ontouchstart||t.msPointerEnabled)&&(T.touches=!0),void 0!==i.onmouseup&&(T.mouse=!0),void 0!==i.onkeyup&&(T.keyboard=!0),(e.DeviceMotionEvent||e.DeviceOrientationEvent)&&(T.accelerometer=!0),E={ONLY_ONE:!1,WEB_AUDIO:!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),DELAY_CREATE_CTX:!1},Vv.os===Vv.OS_IOS&&(E.USE_LOADER_EVENT="loadedmetadata"),Vv.browserType===Vv.BROWSER_TYPE_FIREFOX&&(E.DELAY_CREATE_CTX=!0,E.USE_LOADER_EVENT="canplay"),Vv.os===Vv.OS_ANDROID&&Vv.browserType===Vv.BROWSER_TYPE_UC&&(E.ONE_SOURCE=!0);try{E.WEB_AUDIO&&(E._context=null,Object.defineProperty(E,"context",{get:function(){return this._context?this._context:this._context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}}))}catch(e){E.WEB_AUDIO=!1,C(5201)}var S,A=[];(S=document.createElement("audio")).canPlayType&&(S.canPlayType('audio/ogg; codecs="vorbis"')&&A.push(".ogg"),S.canPlayType("audio/mpeg")&&A.push(".mp3"),S.canPlayType('audio/wav; codecs="1"')&&A.push(".wav"),S.canPlayType("audio/mp4")&&A.push(".mp4"),S.canPlayType("audio/x-m4a")&&A.push(".m4a")),E.format=A,Vv.__audioSupport=E,Vv.__videoSupport={format:[]},function(){var e=document.createElement("video");if(e.canPlayType){var t=Vv.__videoSupport.format;["mp4","webm"].forEach((function(n){e.canPlayType("video/"+n)&&t.push("."+n)})),Vv.__videoSupport.format=t}}(),Vv.__isWebIOS14OrIPadOS14Env=(Vv.os===Vv.OS_IOS||Vv.os===Vv.MACOS)&&Vv.isBrowser&&/(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent)}});"object"!=typeof window||"object"!=typeof document||o||a||r||Vv.__init(),c.sys=Vv;var jv,Wv,qv,Yv,Xv,Kv,Qv,Zv,Jv,$v,eg,tg,ng,ig=e("fe",(Mv=bh("RenderStage"),Dv=Qh(),Lv=Qh(),Fv=Qh(),Mv((kv=function(){function e(){ae(this,"_name",Uv,this),ae(this,"_priority",Gv,this),ae(this,"_tag",Hv,this)}var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._priority=e.priority,e.tag&&(this._tag=e.tag),!0},t.activate=function(e,t){this._pipeline=e,this._flow=t},Z(e,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}}]),e}(),Uv=se((Bv=kv).prototype,"_name",[Dv,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Gv=se(Bv.prototype,"_priority",[Lv,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hv=se(Bv.prototype,"_tag",[Fv,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zv=Bv))||zv));c.RenderStage=ig;var rg,og,ag,sg,cg,lg,ug,hg,_g,fg=e("fd",(jv=bh("RenderFlow"),Wv=Qh(),qv=Qh(),Yv=Qh(),Xv=Qh(),Kv=n_([ig]),jv((ng=function(){function e(){ae(this,"_name",Jv,this),ae(this,"_priority",$v,this),ae(this,"_tag",eg,this),ae(this,"_stages",tg,this)}var t=e.prototype;return t.initialize=function(e){return this._name=e.name,this._priority=e.priority,this._stages=e.stages,e.tag&&(this._tag=e.tag),!0},t.activate=function(e){this._pipeline=e,this._stages.sort((function(e,t){return e.priority-t.priority}));for(var t=0,n=this._stages.length;t<n;t++)this._stages[t].activate(e,this)},t.render=function(e){for(var t=0,n=this._stages.length;t<n;t++)this._stages[t].render(e)},t.destroy=function(){for(var e=0,t=this._stages.length;e<t;e++)this._stages[e].destroy();this._stages.length=0},Z(e,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}}]),e}(),Jv=se((Zv=ng).prototype,"_name",[Wv,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$v=se(Zv.prototype,"_priority",[qv,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eg=se(Zv.prototype,"_tag",[Yv,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tg=se(Zv.prototype,"_stages",[Xv,Kv,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qv=Zv))||Qv));c.RenderFlow=fg;var dg,mg,pg=e("fc",(rg=bh("cc.RenderPipeline"),og=Qh(),ag=Qh(),sg=n_([fg]),rg((_g=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"_tag",ug,ie(t)),ae(t,"_flows",hg,ie(t)),t._macros={},t._commandBuffers=[],t}$(t,e);var n=t.prototype;return n.initialize=function(e){return this._flows=e.flows,e.tag&&(this._tag=e.tag),!0},n.activate=function(){this._device=c.director.root.device;var e=new $s(ou.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(e),this._descriptorSet=this._device.createDescriptorSet(new Qs(this._descriptorSetLayout));for(var t=0;t<this._flows.length;t++)this._flows[t].activate(this);return!0},n.render=function(e){for(var t=0;t<this.flows.length;t++)for(var n=0;n<e.length;n++){var i=e[n];this.flows[t].render(i)}},n.destroy=function(){for(var t=0;t<this._flows.length;t++)this._flows[t].destroy();this._flows.length=0,this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null);for(var n=0;n<this._commandBuffers.length;n++)this._commandBuffers[n].destroy();return this._commandBuffers.length=0,e.prototype.destroy.call(this)},Z(t,[{key:"macros",get:function(){return this._macros}},{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"device",get:function(){return this._device}},{key:"descriptorSetLayout",get:function(){return this._descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}}]),t}(Z_),ug=se((lg=_g).prototype,"_tag",[og,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hg=se(lg.prototype,"_flows",[ag,sg,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cg=lg))||cg));c.RenderPipeline=pg,function(e){e[e.FORWARD=10]="FORWARD",e[e.UI=20]="UI"}(dg||(dg={})),function(e){e[e.SHADOW=0]="SHADOW",e[e.FORWARD=1]="FORWARD",e[e.UI=10]="UI"}(mg||(mg={}));var vg=e("fl",function(){function e(){}return e.getOrCreatePipelineState=function(e,t,n,i,r){var o=t.handle,a=yr.get(o,tr.HASH)^i.hash^r.attributesHash^n.id,s=this._PSOHashMap.get(a);if(!s){var c=ar.get(yr.get(o,tr.PIPELINE_LAYOUT)),l=new Cs(r.attributes),u=new ws(n,c,i,l,t.rasterizerState,t.depthStencilState,t.blendState,yr.get(o,tr.PRIMITIVE),yr.get(o,tr.DYNAMIC_STATES));s=e.createPipelineState(u),this._PSOHashMap.set(a,s)}return s},e}());function gg(e,t){return e.hash-t.hash||e.depth-t.depth||e.shaderId-t.shaderId}function yg(e,t){return e.hash-t.hash||t.depth-e.depth||e.shaderId-t.shaderId}vg._PSOHashMap=new Map;var xg=function(){function e(e){this.queue=void 0,this._passDesc=void 0,this._passPool=void 0,this._passDesc=e,this._passPool=new N_((function(){return{hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64),this.queue=new P_(64,this._passDesc.sortFunc)}var t=e.prototype;return t.clear=function(){this.queue.clear(),this._passPool.reset()},t.insertRenderPass=function(e,t,n){var i=e.model.subModels[t],r=Tr.get(i.handle,vr.PASS_0+n);if(i.passes[n].blendState.targets[0].blend!==this._passDesc.isTransparent||!(yr.get(r,tr.PHASE)&this._passDesc.phases))return!1;var o=0|yr.get(r,tr.PRIORITY)<<16|i.priority<<8|n,a=this._passPool.add();return a.hash=o,a.depth=e.depth||0,a.shaderId=Tr.get(i.handle,vr.SHADER_0+n),a.subModel=i,a.passIdx=n,this.queue.push(a),!0},t.sort=function(){this.queue.sort()},t.recordCommandBuffer=function(e,t,n){for(var i=0;i<this.queue.length;++i){var r=this.queue.array[i],o=r.subModel,a=r.passIdx,s=o.inputAssembler,c=o.handle,l=o.passes[a],u=ir.get(Tr.get(c,vr.SHADER_0+a)),h=vg.getOrCreatePipelineState(e,l,u,t,s);n.bindPipelineState(h),n.bindDescriptorSet(uu.MATERIAL,l.descriptorSet),n.bindDescriptorSet(uu.LOCAL,o.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},e}(),Eg=function(){function e(){this.queue=new Set}var t=e.prototype;return t.clear=function(){for(var e=this.queue.values(),t=e.next();!t.done;)t.value.clear(),t=e.next();this.queue.clear()},t.uploadBuffers=function(e){for(var t=this.queue.values(),n=t.next();!n.done;){for(var i=0;i<n.value.batches.length;++i){var r=n.value.batches[i];if(r.mergeCount){for(var o=0;o<r.vbs.length;++o)r.vbs[o].update(r.vbDatas[o]);e.updateBuffer(r.vbIdx,r.vbIdxData.buffer),e.updateBuffer(r.ubo,r.uboData)}}n=t.next()}},t.recordCommandBuffer=function(e,t,n){for(var i=this.queue.values(),r=i.next();!r.done;){for(var o=!1,a=0;a<r.value.batches.length;++a){var s=r.value.batches[a];if(s.mergeCount){if(!o){var c=ir.get(s.hShader),l=vg.getOrCreatePipelineState(e,s.pass,c,t,s.ia);n.bindPipelineState(l),n.bindDescriptorSet(uu.MATERIAL,s.pass.descriptorSet),o=!0}n.bindDescriptorSet(uu.LOCAL,s.descriptorSet,r.value.dynamicOffsets),n.bindInputAssembler(s.ia),n.draw(s.ia)}}r=i.next()}},e}(),Tg=function(){function e(){this.queue=new Set}var t=e.prototype;return t.clear=function(){for(var e=this.queue.values(),t=e.next();!t.done;)t.value.clear(),t=e.next();this.queue.clear()},t.uploadBuffers=function(e){for(var t=this.queue.values(),n=t.next();!n.done;)n.value.hasPendingModels&&n.value.uploadBuffers(e),n=t.next()},t.recordCommandBuffer=function(e,t,n){for(var i=this.queue.values(),r=i.next();!r.done;){var o=r.value,a=o.instances,s=o.pass;if(o.hasPendingModels){n.bindDescriptorSet(uu.MATERIAL,s.descriptorSet);for(var c=null,l=0;l<a.length;++l){var u=a[l];if(u.count){var h=ir.get(u.hShader),_=vg.getOrCreatePipelineState(e,s,h,t,u.ia);c!==_&&(n.bindPipelineState(_),c=_),n.bindDescriptorSet(uu.LOCAL,rr.get(u.hDescriptorSet),r.value.dynamicOffsets),n.bindInputAssembler(u.ia),n.draw(u.ia)}}}r=i.next()}},e}(),Sg=function(){function e(e){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=e.device}e.get=function(t,n){void 0===n&&(n=0);var i=e._buffers;i.has(t)||i.set(t,{});var r=i.get(t);return r[n]||(r[n]=new e(t))};var t=e.prototype;return t.destroy=function(){for(var e=0;e<this.batches.length;++e){for(var t=this.batches[e],n=0;n<t.vbs.length;++n)t.vbs[n].destroy();t.vbIdx.destroy(),t.ia.destroy(),t.ubo.destroy()}this.batches.length=0},t.merge=function(e,t,n){var i=e.subMesh.flatBuffers;if(0!==i.length){for(var r=0,o=0,a=i[0].count,s=e.passes[t],c=Tr.get(e.handle,vr.SHADER_0+t),l=e.descriptorSet,u=!1,h=0;h<this.batches.length;++h){var _=this.batches[h];if(_.vbs.length===i.length&&_.mergeCount<Iu.BATCHING_COUNT){u=!0;for(var f=0;f<_.vbs.length;++f)if(_.vbs[f].stride!==i[f].stride){u=!1;break}if(u){for(var d=0;d<_.vbs.length;++d){var m=i[d],p=_.vbs[d],v=_.vbDatas[d];(r=(a+_.vbCount)*m.stride)>p.size&&(p.resize(r),_.vbDatas[d]=new Uint8Array(r),_.vbDatas[d].set(v)),_.vbDatas[d].set(m.buffer,_.vbCount*m.stride)}var g=_.vbIdxData;(o=4*(a+_.vbCount))>_.vbIdx.size&&(_.vbIdx.resize(o),_.vbIdxData=new Float32Array(o/Float32Array.BYTES_PER_ELEMENT),_.vbIdxData.set(g),g=_.vbIdxData);var y=_.vbCount,x=y+a,E=_.mergeCount;if(g[y]!==E||g[x-1]!==E)for(var T=y;T<x;T++)g[T]=E+.1;return ai.toArray(_.uboData,n.transform.worldMatrix,Iu.MAT_WORLDS_OFFSET+16*_.mergeCount),_.mergeCount||(l.bindBuffer(Iu.BINDING,_.ubo),l.update(),_.pass=s,_.hShader=c,_.descriptorSet=l),++_.mergeCount,_.vbCount+=a,void(_.ia.vertexCount+=a)}}}for(var S=[],A=[],C=[],w=0;w<i.length;++w){var b=i[w],I=this._device.createBuffer(new Za(oa.VERTEX|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,b.count*b.stride,b.stride));I.update(b.buffer.buffer),S.push(I),A.push(new Uint8Array(I.size)),C.push(I)}var R=this._device.createBuffer(new Za(oa.VERTEX|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,4*a,4)),O=new Float32Array(a);O.fill(0),R.update(O),C.push(R);for(var N=e.inputAssembler.attributes,P=new Array(N.length+1),M=0;M<N.length;++M)P[M]=N[M];P[N.length]=new us("a_dyn_batch_id",ra.R32F,!1,i.length);var D=new hs(P,C),L=this._device.createInputAssembler(D),F=this._device.createBuffer(new Za(oa.UNIFORM|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,Iu.SIZE,Iu.SIZE));l.bindBuffer(Iu.BINDING,F),l.update();var z=new Float32Array(Iu.COUNT);ai.toArray(z,n.transform.worldMatrix,Iu.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:S,vbDatas:A,vbIdx:R,vbIdxData:O,vbCount:a,ia:L,ubo:F,uboData:z,pass:s,hShader:c,descriptorSet:l})}},t.clear=function(){for(var e=0;e<this.batches.length;++e){var t=this.batches[e];t.vbCount=0,t.mergeCount=0,t.ia.vertexCount=0}},e}();Sg._buffers=new Map;var Ag=new Wn,Cg=new Wn,wg=new Wn,bg=new ai,Ig=new Al,Rg=!1,Og=[],Ng=$o.create(0,0,0,1),Pg=new O_((function(){return{model:null,depth:0}}),128),Mg=new O_((function(){return{model:null,depth:0}}),128);function Dg(e,t){var n=0;e.node&&(Wn.subtract(Ag,e.node.worldPosition,t.position),n=Wn.dot(Ag,t.forward));var i=Pg.alloc();return i.model=e,i.depth=n,i}function Lg(e,t){var n=0;e.node&&(Wn.subtract(Ag,e.node.worldPosition,t.position),n=Wn.dot(Ag,t.forward));var i=Mg.alloc();return i.model=e,i.depth=n,i}function Fg(e,t,n,i){var r=e.shadows;Wn.negate(Cg,n);var o=r.sphere.radius*Np.COEFFICIENT_OF_EXPANSION;return Wn.multiplyScalar(wg,Cg,o),Wn.add(wg,wg,r.sphere.center),i.set(wg),ai.fromRT(bg,t,wg),bg}function zg(e,t,n){var i=t.direction,r=e.normal,o=e.distance+.001,a=1/Wn.dot(r,i),s=i.x*a,c=i.y*a,l=i.z*a,u=r.x,h=r.y,_=r.z,f=e.matLight;f.m00=1-u*s,f.m01=-u*c,f.m02=-u*l,f.m03=0,f.m04=-h*s,f.m05=1-h*c,f.m06=-h*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*o,f.m13=c*o,f.m14=l*o,f.m15=1,ai.toArray(n,f,pu.MAT_LIGHT_PLANE_PROJ_OFFSET)}var Bg=[ga.LINEAR,ga.LINEAR,ga.NONE,ya.CLAMP,ya.CLAMP,ya.CLAMP],Ug=new O_((function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}}),16),Gg=new Float32Array(4),Hg=$o.create(0,0,0,1),kg=[],Vg=[],jg=new ai,Wg=new ai;function qg(e,t){return!(!t.worldBounds||_l.aabbWithAABB(t.worldBounds,e.aabb))}function Yg(e,t){return!(!t.worldBounds||_l.aabbWithAABB(t.worldBounds,e.aabb)&&_l.aabbFrustum(t.worldBounds,e.frustum))}var Xg=Em("forward-add"),Kg=[];function Qg(e,t){t.length=0;for(var n=!1,i=0;i<e.length;i++){for(var r=e[i].passes,o=-1,a=0;a<r.length;a++)if(r[a].phase===Xg){o=a,n=!0;break}t.push(o)}return n}var Zg,Jg,$g,ey,ty,ny,iy,ry,oy,ay,sy,cy,ly,uy,hy,_y,fy,dy,my,py,vy,gy,yy,xy,Ey,Ty,Sy,Ay,Cy,wy,by,Iy,Ry,Oy,Ny,Py,My,Dy,Ly,Fy,zy,By,Uy,Gy,Hy,ky,Vy,jy,Wy,qy,Yy,Xy,Ky,Qy,Zy,Jy,$y,ex,tx,nx,ix,rx,ox,ax,sx,cx,lx,ux,hx,_x,fx,dx,mx,px,vx,gx,yx,xx,Ex,Tx,Sx=function(){function e(e){this._pipeline=void 0,this._device=void 0,this._validLights=[],this._lightPasses=[],this._descriptorSetMap=new Map,this._globalUBO=new Float32Array(du.COUNT),this._cameraUBO=new Float32Array(mu.COUNT),this._shadowUBO=new Float32Array(pu.COUNT),this._lightBufferCount=16,this._lightBufferStride=void 0,this._lightBufferElementCount=void 0,this._lightBuffer=void 0,this._firstLightBufferView=void 0,this._lightBufferData=void 0,this._isHDR=void 0,this._fpScale=void 0,this._renderObjects=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._lightMeterScale=1e4,this._sampler=null,this._pipeline=e,this._device=e.device,this._isHDR=e.isHDR,this._fpScale=e.fpScale,this._renderObjects=e.renderObjects,this._instancedQueue=new Tg,this._batchedQueue=new Eg,this._lightBufferStride=Math.ceil(Ru.SIZE/this._device.uboOffsetAlignment)*this._device.uboOffsetAlignment,this._lightBufferElementCount=this._lightBufferStride/Float32Array.BYTES_PER_ELEMENT,this._lightBuffer=this._device.createBuffer(new Za(oa.UNIFORM|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,this._lightBufferStride*this._lightBufferCount,this._lightBufferStride)),this._firstLightBufferView=this._device.createBuffer(new Ja(this._lightBuffer,0,Ru.SIZE)),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount);var t=df(Bg);this._sampler=If.getSampler(this._device,t)}var t=e.prototype;return t.clear=function(){this._instancedQueue.clear(),this._batchedQueue.clear(),this._validLights.length=0;for(var e=0;e<this._lightPasses.length;e++){var t=this._lightPasses[e];t.dynamicOffsets.length=0,t.lights.length=0}Ug.freeArray(this._lightPasses),this._lightPasses.length=0},t.destroy=function(){for(var e=Array.from(this._descriptorSetMap.values()),t=0;t<e.length;++t){var n=e[t];n&&(n.getBuffer(du.BINDING).destroy(),n.getBuffer(pu.BINDING).destroy(),n.getSampler(vu).destroy(),n.getSampler(Su).destroy(),n.getTexture(vu).destroy(),n.getTexture(Su).destroy(),n.destroy())}this._descriptorSetMap.clear()},t.gatherLightPasses=function(e,t){var n=this._validLights;if(this.clear(),this._gatherValidLights(e,n),n.length){this._updateUBOs(e,t),this._updateLightDescriptorSet(e,t);for(var i=0;i<this._renderObjects.length;i++){var r=this._renderObjects[i].model,o=r.subModels;if(Qg(o,Kg)&&(Vg.length=0,this._lightCulling(r,n),Vg.length))for(var a=0;a<o.length;a++){var s=Kg[a];if(!(s<0)){var c=o[a],l=c.passes[s];c.descriptorSet.bindBuffer(Ru.BINDING,this._firstLightBufferView),c.descriptorSet.update(),this._addRenderQueue(l,c,r,s,n)}}}this._instancedQueue.uploadBuffers(t),this._batchedQueue.uploadBuffers(t)}},t.recordCommandBuffer=function(e,t,n){this._instancedQueue.recordCommandBuffer(e,t,n),this._batchedQueue.recordCommandBuffer(e,t,n);for(var i=0;i<this._lightPasses.length;i++){var r=this._lightPasses[i],o=r.subModel,a=r.passIdx,s=r.dynamicOffsets,c=r.lights,l=ir.get(Tr.get(o.handle,vr.SHADER_0+a)),u=o.passes[a],h=o.inputAssembler,_=vg.getOrCreatePipelineState(e,u,l,t,h),f=rr.get(yr.get(u.handle,tr.DESCRIPTOR_SET)),d=o.descriptorSet;n.bindPipelineState(_),n.bindDescriptorSet(uu.MATERIAL,f),n.bindInputAssembler(h);for(var m=0;m<s.length;++m){var p=c[m],v=this._getOrCreateDescriptorSet(p);kg[0]=s[m],n.bindDescriptorSet(uu.GLOBAL,v),n.bindDescriptorSet(uu.LOCAL,d,kg),n.draw(h)}}},t._gatherValidLights=function(e,t){for(var n=e.scene.sphereLights,i=0;i<n.length;i++){var r=n[i];r.baked||($o.set(Hg,r.position.x,r.position.y,r.position.z,r.range),_l.sphereFrustum(Hg,e.frustum)&&(t.push(r),this._getOrCreateDescriptorSet(r)))}for(var o=e.scene.spotLights,a=0;a<o.length;a++){var s=o[a];s.baked||($o.set(Hg,s.position.x,s.position.y,s.position.z,s.range),_l.sphereFrustum(Hg,e.frustum)&&(t.push(s),this._getOrCreateDescriptorSet(s)))}},t._lightCulling=function(e,t){for(var n=0;n<t.length;n++){var i=t[n],r=!1;switch(i.type){case bm.SPHERE:r=qg(i,e);break;case bm.SPOT:r=Yg(i,e)}r||Vg.push(n)}},t._addRenderQueue=function(e,t,n,i,r){var o=e.batchingScheme;if(o===vm.INSTANCING)for(var a=0;a<Vg.length;a++){var s=Vg[a],c=zm.get(e,s);c.merge(t,n.instancedAttributes,i),c.dynamicOffsets[0]=this._lightBufferStride*s,this._instancedQueue.queue.add(c)}else if(o===vm.VB_MERGING)for(var l=0;l<Vg.length;l++){var u=Vg[l],h=Sg.get(e,u);h.merge(t,i,n),h.dynamicOffsets[0]=this._lightBufferStride*u,this._batchedQueue.queue.add(h)}else{var _=Ug.alloc();_.subModel=t,_.passIdx=i;for(var f=0;f<Vg.length;f++){var d=Vg[f];_.lights.push(r[d]),_.dynamicOffsets.push(this._lightBufferStride*d)}this._lightPasses.push(_)}},t._updateLightDescriptorSet=function(e,t){for(var n=this._pipeline.shadows,i=e.scene.mainLight,r=0;r<this._validLights.length;r++){var o=this._validLights[r],a=this._getOrCreateDescriptorSet(o);if(a){switch(this._updateGlobalDescriptorSet(e,t),o.type){case bm.SPHERE:i&&zg(n,i,this._shadowUBO),Vn.toArray(this._shadowUBO,n.shadowColor,pu.SHADOW_COLOR_OFFSET),this._shadowUBO[pu.SHADOW_INFO_OFFSET+0]=n.size.x,this._shadowUBO[pu.SHADOW_INFO_OFFSET+1]=n.size.y,this._shadowUBO[pu.SHADOW_INFO_OFFSET+2]=n.pcf,this._shadowUBO[pu.SHADOW_INFO_OFFSET+3]=n.bias;break;case bm.SPOT:if(i&&zg(n,i,this._shadowUBO),ai.invert(jg,o.node.getWorldMatrix()),ai.perspective(Wg,o.spotAngle,o.aspect,.001,o.range),ai.multiply(Wg,Wg,jg),ai.toArray(this._shadowUBO,Wg,pu.MAT_LIGHT_VIEW_PROJ_OFFSET),Vn.toArray(this._shadowUBO,n.shadowColor,pu.SHADOW_COLOR_OFFSET),this._shadowUBO[pu.SHADOW_INFO_OFFSET+0]=n.size.x,this._shadowUBO[pu.SHADOW_INFO_OFFSET+1]=n.size.y,this._shadowUBO[pu.SHADOW_INFO_OFFSET+2]=n.pcf,this._shadowUBO[pu.SHADOW_INFO_OFFSET+3]=n.bias,this._pipeline.shadowFrameBufferMap.has(o)&&this._pipeline.shadowFrameBufferMap.has(o)){var s,c=null===(s=this._pipeline.shadowFrameBufferMap.get(o))||void 0===s?void 0:s.colorTextures[0];c&&a.bindTexture(Su,c)}}a.update(),t.updateBuffer(a.getBuffer(du.BINDING),this._globalUBO),t.updateBuffer(a.getBuffer(mu.BINDING),this._cameraUBO),t.updateBuffer(a.getBuffer(pu.BINDING),this._shadowUBO)}}},t._updateGlobalDescriptorSet=function(e,t){var n=c.director.root,i=this._pipeline.device,r=this._globalUBO,o=Math.floor(i.width),a=Math.floor(i.height);r[du.TIME_OFFSET]=n.cumulativeTime,r[du.TIME_OFFSET+1]=n.frameTime,r[du.TIME_OFFSET+2]=c.director.getTotalFrames(),r[du.SCREEN_SIZE_OFFSET]=i.width,r[du.SCREEN_SIZE_OFFSET+1]=i.height,r[du.SCREEN_SIZE_OFFSET+2]=1/i.width,r[du.SCREEN_SIZE_OFFSET+3]=1/i.height,r[du.NATIVE_SIZE_OFFSET]=o,r[du.NATIVE_SIZE_OFFSET+1]=a,r[du.NATIVE_SIZE_OFFSET+2]=1/r[du.NATIVE_SIZE_OFFSET],r[du.NATIVE_SIZE_OFFSET+3]=1/r[du.NATIVE_SIZE_OFFSET+1],this._updateCameraUBO(e)},t._updateCameraUBO=function(e){var t=this._pipeline,n=e.scene.mainLight,i=t.ambient,r=t.shadingScale,o=this._pipeline.device,a=Math.floor(o.width),s=Math.floor(o.height),c=t.fog,l=this._cameraUBO;l[mu.SCREEN_SCALE_OFFSET]=e.width/a*r,l[mu.SCREEN_SCALE_OFFSET+1]=e.height/s*r,l[mu.SCREEN_SCALE_OFFSET+2]=1/l[mu.SCREEN_SCALE_OFFSET],l[mu.SCREEN_SCALE_OFFSET+3]=1/l[mu.SCREEN_SCALE_OFFSET+1];var u=e.exposure;if(l[mu.EXPOSURE_OFFSET]=u,l[mu.EXPOSURE_OFFSET+1]=1/u,l[mu.EXPOSURE_OFFSET+2]=this._isHDR?1:0,l[mu.EXPOSURE_OFFSET+3]=this._fpScale/u,n){if(Wn.toArray(l,n.direction,mu.MAIN_LIT_DIR_OFFSET),Wn.toArray(l,n.color,mu.MAIN_LIT_COLOR_OFFSET),n.useColorTemperature){var h=n.colorTemperatureRGB;l[mu.MAIN_LIT_COLOR_OFFSET]*=h.x,l[mu.MAIN_LIT_COLOR_OFFSET+1]*=h.y,l[mu.MAIN_LIT_COLOR_OFFSET+2]*=h.z}this._isHDR?l[mu.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*this._fpScale:l[mu.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*u}else Wn.toArray(l,Wn.UNIT_Z,mu.MAIN_LIT_DIR_OFFSET),di.toArray(l,di.ZERO,mu.MAIN_LIT_COLOR_OFFSET);ai.toArray(l,e.matView,mu.MAT_VIEW_OFFSET),ai.toArray(l,e.node.worldMatrix,mu.MAT_VIEW_INV_OFFSET),ai.toArray(l,e.matProj,mu.MAT_PROJ_OFFSET),ai.toArray(l,e.matProjInv,mu.MAT_PROJ_INV_OFFSET),ai.toArray(l,e.matViewProj,mu.MAT_VIEW_PROJ_OFFSET),ai.toArray(l,e.matViewProjInv,mu.MAT_VIEW_PROJ_INV_OFFSET),Wn.toArray(l,e.position,mu.CAMERA_POS_OFFSET);var _=o.screenSpaceSignY;e.window.hasOffScreenAttachments&&(_*=o.UVSpaceSignY),l[mu.CAMERA_POS_OFFSET+3]=_;var f=i.colorArray;this._isHDR?f[3]=i.skyIllum*this._fpScale:f[3]=i.skyIllum*u,l.set(f,mu.AMBIENT_SKY_OFFSET),l.set(i.albedoArray,mu.AMBIENT_GROUND_OFFSET),c.enabled&&(l.set(c.colorArray,mu.GLOBAL_FOG_COLOR_OFFSET),l[mu.GLOBAL_FOG_BASE_OFFSET]=c.fogStart,l[mu.GLOBAL_FOG_BASE_OFFSET+1]=c.fogEnd,l[mu.GLOBAL_FOG_BASE_OFFSET+2]=c.fogDensity,l[mu.GLOBAL_FOG_ADD_OFFSET]=c.fogTop,l[mu.GLOBAL_FOG_ADD_OFFSET+1]=c.fogRange,l[mu.GLOBAL_FOG_ADD_OFFSET+2]=c.fogAtten)},t._updateUBOs=function(e,t){var n=e.exposure;this._validLights.length>this._lightBufferCount&&(this._firstLightBufferView.destroy(),this._lightBufferCount=Fn(this._validLights.length),this._lightBuffer.resize(this._lightBufferStride*this._lightBufferCount),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount),this._firstLightBufferView.initialize(new Ja(this._lightBuffer,0,Ru.SIZE)));for(var i=0,r=0;i<this._validLights.length;i++,r+=this._lightBufferElementCount){var o=this._validLights[i];switch(o.type){case bm.SPHERE:if(Wn.toArray(Gg,o.position),Gg[3]=0,this._lightBufferData.set(Gg,r+Ru.LIGHT_POS_OFFSET),Gg[0]=o.size,Gg[1]=o.range,Gg[2]=0,this._lightBufferData.set(Gg,r+Ru.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Wn.toArray(Gg,o.color),o.useColorTemperature){var a=o.colorTemperatureRGB;Gg[0]*=a.x,Gg[1]*=a.y,Gg[2]*=a.z}this._isHDR?Gg[3]=o.luminance*this._fpScale*this._lightMeterScale:Gg[3]=o.luminance*n*this._lightMeterScale,this._lightBufferData.set(Gg,r+Ru.LIGHT_COLOR_OFFSET);break;case bm.SPOT:if(Wn.toArray(Gg,o.position),Gg[3]=1,this._lightBufferData.set(Gg,r+Ru.LIGHT_POS_OFFSET),Gg[0]=o.size,Gg[1]=o.range,Gg[2]=o.spotAngle,this._lightBufferData.set(Gg,r+Ru.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Wn.toArray(Gg,o.direction),this._lightBufferData.set(Gg,r+Ru.LIGHT_DIR_OFFSET),Wn.toArray(Gg,o.color),o.useColorTemperature){var s=o.colorTemperatureRGB;Gg[0]*=s.x,Gg[1]*=s.y,Gg[2]*=s.z}this._isHDR?Gg[3]=o.luminance*this._fpScale*this._lightMeterScale:Gg[3]=o.luminance*n*this._lightMeterScale,this._lightBufferData.set(Gg,r+Ru.LIGHT_COLOR_OFFSET)}}t.updateBuffer(this._lightBuffer,this._lightBufferData)},t._getOrCreateDescriptorSet=function(e){if(!this._descriptorSetMap.has(e)){var t=this._device,n=t.createDescriptorSet(new Qs(this._pipeline.descriptorSetLayout)),i=t.createBuffer(new Za(oa.UNIFORM|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,du.SIZE,du.SIZE));n.bindBuffer(du.BINDING,i);var r=t.createBuffer(new Za(oa.UNIFORM|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,mu.SIZE,mu.SIZE));n.bindBuffer(mu.BINDING,r);var o=t.createBuffer(new Za(oa.UNIFORM|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,pu.SIZE,pu.SIZE));return n.bindBuffer(pu.BINDING,o),n.bindSampler(vu,this._sampler),n.bindTexture(vu,xm.get("default-texture").getGFXTexture()),n.bindSampler(Su,this._sampler),n.bindTexture(Su,xm.get("default-texture").getGFXTexture()),n.update(),this._descriptorSetMap.set(e,n),n}return this._descriptorSetMap.get(e)},e}();wt(xa),wt(Ea),wt(Ia),wt(ba),wt(Ra),function(e){e[e.SCENE=0]="SCENE",e[e.POSTPROCESS=1]="POSTPROCESS",e[e.UI=2]="UI"}(Tx||(Tx={})),wt(Tx),Zg=bh("RenderTextureDesc"),Jg=n_(xa),$g=n_(Ea),ey=n_(ra),Zg((ny=se((ty=function(){ae(this,"name",ny,this),ae(this,"type",iy,this),ae(this,"usage",ry,this),ae(this,"format",oy,this),ae(this,"width",ay,this),ae(this,"height",sy,this)}).prototype,"name",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),iy=se(ty.prototype,"type",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xa.TEX2D}}),ry=se(ty.prototype,"usage",[$g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ea.COLOR_ATTACHMENT}}),oy=se(ty.prototype,"format",[ey],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ra.UNKNOWN}}),ay=se(ty.prototype,"width",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),sy=se(ty.prototype,"height",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),ty));var Ax,Cx=(cy=bh("RenderTextureConfig"),ly=n_(wp),cy((_y=se((hy=function(){ae(this,"name",_y,this),ae(this,"texture",fy,this)}).prototype,"name",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),fy=se(hy.prototype,"texture",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uy=hy))||uy),wx=(dy=bh("MaterialConfig"),my=n_(bp),dy((gy=se((vy=function(){ae(this,"name",gy,this),ae(this,"material",yy,this)}).prototype,"name",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),yy=se(vy.prototype,"material",[my],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),py=vy))||py),bx=(xy=bh("FrameBufferDesc"),Ey=n_([$t]),Ty=n_(wp),xy((Ay=se((Sy=function(){ae(this,"name",Ay,this),ae(this,"renderPass",Cy,this),ae(this,"colorTextures",wy,this),ae(this,"depthStencilTexture",by,this),ae(this,"texture",Iy,this)}).prototype,"name",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Cy=se(Sy.prototype,"renderPass",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wy=se(Sy.prototype,"colorTextures",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),by=se(Sy.prototype,"depthStencilTexture",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Iy=se(Sy.prototype,"texture",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sy)),Ry=bh("ColorDesc"),Oy=n_(ra),Ny=n_(ba),Py=n_(Ia),My=n_(Ra),Dy=n_(Ra),Ry((zy=se((Fy=function(){ae(this,"format",zy,this),ae(this,"loadOp",By,this),ae(this,"storeOp",Uy,this),ae(this,"sampleCount",Gy,this),ae(this,"beginLayout",Hy,this),ae(this,"endLayout",ky,this)}).prototype,"format",[Oy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ra.UNKNOWN}}),By=se(Fy.prototype,"loadOp",[Ny],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ba.CLEAR}}),Uy=se(Fy.prototype,"storeOp",[Py],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ia.STORE}}),Gy=se(Fy.prototype,"sampleCount",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Hy=se(Fy.prototype,"beginLayout",[My],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ra.UNDEFINED}}),ky=se(Fy.prototype,"endLayout",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ra.PRESENT_SRC}}),Ly=Fy))||Ly),Ix=(Vy=bh("DepthStencilDesc"),jy=n_(ra),Wy=n_(ba),qy=n_(Ia),Yy=n_(ba),Xy=n_(Ia),Ky=n_(Ra),Qy=n_(Ra),Vy(($y=se((Jy=function(){ae(this,"format",$y,this),ae(this,"depthLoadOp",ex,this),ae(this,"depthStoreOp",tx,this),ae(this,"stencilLoadOp",nx,this),ae(this,"stencilStoreOp",ix,this),ae(this,"sampleCount",rx,this),ae(this,"beginLayout",ox,this),ae(this,"endLayout",ax,this)}).prototype,"format",[jy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ra.UNKNOWN}}),ex=se(Jy.prototype,"depthLoadOp",[Wy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ba.CLEAR}}),tx=se(Jy.prototype,"depthStoreOp",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ia.STORE}}),nx=se(Jy.prototype,"stencilLoadOp",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ba.CLEAR}}),ix=se(Jy.prototype,"stencilStoreOp",[Xy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ia.STORE}}),rx=se(Jy.prototype,"sampleCount",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ox=se(Jy.prototype,"beginLayout",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ra.UNDEFINED}}),ax=se(Jy.prototype,"endLayout",[Qy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ra.DEPTH_STENCIL_ATTACHMENT_OPTIMAL}}),Zy=Jy))||Zy);sx=bh("RenderPassDesc"),cx=n_([bx]),lx=n_(Ix),sx((hx=se((ux=function(){ae(this,"index",hx,this),ae(this,"colorAttachments",_x,this),ae(this,"depthStencilAttachment",fx,this)}).prototype,"index",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),_x=se(ux.prototype,"colorAttachments",[cx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fx=se(ux.prototype,"depthStencilAttachment",[lx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ix}}),ux)),function(e){e[e.FRONT_TO_BACK=0]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(Ax||(Ax={})),wt(Ax);var Rx,Ox,Nx,Px,Mx,Dx,Lx,Fx,zx,Bx,Ux,Gx=(dx=bh("RenderQueueDesc"),mx=n_(Ax),px=n_([$t]),dx((yx=se((gx=function(){ae(this,"isTransparent",yx,this),ae(this,"sortMode",xx,this),ae(this,"stages",Ex,this)}).prototype,"isTransparent",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xx=se(gx.prototype,"sortMode",[mx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ax.FRONT_TO_BACK}}),Ex=se(gx.prototype,"stages",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vx=gx))||vx),Hx=new Al,kx=function(){function e(e){this._pendingModels=[],this._instancedQueue=new Tg,this._pipeline=void 0,this._pipeline=e}var t=e.prototype;return t.gatherShadowPasses=function(e,t){var n=this._pipeline.shadows;if(this._pendingModels.length=0,n.enabled&&n.type===Ip.Planar){this._pipeline.updateShadowUBO(e);var i=e.scene,r=e.frustum,o=0!=(e.visibility&$l.BitMask.DEFAULT);if(i.mainLight&&o){var a=this._pipeline.renderObjects,s=zm.get(n.instancingMaterial.passes[0]);this._instancedQueue.clear(),this._instancedQueue.queue.add(s);for(var c=0;c<a.length;c++){var l=a[c].model;if(l.enabled&&l.node&&l.castShadow&&(!l.worldBounds||(Al.transform(Hx,l.worldBounds,n.matLight),_l.aabbFrustum(Hx,r))))if(l.isInstancingEnabled)for(var u=0;u<l.subModels.length;u++)s.merge(l.subModels[u],l.instancedAttributes,0);else this._pendingModels.push(l)}this._instancedQueue.uploadBuffers(t)}}},t.recordCommandBuffer=function(e,t,n){var i=this._pipeline.shadows;if(i.enabled&&i.type===Ip.Planar&&this._pendingModels.length){this._instancedQueue.recordCommandBuffer(e,t,n);var r=i.material.passes[0],o=rr.get(yr.get(r.handle,tr.DESCRIPTOR_SET));n.bindDescriptorSet(uu.MATERIAL,o);for(var a=this._pendingModels.length,s=0;s<a;s++)for(var c=this._pendingModels[s],l=0;l<c.subModels.length;l++){var u=c.subModels[l],h=ir.get(u.planarShaderHandel),_=u.inputAssembler,f=vg.getOrCreatePipelineState(e,r,h,t,_);n.bindPipelineState(f),n.bindDescriptorSet(uu.LOCAL,u.descriptorSet),n.bindInputAssembler(_),n.draw(_)}}},e}(),Vx=function(){function e(){this._phaseID=Em("default")}var t=e.prototype;return t.activate=function(e){this._pipeline=e},t.render=function(e,t){for(var n=this._pipeline,i=n.device,r=n.commandBuffers[0],o=e.scene.batches,a=0;a<o.length;a++){var s=o[a],c=!1;if(e.visibility&s.visFlags&&(c=!0),c)for(var l=s.handle,u=Ir.get(l,Sr.PASS_COUNT),h=0;h<u;h++){var _=s.passes[h];if(_.phase===this._phaseID){var f=Ir.get(l,Sr.SHADER_0+h),d=ir.get(f),m=or.get(s.hInputAssembler),p=rr.get(s.hDescriptorSet),v=vg.getOrCreatePipelineState(i,_,d,t,m);r.bindPipelineState(v),r.bindDescriptorSet(uu.MATERIAL,_.descriptorSet),r.bindDescriptorSet(uu.LOCAL,p),r.bindInputAssembler(m),r.draw(m)}}}},e}(),jx=[new ms(0,0,0,1)],Wx=e("fh",(Rx=bh("ForwardStage"),Ox=n_([Gx]),Nx=Qh(),Rx((Fx=Lx=function(e){function t(){var t;return ae(t=e.call(this)||this,"renderQueues",Dx,ie(t)),t._renderQueues=[],t._renderArea=new fs,t._batchedQueue=void 0,t._instancedQueue=void 0,t._phaseID=Em("default"),t._clearFlag=4294967295,t._batchedQueue=new Eg,t._instancedQueue=new Tg,t._uiPhase=new Vx,t}$(t,e);var n=t.prototype;return n.initialize=function(t){return e.prototype.initialize.call(this,t),t.renderQueues&&(this.renderQueues=t.renderQueues),!0},n.activate=function(t,n){e.prototype.activate.call(this,t,n);for(var i=0;i<this.renderQueues.length;i++){for(var r=0,o=0;o<this.renderQueues[i].stages.length;o++)r|=Em(this.renderQueues[i].stages[o]);var a=gg;switch(this.renderQueues[i].sortMode){case Ax.BACK_TO_FRONT:a=yg;break;case Ax.FRONT_TO_BACK:a=gg}this._renderQueues[i]=new xg({isTransparent:this.renderQueues[i].isTransparent,phases:r,sortFunc:a})}this._additiveLightQueue=new Sx(this._pipeline),this._planarQueue=new kx(this._pipeline),this._uiPhase.activate(t)},n.destroy=function(){},n.render=function(e){this._instancedQueue.clear(),this._batchedQueue.clear();var t=this._pipeline,n=t.device;this._renderQueues.forEach(this.renderQueueClearFunc);for(var i=t.renderObjects,r=0,o=0,a=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(r=0;r<l.length;++r){var u=l[r],h=u.passes;for(o=0;o<h.length;++o){var _=h[o];if(_.phase===this._phaseID){var f=_.batchingScheme;if(f===vm.INSTANCING){var d=zm.get(_);d.merge(u,c.model.instancedAttributes,o),this._instancedQueue.queue.add(d)}else if(f===vm.VB_MERGING){var m=Sg.get(_);m.merge(u,o,c.model),this._batchedQueue.queue.add(m)}else for(a=0;a<this._renderQueues.length;a++)this._renderQueues[a].insertRenderPass(c,r,o)}}}}this._renderQueues.forEach(this.renderQueueSortFunc);var p=t.commandBuffers[0];this._instancedQueue.uploadBuffers(p),this._batchedQueue.uploadBuffers(p),this._additiveLightQueue.gatherLightPasses(e,p),this._planarQueue.gatherShadowPasses(e,p);var v,g,y=e.viewport,x=e.window.hasOnScreenAttachments&&n.surfaceTransform%2?e.height:e.width,E=e.window.hasOnScreenAttachments&&n.surfaceTransform%2?e.width:e.height;if(this._renderArea.x=y.x*x,this._renderArea.y=y.y*E,this._renderArea.width=y.width*x*t.shadingScale,this._renderArea.height=y.height*E*t.shadingScale,e.clearFlag&Da.COLOR)if(t.isHDR){v=jx[0],g=e.clearColor,v.x=g.x*g.x,v.y=g.y*g.y,v.z=g.z*g.z;var T=t.fpScale/e.exposure;jx[0].x*=T,jx[0].y*=T,jx[0].z*=T}else jx[0].x=e.clearColor.x,jx[0].y=e.clearColor.y,jx[0].z=e.clearColor.z;jx[0].w=e.clearColor.w;var S=e.window.framebuffer,A=S.colorTextures[0]?S.renderPass:t.getRenderPass(e.clearFlag&this._clearFlag);p.beginRenderPass(A,S,this._renderArea,jx,e.clearDepth,e.clearStencil),p.bindDescriptorSet(uu.GLOBAL,t.descriptorSet),this._renderQueues[0].recordCommandBuffer(n,A,p),this._instancedQueue.recordCommandBuffer(n,A,p),this._batchedQueue.recordCommandBuffer(n,A,p),this._additiveLightQueue.recordCommandBuffer(n,A,p),this._planarQueue.recordCommandBuffer(n,A,p),this._renderQueues[1].recordCommandBuffer(n,A,p),this._uiPhase.render(e,A),p.endRenderPass()},n.renderQueueClearFunc=function(e){e.clear()},n.renderQueueSortFunc=function(e){e.sort()},t}(ig),Lx.initInfo={name:"ForwardStage",priority:dg.FORWARD,tag:0,renderQueues:[{isTransparent:!1,sortMode:Ax.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:Ax.BACK_TO_FRONT,stages:["default","planarShadow"]}]},Dx=se((Mx=Fx).prototype,"renderQueues",[Ox,Ph,Nx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Px=Mx))||Px)),qx=e("fg",bh("ForwardFlow")((Ux=Bx=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new Wx;n.initialize(Wx.initInfo),this._stages.push(n)}return!0},n.activate=function(t){e.prototype.activate.call(this,t)},n.render=function(t){(function(e,t){var n=t.scene,i=n.mainLight,r=e.shadows,o=e.renderObjects;Pg.freeArray(o),o.length=0,r.enabled&&Vn.toArray(e.shadowUBO,r.shadowColor,pu.SHADOW_COLOR_OFFSET),i&&r.type===Ip.Planar&&function(e,t){var n=e.shadows,i=t.direction,r=n.normal,o=n.distance+.001,a=1/Wn.dot(r,i),s=i.x*a,c=i.y*a,l=i.z*a,u=r.x,h=r.y,_=r.z,f=n.matLight;f.m00=1-u*s,f.m01=-u*c,f.m02=-u*l,f.m03=0,f.m04=-h*s,f.m05=1-h*c,f.m06=-h*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*o,f.m13=c*o,f.m14=l*o,f.m15=1,ai.toArray(e.shadowUBO,n.matLight,pu.MAT_LIGHT_PLANE_PROJ_OFFSET)}(e,i),e.skybox.enabled&&e.skybox.model&&t.clearFlag&mh&&o.push(Dg(e.skybox.model,t));for(var a=n.models,s=0;s<a.length;s++){var c=a[s];if(c.enabled&&(c.node&&(t.visibility&c.node.layer)===c.node.layer||t.visibility&c.visFlags)){if(c.worldBounds&&!_l.aabbFrustum(c.worldBounds,t.frustum))continue;o.push(Dg(c,t))}}})(this._pipeline,t),e.prototype.render.call(this,t)},n.destroy=function(){e.prototype.destroy.call(this)},t}(fg),Bx.initInfo={name:nu,priority:mg.FORWARD,stages:[]},zx=Ux))||zx),Yx=new ai,Xx=new ai,Kx=new di,Qx=new Wn,Zx=new ai,Jx=Em("shadow-caster"),$x=[];function eE(e,t){t.length=0;for(var n=!1,i=0;i<e.length;i++){for(var r=e[i].passes,o=-1,a=0;a<r.length;a++)if(r[a].phase===Jx){o=a,n=!0;break}t.push(o)}return n}var tE,nE,iE,rE,oE,aE,sE,cE,lE,uE,hE,_E,fE,dE,mE,pE,vE=function(){function e(e){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._shadowMapBuffer=void 0,this._device=void 0,this._shadowInfo=void 0,this._descriptorSet=void 0,this._shadowObjects=void 0,this._shadowUBO=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._pipeline=e,this._device=e.device,this._shadowInfo=e.shadows,this._descriptorSet=e.descriptorSet,this._shadowObjects=e.shadowObjects,this._shadowUBO=e.shadowUBO,this._shadowMapBuffer=e.descriptorSet.getBuffer(pu.BINDING),this._instancedQueue=new Tg,this._batchedQueue=new Eg}var t=e.prototype;return t.gatherLightPasses=function(e,t){if(this.clear(),e&&this._shadowInfo.enabled&&this._shadowInfo.type===Ip.ShadowMap){this._updateUBOs(e);for(var n=0;n<this._shadowObjects.length;n++){var i=this._shadowObjects[n].model;if(eE(i.subModels,$x))switch(e.type){case bm.DIRECTIONAL:this.add(i,t,$x);break;case bm.SPOT:if(i.worldBounds&&(!_l.aabbWithAABB(i.worldBounds,e.aabb)||!_l.aabbFrustum(i.worldBounds,e.frustum)))continue;this.add(i,t,$x)}}}},t.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._batchedQueue.clear()},t.add=function(e,t,n){for(var i=e.subModels,r=0;r<i.length;r++){var o=i[r],a=n[r],s=o.passes[a],c=s.batchingScheme;if(o.descriptorSet.bindBuffer(pu.BINDING,this._shadowMapBuffer),o.descriptorSet.update(),c===vm.INSTANCING){var l=zm.get(s);l.merge(o,e.instancedAttributes,a),this._instancedQueue.queue.add(l)}else if(s.batchingScheme===vm.VB_MERGING){var u=Sg.get(s);u.merge(o,a,e),this._batchedQueue.queue.add(u)}else{var h=ir.get(Tr.get(o.handle,vr.SHADER_0+a));this._subModelsArray.push(o),this._shaderArray.push(h),this._passArray.push(s)}}this._instancedQueue.uploadBuffers(t),this._batchedQueue.uploadBuffers(t)},t.recordCommandBuffer=function(e,t,n){this._instancedQueue.recordCommandBuffer(e,t,n),this._batchedQueue.recordCommandBuffer(e,t,n);for(var i=0;i<this._subModelsArray.length;++i){var r=this._subModelsArray[i],o=this._shaderArray[i],a=this._passArray[i],s=r.inputAssembler,c=vg.getOrCreatePipelineState(e,a,o,t,s),l=a.descriptorSet;n.bindPipelineState(c),n.bindDescriptorSet(uu.MATERIAL,l),n.bindDescriptorSet(uu.LOCAL,r.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},t._updateUBOs=function(e){var t=0,n=0,i=0;switch(e.type){case bm.DIRECTIONAL:if(e.update(),this._shadowInfo.autoAdapt){var r=e.node;r&&(Zx=Fg(this._pipeline,r.getWorldRotation(),e.direction,Qx));var o=this._shadowInfo.sphere.radius;t=o*this._shadowInfo.aspect,n=o;var a=Wn.distance(this._shadowInfo.sphere.center,Qx);i=Math.min(a*Np.COEFFICIENT_OF_EXPANSION,Np.MAX_FAR)}else Zx=e.node.getWorldMatrix(),t=this._shadowInfo.orthoSize*this._shadowInfo.aspect,n=this._shadowInfo.orthoSize,i=this._shadowInfo.far;ai.invert(Yx,Zx),ai.ortho(Xx,-t,t,-n,n,this._shadowInfo.near,i,this._device.clipSpaceMinZ,this._device.screenSpaceSignY*this._device.UVSpaceSignY);break;case bm.SPOT:ai.invert(Yx,e.node.getWorldMatrix()),ai.perspective(Xx,e.spotAngle,e.aspect,.001,e.range)}ai.multiply(Xx,Xx,Yx),ai.toArray(this._shadowUBO,Xx,pu.MAT_LIGHT_VIEW_PROJ_OFFSET),Vn.toArray(this._shadowUBO,this._shadowInfo.shadowColor,pu.SHADOW_COLOR_OFFSET),Kx.set(this._shadowInfo.size.x,this._shadowInfo.size.y,this._shadowInfo.pcf,this._shadowInfo.bias),di.toArray(this._shadowUBO,Kx,pu.SHADOW_INFO_OFFSET),this._descriptorSet.getBuffer(pu.BINDING).update(this._shadowUBO)},e}(),gE=[new ms(1,1,1,1)],yE=e("fj",bh("ShadowStage")((iE=nE=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._shadowFrameBuffer=null,t._renderArea=new fs,t._light=null,t}$(t,e);var n=t.prototype;return n.setUsage=function(e,t){this._light=e,this._shadowFrameBuffer=t},n.destroy=function(){this._additiveShadowQueue.clear()},n.clearFramebuffer=function(e){if(this._light&&this._shadowFrameBuffer){gE[0].w=e.clearColor.w;var t=this._pipeline.commandBuffers[0],n=this._shadowFrameBuffer.renderPass;t.beginRenderPass(n,this._shadowFrameBuffer,this._renderArea,gE,e.clearDepth,e.clearStencil),t.endRenderPass()}},n.render=function(e){var t=this._pipeline,n=t.shadows,i=t.commandBuffers[0];if(this._light&&this._shadowFrameBuffer){this._additiveShadowQueue.gatherLightPasses(this._light,i);var r=e.viewport,o=n.size;this._renderArea.x=r.x*o.x,this._renderArea.y=r.y*o.y,this._renderArea.width=r.width*o.x*t.shadingScale,this._renderArea.height=r.height*o.y*t.shadingScale;var a=t.device,s=this._shadowFrameBuffer.renderPass;i.beginRenderPass(s,this._shadowFrameBuffer,this._renderArea,gE,e.clearDepth,e.clearStencil),i.bindDescriptorSet(uu.GLOBAL,t.descriptorSet),this._additiveShadowQueue.recordCommandBuffer(a,s,i),i.endRenderPass()}},n.activate=function(t,n){e.prototype.activate.call(this,t,n),this._additiveShadowQueue=new vE(t)},t}(ig),nE.initInfo={name:"ShadowStage",priority:dg.FORWARD,tag:0},tE=iE))||tE),xE=e("fi",bh("ShadowFlow")((aE=oE=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._shadowRenderPass=null,t}$(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._stages.length){var n=new yE;n.initialize(yE.initInfo),this._stages.push(n)}return!0},n.render=function(e){var t=this._pipeline,n=t.shadows;if(n.enabled&&n.type===Ip.ShadowMap){var i=function(e,t){Og.length=0;var n=e.scene;Og.push(n.mainLight);for(var i=n.spotLights,r=0;r<i.length;r++){var o=i[r];$o.set(Ng,o.position.x,o.position.y,o.position.z,o.range),_l.sphereFrustum(Ng,e.frustum)&&t>Og.length&&Og.push(o)}return Og}(e,n.maxReceived);if(function(e,t){var n=t.scene,i=e.shadows,r=e.shadowObjects;Mg.freeArray(r),r.length=0,Rg=!1;for(var o=n.models,a=0;a<o.length;a++){var s=o[a];(s.node&&(t.visibility&s.node.layer)===s.node.layer||t.visibility&s.visFlags)&&s.castShadow&&s.worldBounds&&(Rg||(Ig.copy(s.worldBounds),Rg=!0),Al.merge(Ig,Ig,s.worldBounds),r.push(Lg(s,t)))}Ig&&Al.toBoundingSphere(i.sphere,Ig)}(t,e),0!==t.shadowObjects.length){for(var r=0;r<i.length;r++){var o=i[r];t.shadowFrameBufferMap.has(o)||this._initShadowFrameBuffer(t,o);var a=t.shadowFrameBufferMap.get(o);n.shadowMapDirty&&this.resizeShadowMap(o,n.size);for(var s=0;s<this._stages.length;s++){var c=this._stages[s];c.setUsage(o,a),c.render(e)}}t.updateShadowUBO(e)}else this.clearShadowMap(i,e)}},n.destroy=function(){e.prototype.destroy.call(this);for(var t=Array.from(this._pipeline.shadowFrameBufferMap.values()),n=0;n<t.length;n++){var i=t[n];if(i){for(var r=i.colorTextures,o=0;o<r.length;o++){var a=r[n];a&&a.destroy()}r.length=0;var s=i.depthStencilTexture;s&&s.destroy(),i.destroy()}}this._pipeline.shadowFrameBufferMap.clear(),this._shadowRenderPass&&this._shadowRenderPass.destroy()},n._initShadowFrameBuffer=function(e,t){var n=e.device,i=e.shadows.size;if(!this._shadowRenderPass){var r=new Os;r.format=ra.RGBA8,r.loadOp=ba.CLEAR,r.storeOp=Ia.STORE,r.sampleCount=1,r.beginLayout=Ra.UNDEFINED,r.endLayout=Ra.PRESENT_SRC;var o=new Ns;o.format=n.depthStencilFormat,o.depthLoadOp=ba.CLEAR,o.depthStoreOp=Ia.DISCARD,o.stencilLoadOp=ba.CLEAR,o.stencilStoreOp=Ia.DISCARD,o.sampleCount=1,o.beginLayout=Ra.UNDEFINED,o.endLayout=Ra.DEPTH_STENCIL_ATTACHMENT_OPTIMAL;var a=new Ms([r],o);this._shadowRenderPass=n.createRenderPass(a)}var s=[];s.push(n.createTexture(new Vs(xa.TEX2D,Ea.COLOR_ATTACHMENT|Ea.SAMPLED,ra.RGBA8,i.x,i.y)));var c=n.createTexture(new Vs(xa.TEX2D,Ea.DEPTH_STENCIL_ATTACHMENT,n.depthStencilFormat,i.x,i.y)),l=n.createFramebuffer(new os(this._shadowRenderPass,s,c));e.shadowFrameBufferMap.set(t,l)},n.clearShadowMap=function(e,t){for(var n=this._pipeline,i=0;i<e.length;i++){var r=e[i],o=n.shadowFrameBufferMap.get(r);if(n.shadowFrameBufferMap.has(r))for(var a=0;a<this._stages.length;a++){var s=this._stages[a];s.setUsage(r,o),s.clearFramebuffer(t)}}},n.resizeShadowMap=function(e,t){var n=t.x,i=t.y,r=this._pipeline;if(r.shadowFrameBufferMap.has(e)){var o=r.shadowFrameBufferMap.get(e);if(!o)return;var a=o.colorTextures;if(a&&a.length>0)for(var s=0;s<a.length;s++){var c=a[s];c&&c.resize(n,i)}var l=o.depthStencilTexture;l&&l.resize(n,i);var u=o.renderPass;o.destroy(),o.initialize(new os(u,a,l))}},t}(fg),oE.initInfo={name:iu,priority:mg.SHADOW,tag:Tx.SCENE,stages:[]},rE=aE))||rE),EE=St({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),TE=EE.LAYERED+1,SE=function(){function e(){this._fogColor=new Vn("#C8C8C8"),this._colorArray=new Float32Array([.2,.2,.2,1]),this._handle=nr,this._handle=ro.alloc()}Z(e,[{key:"enabled",set:function(e){ro.set(this._handle,$r.ENABLE,e?1:0),e||ro.set(this._handle,$r.TYPE,TE),e?this.activate():this._updatePipeline()},get:function(){return ro.get(this._handle,$r.ENABLE)}},{key:"fogColor",set:function(e){this._fogColor.set(e),Vn.toArray(this._colorArray,this._fogColor),ro.setVec4(this._handle,$r.COLOR,this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return ro.get(this._handle,$r.TYPE)},set:function(e){ro.set(this._handle,$r.TYPE,this.enabled?e:TE),this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return ro.get(this._handle,$r.DENSITY)},set:function(e){ro.set(this._handle,$r.DENSITY,e)}},{key:"fogStart",get:function(){return ro.get(this._handle,$r.START)},set:function(e){ro.set(this._handle,$r.START,e)}},{key:"fogEnd",get:function(){return ro.get(this._handle,$r.END)},set:function(e){ro.set(this._handle,$r.END,e)}},{key:"fogAtten",get:function(){return ro.get(this._handle,$r.ATTEN)},set:function(e){ro.set(this._handle,$r.ATTEN,e)}},{key:"fogTop",get:function(){return ro.get(this._handle,$r.TOP)},set:function(e){ro.set(this._handle,$r.TOP,e)}},{key:"fogRange",get:function(){return ro.get(this._handle,$r.RANGE)},set:function(e){ro.set(this._handle,$r.RANGE,e)}},{key:"colorArray",get:function(){return this._colorArray}},{key:"handle",get:function(){return this._handle}}]);var t=e.prototype;return t.initialize=function(e){ro.set(this._handle,$r.ENABLE,e.enabled?1:0),ro.set(this._handle,$r.TYPE,e.enabled?e.type:TE),this._fogColor.set(e.fogColor),Vn.toArray(this._colorArray,this._fogColor),ro.setVec4(this._handle,$r.COLOR,this._fogColor),ro.set(this._handle,$r.DENSITY,e.fogDensity),ro.set(this._handle,$r.START,e.fogStart),ro.set(this._handle,$r.END,e.fogEnd),ro.set(this._handle,$r.ATTEN,e.fogAtten),ro.set(this._handle,$r.TOP,e.fogTop),ro.set(this._handle,$r.RANGE,e.fogRange)},t.activate=function(){this._updatePipeline()},t._updatePipeline=function(){var e=c.director.root,t=this.enabled?this.type:TE,n=e.pipeline;n.macros.CC_USE_FOG!==t&&(n.macros.CC_USE_FOG=t,e.onGlobalPipelineStateChanged())},t.destroy=function(){this._handle&&(ro.free(this._handle),this._handle=nr)},e}();c.Fog=SE;var AE=new ai,CE=new ai,wE=new Wn,bE=[ga.LINEAR,ga.LINEAR,ga.NONE,ya.CLAMP,ya.CLAMP,ya.CLAMP],IE=e("ff",(sE=bh("ForwardPipeline"),cE=n_([Cx]),lE=Qh(),uE=n_([wx]),hE=Qh(),sE((pE=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"renderTextures",dE,ie(t)),ae(t,"materials",mE,ie(t)),t.fog=new SE,t.ambient=new No,t.skybox=new Fp,t.shadows=new Np,t.renderObjects=[],t.shadowObjects=[],t.shadowFrameBufferMap=new Map,t._isHDR=!1,t._shadingScale=1,t._fpScale=1/1024,t._renderPasses=new Map,t._globalUBO=new Float32Array(du.COUNT),t._cameraUBO=new Float32Array(mu.COUNT),t._shadowUBO=new Float32Array(pu.COUNT),t}$(t,e);var n=t.prototype;return n.initialize=function(t){if(e.prototype.initialize.call(this,t),0===this._flows.length){var n=new xE;n.initialize(xE.initInfo),this._flows.push(n);var i=new qx;i.initialize(qx.initInfo),this._flows.push(i)}return!0},n.activate=function(){return this._macros={},!(!e.prototype.activate.call(this)||!this._activeRenderer()&&(R(2402),1))},n.render=function(e){this._commandBuffers[0].begin(),this.updateGlobalUBO();for(var t=0;t<e.length;t++){var n=e[t];if(n.scene){this.updateCameraUBO(n);for(var i=0;i<this._flows.length;i++)this._flows[i].render(n)}}this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)},n.getRenderPass=function(e){var t=this._renderPasses.get(e);if(t)return t;var n=this.device,i=new Os,r=new Ns;i.format=n.colorFormat,r.format=n.depthStencilFormat,r.stencilStoreOp=Ia.DISCARD,r.depthStoreOp=Ia.DISCARD,e&Da.COLOR||(e&mh?i.loadOp=ba.DISCARD:(i.loadOp=ba.LOAD,i.beginLayout=Ra.PRESENT_SRC)),(e&Da.DEPTH_STENCIL)!==Da.DEPTH_STENCIL&&(e&Da.DEPTH||(r.depthLoadOp=ba.LOAD),e&Da.STENCIL||(r.stencilLoadOp=ba.LOAD),r.beginLayout=Ra.DEPTH_STENCIL_ATTACHMENT_OPTIMAL);var o=new Ms([i],r);return t=n.createRenderPass(o),this._renderPasses.set(e,t),t},n.updateGlobalUBO=function(){this._descriptorSet.update();var e=c.director.root,t=this._globalUBO,n=this.device,i=Math.floor(n.width),r=Math.floor(n.height);t[du.TIME_OFFSET]=e.cumulativeTime,t[du.TIME_OFFSET+1]=e.frameTime,t[du.TIME_OFFSET+2]=c.director.getTotalFrames(),t[du.SCREEN_SIZE_OFFSET]=n.width,t[du.SCREEN_SIZE_OFFSET+1]=n.height,t[du.SCREEN_SIZE_OFFSET+2]=1/n.width,t[du.SCREEN_SIZE_OFFSET+3]=1/n.height,t[du.NATIVE_SIZE_OFFSET]=i,t[du.NATIVE_SIZE_OFFSET+1]=r,t[du.NATIVE_SIZE_OFFSET+2]=1/t[du.NATIVE_SIZE_OFFSET],t[du.NATIVE_SIZE_OFFSET+3]=1/t[du.NATIVE_SIZE_OFFSET+1],this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(du.BINDING),this._globalUBO)},n._activeRenderer=function(){var e=this.device;this._commandBuffers.push(e.commandBuffer);var t=e.createBuffer(new Za(oa.UNIFORM|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,du.SIZE,du.SIZE));this._descriptorSet.bindBuffer(du.BINDING,t);var n=e.createBuffer(new Za(oa.UNIFORM|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,mu.SIZE,mu.SIZE));this._descriptorSet.bindBuffer(mu.BINDING,n);var i=e.createBuffer(new Za(oa.UNIFORM|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,pu.SIZE,pu.SIZE));this._descriptorSet.bindBuffer(pu.BINDING,i);var r=df(bE),o=If.getSampler(e,r);return this._descriptorSet.bindSampler(vu,o),this._descriptorSet.bindTexture(vu,xm.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(Su,o),this._descriptorSet.bindTexture(Su,xm.get("default-texture").getGFXTexture()),this._descriptorSet.update(),this.macros.CC_USE_HDR=this._isHDR,this.macros.CC_SUPPORT_FLOAT_TEXTURE=this.device.hasFeature(Ba.TEXTURE_FLOAT),!0},n.updateShadowUBO=function(e){this._descriptorSet.update();var t=e.scene.mainLight,n=this.device,i=this.shadows;if(i.enabled){if(t&&i.type===Ip.ShadowMap){var r;this.shadowFrameBufferMap.has(t)&&this._descriptorSet.bindTexture(vu,this.shadowFrameBufferMap.get(t).colorTextures[0]);var o=0,a=0,s=0;if(i.autoAdapt){r=Fg(this,t.node.getWorldRotation(),t.direction,wE);var c=i.sphere.radius;o=c*i.aspect,a=c;var l=Wn.distance(i.sphere.center,wE);s=Math.min(l*Np.COEFFICIENT_OF_EXPANSION,Np.MAX_FAR)}else r=t.node.getWorldMatrix(),o=i.orthoSize*i.aspect,a=i.orthoSize,s=i.far;ai.invert(AE,r);var u=n.screenSpaceSignY*n.UVSpaceSignY;ai.ortho(CE,-o,o,-a,a,i.near,s,n.clipSpaceMinZ,u),ai.multiply(CE,CE,AE),ai.toArray(this._shadowUBO,CE,pu.MAT_LIGHT_VIEW_PROJ_OFFSET),this._shadowUBO[pu.SHADOW_INFO_OFFSET]=i.size.x,this._shadowUBO[pu.SHADOW_INFO_OFFSET+1]=i.size.y,this._shadowUBO[pu.SHADOW_INFO_OFFSET+2]=i.pcf,this._shadowUBO[pu.SHADOW_INFO_OFFSET+3]=i.bias}else t&&i.type===Ip.Planar&&zg(i,t,this._shadowUBO);Vn.toArray(this._shadowUBO,i.shadowColor,pu.SHADOW_COLOR_OFFSET),this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(pu.BINDING),this._shadowUBO)}},n.updateCameraUBO=function(e){var t=this.device,n=(e.scene?e.scene:c.director.getScene().renderScene).mainLight,i=this.ambient,r=this.fog,o=Math.floor(t.width),a=Math.floor(t.height),s=this._cameraUBO,l=e.exposure;if(s[mu.SCREEN_SCALE_OFFSET]=e.width/o*this.shadingScale,s[mu.SCREEN_SCALE_OFFSET+1]=e.height/a*this.shadingScale,s[mu.SCREEN_SCALE_OFFSET+2]=1/s[mu.SCREEN_SCALE_OFFSET],s[mu.SCREEN_SCALE_OFFSET+3]=1/s[mu.SCREEN_SCALE_OFFSET+1],s[mu.EXPOSURE_OFFSET]=l,s[mu.EXPOSURE_OFFSET+1]=1/l,s[mu.EXPOSURE_OFFSET+2]=this._isHDR?1:0,s[mu.EXPOSURE_OFFSET+3]=this._fpScale/l,n){if(Wn.toArray(s,n.direction,mu.MAIN_LIT_DIR_OFFSET),Wn.toArray(s,n.color,mu.MAIN_LIT_COLOR_OFFSET),n.useColorTemperature){var u=n.colorTemperatureRGB;s[mu.MAIN_LIT_COLOR_OFFSET]*=u.x,s[mu.MAIN_LIT_COLOR_OFFSET+1]*=u.y,s[mu.MAIN_LIT_COLOR_OFFSET+2]*=u.z}this._isHDR?s[mu.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*this._fpScale:s[mu.MAIN_LIT_COLOR_OFFSET+3]=n.illuminance*l}else Wn.toArray(s,Wn.UNIT_Z,mu.MAIN_LIT_DIR_OFFSET),di.toArray(s,di.ZERO,mu.MAIN_LIT_COLOR_OFFSET);var h=i.colorArray;this._isHDR?h[3]=i.skyIllum*this._fpScale:h[3]=i.skyIllum*l,s.set(h,mu.AMBIENT_SKY_OFFSET),s.set(i.albedoArray,mu.AMBIENT_GROUND_OFFSET),ai.toArray(s,e.matView,mu.MAT_VIEW_OFFSET),ai.toArray(s,e.node.worldMatrix,mu.MAT_VIEW_INV_OFFSET),ai.toArray(s,e.matProj,mu.MAT_PROJ_OFFSET),ai.toArray(s,e.matProjInv,mu.MAT_PROJ_INV_OFFSET),ai.toArray(s,e.matViewProj,mu.MAT_VIEW_PROJ_OFFSET),ai.toArray(s,e.matViewProjInv,mu.MAT_VIEW_PROJ_INV_OFFSET),Wn.toArray(s,e.position,mu.CAMERA_POS_OFFSET);var _=t.screenSpaceSignY;e.window.hasOffScreenAttachments&&(_*=t.UVSpaceSignY),s[mu.CAMERA_POS_OFFSET+3]=_,r.enabled&&(s.set(r.colorArray,mu.GLOBAL_FOG_COLOR_OFFSET),s[mu.GLOBAL_FOG_BASE_OFFSET]=r.fogStart,s[mu.GLOBAL_FOG_BASE_OFFSET+1]=r.fogEnd,s[mu.GLOBAL_FOG_BASE_OFFSET+2]=r.fogDensity,s[mu.GLOBAL_FOG_ADD_OFFSET]=r.fogTop,s[mu.GLOBAL_FOG_ADD_OFFSET+1]=r.fogRange,s[mu.GLOBAL_FOG_ADD_OFFSET+2]=r.fogAtten),this._commandBuffers[0].updateBuffer(this._descriptorSet.getBuffer(mu.BINDING),this._cameraUBO)},n.destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(du.BINDING).destroy(),this._descriptorSet.getBuffer(pu.BINDING).destroy(),this._descriptorSet.getBuffer(mu.BINDING).destroy(),this._descriptorSet.getSampler(vu).destroy(),this._descriptorSet.getSampler(Su).destroy(),this._descriptorSet.getTexture(vu).destroy(),this._descriptorSet.getTexture(Su).destroy())},n.destroy=function(){this.destroyUBOs();for(var t=this._renderPasses.values(),n=t.next();!n.done;)n.value.destroy(),n=t.next();return this._commandBuffers.length=0,this.ambient.destroy(),this.skybox.destroy(),this.fog.destroy(),this.shadows.destroy(),e.prototype.destroy.call(this)},Z(t,[{key:"isHDR",get:function(){return this._isHDR},set:function(e){this._isHDR!==e&&(this._isHDR=e,this._cameraUBO[mu.EXPOSURE_OFFSET+2]=this._isHDR?1:0)}},{key:"shadingScale",get:function(){return this._shadingScale}},{key:"fpScale",get:function(){return this._fpScale}},{key:"shadowUBO",get:function(){return this._shadowUBO}}]),t}(pg),dE=se((fE=pE).prototype,"renderTextures",[cE,Ph,lE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mE=se(fE.prototype,"materials",[uE,Ph,hE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_E=fE))||_E));function RE(e,t){for(var n,i=oe(t);!(n=i()).done;){var r=n.value;Array.isArray(r)?RE(e,r):e.push(r)}}function OE(e){var t=[];return RE(t,e),t.join("")}var NE=D_.Flags.Destroyed,PE=D_.Flags.PersistentMask,ME=vn.IDENTIFIER_RE,DE="var ",LE="o",FE={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},zE=vn.escapeForJS,BE=function(){function e(e,t){this.varName=void 0,this.expression=void 0,this.varName=e,this.expression=t}return e.prototype.toString=function(){return DE+this.varName+"="+this.expression+";"},e}();function UE(e,t){return t instanceof BE?new BE(t.varName,e+t.expression):e+t}function GE(e,t,n){Array.isArray(n)?(n[0]=UE(t,n[0]),e.push(n)):e.push(UE(t,n)+";")}var HE=function(){function e(e){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=e}var t=e.prototype;return t.append=function(e,t){this._exps.push([e,t])},t.writeCode=function(e){var t;if(this._exps.length>1)e.push("t="+this._targetExp+";"),t="t";else{if(1!==this._exps.length)return;t=this._targetExp}for(var n=0;n<this._exps.length;n++){var i=this._exps[n];GE(e,t+kE(i[0])+"=",i[1])}},e}();function kE(e){return ME.test(e)?"."+e:"["+zE(e)+"]"}HE.pool=void 0,HE.pool=new vt((function(e){e._exps.length=0,e._targetExp=null}),1),HE.pool.get=function(e){var t=this._get()||new HE;return t._targetExp=e,t};var VE=function(){function e(e,t){var n;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=t,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=Ve(),et(this.funcModuleCache,FE),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(e.constructor,!0)+"();","}"),e._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(e),this.enumerateObject(this.codeArray,e),this.globalVariables.length>0&&(n=DE+this.globalVariables.join(",")+";");var i=OE(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",i)(this.objs,this.funcs);for(var r=0,o=this.objsToClear_iN$t.length;r<o;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}var t=e.prototype;return t.getFuncModule=function(e,t){var n=je(e);if(n){var i=this.funcModuleCache[n];if(i)return i;if(void 0===i){var r=-1!==n.indexOf(".");if(r)try{if(r=e===Function("return "+n)())return this.funcModuleCache[n]=n,n}catch(e){}}}var o=this.funcs.indexOf(e);o<0&&(o=this.funcs.length,this.funcs.push(e));var a="F["+o+"]";return t&&(a="("+a+")"),this.funcModuleCache[n]=a,a},t.getObjRef=function(e){var t=this.objs.indexOf(e);return t<0&&(t=this.objs.length,this.objs.push(e)),"O["+t+"]"},t.setValueType=function(e,t,n,i){var r=HE.pool.get(i),o=t.constructor.__props__;o||(o=Object.keys(t));for(var a=0;a<o.length;a++){var s=o[a],c=n[s];if(t[s]!==c){var l=this.enumerateField(n,s,c);r.append(s,l)}}r.writeCode(e),HE.pool.put(r)},t.enumerateCCClass=function(e,t,n){for(var i=n.__values__,r=Yt(n),o=0;o<i.length;o++){var a=i[o],s=t[a],l=r[a+"$_$default"];if(!jE(l,s))if("object"==typeof s&&s instanceof c.ValueType&&(l=vn.getDefault(l))&&l.constructor===s.constructor){var u=LE+kE(a);this.setValueType(e,l,s,u)}else this.setObjProp(e,t,a,s)}},t.instantiateArray=function(e){if(0===e.length)return"[]";var t="a"+ ++this.localVariableId,n=[new BE(t,"new Array("+e.length+")")];e._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(e);for(var i=0;i<e.length;++i)GE(n,t+"["+i+"]=",this.enumerateField(e,i,e[i]));return n},t.instantiateTypedArray=function(e){var t=e.constructor.name;if(0===e.length)return"new "+t;var n="a"+ ++this.localVariableId,i=[new BE(n,"new "+t+"("+e.length+")")];e._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(e);for(var r=0;r<e.length;++r)0!==e[r]&&GE(i,n+"["+r+"]=",e[r]);return i},t.enumerateField=function(e,t,n){if("object"==typeof n&&n){var i=n._iN$t;if(i){var r=i.globalVar;if(!r){r=i.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var o=i.source[0];i.source[0]=UE(r+"=",o)}return r}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?zE(n):("_objFlags"===t&&e instanceof D_&&(n&=PE),n)},t.setObjProp=function(e,t,n,i){GE(e,LE+kE(n)+"=",this.enumerateField(t,n,i))},t.enumerateObject=function(e,t){var n=t.constructor;if(c.Class._isCCClass(n))this.enumerateCCClass(e,t,n);else for(var i in t)if(t.hasOwnProperty(i)&&(95!==i.charCodeAt(0)||95!==i.charCodeAt(1)||"__type__"===i)){var r=t[i];"object"==typeof r&&r&&r===t._iN$t||this.setObjProp(e,t,i,r)}},t.instantiateObj=function(e){if(e instanceof c.ValueType)return vn.getNewValueTypeCode(e);if(e instanceof c.Asset)return this.getObjRef(e);if(e._objFlags&NE)return null;var t,n=e.constructor;if(c.Class._isCCClass(n)){if(this.parent)if(this.parent instanceof c.Component){if(e instanceof c._BaseNode||e instanceof c.Component)return this.getObjRef(e)}else if(this.parent instanceof c._BaseNode)if(e instanceof c._BaseNode){if(!e.isChildOf(this.parent))return this.getObjRef(e)}else if(e instanceof c.Component&&!e.node.isChildOf(this.parent))return this.getObjRef(e);t=new BE(LE,"new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)t=new BE(LE,"{}");else{if(n)return this.getObjRef(e);t=new BE(LE,"Object.create(null)")}var i=[t];return e._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(e),this.enumerateObject(i,e),["(function(){",i,"return o;})();"]},e}();function jE(e,t){if("function"==typeof e)try{e=e()}catch(e){return!1}if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t&&e.constructor===t.constructor)if(e instanceof c.ValueType){if(e.equals(t))return!0}else{if(Array.isArray(e))return 0===e.length&&0===t.length;if(e.constructor===Object)return ze(e)&&ze(t)}return!1}var WE=Object.freeze({__proto__:null,ccclass:bh,property:Nh,requireComponent:Ih,executionOrder:Rh,disallowMultiple:Oh,executeInEditMode:Lh,menu:Fh,playOnFocus:zh,inspector:Bh,icon:Uh,help:Gh,type:n_,integer:Jh,float:$h,boolean:e_,string:t_});e("e9",WE);var qE,YE,XE,KE,QE,ZE,JE,$E,eT,tT,nT,iT=D_.Flags.Destroyed,rT=D_.Flags.PersistentMask,oT=[];function aT(e,t){var n;if(e instanceof D_){if(e._instantiate)return c.game._isCloning=!0,n=e._instantiate(null,!0),c.game._isCloning=!1,n;if(e instanceof c.Asset)throw new TypeError(M(6903))}return c.game._isCloning=!0,n=sT(e),c.game._isCloning=!1,n}function sT(e,t){var n;cT(e,n=e._iN$t?e._iN$t:e.constructor?new(0,e.constructor):Object.create(null),t);for(var i=0,r=oT.length;i<r;++i)oT[i]._iN$t=null;return oT.length=0,n}function cT(e,t,n){yt.value(e,"_iN$t",t,!0),oT.push(e);var i=e.constructor;if(c.Class._isCCClass(i))!function(e,t,n,i){for(var r=e.__values__,o=0;o<r.length;o++){var a=r[o],s=t[a];if("object"==typeof s&&s){var c=n[a];c instanceof bt&&c.constructor===s.constructor?c.set(s):n[a]=s._iN$t||lT(s,i)}else n[a]=s}}(i,e,t,n);else for(var r in e)if(e.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var o=e[r];if("object"==typeof o&&o){if(o===t)continue;t[r]=o._iN$t||lT(o,n)}else t[r]=o}e instanceof D_&&(t._objFlags&=rT)}function lT(e,t){if(e instanceof bt)return e.clone();if(e instanceof c.Asset)return e;var n;if(ArrayBuffer.isView(e)){var i=e.length;n=new e.constructor(i),e._iN$t=n,oT.push(e);for(var r=0;r<i;++r)n[r]=e[r];return n}if(Array.isArray(e)){var o=e.length;n=new Array(o),e._iN$t=n,oT.push(e);for(var a=0;a<o;++a){var s=e[a];n[a]="object"==typeof s&&s?s._iN$t||lT(s,t):s}return n}if(e._objFlags&iT)return null;var l=e.constructor;if(c.Class._isCCClass(l)){if(t)if(t instanceof c.Component){if(e instanceof c._BaseNode||e instanceof c.Component)return e}else if(t instanceof c._BaseNode)if(e instanceof c._BaseNode){if(!e.isChildOf(t))return e}else if(e instanceof c.Component&&!e.node.isChildOf(t))return e;n=new l}else if(l===Object)n={};else{if(l)return e;n=Object.create(null)}return cT(e,n,t),n}function uT(e,t){return(t<<3)+e}aT._clone=sT,c.instantiate=aT,function(e){e[e.Uint8=0]="Uint8",e[e.Uint16=1]="Uint16",e[e.Uint32=2]="Uint32",e[e.Int8=3]="Int8",e[e.Int16=4]="Int16",e[e.Int32=5]="Int32",e[e.Float32=6]="Float32",e[e.Float64=7]="Float64"}(tT||(tT={})),function(e){e[e.Scalar=0]="Scalar",e[e.Vec2=1]="Vec2",e[e.Vec3=2]="Vec3",e[e.Vec4=3]="Vec4",e[e.Quat=4]="Quat",e[e.Mat4=5]="Mat4"}(nT||(nT={}));var hT=e("ed",bh("cc.CompactValueTypeArray")(($E=JE=function(){function e(){ae(this,"_byteOffset",XE,this),ae(this,"_unitCount",KE,this),ae(this,"_unitElement",QE,this),ae(this,"_length",ZE,this)}return e.lengthFor=function(e,t,n){return _T(t).requiredUnits*e.length*fT(n).BYTES_PER_ELEMENT},e.compress=function(t,n,i,r,o,a){for(var s=_T(n),c=fT(i),l=s.requiredUnits*t.length,u=new c(r,o,l),h=0;h<t.length;++h)s.compress(u,h,t[h]);var _=new e;return _._unitElement=uT(i,n),_._byteOffset=a,_._unitCount=l,_._length=t.length,_},e.prototype.decompress=function(e){for(var t,n={storageUnit:7&(t=this._unitElement),elementType:t>>3},i=n.storageUnit,r=_T(n.elementType),o=new(fT(i))(e,this._byteOffset,this._unitCount),a=new Array(this._length),s=0;s<this._length;++s)a[s]=r.decompress(o,s);return a},e}(),JE.StorageUnit=tT,JE.ElementType=nT,XE=se((YE=$E).prototype,"_byteOffset",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),KE=se(YE.prototype,"_unitCount",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),QE=se(YE.prototype,"_unitElement",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uT(tT.Uint8,nT.Scalar)}}),ZE=se(YE.prototype,"_length",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qE=YE))||qE);function _T(e){return pS[e]}function fT(e){switch(e){case tT.Uint8:return Uint8Array;case tT.Uint16:return Uint16Array;case tT.Uint32:return Uint32Array;case tT.Int8:return Int8Array;case tT.Int16:return Int16Array;case tT.Int32:return Int32Array;case tT.Float32:return Float32Array;case tT.Float64:return Float64Array}}var dT,mT,pT,vT,gT,yT,xT,ET,TT,ST,AT,CT,wT,bT,IT,RT,OT,NT,PT,MT,DT,LT,FT,zT,BT,UT,GT,HT,kT,VT,jT,WT,qT,YT,XT,KT,QT,ZT,JT,$T,eS,tS,nS,iS,rS,oS,aS,sS,cS,lS,uS,hS,_S,fS,dS,mS,pS=((eT={})[nT.Scalar]={requiredUnits:1,compress:function(e,t,n){e[t]=n},decompress:function(e,t){return e[t]}},eT[nT.Vec2]={requiredUnits:2,compress:function(e,t,n){e[2*t]=n.x,e[2*t+1]=n.y},decompress:function(e,t){return new Wn(e[2*t],e[2*t+1])}},eT[nT.Vec3]={requiredUnits:3,compress:function(e,t,n){e[3*t]=n.x,e[3*t+1]=n.y,e[3*t+2]=n.z},decompress:function(e,t){return new Wn(e[3*t],e[3*t+1],e[3*t+2])}},eT[nT.Vec4]={requiredUnits:4,compress:function(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:function(e,t){return new di(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])}},eT[nT.Quat]={requiredUnits:4,compress:function(e,t,n){e[4*t]=n.x,e[4*t+1]=n.y,e[4*t+2]=n.z,e[4*t+3]=n.w},decompress:function(e,t){return new Jn(e[4*t],e[4*t+1],e[4*t+2],e[4*t+3])}},eT[nT.Mat4]={requiredUnits:16,compress:function(e,t,n){ai.toArray(e,n,16*t)},decompress:function(e,t){return ai.fromArray(new ai,e,16*t)}},eT);c._decorator=WE;var vS=bh("cc.TargetInfo")((pT=se((mT=function(){ae(this,"localID",pT,this)}).prototype,"localID",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dT=mT))||dT,gS=(vT=bh("cc.TargetOverrideInfo"),gT=n_(D_),yT=n_(vS),xT=n_(c.Node),ET=n_(vS),vT((AT=se((ST=function(){ae(this,"source",AT,this),ae(this,"sourceInfo",CT,this),ae(this,"propertyPath",wT,this),ae(this,"target",bT,this),ae(this,"targetInfo",IT,this)}).prototype,"source",[Ph,gT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),CT=se(ST.prototype,"sourceInfo",[Ph,yT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wT=se(ST.prototype,"propertyPath",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bT=se(ST.prototype,"target",[Ph,xT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),IT=se(ST.prototype,"targetInfo",[Ph,ET],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TT=ST))||TT),yS=(RT=bh("cc.PrefabInfo"),OT=n_([gS]),RT((MT=se((PT=function(){ae(this,"root",MT,this),ae(this,"asset",DT,this),ae(this,"fileId",LT,this),ae(this,"instance",FT,this),ae(this,"targetOverrides",zT,this)}).prototype,"root",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DT=se(PT.prototype,"asset",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LT=se(PT.prototype,"fileId",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),FT=se(PT.prototype,"instance",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zT=se(PT.prototype,"targetOverrides",[Ph,OT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NT=PT))||NT);c._PrefabInfo=yS;var xS=bh("cc.CompPrefabInfo")((GT=se((UT=function(){ae(this,"fileId",GT,this)}).prototype,"fileId",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),BT=UT))||BT,ES=(HT=bh("CCPropertyOverrideInfo"),kT=n_(vS),HT((XT=function(){function e(){ae(this,"targetInfo",WT,this),ae(this,"propertyPath",qT,this),ae(this,"value",YT,this)}return e.prototype.isTarget=function(e,t){},e}(),WT=se((jT=XT).prototype,"targetInfo",[Ph,kT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qT=se(jT.prototype,"propertyPath",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YT=se(jT.prototype,"value",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VT=jT))||VT),TS=(KT=bh("cc.MountedChildrenInfo"),QT=n_(vS),ZT=n_([c.Node]),KT((nS=function(){function e(){ae(this,"targetInfo",eS,this),ae(this,"nodes",tS,this)}return e.prototype.isTarget=function(e){},e}(),eS=se(($T=nS).prototype,"targetInfo",[Ph,QT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tS=se($T.prototype,"nodes",[Ph,ZT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JT=$T))||JT),SS=(iS=bh("cc.PrefabInstance"),rS=n_(c.Node),oS=n_([TS]),aS=n_([ES]),sS=n_([vS]),iS((mS=function(){function e(){ae(this,"fileId",uS,this),ae(this,"prefabRootNode",hS,this),ae(this,"mountedChildren",_S,this),ae(this,"propertyOverrides",fS,this),ae(this,"removedComponents",dS,this),this.targetMap={}}var t=e.prototype;return t.findPropertyOverride=function(e,t){},t.removePropertyOverride=function(e,t){},e}(),uS=se((lS=mS).prototype,"fileId",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),hS=se(lS.prototype,"prefabRootNode",[Ph,rS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_S=se(lS.prototype,"mountedChildren",[Ph,oS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fS=se(lS.prototype,"propertyOverrides",[Ph,aS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dS=se(lS.prototype,"removedComponents",[Ph,sS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cS=lS))||cS);function AS(e){var t=e._prefab;if(t&&t.instance){if(!t.asset)return R(3701,e.name),void(t.instance=null);var n=e._objFlags,i=e._parent,r=e._id,o=e._prefab;c.game._isCloning=!0,t.asset._doInstantiate(e),c.game._isCloning=!1,e._objFlags=n,e._parent=i,e._id=r,e._prefab&&(e._prefab.instance=null==o?void 0:o.instance)}}function CS(e,t,n){var i,r=t,o=null===(i=e._prefab)||void 0===i?void 0:i.instance;!n&&o&&(t[o.fileId]={},r=t[o.fileId]);var a=e._prefab;a&&(r[a.fileId]=e);for(var s=e.components,c=0;c<s.length;c++){var l=s[c];l.__prefab&&(r[l.__prefab.fileId]=l)}for(var u=0;u<e.children.length;u++)CS(e.children[u],r,!1)}function wS(e,t){if(!e)return null;for(var n=t,i=0;i<e.length;i++){if(!n)return null;n=n[e[i]]}return n}function bS(e,t,n){if(t)for(var i=0;i<t.length;i++){var r=t[i];if(r&&r.targetInfo){var o=wS(r.targetInfo.localID,n);if(!o)continue;if(r.nodes)for(var a=0;a<r.nodes.length;a++){var s=r.nodes[a];o._children.push(s),s._parent=o,s._onBatchCreated(!1)}}}}function IS(e,t,n){if(!(t.length<=0))for(var i=null,r=0;r<t.length;r++){var o=t[r];if(o&&o.targetInfo){if(!(i=wS(o.targetInfo.localID,n)))continue;var a=i,s=o.propertyPath.slice();if(s.length>0){var c=s.pop();if(!c)continue;for(var l=0;l<s.length&&(a=a[s[l]]);l++);if(!a)continue;if(Array.isArray(a))if("length"===c)a[c]=o.value;else{var u=Number.parseInt(c);Number.isInteger(u)&&u<a.length&&(a[c]=o.value)}else a[c]=o.value}}}}function RS(e){var t,n=null===(t=e._prefab)||void 0===t?void 0:t.targetOverrides;if(n)for(var i=0;i<n.length;i++){var r,o,a=n[i],s=a.source,c=a.sourceInfo;if(c){var l,u,h=null===(l=a.source)||void 0===l||null===(u=l._prefab)||void 0===u?void 0:u.instance;if(h&&h.targetMap&&(s=wS(c.localID,h.targetMap)),!s)continue}var _,f=a.targetInfo;if(f){var d=null===(r=a.target)||void 0===r||null===(o=r._prefab)||void 0===o?void 0:o.instance;if(d&&d.targetMap&&(_=wS(f.localID,d.targetMap))){var m=a.propertyPath.slice(),p=s;if(m.length>0){var v=m.pop();if(!v)return;for(var g=0;g<m.length;g++)p=p[m[g]];p[v]=_}}}}}var OS,NS,PS,MS,DS,LS,FS,zS,BS,US,GS,HS,kS,VS,jS=Object.freeze({__proto__:null,TargetInfo:vS,TargetOverrideInfo:gS,PrefabInfo:yS,CompPrefabInfo:xS,PropertyOverrideInfo:ES,MountedChildrenInfo:TS,PrefabInstance:SS,createNodeWithPrefab:AS,generateTargetMap:CS,getTarget:wS,applyMountedChildren:bS,applyPropertyOverrides:IS,applyTargetOverrides:RS}),WS=St({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),qS=e("ef",bh("cc.Prefab")((FS=LS=function(e){function t(){var t;return ae(t=e.call(this)||this,"data",PS,ie(t)),ae(t,"optimizationPolicy",MS,ie(t)),ae(t,"asyncLoadAssets",DS,ie(t)),t._createFunction=void 0,t._instantiatedTimes=void 0,t._createFunction=null,t._instantiatedTimes=0,t}$(t,e);var n=t.prototype;return n.createNode=function(e){var t=c.instantiate(this);t.name=this.name,e(null,t)},n.compileCreateFunction=function(){var e,t;this._createFunction=(t=(e=this.data)instanceof c._BaseNode&&e,new VE(e,t).result)},n._doInstantiate=function(e){return this.data._prefab||b(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(e)},n._instantiate=function(){var e;return this.optimizationPolicy!==WS.SINGLE_INSTANCE&&(this.optimizationPolicy===WS.MULTI_INSTANCE||this._instantiatedTimes+1>=t.OptimizationPolicyThreshold)?(e=this._doInstantiate(),this.data._instantiate(e)):e=this.data._instantiate(),++this._instantiatedTimes,e},t}(Z_),LS.OptimizationPolicy=WS,LS.OptimizationPolicyThreshold=3,PS=se((NS=FS).prototype,"data",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MS=se(NS.prototype,"optimizationPolicy",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return WS.AUTO}}),DS=se(NS.prototype,"asyncLoadAssets",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),OS=NS))||OS);yt.value(qS,"_utils",jS),c.Prefab=qS,We(c,"cc._Prefab","Prefab"),e("e3",(zS=bh("cc.PrefabLink"),BS=n_(qS),US=kh(),zS((VS=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"prefab",kS,ie(t)),t}return $(t,e),t}(gd),kS=se((HS=VS).prototype,"prefab",[BS,Ph,US],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GS=HS))||GS));var YS=new Wn;function XS(e,t,n,i){i||(i=new Wn),e.convertToUINode(t,n,i);var r=n.position;return i.add(r),i}function KS(e,t,n){return n||(n=new Wn),e.worldToScreen(t,n),n.x/=c.view.getScaleX(),n.y/=c.view.getScaleY(),n}var QS=e("e8",{WorldNode3DToLocalNodeUI:XS,WorldNode3DToWorldNodeUI:KS});c.pipelineUtils=QS,ve(c.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0],r=t[3]||YS;return i.convertToUINode(t[1],t[2],r),r.add(t[2].position),t[3]||r.clone()}}]);var ZS=new ui,JS=e("ex",function(e){function t(n,i,r){var o;return(o=e.call(this,R_.MOUSE,i)||this).movementX=0,o.movementY=0,o.eventType=void 0,o._button=t.BUTTON_MISSING,o._x=0,o._y=0,o._prevX=0,o._prevY=0,o._scrollX=0,o._scrollY=0,o.eventType=n,r&&(o._prevX=r.x,o._prevY=r.y),o}$(t,e);var n=t.prototype;return n.setScrollData=function(e,t){this._scrollX=e,this._scrollY=t},n.getScrollX=function(){return this._scrollX},n.getScrollY=function(){return this._scrollY},n.setLocation=function(e,t){this._x=e,this._y=t},n.getLocation=function(e){return e||(e=new ui),ui.set(e,this._x,this._y),e},n.getLocationInView=function(e){return e||(e=new ui),ui.set(e,this._x,c.view._designResolutionSize.height-this._y),e},n.getUILocation=function(e){return e||(e=new ui),ui.set(e,this._x,this._y),c.view._convertPointWithScale(e),e},n.getPreviousLocation=function(e){return e||(e=new ui),ui.set(e,this._prevX,this._prevY),e},n.getUIPreviousLocation=function(e){return e||(e=new ui),ui.set(e,this._prevX,this._prevY),c.view._convertPointWithScale(e),e},n.getDelta=function(e){return e||(e=new ui),ui.set(e,this._x-this._prevX,this._y-this._prevY),e},n.getDeltaX=function(){return this._x-this._prevX},n.getDeltaY=function(){return this._y-this._prevY},n.getUIDelta=function(e){return e||(e=new ui),ui.set(e,(this._x-this._prevX)/c.view.getScaleX(),(this._y-this._prevY)/c.view.getScaleY()),e},n.getUIDeltaX=function(){return(this._x-this._prevX)/c.view.getScaleX()},n.getUIDeltaY=function(){return(this._y-this._prevY)/c.view.getScaleY()},n.setButton=function(e){this._button=e},n.getButton=function(){return this._button},n.getLocationX=function(){return this._x},n.getLocationY=function(){return this._y},n.getUILocationX=function(){var e=c.view.getViewportRect();return(this._x-e.x)/c.view.getScaleX()},n.getUILocationY=function(){var e=c.view.getViewportRect();return(this._y-e.y)/c.view.getScaleY()},t}(R_));JS.NONE=0,JS.DOWN=1,JS.UP=2,JS.MOVE=3,JS.SCROLL=4,JS.BUTTON_MISSING=-1,JS.BUTTON_LEFT=0,JS.BUTTON_RIGHT=2,JS.BUTTON_MIDDLE=1,JS.BUTTON_4=3,JS.BUTTON_5=4,JS.BUTTON_6=5,JS.BUTTON_7=6,JS.BUTTON_8=7;var $S=e("cN",function(e){function t(t,n,i,r){var o;return(o=e.call(this,R_.TOUCH,n)||this).touch=null,o.simulate=!1,o._eventCode=void 0,o._touches=void 0,o._allTouches=void 0,o._eventCode=i||0,o._touches=t||[],o._allTouches=r||[],o}$(t,e);var n=t.prototype;return n.getEventCode=function(){return this._eventCode},n.getTouches=function(){return this._touches},n.getAllTouches=function(){return this._allTouches},n.setLocation=function(e,t){this.touch&&this.touch.setTouchInfo(this.touch.getID(),e,t)},n.getLocation=function(e){return this.touch?this.touch.getLocation(e):new ui},n.getUILocation=function(e){return this.touch?this.touch.getUILocation(e):new ui},n.getLocationInView=function(e){return this.touch?this.touch.getLocationInView(e):new ui},n.getPreviousLocation=function(e){return this.touch?this.touch.getPreviousLocation(e):new ui},n.getStartLocation=function(e){return this.touch?this.touch.getStartLocation(e):new ui},n.getUIStartLocation=function(e){return this.touch?this.touch.getUIStartLocation(e):new ui},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(e){return this.touch?this.touch.getDelta(e):new ui},n.getUIDelta=function(e){return this.touch?this.touch.getUIDelta(e):new ui},n.getDeltaX=function(){return this.touch?this.touch.getDelta(ZS).x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta(ZS).y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},t}(R_));$S.MAX_TOUCHES=5,$S.BEGAN=0,$S.MOVED=1,$S.ENDED=2,$S.CANCELLED=3;var eA=e("ey",function(e){function t(t,n){var i;return(i=e.call(this,R_.ACCELERATION,n)||this).acc=void 0,i.acc=t,i}return $(t,e),t}(R_)),tA=e("ez",function(e){function t(t,n,i){var r;return(r=e.call(this,R_.KEYBOARD,i)||this).keyCode=void 0,r.rawEvent=void 0,r.isPressed=void 0,"number"==typeof t?r.keyCode=t:(r.keyCode=t.keyCode,r.rawEvent=t),r.isPressed=n,r}return $(t,e),t}(R_));R_.EventMouse=JS,R_.EventTouch=$S,R_.EventAcceleration=eA,R_.EventKeyboard=tA;var nA=function(){function e(e,t,n){this._cameraPriority=0,this.owner=null,this.mask=null,this._previousIn=!1,this._target=null,this._onEvent=void 0,this._type=void 0,this._listenerID=void 0,this._registered=!1,this._fixedPriority=0,this._node=null,this._paused=!0,this._isEnabled=!0,this._onEvent=n,this._type=e||0,this._listenerID=t||""}e.create=function(e){P(e&&e.event,1900);var t=e.event;delete e.event;var n=null;if(t===c.EventListener.TOUCH_ONE_BY_ONE?n=new oA:t===c.EventListener.TOUCH_ALL_AT_ONCE?n=new aA:t===c.EventListener.MOUSE?n=new rA:t===c.EventListener.KEYBOARD?n=new cA:t===c.EventListener.ACCELERATION&&(n=new sA(e.callback),delete e.callback),n)for(var i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];n[o]=e[o]}return n},Z(e,[{key:"onEvent",get:function(){return this._onEvent}}]);var t=e.prototype;return t._setPaused=function(e){this._paused=e},t._isPaused=function(){return this._paused},t._setRegistered=function(e){this._registered=e},t._isRegistered=function(){return this._registered},t._getType=function(){return this._type},t._getListenerID=function(){return this._listenerID},t._setFixedPriority=function(e){this._fixedPriority=e},t._getFixedPriority=function(){return this._fixedPriority},t._setSceneGraphPriority=function(e){this._target=e,this._node=e},t._getSceneGraphPriority=function(){return this._node},t.checkAvailable=function(){return null!==this._onEvent},t.clone=function(){return null},t.setEnabled=function(e){this._isEnabled=e},t.isEnabled=function(){return this._isEnabled},e}();nA.UNKNOWN=0,nA.TOUCH_ONE_BY_ONE=1,nA.TOUCH_ALL_AT_ONCE=2,nA.KEYBOARD=3,nA.MOUSE=4,nA.ACCELERATION=6,nA.CUSTOM=8,nA.ListenerID={MOUSE:"__cc_mouse",TOUCH_ONE_BY_ONE:"__cc_touch_one_by_one",TOUCH_ALL_AT_ONCE:"__cc_touch_all_at_once",KEYBOARD:"__cc_keyboard",ACCELERATION:"__cc_acceleration"};var iA=nA.ListenerID,rA=function(e){function t(){var t;return(t=e.call(this,nA.MOUSE,iA.MOUSE,null)||this).onMouseDown=null,t.onMouseUp=null,t.onMouseMove=null,t.onMouseScroll=null,t._onEvent=function(e){return t._callback(e)},t}$(t,e);var n=t.prototype;return n._callback=function(e){var t=c.Event.EventMouse;switch(e.eventType){case t.DOWN:this.onMouseDown&&this.onMouseDown(e);break;case t.UP:this.onMouseUp&&this.onMouseUp(e);break;case t.MOVE:this.onMouseMove&&this.onMouseMove(e);break;case t.SCROLL:this.onMouseScroll&&this.onMouseScroll(e)}},n.clone=function(){var e=new t;return e.onMouseDown=this.onMouseDown,e.onMouseUp=this.onMouseUp,e.onMouseMove=this.onMouseMove,e.onMouseScroll=this.onMouseScroll,e},n.checkAvailable=function(){return!0},t}(nA),oA=function(e){function t(){var t;return(t=e.call(this,nA.TOUCH_ONE_BY_ONE,iA.TOUCH_ONE_BY_ONE,null)||this).swallowTouches=!1,t.onTouchBegan=null,t.onTouchMoved=null,t.onTouchEnded=null,t.onTouchCancelled=null,t._claimedTouches=[],t}$(t,e);var n=t.prototype;return n.setSwallowTouches=function(e){this.swallowTouches=e},n.isSwallowTouches=function(){return this.swallowTouches},n.clone=function(){var e=new t;return e.onTouchBegan=this.onTouchBegan,e.onTouchMoved=this.onTouchMoved,e.onTouchEnded=this.onTouchEnded,e.onTouchCancelled=this.onTouchCancelled,e.swallowTouches=this.swallowTouches,e},n.checkAvailable=function(){return!!this.onTouchBegan||(C(1801),!1)},t}(nA),aA=function(e){function t(){var t;return(t=e.call(this,nA.TOUCH_ALL_AT_ONCE,iA.TOUCH_ALL_AT_ONCE,null)||this).onTouchesBegan=null,t.onTouchesMoved=null,t.onTouchesEnded=null,t.onTouchesCancelled=null,t}$(t,e);var n=t.prototype;return n.clone=function(){var e=new t;return e.onTouchesBegan=this.onTouchesBegan,e.onTouchesMoved=this.onTouchesMoved,e.onTouchesEnded=this.onTouchesEnded,e.onTouchesCancelled=this.onTouchesCancelled,e},n.checkAvailable=function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(C(1802),!1)},t}(nA),sA=function(e){function t(t){var n;return(n=e.call(this,nA.ACCELERATION,iA.ACCELERATION,null)||this)._onAccelerationEvent=null,n._onEvent=function(e){return n._callback(e)},n._onAccelerationEvent=t,n}$(t,e);var n=t.prototype;return n._callback=function(e){this._onAccelerationEvent&&this._onAccelerationEvent(e.acc,e)},n.checkAvailable=function(){return P(this._onAccelerationEvent,1803),!0},n.clone=function(){return new t(this._onAccelerationEvent)},t}(nA),cA=function(e){function t(){var t;return(t=e.call(this,nA.KEYBOARD,iA.KEYBOARD,null)||this).onKeyPressed=null,t.onKeyReleased=null,t._onEvent=function(e){return t._callback(e)},t}$(t,e);var n=t.prototype;return n._callback=function(e){e.isPressed?this.onKeyPressed&&this.onKeyPressed(e.keyCode,e):this.onKeyReleased&&this.onKeyReleased(e.keyCode,e)},n.clone=function(){var e=new t;return e.onKeyPressed=this.onKeyPressed,e.onKeyReleased=this.onKeyReleased,e},n.checkAvailable=function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(C(1800),!1)},t}(nA);c.EventListener=nA;var lA=nA.ListenerID,uA=function(){function e(){this.gt0Index=0,this._fixedListeners=[],this._sceneGraphListeners=[]}var t=e.prototype;return t.size=function(){return this._fixedListeners.length+this._sceneGraphListeners.length},t.empty=function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},t.push=function(e){0===e._getFixedPriority()?this._sceneGraphListeners.push(e):this._fixedListeners.push(e)},t.clearSceneGraphListeners=function(){this._sceneGraphListeners.length=0},t.clearFixedListeners=function(){this._fixedListeners.length=0},t.clear=function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},t.getFixedPriorityListeners=function(){return this._fixedListeners},t.getSceneGraphPriorityListeners=function(){return this._sceneGraphListeners},e}(),hA=function(){function e(){this._listenersMap={},this._priorityDirtyFlagMap={},this._nodeListenersMap={},this._toAddedListeners=[],this._toRemovedListeners=[],this._dirtyListeners={},this._inDispatch=0,this._isEnabled=!1,this._internalCustomListenerIDs=[],this._currentTouch=null,this._currentTouchListener=null}var t=e.prototype;return t.pauseTarget=function(e,t){if(void 0===t&&(t=!1),e instanceof c._BaseNode){var n=this._nodeListenersMap[e.uuid];if(n)for(var i=0;i<n.length;++i)n[i]._setPaused(!0);if(!0===t){var r=e.children;if(r)for(var o=0;o<r.length;++o){var a=r[o];this.pauseTarget(a,!0)}}}else b(3506)},t.resumeTarget=function(e,t){if(void 0===t&&(t=!1),e instanceof c._BaseNode){var n=this._nodeListenersMap[e.uuid];if(n)for(var i=0;i<n.length;++i)n[i]._setPaused(!1);if(this._setDirtyForNode(e),!0===t&&e.children.length>0){var r=e.children;if(r)for(var o=0;o<r.length;++o){var a=r[o];this.resumeTarget(a,!0)}}}else b(3506)},t.frameUpdateListeners=function(){var e=this._listenersMap,t=this._priorityDirtyFlagMap;for(var n in e)e[n].empty()&&(delete t[n],delete e[n]);var i=this._toAddedListeners;if(0!==i.length){for(var r=0,o=i.length;r<o;r++)this._forceAddEventListener(i[r]);i.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},t.hasEventListener=function(e){return!!this._getListeners(e)},t.addListener=function(e,t){if(P(e&&t,3503),!(c.js.isNumber(t)||t instanceof c._BaseNode))return b(3506),null;if(e instanceof c.EventListener){if(e._isRegistered())return C(3505),null}else P(!c.js.isNumber(t),3504),e=c.EventListener.create(e);if(!e.checkAvailable())return null;if(c.js.isNumber(t)){if(0===t)return C(3500),null;e._setSceneGraphPriority(null),e._setFixedPriority(t),e._setRegistered(!0),e._setPaused(!1),this._addListener(e)}else{if(!(n=t)||!n.getComponent("cc.UITransform"))return C(3512),null;e._setSceneGraphPriority(t),e._setFixedPriority(0),e._setRegistered(!0),this._addListener(e)}var n;return e},t.addCustomListener=function(e,t){var n=nA.create({event:c.EventListener.CUSTOM,eventName:e,callback:t});return this.addListener(n,1),n},t.removeListener=function(e){if(null!=e){var t=!1,n=this._listenersMap;for(var i in n){var r=n[i],o=r.getFixedPriorityListeners(),a=r.getSceneGraphPriorityListeners();if((t=this._removeListenerInVector(a,e))?this._setDirty(e._getListenerID(),2):(t=this._removeListenerInVector(o,e))&&this._setDirty(e._getListenerID(),1),r.empty()&&(delete this._priorityDirtyFlagMap[e._getListenerID()],delete n[i]),t)break}if(!t)for(var s=this._toAddedListeners,l=s.length-1;l>=0;l--){var u=s[l];if(u===e){c.js.array.removeAt(s,l),u._setRegistered(!1);break}}}},t.removeListeners=function(e,t){if(void 0===t&&(t=!1),c.js.isNumber(e)||e instanceof c._BaseNode)if(void 0!==e._id){var n=this._nodeListenersMap[e._id];if(n){for(var i=c.js.array.copy(n),r=0;r<i.length;++r){var o=i[r];this.removeListener(o)}delete this._nodeListenersMap[e._id]}for(var a=this._toAddedListeners,s=0;s<a.length;){var l=a[s];l._getSceneGraphPriority()===e?(l._setSceneGraphPriority(null),l._setRegistered(!1),a.splice(s,1)):++s}if(!0===t)for(var u=e.getChildren(),h=0;h<u.length;++h){var _=u[h];this.removeListeners(_,!0)}}else e===c.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(lA.TOUCH_ONE_BY_ONE):e===c.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(lA.TOUCH_ALL_AT_ONCE):e===c.EventListener.MOUSE?this._removeListenersForListenerID(lA.MOUSE):e===c.EventListener.ACCELERATION?this._removeListenersForListenerID(lA.ACCELERATION):e===c.EventListener.KEYBOARD?this._removeListenersForListenerID(lA.KEYBOARD):C(3501);else b(3506)},t.removeCustomListeners=function(e){this._removeListenersForListenerID(e)},t.removeAllListeners=function(){var e=this._listenersMap,t=this._internalCustomListenerIDs;for(var n in e)-1===t.indexOf(n)&&this._removeListenersForListenerID(n)},t.setPriority=function(e,t){if(null!=e){var n=this._listenersMap;for(var i in n){var r=n[i].getFixedPriorityListeners();if(r&&-1!==r.indexOf(e))return null!=e._getSceneGraphPriority()&&C(3502),void(e._getFixedPriority()!==t&&(e._setFixedPriority(t),this._setDirty(e._getListenerID(),1)))}}},t.setEnabled=function(e){this._isEnabled=e},t.isEnabled=function(){return this._isEnabled},t.dispatchEvent=function(e){if(this._isEnabled)if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,e&&e.getType){if(e.getType().startsWith(c.Event.TOUCH))return this._dispatchTouchEvent(e),void this._inDispatch--;var t=function(e){var t=R_,n=e.type;return n===t.ACCELERATION?lA.ACCELERATION:n===t.KEYBOARD?lA.KEYBOARD:n.startsWith(t.MOUSE)?lA.MOUSE:(n.startsWith(t.TOUCH)&&C(2e3),"")}(e);this._sortEventListeners(t);var n=this._listenersMap[t];null!=n&&(this._dispatchEventToListeners(n,this._onListenerCallback,e),this._onUpdateListeners(n)),this._inDispatch--}else R(3511)},t._onListenerCallback=function(e,t){t.currentTarget=e._target;var n=e.onEvent;return n&&n(t),t.isStopped()},t.dispatchCustomEvent=function(e,t){var n=new c.Event.EventCustom(e);n.setUserData(t),this.dispatchEvent(n)},t._setDirtyForNode=function(e){var t=this._nodeListenersMap[e._id];if(void 0!==t)for(var n=0,i=t.length;n<i;n++){var r=t[n]._getListenerID();this._dirtyListeners[r]||(this._dirtyListeners[r]=!0)}if(e.children.length>0)for(var o=e.children,a=0,s=o?o.length:0;a<s;a++)this._setDirtyForNode(o[a])},t._addListener=function(e){0===this._inDispatch?this._forceAddEventListener(e):this._toAddedListeners.push(e)},t._forceAddEventListener=function(e){var t=e._getListenerID(),n=this._listenersMap[t];if(n||(n=new uA,this._listenersMap[t]=n),n.push(e),0===e._getFixedPriority()){this._setDirty(t,2);var i=e._getSceneGraphPriority();null===i&&C(3507),this._associateNodeAndEventListener(i,e),i.activeInHierarchy&&this.resumeTarget(i)}else this._setDirty(t,1)},t._getListeners=function(e){return this._listenersMap[e]},t._updateDirtyFlagForSceneGraph=function(){var e=this._dirtyListeners;for(var t in e)this._setDirty(t,2),e[t]=!1},t._removeAllListenersInVector=function(e){if(e)for(var t,n=e.length-1;n>=0;n--)(t=e[n])._setRegistered(!1),null!=t._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(t._getSceneGraphPriority(),t),t._setSceneGraphPriority(null)),0===this._inDispatch&&c.js.array.removeAt(e,n)},t._removeListenersForListenerID=function(e){var t=this._listenersMap[e];if(t){var n=t.getFixedPriorityListeners(),i=t.getSceneGraphPriorityListeners();this._removeAllListenersInVector(i),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[e],this._inDispatch||(t.clear(),delete this._listenersMap[e])}for(var r=this._toAddedListeners,o=r.length-1;o>=0;o--){var a=r[o];a&&a._getListenerID()===e&&c.js.array.removeAt(r,o)}},t._sortEventListeners=function(e){var t=0,n=this._priorityDirtyFlagMap;n[e]&&(t=n[e]),0!==t&&(n[e]=0,1&t&&this._sortListenersOfFixedPriority(e),2&t&&c.director.getScene()&&this._sortListenersOfSceneGraphPriority(e))},t._sortListenersOfSceneGraphPriority=function(e){var t=this._getListeners(e);if(t){var n=t.getSceneGraphPriorityListeners();if(n&&0!==n.length){var i=t.getSceneGraphPriorityListeners();i.forEach((function(e){var t=e._getSceneGraphPriority()._uiProps.uiTransformComp;e._cameraPriority=t.cameraPriority})),i.sort(this._sortEventListenersOfSceneGraphPriorityDes)}}},t._sortEventListenersOfSceneGraphPriorityDes=function(e,t){var n=e._getSceneGraphPriority(),i=t._getSceneGraphPriority();if(!(t&&i&&i._activeInHierarchy&&i._uiProps.uiTransformComp))return-1;if(!(e&&n&&n._activeInHierarchy&&n._uiProps.uiTransformComp))return 1;var r=n,o=i,a=!1;if(e._cameraPriority!==t._cameraPriority)return t._cameraPriority-e._cameraPriority;for(;r.parent._id!==o.parent._id;)r=null===r.parent.parent?(a=!0)&&i:r.parent,o=null===o.parent.parent?(a=!0)&&n:o.parent;if(r._id===o._id){if(r._id===i._id)return-1;if(r._id===n._id)return 1}var s=r.getSiblingIndex(),c=o.getSiblingIndex();return a?s-c:c-s},t._sortListenersOfFixedPriority=function(e){var t=this._listenersMap[e];if(t){var n=t.getFixedPriorityListeners();if(n&&0!==n.length){n.sort(this._sortListenersOfFixedPriorityAsc);for(var i=0,r=n.length;i<r&&!(n[i]._getFixedPriority()>=0);)++i;t.gt0Index=i}}},t._sortListenersOfFixedPriorityAsc=function(e,t){return e._getFixedPriority()-t._getFixedPriority()},t._onUpdateListeners=function(e){var t=e.getFixedPriorityListeners(),n=e.getSceneGraphPriorityListeners(),i=this._toRemovedListeners;if(n)for(var r=n.length-1;r>=0;r--){var o=n[r];if(!o._isRegistered()){c.js.array.removeAt(n,r);var a=i.indexOf(o);-1!==a&&i.splice(a,1)}}if(t)for(var s=t.length-1;s>=0;s--){var l=t[s];if(!l._isRegistered()){c.js.array.removeAt(t,s);var u=i.indexOf(l);-1!==u&&i.splice(u,1)}}n&&0===n.length&&e.clearSceneGraphListeners(),t&&0===t.length&&e.clearFixedListeners()},t._updateTouchListeners=function(e){var t=this._inDispatch;if(P(t>0,3508),!(t>1)){var n;(n=this._listenersMap[lA.TOUCH_ONE_BY_ONE])&&this._onUpdateListeners(n),(n=this._listenersMap[lA.TOUCH_ALL_AT_ONCE])&&this._onUpdateListeners(n),P(1===t,3509);var i=this._toAddedListeners;if(0!==i.length){for(var r=0,o=i.length;r<o;r++)this._forceAddEventListener(i[r]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},t._cleanToRemovedListeners=function(){for(var e=this._toRemovedListeners,t=0;t<e.length;++t){var n=e[t],i=this._listenersMap[n._getListenerID()];if(i){var r=i.getFixedPriorityListeners(),o=i.getSceneGraphPriorityListeners();if(o){var a=o.indexOf(n);-1!==a&&o.splice(a,1)}if(r){var s=r.indexOf(n);-1!==s&&r.splice(s,1)}}}e.length=0},t._onTouchEventCallback=function(e,t){if(!e._isRegistered())return!1;var n=t.event,i=n.touch;n.currentTarget=e._getSceneGraphPriority();var r=!1,o=-1,a=n.getEventCode();if(a===$S.BEGAN){if(!It.ENABLE_MULTI_TOUCH&&_A._currentTouch){var s=_A._currentTouchListener._node;if(!s||s.activeInHierarchy)return!1}e.onTouchBegan&&(r=e.onTouchBegan(i,n))&&e._isRegistered()&&(e._claimedTouches.push(i),!It.ENABLE_MULTI_TOUCH&&_A._currentTouch||(_A._currentTouch=i),_A._currentTouchListener=e)}else if(e._claimedTouches.length>0&&-1!==(o=e._claimedTouches.indexOf(i))){if(r=!0,!It.ENABLE_MULTI_TOUCH&&_A._currentTouch&&_A._currentTouch!==i)return!1;a===$S.MOVED&&e.onTouchMoved?e.onTouchMoved(i,n):a===$S.ENDED?(e.onTouchEnded&&e.onTouchEnded(i,n),e._isRegistered()&&e._claimedTouches.splice(o,1),(It.ENABLE_MULTI_TOUCH||_A._currentTouch===i)&&(_A._currentTouch=null),_A._currentTouchListener=null):a===$S.CANCELLED&&(e.onTouchCancelled&&e.onTouchCancelled(i,n),e._isRegistered()&&e._claimedTouches.splice(o,1),(It.ENABLE_MULTI_TOUCH||_A._currentTouch===i)&&(_A._currentTouch=null),_A._currentTouchListener=null)}return n.isStopped()?(_A._updateTouchListeners(n),!0):!!(r&&e._isRegistered()&&e.swallowTouches)&&(t.needsMutableSet&&t.touches.splice(i,1),!0)},t._dispatchTouchEvent=function(e){this._sortEventListeners(lA.TOUCH_ONE_BY_ONE),this._sortEventListeners(lA.TOUCH_ALL_AT_ONCE);var t=this._getListeners(lA.TOUCH_ONE_BY_ONE),n=this._getListeners(lA.TOUCH_ALL_AT_ONCE);if(null!==t||null!==n){var i=e.getTouches(),r=c.js.array.copy(i),o={event:e,needsMutableSet:t&&n,touches:r,selTouch:null};if(t)for(var a=0;a<i.length;++a){var s=i[a];e.touch=s,e.propagationStopped=e.propagationImmediateStopped=!1,this._dispatchEventToListeners(t,this._onTouchEventCallback,o)}n&&r.length>0&&(this._dispatchEventToListeners(n,this._onTouchesEventCallback,{event:e,touches:r}),e.isStopped())||this._updateTouchListeners(e)}},t._onTouchesEventCallback=function(e,t){if(!e._isRegistered())return!1;var n=t.event,i=t.touches,r=n.getEventCode();return n.currentTarget=e._getSceneGraphPriority(),r===$S.BEGAN&&e.onTouchesBegan?e.onTouchesBegan(i,n):r===$S.MOVED&&e.onTouchesMoved?e.onTouchesMoved(i,n):r===$S.ENDED&&e.onTouchesEnded?e.onTouchesEnded(i,n):r===$S.CANCELLED&&e.onTouchesCancelled&&e.onTouchesCancelled(i,n),!!n.isStopped()&&(_A._updateTouchListeners(n),!0)},t._associateNodeAndEventListener=function(e,t){var n=this._nodeListenersMap[e.uuid];n||(n=[],this._nodeListenersMap[e.uuid]=n),n.push(t)},t._dissociateNodeAndEventListener=function(e,t){var n=this._nodeListenersMap[e.uuid];n&&(c.js.array.remove(n,t),0===n.length&&delete this._nodeListenersMap[e.uuid])},t._dispatchEventToListeners=function(e,t,n){var i=!1,r=e.getFixedPriorityListeners(),o=e.getSceneGraphPriorityListeners(),a=0;if(r&&0!==r.length)for(;a<e.gt0Index;++a){var s=r[a];if(s.isEnabled()&&!s._isPaused()&&s._isRegistered()&&t(s,n)){i=!0;break}}if(o&&!i)for(var c=0;c<o.length;++c){var l=o[c];if(l.isEnabled()&&!l._isPaused()&&l._isRegistered()&&t(l,n)){i=!0;break}}if(r&&!i)for(;a<r.length;++a){var u=r[a];if(u.isEnabled()&&!u._isPaused()&&u._isRegistered()&&t(u,n)){i=!0;break}}},t._setDirty=function(e,t){var n=this._priorityDirtyFlagMap;null==n[e]?n[e]=t:n[e]|=t},t._sortNumberAsc=function(e,t){return e-t},t._removeListenerInCallback=function(e,t){if(null==e)return!1;for(var n=e.length-1;n>=0;n--){var i=e[n];if(i._onCustomEvent===t||i.onEvent===t)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?c.js.array.removeAt(e,n):this._toRemovedListeners.push(i),!0}return!1},t._removeListenerInVector=function(e,t){if(null==e)return!1;for(var n=e.length-1;n>=0;n--){var i=e[n];if(i===t)return i._setRegistered(!1),null!=i._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(i._getSceneGraphPriority(),i),i._setSceneGraphPriority(null)),0===this._inDispatch?c.js.array.removeAt(e,n):this._toRemovedListeners.push(i),!0}return!1},e}(),_A=e("et",new hA);c.eventManager=_A;var fA=new ui,dA=e("eA",function(){function e(e,t,n){void 0===n&&(n=0),this._point=new ui,this._prevPoint=new ui,this._lastModified=0,this._id=0,this._startPoint=new ui,this._startPointCaptured=!1,this.setTouchInfo(n,e,t)}Z(e,[{key:"lastModified",get:function(){return this._lastModified}}]);var t=e.prototype;return t.getLocation=function(e){return e||(e=new ui),e.set(this._point.x,this._point.y),e},t.getLocationX=function(){return this._point.x},t.getLocationY=function(){return this._point.y},t.getUILocation=function(e){return e||(e=new ui),e.set(this._point.x,this._point.y),c.view._convertPointWithScale(e),e},t.getUILocationX=function(){var e=c.view.getViewportRect();return(this._point.x-e.x)/c.view.getScaleX()},t.getUILocationY=function(){var e=c.view.getViewportRect();return(this._point.y-e.y)/c.view.getScaleY()},t.getPreviousLocation=function(e){return e||(e=new ui),e.set(this._prevPoint.x,this._prevPoint.y),e},t.getUIPreviousLocation=function(e){return e||(e=new ui),e.set(this._prevPoint.x,this._prevPoint.y),c.view._convertPointWithScale(e),e},t.getStartLocation=function(e){return e||(e=new ui),e.set(this._startPoint.x,this._startPoint.y),e},t.getUIStartLocation=function(e){return e||(e=new ui),e.set(this._startPoint.x,this._startPoint.y),c.view._convertPointWithScale(e),e},t.getDelta=function(e){return e||(e=new ui),e.set(this._point),e.subtract(this._prevPoint),e},t.getUIDelta=function(e){return e||(e=new ui),fA.set(this._point),fA.subtract(this._prevPoint),e.set(c.view.getScaleX(),c.view.getScaleY()),ui.divide(e,fA,e),e},t.getLocationInView=function(e){return e||(e=new ui),e.set(this._point.x,c.view._designResolutionSize.height-this._point.y),e},t.getPreviousLocationInView=function(e){return e||(e=new ui),e.set(this._prevPoint.x,c.view._designResolutionSize.height-this._prevPoint.y),e},t.getStartLocationInView=function(e){return e||(e=new ui),e.set(this._startPoint.x,c.view._designResolutionSize.height-this._startPoint.y),e},t.getID=function(){return this._id},t.setTouchInfo=function(e,t,n){void 0===e&&(e=0),this._prevPoint=this._point,this._point=new ui(t||0,n||0),this._id=e,this._startPointCaptured||(this._startPoint=new ui(this._point),this._startPointCaptured=!0)},t.setPoint=function(e,t){"object"==typeof e?(this._point.x=e.x,this._point.y=e.y):(this._point.x=e||0,this._point.y=t||0),this._lastModified=c.director.getCurrentTime()},t.setPrevPoint=function(e,t){this._prevPoint="object"==typeof e?new ui(e.x,e.y):new ui(e||0,t||0),this._lastModified=c.director.getCurrentTime()},e}());c.Touch=dA;var mA,pA=It.TOUCH_TIMEOUT,vA=new ui,gA=new ui,yA=e("eu",(function(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=e,this.y=t,this.z=n,this.timestamp=i}));c.internal.Acceleration=yA;var xA=new(function(){function e(){this._mousePressed=!1,this._isRegisterEvent=!1,this._preTouchPoint=new ui,this._prevMousePoint=new ui,this._preTouchPool=[],this._preTouchPoolPointer=0,this._touches=[],this._touchesIntegerDict={},this._indexBitsUsed=0,this._maxTouches=8,this._accelEnabled=!1,this._accelInterval=.2,this._accelMinus=1,this._accelCurTime=0,this._acceleration=null,this._accelDeviceEvent=null,this._glView=null,this._pointLocked=!1}var t=e.prototype;return t.handleTouchesBegin=function(e){for(var t=[],n=this._touchesIntegerDict,i=0;i<e.length;++i){var r=e[i],o=r.getID();if(null!==o&&void 0===n[o]){var a=this._getUnUsedIndex();if(-1===a){C(2300,a);continue}r.getLocation(vA);var s=new dA(vA.x,vA.y,o);this._touches[a]=s,r.getPreviousLocation(vA),s.setPrevPoint(vA),n[o]=a,t.push(s)}}if(t.length>0){var c=new $S(t,!1,$S.BEGAN,It.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);_A.dispatchEvent(c)}},t.handleTouchesMove=function(e){for(var t=[],n=this._touches,i=0;i<e.length;++i){var r=e[i],o=r.getID();if(null!==o){var a=this._touchesIntegerDict[o];void 0!==a&&n[a]&&(r.getLocation(vA),n[a].setPoint(vA),r.getPreviousLocation(vA),n[a].setPrevPoint(vA),t.push(n[a]))}}if(t.length>0){var s=new $S(t,!1,$S.MOVED,It.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);_A.dispatchEvent(s)}},t.handleTouchesEnd=function(e){var t=this.getSetOfTouchesEndOrCancel(e);if(t.length>0){var n=new $S(t,!1,$S.ENDED,It.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);_A.dispatchEvent(n)}this._preTouchPool.length=0},t.handleTouchesCancel=function(e){var t=this.getSetOfTouchesEndOrCancel(e);if(t.length>0){var n=new $S(t,!1,$S.CANCELLED,It.ENABLE_MULTI_TOUCH?this._getUsefulTouches():t);_A.dispatchEvent(n)}this._preTouchPool.length=0},t.getSetOfTouchesEndOrCancel=function(e){for(var t=[],n=this._touches,i=this._touchesIntegerDict,r=0;r<e.length;++r){var o=e[r],a=o.getID();if(null!==a){var s=i[a];void 0!==s&&n[s]&&(o.getLocation(vA),n[s].setPoint(vA),o.getPreviousLocation(vA),n[s].setPrevPoint(vA),t.push(n[s]),this._removeUsedIndexBit(s),delete i[a])}}return t},t.getHTMLElementPosition=function(e){var t=document.documentElement,n=Vv.os===Vv.OS_IOS&&Vv.isBrowser?window.screenLeft:window.pageXOffset;n-=t.clientLeft;var i=Vv.os===Vv.OS_IOS&&Vv.isBrowser?window.screenTop:window.pageYOffset;if(i-=t.clientTop,e.getBoundingClientRect){var r=e.getBoundingClientRect();return{left:r.left+n,top:r.top+i,width:r.width,height:r.height}}return e instanceof HTMLCanvasElement?{left:n,top:i,width:e.width,height:e.height}:{left:n,top:i,width:parseInt(e.style.width||"0",void 0),height:parseInt(e.style.height||"0",void 0)}},t.getPreTouch=function(e){for(var t=null,n=this._preTouchPool,i=e.getID(),r=n.length-1;r>=0;r--)if(n[r].getID()===i){t=n[r];break}return t||(t=e),t},t.setPreTouch=function(e){for(var t=!1,n=this._preTouchPool,i=e.getID(),r=n.length-1;r>=0;r--)if(n[r].getID()===i){n[r]=e,t=!0;break}t||(n.length<=50?n.push(e):(n[this._preTouchPoolPointer]=e,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},t.getTouchByXY=function(e,t,n,i){var r=this._preTouchPoint,o=this._glView.convertToLocationInView(t,n,i);this._pointLocked&&(o.x=r.x+e.movementX,o.y=r.y-e.movementY);var a=new dA(o.x,o.y,0);return a.setPrevPoint(r.x,r.y),r.x=o.x,r.y=o.y,a},t.getMouseEvent=function(e,t,n){var i=this._prevMousePoint,r=new JS(n,!1,i);return i.x=e.x,i.y=e.y,this._glView._convertMouseToLocation(i,t),r.setLocation(i.x,i.y),r},t.getPointByEvent=function(e,t){return null!=e.pageX?{x:e.pageX,y:e.pageY}:(t.left-=document.body.scrollLeft,t.top-=document.body.scrollTop,{x:e.clientX,y:e.clientY})},t.getTouchesByEvent=function(e,t){for(var n=[],i=this._glView,r=this._preTouchPoint,o=e.changedTouches.length,a=0;a<o;a++){var s=e.changedTouches[a];if(s){var c;c=Vv.BROWSER_TYPE_FIREFOX===Vv.browserType?i.convertToLocationInView(s.pageX,s.pageY,t,vA):i.convertToLocationInView(s.clientX,s.clientY,t,vA);var l=void 0;if(null!=s.identifier?(l=new dA(c.x,c.y,s.identifier),this.getPreTouch(l).getLocation(gA),l.setPrevPoint(gA.x,gA.y),this.setPreTouch(l)):(l=new dA(c.x,c.y)).setPrevPoint(r.x,r.y),r.x=c.x,r.y=c.y,n.push(l),!It.ENABLE_MULTI_TOUCH)break}}return n},t.registerSystemEvent=function(e){if(!this._isRegisterEvent&&e){this._glView=c.view;var t=Vv.isMobile,n=Vv.capabilities.mouse,i=Vv.capabilities.touches;n&&this._registerMouseEvents(e,t),window.navigator.msPointerEnabled&&this._registerMousePointerEvents(e),i&&this._registerTouchEvents(e),this._registerKeyboardEvent(),this._isRegisterEvent=!0}},t.setAccelerometerEnabled=function(e){if(this._accelEnabled!==e){this._accelEnabled=e;var t=c.director.getScheduler();t.enableForTarget(this),this._accelEnabled?(this._registerAccelerometerEvent(),this._accelCurTime=0,t.scheduleUpdate(this)):(this._unregisterAccelerometerEvent(),this._accelCurTime=0,t.unscheduleUpdate(this))}},t.didAccelerate=function(e){if(this._accelEnabled){var t=this._acceleration,n=0,i=0,r=0;if(this._accelDeviceEvent===window.DeviceMotionEvent){var o=e.accelerationIncludingGravity;o&&(n=this._accelMinus*(o.x||0)*.1,i=this._accelMinus*(o.y||0)*.1,r=.1*(o.z||0))}else{var a=e;n=(a.gamma||0)/90*.981,i=-(a.beta||0)/90*.981,r=(a.alpha||0)/90*.981}if(c.view._isRotated){var s=n;n=-i,i=s}t.x=n,t.y=i,t.z=r,t.timestamp=e.timeStamp||Date.now();var l=t.x;90===window.orientation?(t.x=-t.y,t.y=l):-90===window.orientation?(t.x=t.y,t.y=-l):180===window.orientation&&(t.x=-t.x,t.y=-t.y),c.sys.os===c.sys.OS_ANDROID&&c.sys.browserType!==c.sys.BROWSER_TYPE_MOBILE_QQ&&(t.x=-t.x,t.y=-t.y)}},t.update=function(e){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,_A.dispatchEvent(new eA(this._acceleration))),this._accelCurTime+=e},t.setAccelerometerInterval=function(e){this._accelInterval!==e&&(this._accelInterval=e)},t._getUnUsedIndex=function(){for(var e=this._indexBitsUsed,t=c.director.getCurrentTime(),n=0;n<this._maxTouches;n++){if(!(1&e))return this._indexBitsUsed|=1<<n,n;var i=this._touches[n];if(t-i.lastModified>pA){this._removeUsedIndexBit(n);var r=i.getID();return null!==r&&delete this._touchesIntegerDict[r],n}e>>=1}return-1},t._removeUsedIndexBit=function(e){if(!(e<0||e>=this._maxTouches)){var t=1<<e;t=~t,this._indexBitsUsed&=t}},t._registerMouseEvents=function(e,t){this._registerPointerLockEvent(),t||this._registerWindowMouseEvents(e),this._registerElementMouseEvents(e,t)},t._registerPointerLockEvent=function(){var e=this,t=function(){var t=c.game.canvas;document.pointerLockElement===t||document.mozPointerLockElement===t?e._pointLocked=!0:e._pointLocked=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",t,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",t,!1)},t._registerWindowMouseEvents=function(e){var t=this;window.addEventListener("mousedown",(function(){t._mousePressed=!0}),!1),window.addEventListener("mouseup",(function(n){if(t._mousePressed){t._mousePressed=!1;var i=t.getHTMLElementPosition(e),r=t.getPointByEvent(n,i);if(!xi(i.left,i.top,i.width,i.height).contains(new ui(r.x,r.y))){t.handleTouchesEnd([t.getTouchByXY(n,r.x,r.y,i)]);var o=t.getMouseEvent(r,i,JS.UP);o.setButton(n.button),_A.dispatchEvent(o)}}}),!1)},t._registerElementMouseEvents=function(e,t){var n=this,i=function(t,i,r){e.addEventListener(t,(function(t){var o=n.getHTMLElementPosition(e),a=n.getPointByEvent(t,o),s=n.getMouseEvent(a,o,i);s.setButton(t.button),r(t,s,a,o),_A.dispatchEvent(s),t.stopPropagation(),t.preventDefault()}))};t||(i("mousedown",JS.DOWN,(function(t,i,r,o){n._mousePressed=!0,n.handleTouchesBegin([n.getTouchByXY(t,r.x,r.y,o)]),e.focus()})),i("mouseup",JS.UP,(function(e,t,i,r){n._mousePressed=!1,n.handleTouchesEnd([n.getTouchByXY(e,i.x,i.y,r)])})),i("mousemove",JS.MOVE,(function(e,t,i,r){n.handleTouchesMove([n.getTouchByXY(e,i.x,i.y,r)]),n._mousePressed||t.setButton(JS.BUTTON_MISSING),void 0!==e.movementX&&void 0!==e.movementY&&(t.movementX=e.movementX,t.movementY=e.movementY)}))),i("mousewheel",JS.SCROLL,(function(e,t,n,i){t.setScrollData(0,e.wheelDelta)})),i("DOMMouseScroll",JS.SCROLL,(function(e,t,n,i){t.setScrollData(0,-120*e.detail)}))},t._registerMousePointerEvents=function(e){var t=this,n={MSPointerDown:this.handleTouchesBegin,MSPointerMove:this.handleTouchesMove,MSPointerUp:this.handleTouchesEnd,MSPointerCancel:this.handleTouchesCancel},i=function(i){var r=n[i];e.addEventListener(i,(function(n){var i=t.getHTMLElementPosition(e);i.left-=document.documentElement.scrollLeft,i.top-=document.documentElement.scrollTop,r.call(t,[t.getTouchByXY(n,n.clientX,n.clientY,i)]),n.stopPropagation()}),!1)};for(var r in n)i(r)},t._registerTouchEvents=function(e){var t=this,n=function(n){return function(i){if(i.changedTouches){var r=t.getHTMLElementPosition(e),o=document.body;r.left-=o.scrollLeft||0,r.top-=o.scrollTop||0,n(t.getTouchesByEvent(i,r)),i.stopPropagation(),i.preventDefault()}}};e.addEventListener("touchstart",n((function(n){t.handleTouchesBegin(n),e.focus()})),!1),e.addEventListener("touchmove",n((function(e){t.handleTouchesMove(e)})),!1),e.addEventListener("touchend",n((function(e){t.handleTouchesEnd(e)})),!1),e.addEventListener("touchcancel",n((function(e){t.handleTouchesCancel(e)})),!1)},t._registerKeyboardEvent=function(){var e=c.game.canvas;e.addEventListener("keydown",(function(e){_A.dispatchEvent(new tA(e,!0)),e.stopPropagation(),e.preventDefault()}),!1),e.addEventListener("keyup",(function(e){_A.dispatchEvent(new tA(e,!1)),e.stopPropagation(),e.preventDefault()}),!1)},t._registerAccelerometerEvent=function(){var e=this;this._acceleration=new yA,this._accelDeviceEvent=window.DeviceMotionEvent||window.DeviceOrientationEvent,c.sys.browserType===c.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var t=this._accelDeviceEvent===window.DeviceMotionEvent?"devicemotion":"deviceorientation";mA=function(){return e.didAccelerate.apply(e,arguments)},window.addEventListener(t,mA,!1)},t._unregisterAccelerometerEvent=function(){var e=this._accelDeviceEvent===window.DeviceMotionEvent?"devicemotion":"deviceorientation";mA&&window.removeEventListener(e,mA,!1)},t._getUsefulTouches=function(){var e=[],t=this._touchesIntegerDict;for(var n in t){var i=t[parseInt(n)];if(null!=i){var r=this._touches[i];e.push(r)}}return e},e}());c.internal.inputManager=xA;var EA=e("ca",function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).frame=null,t.container=null,t.canvas=null,t.renderType=-1,t.eventTargetOn=e.prototype.on,t.eventTargetOnce=e.prototype.once,t.config={},t.onStart=null,t.collisionMatrix=[],t.groupList=[],t._persistRootNodes={},t._paused=!0,t._configLoaded=!1,t._isCloning=!1,t._inited=!1,t._engineInited=!1,t._rendererInitialized=!1,t._gfxDevice=null,t._intervalId=null,t}$(t,e);var n=t.prototype;return n.setFrameRate=function(e){var t=this.config;"number"!=typeof e&&(e=parseInt(e,10),Number.isNaN(e)&&(e=60)),t.frameRate=e,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},n.getFrameRate=function(){return this.config.frameRate||0},n.step=function(){c.director.mainLoop()},n.pause=function(){this._paused||(this._paused=!0,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0))},n.resume=function(){this._paused&&this._runMainLoop()},n.isPaused=function(){return this._paused},n.restart=function(){var e=this;return new Promise((function(e){return c.director.once(c.Director.EVENT_AFTER_DRAW,(function(){return e()}))})).then((function(){for(var n in e._persistRootNodes)e.removePersistRootNode(e._persistRootNodes[n]);return c.director.getScene().destroy(),c.Object._deferredDestroy(),c.director.reset(),e.pause(),e._setRenderPipelineNShowSplash().then((function(){e.resume(),e._safeEmit(t.EVENT_RESTART)}))}))},n.end=function(){this._gfxDevice&&(this._gfxDevice.destroy(),this._gfxDevice=null),window.close()},n.on=function(e,n,i,r){return this._engineInited&&e===t.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOn(e,n,i,r)},n.once=function(e,n,i){return this._engineInited&&e===t.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOnce(e,n,i)},n.init=function(e){var t=this;return this._initConfig(e),this.config.assetOptions&&c.assetManager.init(this.config.assetOptions),this._initEngine().then((function(){return t._initEvents(),c.director.root.dataPoolManager&&c.director.root.dataPoolManager.jointTexturePool.registerCustomTextureLayouts(e.customJointTextureLayouts),t._engineInited}))},n.run=function(e,t){var n,i=this;return"function"!=typeof e&&e?(n=this.init(e),this.onStart=null!=t?t:null):this.onStart=null!=e?e:null,Promise.resolve(n).then((function(){return TA.config.registerSystemEvent&&xA.registerSystemEvent(TA.canvas),i._setRenderPipelineNShowSplash()}))},n.addPersistRootNode=function(e){if(c.Node.isNode(e)&&e.uuid){var t=e.uuid;if(!this._persistRootNodes[t]){var n=c.director._scene;if(c.isValid(n))if(e.parent){if(!(e.parent instanceof c.Scene))return void b(3801);if(e.parent!==n)return void b(3802)}else e.parent=n;this._persistRootNodes[t]=e,e._persistNode=!0,c.assetManager._releaseManager._addPersistNodeRef(e)}}else b(3800)},n.removePersistRootNode=function(e){var t=e.uuid||"";e===this._persistRootNodes[t]&&(delete this._persistRootNodes[t],e._persistNode=!1,c.assetManager._releaseManager._removePersistNodeRef(e))},n.isPersistRootNode=function(e){return!!e._persistNode},n._initEngine=function(){var e=this;return this._initDevice(),Promise.resolve(c.director._init()).then((function(){v("Cocos Creator v"+l),e.emit(t.EVENT_ENGINE_INITED),e._engineInited=!0,c.internal.dynamicAtlasManager.enabled=!It.CLEANUP_IMAGE_CACHE}))},n._setAnimFrame=function(){this._lastTime=performance.now();var e=this.config.frameRate;this._frameTime=1e3/e,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0);var t=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==e&&30!==e?(window.rAF=t?this._stTimeWithRAF:this._stTime,window.cAF=this._ctTime):(window.rAF=t||this._stTime,window.cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame||this._ctTime)},n._stTimeWithRAF=function(e){var t=performance.now(),n=Math.max(0,t-TA._lastTime),i=Math.max(0,TA._frameTime-n),r=window.setTimeout((function(){window.requestAnimationFrame(e)}),i);return TA._lastTime=t+i,r},n._stTime=function(e){var t=performance.now(),n=Math.max(0,t-TA._lastTime),i=Math.max(0,TA._frameTime-n),r=window.setTimeout(e,i);return TA._lastTime=t+i,r},n._ctTime=function(e){window.clearTimeout(e)},n._runMainLoop=function(){var e=this;if(this._inited&&!i){var t,n=this.config,r=c.director,o=n.frameRate;if(L(!!n.showFPS),r.startAnimation(),30===o){var a=!0;t=function(n){e._intervalId=window.rAF(t),(a=!a)||r.mainLoop(n)}}else t=function(n){e._intervalId=window.rAF(t),r.mainLoop(n)};this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0),this._intervalId=window.rAF(t),this._paused=!1}},n._initConfig=function(e){"number"!=typeof e.debugMode&&(e.debugMode=O.NONE),e.exposeClassName=!!e.exposeClassName,"number"!=typeof e.frameRate&&(e.frameRate=60);var t=e.renderMode;("number"!=typeof t||t>2||t<0)&&(e.renderMode=0),"boolean"!=typeof e.registerSystemEvent&&(e.registerSystemEvent=!0),e.showFPS=!!e.showFPS,this.collisionMatrix=e.collisionMatrix||[],this.groupList=e.groupList||[],E(e.debugMode),this.config=e,this._configLoaded=!0,this._setAnimFrame()},n._determineRenderType=function(){var e=this.config,n=parseInt(e.renderMode,10);this.renderType=t.RENDER_TYPE_CANVAS;var i=!1;if(0===n?c.sys.capabilities.opengl?(this.renderType=t.RENDER_TYPE_WEBGL,i=!0):c.sys.capabilities.canvas&&(this.renderType=t.RENDER_TYPE_CANVAS,i=!0):1===n&&c.sys.capabilities.canvas?(this.renderType=t.RENDER_TYPE_CANVAS,i=!0):2===n&&c.sys.capabilities.opengl&&(this.renderType=t.RENDER_TYPE_WEBGL,i=!0),!i)throw new Error(M(3820,n))},n._initDevice=function(){if(!this._rendererInitialized){if(this.canvas=this.config.adapter.canvas,this.frame=this.config.adapter.frame,this.container=this.config.adapter.container,this._determineRenderType(),this.renderType===t.RENDER_TYPE_WEBGL){var e=[],n=!!window.WebGL2RenderingContext,i=window.navigator.userAgent.toLowerCase();(-1!==i.indexOf("safari")&&-1===i.indexOf("chrome")||Vv.browserType===Vv.BROWSER_TYPE_UC)&&(n=!1),n&&c.WebGL2Device&&e.push(c.WebGL2Device),c.WebGLDevice&&e.push(c.WebGLDevice);for(var r=new is(this.canvas,It.ENABLE_WEBGL_ANTIALIAS,!1,window.devicePixelRatio,Vv.windowPixelResolution.width,Vv.windowPixelResolution.height,fu),o=0;o<e.length&&(this._gfxDevice=new e[o],!this._gfxDevice.initialize(r));o++);}if(!this._gfxDevice)return y("can not support canvas rendering in 3D"),void(this.renderType=t.RENDER_TYPE_CANVAS);this.canvas.oncontextmenu=function(){return!1}}},n._initEvents=function(){var e,n=this,i=window;void 0!==document.hidden?e="hidden":void 0!==document.mozHidden?e="mozHidden":void 0!==document.msHidden?e="msHidden":void 0!==document.webkitHidden&&(e="webkitHidden");var r=!1,o=this;function a(){r||(r=!0,o.emit(t.EVENT_HIDE))}function s(e,n,i,a,s){r&&(r=!1,o.emit(t.EVENT_SHOW,e,n,i,a,s))}if(e)for(var c=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],l=0;l<c.length;l++)document.addEventListener(c[l],(function(t){var n=document[e];(n=n||t.hidden)?a():s()}));else i.addEventListener("blur",a),i.addEventListener("focus",s);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(i.onfocus=s),"onpageshow"in window&&"onpagehide"in window&&(i.addEventListener("pagehide",a),i.addEventListener("pageshow",s),document.addEventListener("pagehide",a),document.addEventListener("pageshow",s)),this.on(t.EVENT_HIDE,(function(){n.pause()})),this.on(t.EVENT_SHOW,(function(){n.resume()}))},n._setRenderPipelineNShowSplash=function(){var e=this;return Promise.resolve(this._setupRenderPipeline()).then((function(){return Promise.resolve(e._showSplashScreen()).then((function(){e._inited=!0,e._setAnimFrame(),e._runMainLoop(),e._safeEmit(t.EVENT_GAME_INITED),e.onStart&&e.onStart()}))}))},n._setupRenderPipeline=function(){var e=this,t=this.config.renderPipeline;return t?new Promise((function(e,n){c.assetManager.loadAny(t,(function(t,i){return!t&&i instanceof pg?e(i):n(t)}))})).then((function(t){e._setRenderPipeline(t)})).catch((function(n){g(n),g("Failed load render pipeline: "+t+", engine failed to initialize, will fallback to default pipeline"),e._setRenderPipeline()})):this._setRenderPipeline()},n._showSplashScreen=function(){if(c.internal.SplashScreen){var e=c.internal.SplashScreen.instance;return e.main(c.director.root),new Promise((function(t){e.setOnFinish((function(){return t()})),e.loadFinish=!0}))}return null},n._setRenderPipeline=function(e){c.director.root.setRenderPipeline(e)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(t.EVENT_RENDERER_INITED)},n._safeEmit=function(e){this.emit(e)},Z(t,[{key:"inited",get:function(){return this._inited}},{key:"frameTime",get:function(){return this._frameTime}}]),t}(Q_));EA.EVENT_HIDE="game_on_hide",EA.EVENT_SHOW="game_on_show",EA.EVENT_LOW_MEMORY="game_on_low_memory",EA.EVENT_GAME_INITED="game_inited",EA.EVENT_ENGINE_INITED="engine_inited",EA.EVENT_RENDERER_INITED="renderer_inited",EA.EVENT_RESTART="game_on_restart",EA.RENDER_TYPE_CANVAS=0,EA.RENDER_TYPE_WEBGL=1,EA.RENDER_TYPE_OPENGL=2,c.Game=EA;var TA=e("cf",c.game=new EA),SA=e("ce",{topLeft:c.v2(0,0),topRight:c.v2(0,0),top:c.v2(0,0),bottomLeft:c.v2(0,0),bottomRight:c.v2(0,0),bottom:c.v2(0,0),center:c.v2(0,0),left:c.v2(0,0),right:c.v2(0,0),width:0,height:0,init:function(e){var t=this.width=e.width,n=this.height=e.height,i=e.x,r=e.y,o=r+n,a=i+t;this.topLeft.x=i,this.topLeft.y=o,this.topRight.x=a,this.topRight.y=o,this.top.x=i+t/2,this.top.y=o,this.bottomLeft.x=i,this.bottomLeft.y=r,this.bottomRight.x=a,this.bottomRight.y=r,this.bottom.x=i+t/2,this.bottom.y=r,this.center.x=i+t/2,this.center.y=r+n/2,this.left.x=i,this.left.y=r+n/2,this.right.x=a,this.right.y=r+n/2}});c.visibleRect=SA;var AA=new(function(){function e(){this.html=void 0,this.meta={width:"device-width"},this.adaptationType=c.sys.browserType}var t=e.prototype;return t.init=function(){this.html=document.getElementsByTagName("html")[0]},t.availWidth=function(e){return c.sys.isMobile||!e||e===this.html?window.innerWidth:e.clientWidth},t.availHeight=function(e){return c.sys.isMobile||!e||e===this.html?window.innerHeight:e.clientHeight},e}());switch(c.sys.os===c.sys.OS_IOS&&(AA.adaptationType=c.sys.BROWSER_TYPE_SAFARI),AA.adaptationType){case c.sys.BROWSER_TYPE_SAFARI:AA.meta["minimal-ui"]="true",AA.availWidth=function(e){return e.clientWidth},AA.availHeight=function(e){return e.clientHeight};break;case c.sys.BROWSER_TYPE_SOUGOU:case c.sys.BROWSER_TYPE_UC:AA.availWidth=function(e){return e.clientWidth},AA.availHeight=function(e){return e.clientHeight}}var CA=e("cS",function(e){function t(){var t;(t=e.call(this)||this)._resizeWithBrowserSize=void 0,t._designResolutionSize=void 0,t._originalDesignResolutionSize=void 0,t._frameSize=void 0,t._scaleX=void 0,t._scaleY=void 0,t._viewportRect=void 0,t._visibleRect=void 0,t._autoFullScreen=void 0,t._devicePixelRatio=void 0,t._maxPixelRatio=void 0,t._retinaEnabled=void 0,t._resizeCallback=void 0,t._resizing=void 0,t._orientationChanging=void 0,t._isRotated=void 0,t._orientation=void 0,t._isAdjustViewport=void 0,t._resolutionPolicy=void 0,t._rpExactFit=void 0,t._rpShowAll=void 0,t._rpNoBorder=void 0,t._rpFixedHeight=void 0,t._rpFixedWidth=void 0;var n=wA,i=bA;return t._frameSize=new vi(0,0),t._designResolutionSize=new vi(0,0),t._originalDesignResolutionSize=new vi(0,0),t._scaleX=1,t._scaleY=1,t._viewportRect=new yi(0,0,0,0),t._visibleRect=new yi(0,0,0,0),t._autoFullScreen=!1,t._devicePixelRatio=1,t._maxPixelRatio=2,t._retinaEnabled=!1,t._resizeCallback=null,t._resizing=!1,t._resizeWithBrowserSize=!1,t._orientationChanging=!0,t._isRotated=!1,t._orientation=c.macro.ORIENTATION_AUTO,t._isAdjustViewport=!0,t._rpExactFit=new IA(n.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new IA(n.EQUAL_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new IA(n.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new IA(n.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new IA(n.EQUAL_TO_FRAME,i.FIXED_WIDTH),t._resolutionPolicy=t._rpShowAll,c.game.once(c.Game.EVENT_ENGINE_INITED,t.init,ie(t)),t}$(t,e);var n=t.prototype;return n.init=function(){AA.init(),this._initFrameSize();var e=c.game.canvas.width,t=c.game.canvas.height;this._designResolutionSize.width=e,this._designResolutionSize.height=t,this._originalDesignResolutionSize.width=e,this._originalDesignResolutionSize.height=t,this._viewportRect.width=e,this._viewportRect.height=t,this._visibleRect.width=e,this._visibleRect.height=t,c.winSize.width=this._visibleRect.width,c.winSize.height=this._visibleRect.height,c.visibleRect&&c.visibleRect.init(this._visibleRect)},n.resizeWithBrowserSize=function(e){e?this._resizeWithBrowserSize||(this._resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this._resizeWithBrowserSize&&(this._resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},n.setResizeCallback=function(e){"function"!=typeof e&&null!=e||(this._resizeCallback=e)},n.setOrientation=function(e){(e&=c.macro.ORIENTATION_AUTO)&&this._orientation!==e&&(this._orientation=e)},n.adjustViewportMeta=function(e){this._isAdjustViewport=e},n.enableRetina=function(e){this._retinaEnabled=!!e},n.isRetinaEnabled=function(){return this._retinaEnabled},n.enableAutoFullScreen=function(e){e&&e!==this._autoFullScreen&&c.sys.isMobile&&c.sys.browserType!==c.sys.BROWSER_TYPE_WECHAT?(this._autoFullScreen=!0,c.screen.autoFullScreen(c.game.frame)):this._autoFullScreen=!1},n.isAutoFullScreenEnabled=function(){return this._autoFullScreen},n.setCanvasSize=function(e,t){var n=c.game.canvas,i=c.game.container;this._devicePixelRatio=window.devicePixelRatio,n.width=Vv.windowPixelResolution.width,n.height=Vv.windowPixelResolution.height,n.style.width=e+"px",n.style.height=t+"px",i.style.width=e+"px",i.style.height=t+"px",this._resizeEvent()},n.getCanvasSize=function(){return new vi(c.game.canvas.width,c.game.canvas.height)},n.getFrameSize=function(){return new vi(this._frameSize.width,this._frameSize.height)},n.setFrameSize=function(e,t){this._frameSize.width=e,this._frameSize.height=t,c.game.frame.style.width=e+"px",c.game.frame.style.height=t+"px",this._resizeEvent()},n.getVisibleSize=function(){return new vi(this._visibleRect.width,this._visibleRect.height)},n.getVisibleSizeInPixel=function(){return new vi(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},n.getVisibleOrigin=function(){return new ui(this._visibleRect.x,this._visibleRect.y)},n.getVisibleOriginInPixel=function(){return new ui(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},n.getResolutionPolicy=function(){return this._resolutionPolicy},n.setResolutionPolicy=function(e){if(e instanceof IA)this._resolutionPolicy=e;else{var t=IA;e===t.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),e===t.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),e===t.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),e===t.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),e===t.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},n.setDesignResolutionSize=function(e,t,n){if(e>0&&t>0){this.setResolutionPolicy(n);var i=this._resolutionPolicy;if(i&&i.preApply(this),c.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),i){this._originalDesignResolutionSize.width=this._designResolutionSize.width=e,this._originalDesignResolutionSize.height=this._designResolutionSize.height=t;var r=i.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var o=this._viewportRect,a=this._visibleRect,s=r.viewport;o.x=s.x,o.y=s.y,o.width=s.width,o.height=s.height,a.x=0,a.y=0,a.width=s.width/this._scaleX,a.height=s.height/this._scaleY}i.postApply(this),c.winSize.width=this._visibleRect.width,c.winSize.height=this._visibleRect.height,SA&&SA.init(this._visibleRect),this.emit("design-resolution-changed")}else C(2201)}else R(2200)},n.getDesignResolutionSize=function(){return new vi(this._designResolutionSize.width,this._designResolutionSize.height)},n.setRealPixelResolution=function(e,t,n){this._setViewportMeta({width:e},!0),document.documentElement.style.width=e+"px",document.body.style.width=e+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(e,t,n)},n.getViewportRect=function(){return this._viewportRect},n.getScaleX=function(){return this._scaleX},n.getScaleY=function(){return this._scaleY},n.getDevicePixelRatio=function(){return this._devicePixelRatio},n.convertToLocationInView=function(e,t,n,i){var r=i||new ui,o=this._devicePixelRatio*(e-n.left),a=this._devicePixelRatio*(n.top+n.height-t);return this._isRotated?(r.x=c.game.canvas.width-a,r.y=o):(r.x=o,r.y=a),c.GAME_VIEW&&(r.x/=c.gameView.canvas.width/c.game.canvas.width,r.y/=c.gameView.canvas.height/c.game.canvas.height),r},n._convertPointWithScale=function(e){var t=this._viewportRect;e.x=(e.x-t.x)/this._scaleX,e.y=(e.y-t.y)/this._scaleY},n._resizeEvent=function(){var e=c.view,t=e._frameSize.width,n=e._frameSize.height,i=e._isRotated;if(c.sys.isMobile){var r=c.game.container.style,o=r.margin;r.margin="0",r.display="none",e._initFrameSize(),r.margin=o,r.display="block"}else e._initFrameSize();if(e._orientationChanging||e._isRotated!==i||e._frameSize.width!==t||e._frameSize.height!==n){var a=e._originalDesignResolutionSize.width,s=e._originalDesignResolutionSize.height;e._resizing=!0,a>0&&e.setDesignResolutionSize(a,s,e._resolutionPolicy),e._resizing=!1,e.emit("canvas-resize"),e._resizeCallback&&e._resizeCallback.call()}},n._orientationChange=function(){c.view._orientationChanging=!0,c.view._resizeEvent()},n._initFrameSize=function(){var e=this._frameSize,t=AA.availWidth(c.game.frame),n=AA.availHeight(c.game.frame),i=t>=n;!c.sys.isMobile||i&&this._orientation&c.macro.ORIENTATION_LANDSCAPE||!i&&this._orientation&c.macro.ORIENTATION_PORTRAIT?(e.width=t,e.height=n,c.game.container.style["-webkit-transform"]="rotate(0deg)",c.game.container.style.transform="rotate(0deg)",this._isRotated=!1):(e.width=n,e.height=t,c.game.container.style["-webkit-transform"]="rotate(90deg)",c.game.container.style.transform="rotate(90deg)",c.game.container.style["-webkit-transform-origin"]="0px 0px 0px",c.game.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0,c.game.canvas.style["-webkit-transform"]="translateZ(0px)",c.game.canvas.style.transform="translateZ(0px)"),this._orientationChanging&&setTimeout((function(){c.view._orientationChanging=!1}),1e3)},n._adjustSizeKeepCanvasSize=function(){var e=this._originalDesignResolutionSize.width,t=this._originalDesignResolutionSize.height;e>0&&this.setDesignResolutionSize(e,t,this._resolutionPolicy)},n._setViewportMeta=function(e,t){var n=document.getElementById("cocosMetaElement");n&&t&&document.head.removeChild(n);var i,r,o,a=document.getElementsByName("viewport"),s=a?a[0]:null;for(r in i=s?s.content:"",(n=n||document.createElement("meta")).id="cocosMetaElement",n.name="viewport",n.content="",e)-1===i.indexOf(r)?i+=","+r+"="+e[r]:t&&(o=new RegExp(r+"s*=s*[^,]+"),i=i.replace(o,r+"="+e[r]));/^,/.test(i)&&(i=i.substr(1)),n.content=i,s&&(s.content=i),document.head.appendChild(n)},n._adjustViewportMeta=function(){!this._isAdjustViewport||a||r||o||(this._setViewportMeta(AA.meta,!1),this._isAdjustViewport=!1)},n._convertMouseToLocation=function(e,t){e.x=this._devicePixelRatio*(e.x-t.left),e.y=this._devicePixelRatio*(t.top+t.height-e.y),c.GAME_VIEW&&(e.x/=c.gameView.canvas.width/c.game.canvas.width,e.y/=c.gameView.canvas.height/c.game.canvas.height)},n._convertTouchWidthScale=function(e){var t=this._viewportRect,n=this._scaleX,i=this._scaleY;e._point.x=(e._point.x-t.x)/n,e._point.y=(e._point.y-t.y)/i,e._prevPoint.x=(e._prevPoint.x-t.x)/n,e._prevPoint.y=(e._prevPoint.y-t.y)/i},n._convertTouchesWithScale=function(e){for(var t,n,i=this._viewportRect,r=this._scaleX,o=this._scaleY,a=0;a<e.length;a++){var s=e[a];t=s._point,n=s._prevPoint,t.x=(t.x-i.x)/r,t.y=(t.y-i.y)/o,n.x=(n.x-i.x)/r,n.y=(n.y-i.y)/o}},t}(Q_));CA.instance=void 0;var wA=function(){function e(){this.name="ContainerStrategy"}var t=e.prototype;return t.preApply=function(e){},t.apply=function(e,t){},t.postApply=function(e){},t._setupContainer=function(e,t,n){var i=c.game.canvas,r=c.game.container;c.sys.os===c.sys.OS_ANDROID&&(document.body.style.width=(e._isRotated?n:t)+"px",document.body.style.height=(e._isRotated?t:n)+"px"),r.style.width=i.style.width=t+"px",r.style.height=i.style.height=n+"px",e._devicePixelRatio=1,e.isRetinaEnabled()&&(e._devicePixelRatio=Math.min(e._maxPixelRatio,window.devicePixelRatio||1)),i.width=t*e._devicePixelRatio,i.height=n*e._devicePixelRatio},t._fixContainer=function(){document.body.insertBefore(c.game.container,document.body.firstChild);var e=document.body.style;e.width=window.innerWidth+"px",e.height=window.innerHeight+"px",e.overflow="hidden";var t=c.game.container.style;t.position="fixed",t.left=t.top="0px",document.body.scrollTop=0},e}();wA.EQUAL_TO_FRAME=void 0,wA.PROPORTION_TO_FRAME=void 0;var bA=function(){function e(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var t=e.prototype;return t.preApply=function(e){},t.apply=function(e,t){return{scale:[1,1]}},t.postApply=function(e){},t._buildResult=function(e,t,n,i,r,o){Math.abs(e-n)<2&&(n=e),Math.abs(t-i)<2&&(i=t);var a=new yi(Math.round((e-n)/2),Math.round((t-i)/2),n,i);return this._result.scale=[r,o],this._result.viewport=a,this._result},e}();bA.EXACT_FIT=void 0,bA.SHOW_ALL=void 0,bA.NO_BORDER=void 0,bA.FIXED_HEIGHT=void 0,bA.FIXED_WIDTH=void 0,function(){var e=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="EqualToFrame",t}return $(t,e),t.prototype.apply=function(e){var t=e._frameSize.height,n=c.game.container.style;this._setupContainer(e,e._frameSize.width,e._frameSize.height),e._isRotated?n.margin="0 0 0 "+t+"px":n.margin="0px",n.padding="0px"},t}(wA),t=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ProportionalToFrame",t}return $(t,e),t.prototype.apply=function(e,t){var n,i,r=e._frameSize.width,o=e._frameSize.height,a=c.game.container.style,s=t.width,l=t.height,u=r/s,h=o/l;u<h?(n=r,i=l*u):(n=s*h,i=o);var _=Math.round((r-n)/2),f=Math.round((o-i)/2);n=r-2*_,i=o-2*f,this._setupContainer(e,n,i),e._isRotated?a.margin="0 0 0 "+o+"px":a.margin="0px",a.paddingLeft=_+"px",a.paddingRight=_+"px",a.paddingTop=f+"px",a.paddingBottom=f+"px"},t}(wA),n=("undefined"==typeof window?global:window).__globalAdapter;n&&(n.adaptContainerStrategy&&n.adaptContainerStrategy(wA.prototype),n.adaptView&&n.adaptView(CA.prototype)),wA.EQUAL_TO_FRAME=new e,wA.PROPORTION_TO_FRAME=new t;var i=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ExactFit",t}return $(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,r=n/t.width,o=i/t.height;return this._buildResult(n,i,n,i,r,o)},t}(bA),r=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="ShowAll",t}return $(t,e),t.prototype.apply=function(e,t){var n,i,r=c.game.canvas.width,o=c.game.canvas.height,a=t.width,s=t.height,l=r/a,u=o/s,h=0;return l<u?(n=r,i=s*(h=l)):(n=a*(h=u),i=o),this._buildResult(r,o,n,i,h,h)},t}(bA),o=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="NoBorder",t}return $(t,e),t.prototype.apply=function(e,t){var n,i,r,o=c.game.canvas.width,a=c.game.canvas.height,s=t.width,l=t.height,u=o/s,h=a/l;return u<h?(i=s*(n=h),r=a):(i=o,r=l*(n=u)),this._buildResult(o,a,i,r,n,n)},t}(bA),a=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="FixedHeight",t}return $(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,r=i/t.height,o=n,a=i;return this._buildResult(n,i,o,a,r,r)},t}(bA),s=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).name="FixedWidth",t}return $(t,e),t.prototype.apply=function(e,t){var n=c.game.canvas.width,i=c.game.canvas.height,r=n/t.width,o=n,a=i;return this._buildResult(n,i,o,a,r,r)},t}(bA);bA.EXACT_FIT=new i,bA.SHOW_ALL=new r,bA.NO_BORDER=new o,bA.FIXED_HEIGHT=new a,bA.FIXED_WIDTH=new s}();var IA=e("es",function(){function e(e,t){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(e),this.setContentStrategy(t)}var t=e.prototype;return t.preApply=function(e){this._containerStrategy.preApply(e),this._contentStrategy.preApply(e)},t.apply=function(e,t){return this._containerStrategy.apply(e,t),this._contentStrategy.apply(e,t)},t.postApply=function(e){this._containerStrategy.postApply(e),this._contentStrategy.postApply(e)},t.setContainerStrategy=function(e){e instanceof wA&&(this._containerStrategy=e)},t.setContentStrategy=function(e){e instanceof bA&&(this._contentStrategy=e)},Z(e,[{key:"canvasSize",get:function(){return new ui(c.game.canvas.width,c.game.canvas.height)}}]),e}());IA.EXACT_FIT=0,IA.NO_BORDER=1,IA.SHOW_ALL=2,IA.FIXED_HEIGHT=3,IA.FIXED_WIDTH=4,IA.UNKNOWN=5,IA.ContainerStrategy=wA,IA.ContentStrategy=bA,c.ResolutionPolicy=IA;var RA,OA=e("cg",CA.instance=c.view=new CA);c.winSize=new vi,ge(CA.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),function(e){e.TOUCH_START="touch-start",e.TOUCH_MOVE="touch-move",e.TOUCH_END="touch-end",e.TOUCH_CANCEL="touch-cancel",e.MOUSE_DOWN="mouse-down",e.MOUSE_MOVE="mouse-move",e.MOUSE_UP="mouse-up",e.MOUSE_WHEEL="mouse-wheel",e.MOUSE_ENTER="mouse-enter",e.MOUSE_LEAVE="mouse-leave",e.KEY_DOWN="keydown",e.KEY_UP="keyup",e.DEVICEMOTION="devicemotion",e.TRANSFORM_CHANGED="transform-changed",e.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",e.SIZE_CHANGED="size-changed",e.ANCHOR_CHANGED="anchor-changed",e.COLOR_CHANGED="color-changed",e.CHILD_ADDED="child-added",e.CHILD_REMOVED="child-removed",e.PARENT_CHANGED="parent-changed",e.NODE_DESTROYED="node-destroyed",e.LAYER_CHANGED="layer-changed",e.SIBLING_ORDER_CHANGED="sibling-order-changed"}(RA||(RA=e("b$",{}))),wt(RA),c.SystemEventType=RA,ve(RA,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]);var NA=null,PA=null,MA=null,DA=null,LA=e("ev",function(e){function t(){return e.call(this)||this}$(t,e);var n=t.prototype;return n.setAccelerometerEnabled=function(e){e&&window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(e){C(3520,e),xA.setAccelerometerEnabled("granted"===e)})).catch((function(e){b(3521,e.message),xA.setAccelerometerEnabled(!1)})):xA.setAccelerometerEnabled(e)},n.setAccelerometerInterval=function(e){xA.setAccelerometerInterval(e)},n.on=function(t,n,i,r){return e.prototype.on.call(this,t,n,i,r),t!==RA.KEY_DOWN&&t!==RA.KEY_UP||NA||(NA=nA.create({event:nA.KEYBOARD,onKeyPressed:function(e,t){t.type=RA.KEY_DOWN,FA.emit(t.type,t)},onKeyReleased:function(e,t){t.type=RA.KEY_UP,FA.emit(t.type,t)}}),_A.addListener(NA,256)),t===RA.DEVICEMOTION&&(PA||(PA=nA.create({event:nA.ACCELERATION,callback:function(e,t){t.type=RA.DEVICEMOTION,c.systemEvent.emit(t.type,t)}}),_A.addListener(PA,256))),t!==RA.TOUCH_START&&t!==RA.TOUCH_MOVE&&t!==RA.TOUCH_END&&t!==RA.TOUCH_CANCEL||MA||(MA=nA.create({event:nA.TOUCH_ONE_BY_ONE,onTouchBegan:function(e,t){return t.type=RA.TOUCH_START,c.systemEvent.emit(t.type,e,t),!0},onTouchMoved:function(e,t){t.type=RA.TOUCH_MOVE,c.systemEvent.emit(t.type,e,t)},onTouchEnded:function(e,t){t.type=RA.TOUCH_END,c.systemEvent.emit(t.type,e,t)},onTouchCancelled:function(e,t){t.type=RA.TOUCH_CANCEL,c.systemEvent.emit(t.type,e,t)}}),_A.addListener(MA,256)),t!==RA.MOUSE_DOWN&&t!==RA.MOUSE_MOVE&&t!==RA.MOUSE_UP&&t!==RA.MOUSE_WHEEL||DA||(DA=nA.create({event:nA.MOUSE,onMouseDown:function(e){e.type=RA.MOUSE_DOWN,c.systemEvent.emit(e.type,e)},onMouseMove:function(e){e.type=RA.MOUSE_MOVE,c.systemEvent.emit(e.type,e)},onMouseUp:function(e){e.type=RA.MOUSE_UP,c.systemEvent.emit(e.type,e)},onMouseScroll:function(e){e.type=RA.MOUSE_WHEEL,c.systemEvent.emit(e.type,e)}}),_A.addListener(DA,256)),n},n.off=function(t,n,i){if(e.prototype.off.call(this,t,n,i),NA&&(t===RA.KEY_DOWN||t===RA.KEY_UP)){var r=this.hasEventListener(RA.KEY_DOWN),o=this.hasEventListener(RA.KEY_UP);r||o||(_A.removeListener(NA),NA=null)}if(PA&&t===RA.DEVICEMOTION&&(_A.removeListener(PA),PA=null),MA&&(t===RA.TOUCH_START||t===RA.TOUCH_MOVE||t===RA.TOUCH_END||t===RA.TOUCH_CANCEL)){var a=this.hasEventListener(RA.TOUCH_START),s=this.hasEventListener(RA.TOUCH_MOVE),c=this.hasEventListener(RA.TOUCH_END),l=this.hasEventListener(RA.TOUCH_CANCEL);a||s||c||l||(_A.removeListener(MA),MA=null)}if(DA&&(t===RA.MOUSE_DOWN||t===RA.MOUSE_MOVE||t===RA.MOUSE_UP||t===RA.MOUSE_WHEEL)){var u=this.hasEventListener(RA.MOUSE_DOWN),h=this.hasEventListener(RA.MOUSE_MOVE),_=this.hasEventListener(RA.MOUSE_UP),f=this.hasEventListener(RA.MOUSE_WHEEL);u||h||_||f||(_A.removeListener(DA),DA=null)}},t}(Q_));LA.EventType=RA,c.SystemEvent=LA;var FA=e("ew",new LA);c.systemEvent=FA;var zA=e("cI",{_supportsFullScreen:!1,_onfullscreenchange:null,_onfullscreenerror:null,_preOnFullScreenError:null,_preOnTouch:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){var e,t,n;this._fn={};var i,r=this._fnMap;for(e=0,t=r.length;e<t;e++)if((n=r[e])&&void 0!==document[n[1]]){for(e=0,i=n.length;e<i;e++)this._fn[r[0][e]]=n[e];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},get supportsFullScreen(){return this._supportsFullScreen},fullScreen:function(){return!!this._supportsFullScreen&&void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement]},requestFullScreen:function(e,t,n){if(this._supportsFullScreen){if(e=e||document.documentElement,t){var i=this._fn.fullscreenchange;this._onfullscreenchange&&document.removeEventListener(i,this._onfullscreenchange),this._onfullscreenchange=t,document.addEventListener(i,t,!1)}if(n){var r=this._fn.fullscreenerror;this._onfullscreenerror&&document.removeEventListener(r,this._onfullscreenerror),this._onfullscreenerror=n,document.addEventListener(r,n,{once:!0})}var o=e[this._fn.requestFullscreen]();return window.Promise&&o instanceof Promise&&o.catch((function(e){})),o}},exitFullScreen:function(){var e;return this.fullScreen()&&(e=document[this._fn.exitFullscreen]()).catch((function(e){})),e},autoFullScreen:function(e,t){e=e||document.body,this._ensureFullScreen(e,t),this.requestFullScreen(e,t)},disableAutoFullScreen:function(e){if(this._preOnTouch){var t=c.game.canvas||e,n=this._touchEvent;t.removeEventListener(n,this._preOnTouch),this._preOnTouch=null}},_ensureFullScreen:function(e,t){var n=this,i=c.game.canvas||e,r=this._fn.fullscreenerror,o=this._touchEvent,a=function(){n._preOnFullScreenError=null,n._preOnTouch&&i.removeEventListener(o,n._preOnTouch),n._preOnTouch=function(){n._preOnTouch=null,n.requestFullScreen(e,t)},i.addEventListener(o,n._preOnTouch,{once:!0})};this._preOnFullScreenError&&e.removeEventListener(r,this._preOnFullScreenError),this._preOnFullScreenError=a,e.addEventListener(r,a,{once:!0})}});zA.init(),c.screen=zA;var BA=function(){var e=t.prototype;function t(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return e.main=function(e){if(null!=e){if(window._CCSettings&&window._CCSettings.splashScreen){var t=this.setting=window._CCSettings.splashScreen;t.totalTime=null!=this.setting.totalTime?this.setting.totalTime:3e3,t.base64src=this.setting.base64src||"",t.effect=this.setting.effect||"FADE-INOUT",t.clearColor=this.setting.clearColor||new ms(.88,.88,.88,1),t.displayRatio=null!=this.setting.displayRatio?this.setting.displayRatio:.4,t.displayWatermark=null==this.setting.displayWatermark||this.setting.displayWatermark}else this.setting={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new ms(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.setting.base64src||this.setting.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.setting=null,this._directCall=!0;else{c.view.enableRetina(!0);var n=window._CCSettings.designResolution;n?c.view.setDesignResolutionSize(n.width,n.height,n.policy):c.view.setDesignResolutionSize(960,640,4),this.root=e,this.device=e.device,c.game.once(c.Game.EVENT_GAME_INITED,(function(){c.director._lateUpdate=performance.now()}),c.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1;var i=this.setting.clearColor;this.clearColors=[new ms(i.x,i.y,i.z,i.w)];var r=this.device,o=r.width,a=r.height,s=r.surfaceTransform;this.screenWidth=s%2?a:o,this.screenHeight=s%2?o:a,this.image=new Image,this.image.onload=this.init.bind(this),this.image.src=this.setting.base64src}}else y("RENDER ROOT IS NULL.")},e.setOnFinish=function(e){if(this._directCall&&e)return t._ins=void 0,void e();this.callBack=e},e._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),c.game.resume())},e.init=function(){var e=this;this.initCMD(),this.initIA(),this.initPSO(),this.setting.displayWatermark&&this.initText(),c.game.pause(),this.handle=requestAnimationFrame((function t(n){if(!e.cancelAnimate){e.startTime<0&&(e.startTime=n);var i=n-e.startTime,r=nv(wn(i/e.setting.totalTime));"NONE"===e.setting.effect&&(r=1),e.material.setProperty("u_precent",r),e.material.passes[0].update(),e.setting.displayWatermark&&e.textMaterial&&(e.textMaterial.setProperty("u_precent",r),e.textMaterial.passes[0].update()),e.frame(n),i>e.setting.totalTime&&(e.splashFinish=!0),requestAnimationFrame(t)}}))},e.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},e.frame=function(e){if(!this.cancelAnimate){var t=this.device;t.acquire();var n=this.cmdBuff,i=this.framebuffer,r=this.renderArea;r.height=t.height,r.width=t.width,n.begin(),n.beginRenderPass(i.renderPass,i,r,this.clearColors,1,0);var o=this.material.passes[0],a=vg.getOrCreatePipelineState(t,o,this.shader,i.renderPass,this.assmebler);if(n.bindPipelineState(a),n.bindDescriptorSet(uu.MATERIAL,o.descriptorSet),n.bindInputAssembler(this.assmebler),n.draw(this.assmebler),this.setting.displayWatermark&&this.textShader&&this.textAssmebler){var s=this.textMaterial.passes[0],c=vg.getOrCreatePipelineState(t,s,this.textShader,i.renderPass,this.textAssmebler);n.bindPipelineState(c),n.bindDescriptorSet(uu.MATERIAL,s.descriptorSet),n.bindInputAssembler(this.textAssmebler),n.draw(this.textAssmebler)}n.endRenderPass(),n.end(),t.queue.submit([n]),t.present()}},e.initText=function(){this.textImg=document.createElement("canvas"),this.textImg.width=330,this.textImg.height=30,this.textImg.style.width=""+this.textImg.width,this.textImg.style.height=""+this.textImg.height;var e=this.textImg.getContext("2d");e.font="18px Arial",e.textBaseline="top",e.textAlign="left",e.fillStyle="`#424242`";var t="Powered by Cocos Creator",n=e.measureText(t);e.fillText(t,(330-n.width)/2,6),this.textRegion=new xs,this.textRegion.texExtent.width=this.textImg.width,this.textRegion.texExtent.height=this.textImg.height,this.textRegion.texExtent.depth=1,this.textTexture=this.device.createTexture(new Vs(xa.TEX2D,Ea.SAMPLED|Ea.TRANSFER_DST,ra.RGBA8,this.textImg.width,this.textImg.height)),this.device.copyTexImagesToTexture([this.textImg],this.textTexture,[this.textRegion]),this.textMaterial=new bp,this.textMaterial.initialize({effectName:"splash-screen"});var i=this.textMaterial.passes[0],r=i.getBinding("mainTexture");i.bindTexture(r,this.textTexture),this.textShader=ir.get(i.getShaderVariant()),rr.get(yr.get(i.handle,tr.DESCRIPTOR_SET)).update();var o=4*Float32Array.BYTES_PER_ELEMENT,a=4*o;this.textVB=this.device.createBuffer(new Za(oa.VERTEX|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,a,o));var s=new Float32Array(16),c=-this.textImg.width/2,l=this.textImg.height;l=this.screenWidth<this.screenHeight?(c=-this.screenWidth/2*.5)/(this.textImg.width/this.textImg.height):(c=-this.screenHeight/2*.5)/(this.textImg.width/this.textImg.height);var u=0;s[u++]=c,s[u++]=l,s[u++]=0,s[u++]=1,s[u++]=-c,s[u++]=l,s[u++]=1,s[u++]=1,s[u++]=c,s[u++]=-l,s[u++]=0,s[u++]=0,s[u++]=-c,s[u++]=-l,s[u++]=1,s[u++]=0;for(var h=0;h<s.length;h+=4)s[h]+=this.screenWidth/2,s[h+1]+=.1*this.screenHeight;for(var _=this.device.screenSpaceSignY,f=oi[this.device.surfaceTransform],d=0;d<s.length;d+=4){var m=s[d]/this.screenWidth*2-1,p=(s[d+1]/this.screenHeight*2-1)*_;s[d]=f[0]*m+f[2]*p,s[d+1]=f[1]*m+f[3]*p}this.textVB.update(s);var v=Uint16Array.BYTES_PER_ELEMENT,g=6*v;this.textIB=this.device.createBuffer(new Za(oa.INDEX|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,g,v));var y=new Uint16Array(6);y[0]=0,y[1]=1,y[2]=2,y[3]=1,y[4]=3,y[5]=2,this.textIB.update(y);var x=[new us("a_position",ra.RG32F),new us("a_texCoord",ra.RG32F)],E=new hs(x,[this.textVB],this.textIB);this.textAssmebler=this.device.createInputAssembler(E)},e.initCMD=function(){var e=this.device;this.renderArea=new fs(0,0,e.width,e.height),this.framebuffer=this.root.mainWindow.framebuffer,this.cmdBuff=e.commandBuffer},e.initIA=function(){var e=this.device,t=4*Float32Array.BYTES_PER_ELEMENT,n=4*t;this.vertexBuffers=e.createBuffer(new Za(oa.VERTEX|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,n,t));var i=new Float32Array(16),r=-this.image.width/2,o=this.image.height;o=this.screenWidth<this.screenHeight?(r=-this.screenWidth/2*this.setting.displayRatio)/(this.image.width/this.image.height):(r=-this.screenHeight/2*this.setting.displayRatio)/(this.image.width/this.image.height);var a=0;i[a++]=r,i[a++]=o,i[a++]=0,i[a++]=1,i[a++]=-r,i[a++]=o,i[a++]=1,i[a++]=1,i[a++]=r,i[a++]=-o,i[a++]=0,i[a++]=0,i[a++]=-r,i[a++]=-o,i[a++]=1,i[a++]=0;for(var s=0;s<i.length;s+=4)i[s]+=this.screenWidth/2,i[s+1]+=this.screenHeight/2;for(var c=this.device.screenSpaceSignY,l=oi[this.device.surfaceTransform],u=0;u<i.length;u+=4){var h=i[u]/this.screenWidth*2-1,_=(i[u+1]/this.screenHeight*2-1)*c;i[u]=l[0]*h+l[2]*_,i[u+1]=l[1]*h+l[3]*_}this.vertexBuffers.update(i);var f=Uint16Array.BYTES_PER_ELEMENT,d=6*f;this.indicesBuffers=e.createBuffer(new Za(oa.INDEX|oa.TRANSFER_DST,aa.HOST|aa.DEVICE,d,f));var m=new Uint16Array(6);m[0]=0,m[1]=1,m[2]=2,m[3]=1,m[4]=3,m[5]=2,this.indicesBuffers.update(m);var p=[new us("a_position",ra.RG32F),new us("a_texCoord",ra.RG32F)],v=new hs(p,[this.vertexBuffers],this.indicesBuffers);this.assmebler=e.createInputAssembler(v)},e.initPSO=function(){var e=this.device;this.material=new bp,this.material.initialize({effectName:"splash-screen"});var t=new Ls;t.addressU=ya.CLAMP,t.addressV=ya.CLAMP,this.sampler=e.createSampler(t),this.texture=e.createTexture(new Vs(xa.TEX2D,Ea.SAMPLED|Ea.TRANSFER_DST,ra.RGBA8,this.image.width,this.image.height));var n=this.material.passes[0],i=n.getBinding("mainTexture");n.bindTexture(i,this.texture),this.shader=ir.get(n.getShaderVariant());var r=rr.get(yr.get(n.handle,tr.DESCRIPTOR_SET));r.bindSampler(i,this.sampler),r.update(),this.region=new xs,this.region.texExtent.width=this.image.width,this.region.texExtent.height=this.image.height,this.region.texExtent.depth=1,e.copyTexImagesToTexture([this.image],this.texture,[this.region])},e.destroy=function(){this.callBack=null,this.clearColors=null,this.device=null,this.image=null,this.framebuffer=null,this.renderArea=null,this.region=null,this.cmdBuff=null,this.shader=null,this.material.destroy(),this.material=null,this.texture.destroy(),this.texture=null,this.assmebler.destroy(),this.assmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler.destroy(),this.sampler=null,this.textImg&&(this.textImg=null,this.textRegion=null,this.textShader=null,this.textMaterial.destroy(),this.textMaterial=null,this.textTexture.destroy(),this.textTexture=null,this.textAssmebler.destroy(),this.textAssmebler=null,this.textVB.destroy(),this.textVB=null,this.textIB.destroy(),this.textIB=null),this.setting=null,t._ins=void 0},Z(t,[{key:"splashFinish",set:function(e){this._splashFinish=e,this._tryToStart()}},{key:"loadFinish",set:function(e){this._loadFinish=e,this._tryToStart()}}],[{key:"instance",get:function(){return t._ins||(t._ins=new t),t._ins}}]),t}();BA._ins=void 0,c.internal.SplashScreen=BA;var UA=e("d8",function(){function e(){this._id="",this._priority=0,this._executeInEditMode=!1}e.sortByPriority=function(e,t){return e._priority<t._priority?1:e._priority>t.priority?-1:0};var t=e.prototype;return t.init=function(){},t.update=function(e){},t.postUpdate=function(e){},Z(e,[{key:"priority",set:function(e){this._priority=e},get:function(){return this._priority}},{key:"id",set:function(e){this._id=e},get:function(){return this._id}}]),e}()),GA=new Ne("Scheduler"),HA=function(e,t,n,i){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=e,this.priority=t,this.paused=n,this.markedForDeletion=i};HA.get=function(e,t,n,i){var r=HA._listEntries.pop();return r?(r.target=e,r.priority=t,r.paused=n,r.markedForDeletion=i):r=new HA(e,t,n,i),r},HA.put=function(e){HA._listEntries.length<20&&(e.target=null,HA._listEntries.push(e))},HA._listEntries=[];var kA=function(e,t,n,i){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=e,this.entry=t,this.target=n,this.callback=i};kA.get=function(e,t,n,i){var r=kA._hashUpdateEntries.pop();return r?(r.list=e,r.entry=t,r.target=n,r.callback=i):r=new kA(e,t,n,i),r},kA.put=function(e){kA._hashUpdateEntries.length<20&&(e.list=e.entry=e.target=e.callback=null,kA._hashUpdateEntries.push(e))},kA._hashUpdateEntries=[];var VA=function(e,t,n,i,r,o){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=e,this.target=t,this.timerIndex=n,this.currentTimer=i,this.currentTimerSalvaged=r,this.paused=o};VA.get=function(e,t,n,i,r,o){var a=VA._hashTimerEntries.pop();return a?(a.timers=e,a.target=t,a.timerIndex=n,a.currentTimer=i,a.currentTimerSalvaged=r,a.paused=o):a=new VA(e,t,n,i,r,o),a},VA.put=function(e){VA._hashTimerEntries.length<20&&(e.timers=e.target=e.currentTimer=null,VA._hashTimerEntries.push(e))},VA._hashTimerEntries=[];var jA=function(){function e(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var t=e.prototype;return t.initWithCallback=function(e,t,n,i,r,o){return this._lock=!1,this._scheduler=e,this._target=n,this._callback=t,this._elapsed=-1,this._interval=i,this._delay=o,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===c.macro.REPEAT_FOREVER,!0},t.getInterval=function(){return this._interval},t.setInterval=function(e){this._interval=e},t.update=function(e){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=e,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},t.getCallback=function(){return this._callback},t.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},t.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},e}();jA._timers=[],jA.get=function(){return jA._timers.pop()||new jA},jA.put=function(e){jA._timers.length<20&&!e._lock&&(e._scheduler=e._target=e._callback=null,jA._timers.push(e))};var WA=e("dD",function(e){function t(){var t;return(t=e.call(this)||this)._timeScale=void 0,t._updatesNegList=void 0,t._updates0List=void 0,t._updatesPosList=void 0,t._hashForUpdates=void 0,t._hashForTimers=void 0,t._currentTarget=void 0,t._currentTargetSalvaged=void 0,t._updateHashLocked=void 0,t._arrayForTimers=void 0,t._timeScale=1,t._updatesNegList=[],t._updates0List=[],t._updatesPosList=[],t._hashForUpdates=Ve(!0),t._hashForTimers=Ve(!0),t._currentTarget=null,t._currentTargetSalvaged=!1,t._updateHashLocked=!1,t._arrayForTimers=[],t}$(t,e),t.enableForTarget=function(e){var t=!1;(e.uuid||e.id)&&(t=!0),t||(e.__instanceId?b(1513):e.id=GA.getNewId())};var n=t.prototype;return n.setTimeScale=function(e){this._timeScale=e},n.getTimeScale=function(){return this._timeScale},n.update=function(e){var t,n,i,r,o;for(this._updateHashLocked=!0,1!==this._timeScale&&(e*=this._timeScale),t=0,i=(n=this._updatesNegList).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,i=(n=this._updates0List).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);for(t=0,i=(n=this._updatesPosList).length;t<i;t++)(r=n[t]).paused||r.markedForDeletion||r.target.update(e);var a=this._arrayForTimers;for(t=0;t<a.length;t++){if(o=a[t],this._currentTarget=o,this._currentTargetSalvaged=!1,!o.paused)for(o.timerIndex=0;o.timerIndex<o.timers.length;++o.timerIndex)o.currentTimer=o.timers[o.timerIndex],o.currentTimerSalvaged=!1,o.currentTimer.update(e),o.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--t)}for(t=0,n=this._updatesNegList;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,n=this._updates0List;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;for(t=0,n=this._updatesPosList;t<n.length;)(r=n[t]).markedForDeletion?this._removeUpdateFromHash(r):t++;this._updateHashLocked=!1,this._currentTarget=null},n.schedule=function(e,t,n,i,r,o){if("function"!=typeof e){var a=e;e=t,t=a}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(o=!!i,i=c.macro.REPEAT_FOREVER,r=0),P(t,1502);var s=t.uuid||t.id;if(s){var l,u,h=this._hashForTimers[s];if(h?h.paused!==o&&b(1511):(h=VA.get(null,t,0,null,null,o),this._arrayForTimers.push(h),this._hashForTimers[s]=h),null==h.timers)h.timers=[];else for(u=0;u<h.timers.length;++u)if((l=h.timers[u])&&e===l._callback)return C(1507,l.getInterval(),n),void(l._interval=n);(l=jA.get()).initWithCallback(this,e,t,n,i,r),h.timers.push(l),this._currentTarget===h&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else R(1510)},n.scheduleUpdate=function(e,t,n){var i=e.uuid||e.id;if(i){var r=this._hashForUpdates[i];if(r&&r.entry){if(r.entry.priority===t)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return C(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(e)}var o,a=HA.get(e,t,n,!1);0===t?(o=this._updates0List,this._appendIn(o,a)):(o=t<0?this._updatesNegList:this._updatesPosList,this._priorityIn(o,a,t)),this._hashForUpdates[i]=kA.get(o,a,e,null)}else R(1510)},n.unschedule=function(e,t){if(t&&e){var n=t.uuid||t.id;if(n){var i=this,r=i._hashForTimers[n];if(r)for(var o=r.timers,a=0,s=o.length;a<s;a++){var c=o[a];if(e===c._callback)return c!==r.currentTimer||r.currentTimerSalvaged||(r.currentTimerSalvaged=!0),o.splice(a,1),jA.put(c),r.timerIndex>=a&&r.timerIndex--,void(0===o.length&&(i._currentTarget===r?i._currentTargetSalvaged=!0:i._removeHashElement(r)))}}else R(1510)}},n.unscheduleUpdate=function(e){if(e){var t=e.uuid||e.id;if(t){var n=this._hashForUpdates[t];n&&(this._updateHashLocked?n.entry.markedForDeletion=!0:this._removeUpdateFromHash(n.entry))}else R(1510)}},n.unscheduleAllForTarget=function(e){if(e){var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];if(n){var i=n.timers;i.indexOf(n.currentTimer)>-1&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0);for(var r=0,o=i.length;r<o;r++)jA.put(i[r]);i.length=0,this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)}this.unscheduleUpdate(e)}else R(1510)}},n.unscheduleAll=function(){this.unscheduleAllWithMinPriority(c.Scheduler.PRIORITY_SYSTEM)},n.unscheduleAllWithMinPriority=function(e){var t,n,i,r=this._arrayForTimers;for(t=r.length-1;t>=0;t--)n=r[t],this.unscheduleAllForTarget(n.target);var o=0;if(e<0)for(t=0;t<this._updatesNegList.length;)o=this._updatesNegList.length,(i=this._updatesNegList[t])&&i.priority>=e&&this.unscheduleUpdate(i.target),o===this._updatesNegList.length&&t++;if(e<=0)for(t=0;t<this._updates0List.length;)o=this._updates0List.length,(i=this._updates0List[t])&&this.unscheduleUpdate(i.target),o===this._updates0List.length&&t++;for(t=0;t<this._updatesPosList.length;)o=this._updatesPosList.length,(i=this._updatesPosList[t])&&i.priority>=e&&this.unscheduleUpdate(i.target),o===this._updatesPosList.length&&t++},n.isScheduled=function(e,t){P(e,1508),P(t,1509);var n=t.uuid||t.id;if(n){var i=this._hashForTimers[n];if(!i)return!1;if(null==i.timers)return!1;for(var r=i.timers,o=0;o<r.length;++o)if(e===r[o]._callback)return!0;return!1}R(1510)},n.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(c.Scheduler.PRIORITY_SYSTEM)},n.pauseAllTargetsWithMinPriority=function(e){var t,n,i,r,o=[],a=this._arrayForTimers;for(n=0,i=a.length;n<i;n++)(t=a[n])&&(t.paused=!0,o.push(t.target));if(e<0)for(n=0;n<this._updatesNegList.length;n++)(r=this._updatesNegList[n])&&r.priority>=e&&(r.paused=!0,o.push(r.target));if(e<=0)for(n=0;n<this._updates0List.length;n++)(r=this._updates0List[n])&&(r.paused=!0,o.push(r.target));for(n=0;n<this._updatesPosList.length;n++)(r=this._updatesPosList[n])&&r.priority>=e&&(r.paused=!0,o.push(r.target));return o},n.resumeTargets=function(e){if(e)for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},n.pauseTarget=function(e){P(e,1503);var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];n&&(n.paused=!0);var i=this._hashForUpdates[t];i&&(i.entry.paused=!0)}else R(1510)},n.resumeTarget=function(e){P(e,1504);var t=e.uuid||e.id;if(t){var n=this._hashForTimers[t];n&&(n.paused=!1);var i=this._hashForUpdates[t];i&&(i.entry.paused=!1)}else R(1510)},n.isTargetPaused=function(e){P(e,1505);var t=e.uuid||e.id;if(!t)return R(1510),!1;var n=this._hashForTimers[t];if(n)return n.paused;var i=this._hashForUpdates[t];return!!i&&i.entry.paused},n._removeHashElement=function(e){var t=e.target.uuid||e.target.id;delete this._hashForTimers[t];for(var n=this._arrayForTimers,i=0,r=n.length;i<r;i++)if(n[i]===e){n.splice(i,1);break}VA.put(e)},n._removeUpdateFromHash=function(e){var t=e.target.uuid||e.target.id,n=this._hashForUpdates[t];if(n){for(var i=n.list,r=n.entry,o=0,a=i.length;o<a;o++)if(i[o]===r){i.splice(o,1);break}delete this._hashForUpdates[t],HA.put(r),kA.put(n)}},n._priorityIn=function(e,t,n){for(var i=0;i<e.length;i++)if(n<e[i].priority)return void e.splice(i,0,t);e.push(t)},n._appendIn=function(e,t){e.push(t)},t}(UA));WA.PRIORITY_SYSTEM=1<<31,WA.PRIORITY_NON_SYSTEM=WA.PRIORITY_SYSTEM+1,WA.ID="scheduler",c.Scheduler=WA;var qA=function(){function e(e){this._title="",this._width=1,this._height=1,this._nativeWidth=1,this._nativeHeight=1,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._swapchainBufferIndices=0,this._shouldSyncSizeWithSwapchain=!1,this._poolHandle=nr,this._cameras=[]}e.registerCreateFunc=function(t){t._createWindowFun=function(t){return new e(t)}},Z(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"framebuffer",get:function(){return sr.get(qr.get(this._poolHandle,Hr.FRAMEBUFFER))}},{key:"shouldSyncSizeWithSwapchain",get:function(){return this._shouldSyncSizeWithSwapchain}},{key:"hasOnScreenAttachments",get:function(){return 1===qr.get(this._poolHandle,Hr.HAS_ON_SCREEN_ATTACHMENTS)}},{key:"hasOffScreenAttachments",get:function(){return 1===qr.get(this._poolHandle,Hr.HAS_OFF_SCREEN_ATTACHMENTS)}},{key:"handle",get:function(){return this._poolHandle}},{key:"cameras",get:function(){return this._cameras}}]);var t=e.prototype;return t.initialize=function(e,t){this._poolHandle=qr.alloc(),void 0!==t.title&&(this._title=t.title),void 0!==t.swapchainBufferIndices&&(this._swapchainBufferIndices=t.swapchainBufferIndices),void 0!==t.shouldSyncSizeWithSwapchain&&(this._shouldSyncSizeWithSwapchain=t.shouldSyncSizeWithSwapchain),this._width=t.width,this._height=t.height,this._nativeWidth=this._width,this._nativeHeight=this._height;for(var n=t.renderPassInfo,i=n.colorAttachments,r=n.depthStencilAttachment,o=0;o<i.length;o++)i[o].format===ra.UNKNOWN&&(i[o].format=e.colorFormat);r&&r.format===ra.UNKNOWN&&(r.format=e.depthStencilFormat),this._renderPass=e.createRenderPass(t.renderPassInfo);for(var a=0;a<i.length;a++){var s=null;this._swapchainBufferIndices&1<<a?qr.set(this._poolHandle,Hr.HAS_ON_SCREEN_ATTACHMENTS,1):(s=e.createTexture(new Vs(xa.TEX2D,Ea.COLOR_ATTACHMENT|Ea.SAMPLED,i[a].format,this._width,this._height)),qr.set(this._poolHandle,Hr.HAS_OFF_SCREEN_ATTACHMENTS,1)),this._colorTextures.push(s)}r&&(this._swapchainBufferIndices>=0?(this._depthStencilTexture=e.createTexture(new Vs(xa.TEX2D,Ea.DEPTH_STENCIL_ATTACHMENT|Ea.SAMPLED,r.format,this._width,this._height)),qr.set(this._poolHandle,Hr.HAS_OFF_SCREEN_ATTACHMENTS,1)):qr.set(this._poolHandle,Hr.HAS_ON_SCREEN_ATTACHMENTS,1));var c=sr.alloc(e,new os(this._renderPass,this._colorTextures,this._depthStencilTexture));return qr.set(this._poolHandle,Hr.FRAMEBUFFER,c),!0},t.destroy=function(){this.clearCameras(),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var e=0;e<this._colorTextures.length;e++){var t=this._colorTextures[e];t&&t.destroy()}this._colorTextures.length=0,this._poolHandle&&(sr.get(qr.get(this._poolHandle,Hr.FRAMEBUFFER)).destroy(),this._poolHandle=nr)},t.resize=function(e,t){if(this._width=e,this._height=t,e>this._nativeWidth||t>this._nativeHeight){this._nativeWidth=e,this._nativeHeight=t;var n=!1;this._depthStencilTexture&&(this._depthStencilTexture.resize(e,t),n=!0);for(var i=0;i<this._colorTextures.length;i++){var r=this._colorTextures[i];r&&(r.resize(e,t),n=!0)}var o=sr.get(qr.get(this._poolHandle,Hr.FRAMEBUFFER));n&&o&&(o.destroy(),o.initialize(new os(this._renderPass,this._colorTextures,this._depthStencilTexture)))}for(var a,s=oe(this._cameras);!(a=s()).done;){var c=a.value;c.isWindowSize&&c.resize(e,t)}},t.extractRenderCameras=function(){for(var e=[],t=0;t<this._cameras.length;t++){var n=this._cameras[t];n.enabled&&(n.update(),e.push(n))}return e},t.attachCamera=function(e){for(var t=0;t<this._cameras.length;t++)if(this._cameras[t]===e)return;this._cameras.push(e),this.sortCameras()},t.detachCamera=function(e){for(var t=0;t<this._cameras.length;++t)if(this._cameras[t]===e)return void this._cameras.splice(t,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(e,t){return e.priority-t.priority}))},e}(),YA=function(){function e(e){var t=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._fixedFPSFrameTime=0,this._poolHandle=nr,this._device=e,this._dataPoolMgr=c.internal.DataPoolManager&&new c.internal.DataPoolManager(e),gh.registerCreateFunc(this),qA.registerCreateFunc(this),this._cameraPool=new O_((function(){return new vh(t._device)}),4)}Z(e,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",set:function(e){this._curWindow=e},get:function(){return this._curWindow}},{key:"tempWindow",set:function(e){this._tempWindow=e},get:function(){return this._tempWindow}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return Vr.get(this._poolHandle,Ur.CUMULATIVE_TIME)}},{key:"frameTime",get:function(){return Vr.get(this._poolHandle,Ur.FRAME_TIME)}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",set:function(e){e>0?(this._fixedFPS=e,this._fixedFPSFrameTime=1e3/e):this._fixedFPSFrameTime=0},get:function(){return this._fixedFPS}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"handle",get:function(){return this._poolHandle}}]);var t=e.prototype;return t.initialize=function(e){var t=this;this._poolHandle=Vr.alloc();var n=new Os,i=new Ns;i.depthStoreOp=Ia.DISCARD,i.stencilStoreOp=Ia.DISCARD;var r=new Ms([n],i);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:this._device.width,height:this._device.height,renderPassInfo:r,swapchainBufferIndices:-1}),this._curWindow=this._mainWindow,Promise.resolve(xm.initBuiltinRes(this._device)).then((function(){c.view.on("design-resolution-changed",(function(){var e=c.game.canvas.width,n=c.game.canvas.height;t.resize(e,n)}),t)}))},t.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._poolHandle&&(Vr.free(this._poolHandle),this._poolHandle=nr)},t.resize=function(e,t){this._device.resize(e,t),this._mainWindow.resize(e,t);for(var n,i=oe(this._windows);!(n=i()).done;){var r=n.value;r.shouldSyncSizeWithSwapchain&&r.resize(e,t)}},t.setRenderPipeline=function(e){if(e||(e=this.createDefaultPipeline()),this._pipeline=e,!this._pipeline.activate())return!1;var t=c.director.getScene();return t&&t.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&c.internal.Batcher2D&&(this._batcher=new c.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},t.createDefaultPipeline=function(){var e=new IE;return e.initialize({flows:[]}),e},t.onGlobalPipelineStateChanged=function(){for(var e=0;e<this._scenes.length;e++)this._scenes[e].onGlobalPipelineStateChanged()},t.activeWindow=function(e){this._curWindow=e},t.resetCumulativeTime=function(){Vr.set(this._poolHandle,Ur.CUMULATIVE_TIME,0)},t.frameMove=function(e){var t=this;Vr.set(this._poolHandle,Ur.FRAME_TIME,e),++this._frameCount,Vr.set(this._poolHandle,Ur.CUMULATIVE_TIME,Vr.get(this._poolHandle,Ur.CUMULATIVE_TIME)+e),this._fpsTime+=e,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var n=0;n<this._scenes.length;++n)this._scenes[n].removeBatches();this._batcher&&this._batcher.update(),this._pipeline&&function(){t._device.acquire();var e=t._windows,n=t._scenes,i=c.director.getTotalFrames();t._batcher&&t._batcher.uploadBuffers();for(var r=0;r<n.length;r++)n[r].update(i);c.director.emit(c.Director.EVENT_BEFORE_COMMIT);for(var o=[],a=0;a<e.length;a++)e[a].extractRenderCameras().forEach((function(e){o.push(e)}));o.sort((function(e,t){return e.priority-t.priority})),t._pipeline.render(o),t._device.present()}(),this._batcher&&this._batcher.reset()},t.createWindow=function(e){var t=this._createWindowFun(this);return t.initialize(this.device,e),this._windows.push(t),t},t.destroyWindow=function(e){for(var t=0;t<this._windows.length;++t)if(this._windows[t]===e)return e.destroy(),void this._windows.splice(t,1)},t.destroyWindows=function(){for(var e,t=oe(this._windows);!(e=t()).done;)e.value.destroy();this._windows=[]},t.createScene=function(e){var t=this._createSceneFun(this);return t.initialize(e),this._scenes.push(t),t},t.destroyScene=function(e){for(var t=0;t<this._scenes.length;++t)if(this._scenes[t]===e)return e.destroy(),void this._scenes.splice(t,1)},t.destroyScenes=function(){for(var e,t=oe(this._scenes);!(e=t()).done;)e.value.destroy();this._scenes=[]},t.createModel=function(e){var t=this._modelPools.get(e);t||(this._modelPools.set(e,new O_((function(){return new e}),10)),t=this._modelPools.get(e));var n=t.alloc();return n.initialize(),n},t.destroyModel=function(e){var t=this._modelPools.get(e.constructor);t?(t.free(e),e.destroy(),e.scene&&e.scene.removeModel(e)):b(1300,e.constructor.name)},t.createCamera=function(){return this._cameraPool.alloc()},t.createLight=function(e){var t=this._lightPools.get(e);t||(this._lightPools.set(e,new O_((function(){return new e}),4)),t=this._lightPools.get(e));var n=t.alloc();return n.initialize(),n},t.destroyLight=function(e){var t=this._lightPools.get(e.constructor);if(e.destroy(),t&&(t.free(e),e.scene))switch(e.type){case bm.SPHERE:e.scene.removeSphereLight(e);break;case bm.SPOT:e.scene.removeSpotLight(e)}},e}();c.Root=YA;var XA,KA,QA={};ve(QA,"vmath",[{name:"vec2",newName:"Vec2",target:Ei,targetName:"math"},{name:"vec3",newName:"Vec3",target:Ei,targetName:"math"},{name:"vec4",newName:"Vec4",target:Ei,targetName:"math"},{name:"quat",newName:"Quat",target:Ei,targetName:"math"},{name:"mat3",newName:"Mat3",target:Ei,targetName:"math"},{name:"mat4",newName:"Mat4",target:Ei,targetName:"math"},{name:"color4",newName:"Color",target:Ei,targetName:"math"},{name:"rect",newName:"Rect",target:Ei,targetName:"math"},{name:"approx",newName:"approx",target:Ei,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:Ei,targetName:"math"},{name:"equals",newName:"equals",target:Ei,targetName:"math"},{name:"clamp",newName:"clamp",target:Ei,targetName:"math"},{name:"clamp01",newName:"clamp01",target:Ei,targetName:"math"},{name:"lerp",newName:"lerp",target:Ei,targetName:"math"},{name:"toRadian",newName:"toRadian",target:Ei,targetName:"math"},{name:"toDegree",newName:"toDegree",target:Ei,targetName:"math"},{name:"random",newName:"random",target:Ei,targetName:"math"},{name:"randomRange",newName:"randomRange",target:Ei,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:Ei,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:Ei,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:Ei,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:Ei,targetName:"math"},{name:"repeat",newName:"repeat",target:Ei,targetName:"math"},{name:"pingPong",newName:"pingPong",target:Ei,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:Ei,targetName:"math"}]),c.vmath=QA,ve(WA.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:WA,targetName:"Scheduler"}]),ve($S.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:$S,targetName:"EventTouch"}]),ve(Fm.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),ge(Fm.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),ve(YA.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]),ge(Of.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),ve(wp.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var ZA,JA=e("ee",bh("cc.BufferAsset")((se((KA=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._buffer=null,t}return $(t,e),t.prototype.buffer=function(){return this._buffer},Z(t,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(e){e instanceof ArrayBuffer?this._buffer=e:this._buffer=e.buffer}}]),t}(Z_)).prototype,"_nativeAsset",[i_],Object.getOwnPropertyDescriptor(KA.prototype,"_nativeAsset"),KA.prototype),XA=KA))||XA);c.BufferAsset=JA;var $A=((ZA={})[La.UNORM]="Uint",ZA[La.SNORM]="Int",ZA[La.UINT]="Uint",ZA[La.INT]="Int",ZA[La.UFLOAT]="Float",ZA[La.FLOAT]="Float",ZA.default="Uint",ZA);function eC(e){return($A[e.type]||$A.default)+e.size/e.count*8}function tC(e,t,n,i,r,o,a){void 0===n&&(n=ra.R32F),void 0===i&&(i=0),void 0===r&&(r=e.byteLength-i),void 0===o&&(o=0),a||(a=new DataView(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)));var s=ka[n];o||(o=s.size);for(var c="set"+eC(s),l="get"+eC(s),u=s.size/s.count,h=Math.floor(r/o),_=Vv.isLittleEndian,f=0;f<h;++f)for(var d=i+o*f,m=0;m<s.count;++m){var p=d+u*m,v=e[l](p,_);a[c](p,t(v,m,e),_)}return a}e("aS",function(){function e(e,t,n,i,r){void 0===i&&(i=null),void 0===r&&(r=null),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._handle=nr,this._attributes=t,this._vertexBuffers=e,this._indexBuffer=i,this._indirectBuffer=r,this._primitiveMode=n,this._iaInfo=new hs(t,e,i,r),this._handle=xo.alloc();var o=hr.alloc();xo.set(this._handle,mo.FLAT_BUFFER_ARRAY,o)}var t=e.prototype;return t.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var e=this.mesh,t=0,n=e.struct.primitives[this.subMeshIdx],i=xo.get(this._handle,mo.FLAT_BUFFER_ARRAY);n.indexView&&(t=n.indexView.count);for(var r=0;r<n.vertexBundelIndices.length;r++){var o=n.vertexBundelIndices[r],a=e.struct.vertexBundles[o],s=n.indexView?n.indexView.count:a.view.count,c=a.view.stride,l=c*s,u=new Uint8Array(e.data.buffer,a.view.offset,a.view.length),h=mr.alloc(n.indexView?l:a.view.length),_=vo.alloc();vo.set(_,_o.STRIDE,c),vo.set(_,_o.AMOUNT,s),vo.set(_,_o.BUFFER,h),hr.push(i,_);var f=mr.getBuffer(h),d=new Uint8Array(f);if(n.indexView){for(var m=e.readIndices(this.subMeshIdx),p=0;p<t;++p)for(var v=p*c,g=m[p]*c,y=0;y<c;++y)d[v+y]=u[g+y];this._flatBuffers.push({stride:c,count:s,buffer:d})}else d.set(e.data.subarray(a.view.offset,a.view.offset+a.view.length)),this._flatBuffers.push({stride:c,count:s,buffer:d})}}},t.destroy=function(){for(var e=0;e<this.vertexBuffers.length;e++)this.vertexBuffers[e].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var t=0;t<this._jointMappedBufferIndices.length;t++)this._jointMappedBuffers[this._jointMappedBufferIndices[t]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null),this._handle&&(er(xo.get(this._handle,mo.FLAT_BUFFER_ARRAY),hr,vo),xo.free(this._handle),this._handle=nr)},t.enableVertexIdChannel=function(e){if(!this._vertexIdChannel){var t=this.vertexBuffers.length,n=this.attributes.length,i=this._allocVertexIdBuffer(e);this._vertexBuffers.push(i),this._attributes.push(new us("a_vertexId",ra.R32F,!1,t)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:t,index:n}}},t._allocVertexIdBuffer=function(e){for(var t=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(t),i=0;i<t;++i)n[i]=i+.5;var r=e.createBuffer(new Za(oa.VERTEX|oa.TRANSFER_DST,aa.DEVICE,n.byteLength,n.BYTES_PER_ELEMENT));return r.update(n),r},Z(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Wn.ZERO,max:Wn.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Wn.ZERO,max:Wn.ZERO}};var e=this.mesh,t=this.subMeshIdx,n=e.readAttribute(t,na.ATTR_POSITION),i=e.readIndices(t),r=new Wn,o=new Wn,a=this.attributes.find((function(e){return e.name===na.ATTR_POSITION}));if(a){var s=ka[a.format].count;2===s?(r.set(n[0],n[1],0),o.set(n[0],n[1],0)):(r.set(n[0],n[1],n[2]),o.set(n[0],n[1],n[2]));for(var c=0;c<n.length;c+=s)2===s?(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,o.x=n[c]<o.x?n[c]:o.x,o.y=n[c+1]<o.y?n[c+1]:o.y):(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,r.z=n[c+2]>r.z?n[c+2]:r.z,o.x=n[c]<o.x?n[c]:o.x,o.y=n[c+1]<o.y?n[c+1]:o.y,o.z=n[c+2]<o.z?n[c+2]:o.z)}return this._geometricInfo={positions:n,indices:i,boundingBox:{max:r,min:o}},this._geometricInfo}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var e=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var t=this._jointMappedBuffers=[],n=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var i,r,o=this.mesh.struct,a=o.primitives[this.subMeshIdx];if(!o.jointMaps||void 0===a.jointMapIndex||!o.jointMaps[a.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var s=c.director.root.device,l=0;l<a.vertexBundelIndices.length;l++){var u=o.vertexBundles[a.vertexBundelIndices[l]];r=0,i=ra.UNKNOWN;for(var h=0;h<u.attributes.length;h++){var _=u.attributes[h];if(_.name===na.ATTR_JOINTS){i=_.format;break}r+=ka[_.format].size}i?function(){var c=new Uint8Array(e.mesh.data.buffer,u.view.offset,u.view.length),h=new DataView(c.slice().buffer),_=o.jointMaps[a.jointMapIndex];tC(h,(function(e){return _.indexOf(e)}),i,r,u.view.length,u.view.stride,h);var f=s.createBuffer(new Za(oa.VERTEX|oa.TRANSFER_DST,aa.DEVICE,u.view.length,u.view.stride));f.update(h.buffer),t.push(f),n.push(l)}():t.push(this.vertexBuffers[a.vertexBundelIndices[l]])}return this._vertexIdChannel&&t.push(this._allocVertexIdBuffer(s)),t}},{key:"iaInfo",get:function(){return this._iaInfo}},{key:"handle",get:function(){return this._handle}}]),e}());var nC,iC,rC,oC,aC,sC,cC,lC,uC,hC=e("eg",bh("cc.SceneAsset")((aC=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"scene",rC,ie(t)),ae(t,"asyncLoadAssets",oC,ie(t)),t}return $(t,e),t}(Z_),rC=se((iC=aC).prototype,"scene",[Hh,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oC=se(iC.prototype,"asyncLoadAssets",[Hh,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nC=iC))||nC);c.SceneAsset=hC;var _C,fC,dC,mC,pC=e("dz",bh("cc.TextAsset")((uC=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"text",lC,ie(t)),t}return $(t,e),t.prototype.toString=function(){return this.text},t}(Z_),lC=se((cC=uC).prototype,"text",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),sC=cC))||sC);c.TextAsset=pC;var vC=e("eh",bh("cc.JsonAsset")((mC=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"json",dC,ie(t)),t}return $(t,e),t}(Z_),dC=se((fC=mC).prototype,"json",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_C=fC))||_C);c.JsonAsset=vC;var gC,yC,xC,EC,TC,SC,AC,CC,wC,bC=function(){function e(e){this._uiComp=null,this.opacity=1,this._uiTransformComp=null,this._node=void 0,this._node=e}return Z(e,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(e){this._uiTransformComp=e}},{key:"uiComp",get:function(){return this._uiComp},set:function(e){this._uiComp&&e?b(12002):this._uiComp=e}}]),e}(),IC=(D_.Flags.Destroying,D_.Flags.Destroying),RC=D_.Flags.DontDestroy,OC=D_.Flags.Deactivating,NC=new Ne("Node");function PC(e){return e?"string"==typeof e?mt(e):e:(R(3804),null)}var MC,DC,LC,FC,zC,BC,UC,GC,HC,kC,VC,jC=e("ft",bh("cc.BaseNode")((wC=CC=function(e){$(n,e),n._setScene=function(e){e._updateScene()},n._findComponent=function(e,t){var n=t,i=e._components;if(n._sealed)for(var r=0;r<i.length;++r){var o=i[r];if(o.constructor===t)return o}else for(var a=0;a<i.length;++a){var s=i[a];if(s instanceof t)return s}return null},n._findComponents=function(e,t,n){var i=t,r=e._components;if(i._sealed)for(var o=0;o<r.length;++o){var a=r[o];a.constructor===t&&n.push(a)}else for(var s=0;s<r.length;++s){var c=r[s];c instanceof t&&n.push(c)}},n._findChildComponent=function(e,t){for(var i=0;i<e.length;++i){var r=e[i],o=n._findComponent(r,t);if(o)return o;if(r._children.length>0&&(o=n._findChildComponent(r._children,t)))return o}return null},n._findChildComponents=function(e,t,i){for(var r=0;r<e.length;++r){var o=e[r];n._findComponents(o,t,i),o._children.length>0&&n._findChildComponents(o._children,t,i)}};var t=n.prototype;function n(t){var n;return ae(n=e.call(this,t)||this,"_parent",xC,ie(n)),ae(n,"_children",EC,ie(n)),ae(n,"_active",TC,ie(n)),ae(n,"_components",SC,ie(n)),ae(n,"_prefab",AC,ie(n)),n._scene=null,n._activeInHierarchy=!1,n._id=NC.getNewId(),n._name=void 0,n._eventProcessor=new c.NodeEventProcessor(ie(n)),n._eventMask=0,n._siblingIndex=0,n._registerIfAttached=void 0,n._name=void 0!==t?t:"New Node",n}return t._updateScene=function(){null==this._parent?y("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},Z(n,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&RC)>0},set:function(e){e?this._objFlags|=RC:this._objFlags&=~RC}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(e){if(this._active!==e){this._active=e;var t=this._parent;t&&t._activeInHierarchy&&c.director._nodeActivator.activateNode(this,e)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(e){this.setParent(e)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}}]),t.attr=function(e){et(this,e)},t.getParent=function(){return this._parent},t.setParent=function(e,t){if(void 0===t&&(t=!1),this._parent!==e){var n=this._parent,i=e;if(n&&n._objFlags&OC&&R(3821),this._parent=i,this._siblingIndex=0,this._onSetParent(n,t),this.emit&&this.emit(RA.PARENT_CHANGED,n),n&&!(n._objFlags&IC)){var r=n._children.indexOf(this);n._children.splice(r,1),n._updateSiblingIndex(),n.emit&&n.emit(RA.CHILD_REMOVED,this)}i&&(i._objFlags&OC&&R(3821),i._children.push(this),this._siblingIndex=i._children.length-1,i.emit&&i.emit(RA.CHILD_ADDED,this)),this._onHierarchyChanged(n)}},t.getChildByUuid=function(e){if(!e)return v("Invalid uuid"),null;for(var t=this._children,n=0,i=t.length;n<i;n++)if(t[n]._id===e)return t[n];return null},t.getChildByName=function(e){if(!e)return v("Invalid name"),null;for(var t=this._children,n=0,i=t.length;n<i;n++)if(t[n]._name===e)return t[n];return null},t.getChildByPath=function(e){for(var t=e.split("/"),n=this,i=function(e){var i=t[e];if(0===i.length)return"continue";var r=n.children.find((function(e){return e.name===i}));if(!r)return{v:null};n=r},r=0;r<t.length;++r){var o=i(r);switch(o){case"continue":continue;default:if("object"==typeof o)return o.v}}return n},t.addChild=function(e){e.setParent(this)},t.insertChild=function(e,t){e.parent=this,e.setSiblingIndex(t)},t.getSiblingIndex=function(){return this._siblingIndex},t.setSiblingIndex=function(e){if(this._parent)if(this._parent._objFlags&OC)R(3821);else{var t=this._parent._children;e=-1!==e?e:t.length-1;var n=t.indexOf(this);e!==n&&(t.splice(n,1),e<t.length?t.splice(e,0,this):t.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(e))}},t.walk=function(e,t){var i=1,r=null,o=null,a=0,s=n._stacks[n._stackId];s||(s=[],n._stacks.push(s)),n._stackId++,s.length=0,s[0]=this;for(var c=null,l=!1;i;)if(o=s[--i])if(!l&&e?e(o):l&&t&&t(o),s[i]=null,l){if(c===this._parent)break;if(l=!1,r)if(r[++a])s[i]=r[a],i++;else if(c&&(s[i]=c,i++,l=!0,c._parent?(a=(r=c._parent._children).indexOf(c),c=c._parent):(c=null,r=null),a<0))break}else o._children.length>0?(c=o,r=o._children,a=0,s[i]=r[a],i++):(s[i]=o,i++,l=!0);s.length=0,n._stackId--},t.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},t.removeChild=function(e){this._children.indexOf(e)>-1&&(e.parent=null)},t.removeAllChildren=function(){for(var e=this._children,t=e.length-1;t>=0;t--){var n=e[t];n&&(n.parent=null)}this._children.length=0},t.isChildOf=function(e){var t=this;do{if(t===e)return!0;t=t._parent}while(t);return!1},t.getComponent=function(e){var t=PC(e);return t?n._findComponent(this,t):null},t.getComponents=function(e){var t=PC(e),i=[];return t&&n._findComponents(this,t,i),i},t.getComponentInChildren=function(e){var t=PC(e);return t?n._findChildComponent(this._children,t):null},t.getComponentsInChildren=function(e){var t=PC(e),i=[];return t&&(n._findComponents(this,t,i),n._findChildComponents(this._children,t,i)),i},t.addComponent=function(e){var t;if("string"==typeof e){if(!(t=mt(e)))throw c._RF.peek()&&R(3808,e),TypeError(M(3807,e))}else{if(!e)throw TypeError(M(3804));t=e}if("function"!=typeof t)throw TypeError(M(3809));if(!it(t,c.Component))throw TypeError(M(3810));var n=t._requireComponent;n&&!this.getComponent(n)&&this.addComponent(n);var i=new t;return i.node=this,this._components.push(i),this._activeInHierarchy&&c.director._nodeActivator.activateComp(i),i},t.removeComponent=function(e){if(e){var t=null;(t=e instanceof gd?e:this.getComponent(e))&&t.destroy()}else R(3813)},t.on=function(e,t,n,i){switch(void 0===i&&(i=!1),e){case RA.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(e,t,n,i)},t.off=function(e,t,n,i){if(void 0===i&&(i=!1),this._eventProcessor.off(e,t,n,i),!this._eventProcessor.hasEventListener(e))switch(e){case RA.TRANSFORM_CHANGED:this._eventMask&=-2}},t.once=function(e,t,n,i){this._eventProcessor.once(e,t,n,i)},t.emit=function(e,t,n,i,r,o){this._eventProcessor.emit(e,t,n,i,r,o)},t.dispatchEvent=function(e){this._eventProcessor.dispatchEvent(e)},t.hasEventListener=function(e,t,n){return this._eventProcessor.hasEventListener(e,t,n)},t.targetOff=function(e){this._eventProcessor.targetOff(e),1&this._eventMask&&!this._eventProcessor.hasEventListener(RA.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},t.destroy=function(){return!!e.prototype.destroy.call(this)&&(this.active=!1,!0)},t.destroyAllChildren=function(){for(var e=this._children,t=0;t<e.length;++t)e[t].destroy()},t._removeComponent=function(e){if(e){if(!(this._objFlags&IC)){var t=this._components.indexOf(e);-1!==t?this._components.splice(t,1):e.node!==this&&R(3815)}}else R(3814)},t._updateSiblingIndex=function(){for(var e=0;e<this._children.length;++e)this._children[e]._siblingIndex=e;this.emit(RA.SIBLING_ORDER_CHANGED)},t._onSetParent=function(e,t){this._parent&&(null!=e&&e._scene===this._parent._scene||null==this._parent._scene||this.walk(n._setScene))},t._onPostActivated=function(e){},t._onBatchCreated=function(e){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this))},t._onPreDestroy=function(){this._onPreDestroyBase()},t._onHierarchyChanged=function(e){return this._onHierarchyChangedBase(e)},t._instantiate=function(e,t){return e||(e=c.instantiate._clone(this,this)),e._prefab,e._parent=null,e._onBatchCreated(t),e},t._onHierarchyChangedBase=function(e){var t=this._parent;!this._persistNode||t instanceof c.Scene||c.game.removePersistRootNode(this);var n=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==n&&c.director._nodeActivator.activateNode(this,n)},t._onPreDestroyBase=function(){this._objFlags|=IC;var e=this._parent,t=!!e&&0!=(e._objFlags&IC);if(!t&&i&&this._registerIfAttached(!1),this._persistNode&&c.game.removePersistRootNode(this),!t&&e){this.emit(RA.PARENT_CHANGED,this);var n=e._children.indexOf(this);e._children.splice(n,1),this._siblingIndex=0,e._updateSiblingIndex(),e.emit&&e.emit(RA.CHILD_REMOVED,this)}this.emit(RA.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var r=this._children,o=0;o<r.length;++o)r[o]._destroyImmediate();for(var a=this._components,s=0;s<a.length;++s)a[s]._destroyImmediate();return t},n}(D_),CC.idGenerator=NC,CC._stacks=[[]],CC._stackId=0,se((yC=wC).prototype,"_persistNode",[Nh],Object.getOwnPropertyDescriptor(yC.prototype,"_persistNode"),yC.prototype),se(yC.prototype,"name",[Hh],Object.getOwnPropertyDescriptor(yC.prototype,"name"),yC.prototype),se(yC.prototype,"children",[Hh],Object.getOwnPropertyDescriptor(yC.prototype,"children"),yC.prototype),se(yC.prototype,"active",[Hh],Object.getOwnPropertyDescriptor(yC.prototype,"active"),yC.prototype),se(yC.prototype,"activeInHierarchy",[Hh],Object.getOwnPropertyDescriptor(yC.prototype,"activeInHierarchy"),yC.prototype),se(yC.prototype,"parent",[Hh],Object.getOwnPropertyDescriptor(yC.prototype,"parent"),yC.prototype),xC=se(yC.prototype,"_parent",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),EC=se(yC.prototype,"_children",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),TC=se(yC.prototype,"_active",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),SC=se(yC.prototype,"_components",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AC=se(yC.prototype,"_prefab",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gC=yC))||gC);c._BaseNode=jC;var WC=new Wn,qC=new Jn,YC=new Jn,XC=new Array(10),KC=new Jn,QC=new Kn,ZC=new Kn,JC=new ai,$C=new Map,ew=e("bJ",(MC=bh("cc.Node"),DC=n_(Wn),MC((VC=kC=function(e){function t(t){var n;return(n=e.call(this,t)||this)._uiProps=new bC(ie(n)),n._static=!1,n._pos=new Wn,n._rot=new Jn,n._scale=new Wn(1,1,1),n._mat=new ai,ae(n,"_lpos",zC,ie(n)),ae(n,"_lrot",BC,ie(n)),ae(n,"_lscale",UC,ie(n)),ae(n,"_layer",GC,ie(n)),ae(n,"_euler",HC,ie(n)),n._dirtyFlags=ch.NONE,n._eulerDirty=!1,n._poolHandle=nr,n._poolHandle=Gr.alloc(),Gr.set(n._poolHandle,Lr.LAYER,n._layer),n}$(t,e),t.isNode=function(e){return e instanceof t&&(e.constructor===t||!(e instanceof c.Scene))};var n=t.prototype;return n.destroy=function(){return this._poolHandle&&(Gr.free(this._poolHandle),this._poolHandle=nr),e.prototype.destroy.call(this)},n.setParent=function(t,n){void 0===n&&(n=!1),n&&this.updateWorldTransform(),e.prototype.setParent.call(this,t,n)},n._onSetParent=function(t,n){if(e.prototype._onSetParent.call(this,t,n),n){var i=this._parent;i?(i.updateWorldTransform(),ai.multiply(JC,ai.invert(JC,i._mat),this._mat),ai.toRTS(JC,this._lrot,this._lpos,this._lscale)):(Wn.copy(this._lpos,this._pos),Jn.copy(this._lrot,this._rot),Wn.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(ch.TRS)},n._onBatchCreated=function(t){var n;e.prototype._onBatchCreated.call(this,t),Gr.set(this._poolHandle,Lr.LAYER,this._layer),Gr.setVec3(this._poolHandle,Lr.WORLD_SCALE,this._scale);var i=null===(n=this._prefab)||void 0===n?void 0:n.instance;!t&&i&&AS(this),this.hasChangedFlags=ch.TRS,this._dirtyFlags=ch.TRS;for(var r=this._children.length,o=0;o<r;++o)this._children[o]._onBatchCreated(t);if(!t&&i){var a={};i.targetMap=a,CS(this,a,!0),bS(0,i.mountedChildren,a),IS(0,i.propertyOverrides,a)}RS(this)},n._onBeforeSerialize=function(){this.eulerAngles},n._onPostActivated=function(e){e?(_A.resumeTarget(this),this.eventProcessor.reattach(),this.invalidateChildren(ch.TRS)):_A.pauseTarget(this)},n.translate=function(e,t){var n=t||sh.LOCAL;if(n===sh.LOCAL)Wn.transformQuat(WC,e,this._lrot),this._lpos.x+=WC.x,this._lpos.y+=WC.y,this._lpos.z+=WC.z;else if(n===sh.WORLD)if(this._parent){Jn.invert(qC,this._parent.worldRotation),Wn.transformQuat(WC,e,qC);var i=this.worldScale;this._lpos.x+=WC.x/i.x,this._lpos.y+=WC.y/i.y,this._lpos.z+=WC.z/i.z}else this._lpos.x+=e.x,this._lpos.y+=e.y,this._lpos.z+=e.z;this.invalidateChildren(ch.POSITION),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.POSITION)},n.rotate=function(e,t){var n=t||sh.LOCAL;if(Jn.normalize(qC,e),n===sh.LOCAL)Jn.multiply(this._lrot,this._lrot,qC);else if(n===sh.WORLD){var i=this.worldRotation;Jn.multiply(YC,qC,i),Jn.invert(qC,i),Jn.multiply(YC,qC,YC),Jn.multiply(this._lrot,this._lrot,YC)}this._eulerDirty=!0,this.invalidateChildren(ch.ROTATION),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.ROTATION)},n.lookAt=function(e,t){this.getWorldPosition(WC),Wn.subtract(WC,WC,e),Wn.normalize(WC,WC),Jn.fromViewUp(qC,WC,t),this.setWorldRotation(qC)},n.invalidateChildren=function(e){var t=this.hasChangedFlags;if((this._dirtyFlags&t&e)!==e){this._dirtyFlags|=e,this.hasChangedFlags=t|e;for(var n=e|ch.POSITION,i=this._children.length,r=0;r<i;++r){var o=this._children[r];o.isValid&&o.invalidateChildren(n)}}},n.updateWorldTransform=function(){if(this._dirtyFlags){for(var e,t=this,n=0;t&&t._dirtyFlags;)XC[n++]=t,t=t._parent;for(var i=0;n;)i|=(e=XC[--n])._dirtyFlags,t?(i&ch.POSITION&&(Wn.transformMat4(e._pos,e._lpos,t._mat),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z,Gr.setVec3(e._poolHandle,Lr.WORLD_POSITION,e._pos)),i&ch.RS&&(ai.fromRTS(e._mat,e._lrot,e._lpos,e._lscale),ai.multiply(e._mat,t._mat,e._mat),i&ch.ROTATION&&(Jn.multiply(e._rot,t._rot,e._lrot),Gr.setVec4(e._poolHandle,Lr.WORLD_ROTATION,e._rot)),Kn.fromQuat(QC,Jn.conjugate(KC,e._rot)),Kn.multiplyMat4(QC,QC,e._mat),e._scale.x=QC.m00,e._scale.y=QC.m04,e._scale.z=QC.m08,Gr.setVec3(e._poolHandle,Lr.WORLD_SCALE,e._scale))):(i&ch.POSITION&&(Wn.copy(e._pos,e._lpos),e._mat.m12=e._pos.x,e._mat.m13=e._pos.y,e._mat.m14=e._pos.z,Gr.setVec3(e._poolHandle,Lr.WORLD_POSITION,e._pos)),i&ch.RS&&(i&ch.ROTATION&&(Jn.copy(e._rot,e._lrot),Gr.setVec4(e._poolHandle,Lr.WORLD_ROTATION,e._rot)),i&ch.SCALE&&(Wn.copy(e._scale,e._lscale),Gr.setVec3(e._poolHandle,Lr.WORLD_SCALE,e._scale),ai.fromRTS(e._mat,e._rot,e._pos,e._scale)))),i!==ch.NONE&&Gr.setMat4(e._poolHandle,Lr.WORLD_MATRIX,e._mat),e._dirtyFlags=ch.NONE,t=e}},n.setPosition=function(e,t,n){void 0===t&&void 0===n?Wn.copy(this._lpos,e):void 0===n?Wn.set(this._lpos,e,t,this._lpos.z):Wn.set(this._lpos,e,t,n),this.invalidateChildren(ch.POSITION),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.POSITION)},n.getPosition=function(e){return e?Wn.set(e,this._lpos.x,this._lpos.y,this._lpos.z):Wn.copy(new Wn,this._lpos)},n.setRotation=function(e,t,n,i){void 0===t||void 0===n||void 0===i?Jn.copy(this._lrot,e):Jn.set(this._lrot,e,t,n,i),this._eulerDirty=!0,this.invalidateChildren(ch.ROTATION),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.ROTATION)},n.setRotationFromEuler=function(e,t,n){var i=void 0===n?this._euler.z:n;void 0===t?(Wn.copy(this._euler,e),Jn.fromEuler(this._lrot,e.x,e.y,e.z)):(Wn.set(this._euler,e,t,i),Jn.fromEuler(this._lrot,e,t,i)),this._eulerDirty=!1,this.invalidateChildren(ch.ROTATION),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.ROTATION)},n.getRotation=function(e){return e?Jn.set(e,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):Jn.copy(new Jn,this._lrot)},n.setScale=function(e,t,n){void 0===t&&void 0===n?Wn.copy(this._lscale,e):void 0===n?Wn.set(this._lscale,e,t,this._lscale.z):Wn.set(this._lscale,e,t,n),this.invalidateChildren(ch.SCALE),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.SCALE)},n.getScale=function(e){return e?Wn.set(e,this._lscale.x,this._lscale.y,this._lscale.z):Wn.copy(new Wn,this._lscale)},n.inverseTransformPoint=function(e,t){Wn.copy(e,t);for(var n=this,i=0;n._parent;)XC[i++]=n,n=n._parent;for(;i>=0;)Wn.transformInverseRTS(e,e,n._lrot,n._lpos,n._lscale),n=XC[--i];return e},n.setWorldPosition=function(e,t,n){void 0===t||void 0===n?Wn.copy(this._pos,e):Wn.set(this._pos,e,t,n),Gr.setVec3(this._poolHandle,Lr.WORLD_POSITION,this._pos);var i=this._parent,r=this._lpos;i?(i.updateWorldTransform(),Wn.transformMat4(r,this._pos,ai.invert(JC,i._mat))):Wn.copy(r,this._pos),this.invalidateChildren(ch.POSITION),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.POSITION)},n.getWorldPosition=function(e){return this.updateWorldTransform(),e?Wn.copy(e,this._pos):Wn.copy(new Wn,this._pos)},n.setWorldRotation=function(e,t,n,i){void 0===t||void 0===n||void 0===i?Jn.copy(this._rot,e):Jn.set(this._rot,e,t,n,i),Gr.setVec4(this._poolHandle,Lr.WORLD_ROTATION,this._rot),this._parent?(this._parent.updateWorldTransform(),Jn.multiply(this._lrot,Jn.conjugate(this._lrot,this._parent._rot),this._rot)):Jn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(ch.ROTATION),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.ROTATION)},n.setWorldRotationFromEuler=function(e,t,n){Jn.fromEuler(this._rot,e,t,n),this._parent?(this._parent.updateWorldTransform(),Jn.multiply(this._lrot,Jn.conjugate(this._lrot,this._parent._rot),this._rot)):Jn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(ch.ROTATION),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.ROTATION)},n.getWorldRotation=function(e){return this.updateWorldTransform(),e?Jn.copy(e,this._rot):Jn.copy(new Jn,this._rot)},n.setWorldScale=function(e,t,n){void 0===t||void 0===n?Wn.copy(this._scale,e):Wn.set(this._scale,e,t,n),Gr.setVec3(this._poolHandle,Lr.WORLD_SCALE,this._scale);var i=this._parent;i?(i.updateWorldTransform(),Kn.fromQuat(QC,Jn.conjugate(KC,i._rot)),Kn.multiplyMat4(QC,QC,i._mat),ZC.m00=this._scale.x,ZC.m04=this._scale.y,ZC.m08=this._scale.z,Kn.multiply(QC,ZC,Kn.invert(QC,QC)),this._lscale.x=Wn.set(WC,QC.m00,QC.m01,QC.m02).length(),this._lscale.y=Wn.set(WC,QC.m03,QC.m04,QC.m05).length(),this._lscale.z=Wn.set(WC,QC.m06,QC.m07,QC.m08).length()):Wn.copy(this._lscale,this._scale),this.invalidateChildren(ch.SCALE),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.SCALE)},n.getWorldScale=function(e){return this.updateWorldTransform(),e?Wn.copy(e,this._scale):Wn.copy(new Wn,this._scale)},n.getWorldMatrix=function(e){this.updateWorldTransform();var t=e||new ai;return ai.copy(t,this._mat)},n.getWorldRS=function(e){this.updateWorldTransform();var t=e||new ai;return ai.copy(t,this._mat),t.m12=0,t.m13=0,t.m14=0,t},n.getWorldRT=function(e){this.updateWorldTransform();var t=e||new ai;return ai.fromRT(t,this._rot,this._pos)},n.setRTS=function(e,t,n){var i=0;e&&(i|=ch.ROTATION,void 0!==e.w?(Jn.copy(this._lrot,e),this._eulerDirty=!0):(Wn.copy(this._euler,e),Jn.fromEuler(this._lrot,e.x,e.y,e.z),this._eulerDirty=!1)),t&&(Wn.copy(this._lpos,t),i|=ch.POSITION),n&&(Wn.copy(this._lscale,n),i|=ch.SCALE),i&&(this.invalidateChildren(i),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,i))},n.pauseSystemEvents=function(e){_A.pauseTarget(this,e)},n.resumeSystemEvents=function(e){_A.resumeTarget(this,e)},Z(t,[{key:"handle",get:function(){return this._poolHandle}},{key:"position",get:function(){return this._lpos},set:function(e){this.setPosition(e)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(e){this.setWorldPosition(e)}},{key:"rotation",get:function(){return this._lrot},set:function(e){this.setRotation(e)}},{key:"eulerAngles",set:function(e){this.setRotationFromEuler(e.x,e.y,e.z)},get:function(){return this._eulerDirty&&(Jn.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler}},{key:"angle",get:function(){return this._euler.z},set:function(e){Wn.set(this._euler,0,0,e),Jn.fromAngleZ(this._lrot,e),this._eulerDirty=!1,this.invalidateChildren(ch.ROTATION),1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(e){this.setWorldRotation(e)}},{key:"scale",get:function(){return this._lscale},set:function(e){this.setScale(e)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(e){this.setWorldScale(e)}},{key:"matrix",set:function(e){ai.toRTS(e,this._lrot,this._lpos,this._lscale),this.invalidateChildren(ch.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(RA.TRANSFORM_CHANGED,ch.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return Wn.transformQuat(new Wn,Wn.FORWARD,this.worldRotation)},set:function(e){var t=e.length();Wn.multiplyScalar(WC,e,-1/t),Jn.fromViewUp(qC,WC),this.setWorldRotation(qC)}},{key:"layer",set:function(e){this._layer=e,Gr.set(this._poolHandle,Lr.LAYER,this._layer),this.emit(RA.LAYER_CHANGED,this._layer)},get:function(){return this._layer}},{key:"hasChangedFlags",get:function(){return $C.get(this)||0},set:function(e){$C.set(this,e),Gr.set(this._poolHandle,Lr.FLAGS_CHANGED,e)}}]),t}(jC),kC.bookOfChange=$C,kC.EventType=RA,kC.NodeSpace=sh,kC.TransformDirtyBit=ch,kC.TransformBit=ch,zC=se((FC=VC).prototype,"_lpos",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Wn}}),BC=se(FC.prototype,"_lrot",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jn}}),UC=se(FC.prototype,"_lscale",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Wn(1,1,1)}}),GC=se(FC.prototype,"_layer",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $l.Enum.DEFAULT}}),HC=se(FC.prototype,"_euler",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Wn}}),se(FC.prototype,"eulerAngles",[DC],Object.getOwnPropertyDescriptor(FC.prototype,"eulerAngles"),FC.prototype),se(FC.prototype,"angle",[Hh],Object.getOwnPropertyDescriptor(FC.prototype,"angle"),FC.prototype),se(FC.prototype,"layer",[Hh],Object.getOwnPropertyDescriptor(FC.prototype,"layer"),FC.prototype),LC=FC))||LC));c.Node=ew;var tw=new Array(16),nw=null,iw=new ui,rw=[RA.TOUCH_START.toString(),RA.TOUCH_MOVE.toString(),RA.TOUCH_END.toString(),RA.TOUCH_CANCEL.toString()],ow=[RA.MOUSE_DOWN.toString(),RA.MOUSE_ENTER.toString(),RA.MOUSE_MOVE.toString(),RA.MOUSE_LEAVE.toString(),RA.MOUSE_UP.toString(),RA.MOUSE_WHEEL.toString()];function aw(e,t){var n=this.owner;return!(!n||!n._uiProps.uiTransformComp||(e.getUILocation(iw),!n._uiProps.uiTransformComp.isHit(iw,this)||(t.type=RA.TOUCH_START.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t),0)))}function sw(e,t){var n=this.owner;return!(!n||!n._uiProps.uiTransformComp||(t.type=RA.TOUCH_MOVE.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t),0))}function cw(e,t){var n=this.owner;n&&n._uiProps.uiTransformComp&&(e.getUILocation(iw),n._uiProps.uiTransformComp.isHit(iw,this)?t.type=RA.TOUCH_END.toString():t.type=RA.TOUCH_CANCEL.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t))}function lw(e,t){var n=this.owner;n&&n._uiProps.uiTransformComp&&(t.type=RA.TOUCH_CANCEL.toString(),t.touch=e,t.bubbles=!0,n.dispatchEvent(t))}function uw(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(iw=e.getUILocation(),t._uiProps.uiTransformComp.isHit(iw,this)&&(e.type=RA.MOUSE_DOWN.toString(),e.bubbles=!0,t.dispatchEvent(e)))}function hw(e){var t=this.owner;if(t&&t._uiProps.uiTransformComp){if(iw=e.getUILocation(),t._uiProps.uiTransformComp.isHit(iw,this))this._previousIn||(nw&&nw.eventProcessor.mouseListener&&(e.type=RA.MOUSE_LEAVE,nw.dispatchEvent(e),nw.eventProcessor.mouseListener&&(nw.eventProcessor.mouseListener._previousIn=!1)),nw=t,e.type=RA.MOUSE_ENTER.toString(),t.dispatchEvent(e),this._previousIn=!0),e.type=RA.MOUSE_MOVE.toString(),e.bubbles=!0,t.dispatchEvent(e);else{if(!this._previousIn)return;e.type=RA.MOUSE_LEAVE.toString(),t.dispatchEvent(e),this._previousIn=!1,nw=null}e.propagationStopped=!0}}function _w(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(iw=e.getUILocation(),t._uiProps.uiTransformComp.isHit(iw,this)&&(e.type=RA.MOUSE_UP.toString(),e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0))}function fw(e){var t=this.owner;t&&t._uiProps.uiTransformComp&&(iw=e.getUILocation(),t._uiProps.uiTransformComp.isHit(iw,this)&&(e.type=RA.MOUSE_WHEEL.toString(),e.bubbles=!0,t.dispatchEvent(e),e.propagationStopped=!0))}function dw(e,t){if(t){for(var n=0,i=[],r=e;r&&ew.isNode(r);r=r.parent,++n){var o=r.getComponent(t);if(o){var a={index:n,comp:o};i?i.push(a):i=[a]}}return i.length>0?i:null}return null}function mw(e,t){if(!e._persistNode){if(e.eventProcessor.bubblingTargets)for(var n=0;n<t.length;++n)if(e.eventProcessor.bubblingTargets.hasEventListener(t[n]))return!0;if(e.eventProcessor.capturingTargets)for(var i=0;i<t.length;++i)if(e.eventProcessor.capturingTargets.hasEventListener(t[i]))return!0;return!1}return!0}var pw,vw,gw,yw,xw,Ew,Tw,Sw,Aw,Cw,ww,bw,Iw,Rw,Ow,Nw,Pw,Mw,Dw,Lw,Fw,zw,Bw,Uw,Gw,Hw,kw,Vw,jw,Ww,qw,Yw,Xw,Kw,Qw,Zw,Jw,$w,eb,tb,nb,ib,rb,ob,ab,sb,cb,lb,ub,hb,_b,fb,db,mb,pb,vb,gb,yb,xb,Eb,Tb,Sb,Ab,Cb,wb,bb,Ib,Rb,Ob,Nb,Pb,Mb,Db,Lb,Fb,zb,Bb,Ub,Gb,Hb,kb,Vb,jb,Wb,qb,Yb,Xb,Kb,Qb,Zb,Jb,$b,eI,tI,nI,iI,rI,oI,aI,sI,cI,lI,uI,hI,_I,fI,dI,mI=function(){function e(e){this.bubblingTargets=null,this.capturingTargets=null,this.touchListener=null,this.mouseListener=null,this._node=void 0,this._comp=null,this._node=e}Z(e,[{key:"node",get:function(){return this._node}}]);var t=e.prototype;return t.reattach=function(){if(this._comp)if(this.touchListener){var e=this.touchListener.mask=dw(this._node,this._comp);this.mouseListener&&(this.mouseListener.mask=e)}else this.mouseListener&&(this.mouseListener.mask=dw(this._node,this._comp))},t.registerComponentHitList=function(e){this._comp=e},t.destroy=function(){nw===this._node&&(nw=null),(this.touchListener||this.mouseListener)&&(_A.removeListeners(this._node),this.touchListener&&(this.touchListener.owner=null,this.touchListener.mask=null,this.touchListener=null),this.mouseListener&&(this.mouseListener.owner=null,this.mouseListener.mask=null,this.mouseListener=null)),this.capturingTargets&&this.capturingTargets.clear(),this.bubblingTargets&&this.bubblingTargets.clear()},t.on=function(e,t,n,i){return this._checknSetupSysEvent(e)?this._onDispatch(e,t,n,i):(this.bubblingTargets||(this.bubblingTargets=new V_),this.bubblingTargets.on(e,t,n))},t.once=function(e,t,n,i){var r,o=this;(r=this._checknSetupSysEvent(e)&&i?this.capturingTargets=this.capturingTargets||new V_:this.bubblingTargets=this.bubblingTargets||new V_).on(e,t,n,!0),r.on(e,(function(){o.off(e,t,n)}),void 0,!0)},t.off=function(e,t,n,i){var r=-1!==rw.indexOf(e),o=!r&&-1!==ow.indexOf(e);r||o?(this._offDispatch(e,t,n,i),r?this.touchListener&&!mw(this._node,rw)&&(_A.removeListener(this.touchListener),this.touchListener=null):o&&this.mouseListener&&!mw(this._node,ow)&&(_A.removeListener(this.mouseListener),this.mouseListener=null)):this.bubblingTargets&&this.bubblingTargets.off(e,t,n)},t.emit=function(e,t,n,i,r,o){this.bubblingTargets&&this.bubblingTargets.emit(e,t,n,i,r,o)},t.dispatchEvent=function(e){!function(e,t){var n,i=0;for(t.target=e,tw.length=0,e.eventProcessor.getCapturingTargets(t.type,tw),t.eventPhase=1,i=tw.length-1;i>=0;--i)if((n=tw[i]).eventProcessor.capturingTargets&&(t.currentTarget=n,n.eventProcessor.capturingTargets.emit(t.type,t,tw),t.propagationStopped))return void(tw.length=0);if(tw.length=0,t.eventPhase=2,t.currentTarget=e,e.eventProcessor.capturingTargets&&e.eventProcessor.capturingTargets.emit(t.type,t),!t.propagationImmediateStopped&&e.eventProcessor.bubblingTargets&&e.eventProcessor.bubblingTargets.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(e.eventProcessor.getBubblingTargets(t.type,tw),t.eventPhase=3,i=0;i<tw.length;++i)if((n=tw[i]).eventProcessor.bubblingTargets&&(t.currentTarget=n,n.eventProcessor.bubblingTargets.emit(t.type,t),t.propagationStopped))return void(tw.length=0);tw.length=0}(this._node,e),tw.length=0},t.hasEventListener=function(e,t,n){var i=!1;return this.bubblingTargets&&(i=this.bubblingTargets.hasEventListener(e,t,n)),!i&&this.capturingTargets&&(i=this.capturingTargets.hasEventListener(e,t,n)),i},t.targetOff=function(e){this.capturingTargets&&this.capturingTargets.removeAll(e),this.bubblingTargets&&this.bubblingTargets.removeAll(e),this.touchListener&&!mw(this.node,rw)&&(_A.removeListener(this.touchListener),this.touchListener=null),this.mouseListener&&!mw(this.node,ow)&&(_A.removeListener(this.mouseListener),this.mouseListener=null)},t.getCapturingTargets=function(e,t){for(var n=this._node.parent;n;)n.eventProcessor.capturingTargets&&n.eventProcessor.capturingTargets.hasEventListener(e)&&t.push(n),n=n.parent},t.getBubblingTargets=function(e,t){for(var n=this._node.parent;n;)n.eventProcessor.bubblingTargets&&n.eventProcessor.bubblingTargets.hasEventListener(e)&&t.push(n),n=n.parent},t._checknSetupSysEvent=function(e){var t=this,n=!1,i=!1;return-1!==rw.indexOf(e)?(this.touchListener||(this.touchListener=c.EventListener.create({event:c.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this._node,mask:dw(this._node,this._comp),onTouchBegan:aw,onTouchMoved:sw,onTouchEnded:cw,onTouchCancelled:lw}),_A.addListener(this.touchListener,this._node),n=!0),i=!0):-1!==ow.indexOf(e)&&(this.mouseListener||(this.mouseListener=c.EventListener.create({event:c.EventListener.MOUSE,_previousIn:!1,owner:this._node,mask:dw(this._node,this._comp),onMouseDown:uw,onMouseMove:hw,onMouseUp:_w,onMouseScroll:fw}),_A.addListener(this.mouseListener,this._node),n=!0),i=!0),n&&!this._node.activeInHierarchy&&c.director.getScheduler().schedule((function(){t._node.activeInHierarchy||_A.pauseTarget(t._node)}),this._node,0,0,0,!1),i},t._onDispatch=function(e,t,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,t){var r=null;return(r=i?this.capturingTargets=this.capturingTargets||new V_:this.bubblingTargets=this.bubblingTargets||new V_).hasEventListener(e,t,n)||r.on(e,t,n),t}R(6800)},t._offDispatch=function(e,t,n,i){if("boolean"==typeof n?(i=n,n=void 0):i=!!i,t){var r=i?this.capturingTargets:this.bubblingTargets;r&&r.off(e,t,n)}else this.capturingTargets&&this.capturingTargets.removeAll(e),this.bubblingTargets&&this.bubblingTargets.removeAll(e)},e}();c.NodeEventProcessor=mI,ve(jC.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),ve(ew.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(e){this._uiProps.uiTransformComp.width=e}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(e){this._uiProps.uiTransformComp.height=e}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(e){this._uiProps.uiTransformComp.anchorX=e}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(e){this._uiProps.uiTransformComp.anchorY=e}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new ui),e.set(this._uiProps.uiTransformComp.anchorPoint),e}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){this._uiProps.uiTransformComp.setAnchorPoint(e,t)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e){return e||(e=new vi),e.set(this._uiProps.uiTransformComp.contentSize),e}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(e,t){"number"==typeof e?this._uiProps.uiTransformComp.setContentSize(e,t):this._uiProps.uiTransformComp.setContentSize(e)}}]),ge(ew.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),ge($l,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),ve($l,"Layers",[{name:"Default",newName:"DEFAULT",target:$l.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:$l.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:$l.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:$l.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:$l.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:$l.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:$l.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:$l.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:$l,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:$l,targetName:"Layers"}]),ge($l.Enum,"Layers.Enum",[{name:"ALWAYS"}]),ge($l.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var pI=new Wn(0,1,0),vI=new Wn,gI=new Jn,yI=(pw=bh("cc.AmbientInfo"),vw=n_(Zt),pw((Sw=function(){function e(){ae(this,"_skyColor",xw,this),ae(this,"_skyIllum",Ew,this),ae(this,"_groundAlbedo",Tw,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this)},Z(e,[{key:"skyColor",set:function(e){this._skyColor.set(e),this._resource&&(this._resource.skyColor=this._skyColor)},get:function(){return this._skyColor}},{key:"skyIllum",set:function(e){this._skyIllum=e,this._resource&&(this._resource.skyIllum=this.skyIllum)},get:function(){return this._skyIllum}},{key:"groundAlbedo",set:function(e){this._groundAlbedo.set(e),this._resource&&(this._resource.groundAlbedo=this._groundAlbedo)},get:function(){return this._groundAlbedo}}]),e}(),xw=se((yw=Sw).prototype,"_skyColor",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Vn(51,128,204,1)}}),Ew=se(yw.prototype,"_skyIllum",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return No.SKY_ILLUM}}),Tw=se(yw.prototype,"_groundAlbedo",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Vn(51,51,51,255)}}),se(yw.prototype,"skyColor",[Hh],Object.getOwnPropertyDescriptor(yw.prototype,"skyColor"),yw.prototype),se(yw.prototype,"skyIllum",[Hh,vw],Object.getOwnPropertyDescriptor(yw.prototype,"skyIllum"),yw.prototype),se(yw.prototype,"groundAlbedo",[Hh],Object.getOwnPropertyDescriptor(yw.prototype,"groundAlbedo"),yw.prototype),gw=yw))||gw);c.AmbientInfo=yI;var xI=(Aw=bh("cc.SkyboxInfo"),Cw=n_(Gd),ww=n_(Gd),Aw((Mw=function(){function e(){ae(this,"_envmap",Rw,this),ae(this,"_isRGBE",Ow,this),ae(this,"_enabled",Nw,this),ae(this,"_useIBL",Pw,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},Z(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=this._enabled))},get:function(){return this._enabled}},{key:"useIBL",set:function(e){this._useIBL=e,this._resource&&(this._resource.useIBL=this._useIBL)},get:function(){return this._useIBL}},{key:"envmap",set:function(e){this._envmap=e,this._resource&&(this._resource.envmap=this._envmap)},get:function(){return this._envmap}},{key:"isRGBE",set:function(e){this._isRGBE=e,this._resource&&(this._resource.isRGBE=this._isRGBE)},get:function(){return this._isRGBE}}]),e}(),Rw=se((Iw=Mw).prototype,"_envmap",[Cw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ow=se(Iw.prototype,"_isRGBE",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Nw=se(Iw.prototype,"_enabled",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Pw=se(Iw.prototype,"_useIBL",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),se(Iw.prototype,"enabled",[Hh],Object.getOwnPropertyDescriptor(Iw.prototype,"enabled"),Iw.prototype),se(Iw.prototype,"useIBL",[Hh],Object.getOwnPropertyDescriptor(Iw.prototype,"useIBL"),Iw.prototype),se(Iw.prototype,"envmap",[Hh,ww],Object.getOwnPropertyDescriptor(Iw.prototype,"envmap"),Iw.prototype),se(Iw.prototype,"isRGBE",[Hh],Object.getOwnPropertyDescriptor(Iw.prototype,"isRGBE"),Iw.prototype),bw=Iw))||bw);c.SkyboxInfo=xI;var EI=(Dw=bh("cc.FogInfo"),Lw=n_(EE),Fw=kh(),zw=n_(Zt),Bw=Wh(),Uw=Xh(),Gw=Qh(),Hw=kh(),kw=n_(Zt),Vw=Xh(),jw=Qh(),Ww=kh(),qw=n_(Zt),Yw=Xh(),Xw=Qh(),Kw=kh(),Qw=n_(Zt),Zw=qh(),Jw=Xh(),$w=Qh(),eb=kh(),tb=n_(Zt),nb=Xh(),ib=Qh(),rb=kh(),ob=n_(Zt),ab=Xh(),sb=Qh(),Dw((xb=yb=function(){function e(){ae(this,"_type",ub,this),ae(this,"_fogColor",hb,this),ae(this,"_enabled",_b,this),ae(this,"_fogDensity",fb,this),ae(this,"_fogStart",db,this),ae(this,"_fogEnd",mb,this),ae(this,"_fogAtten",pb,this),ae(this,"_fogTop",vb,this),ae(this,"_fogRange",gb,this),this._resource=null}return e.prototype.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},Z(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"fogColor",set:function(e){this._fogColor.set(e),this._resource&&(this._resource.fogColor=this._fogColor)},get:function(){return this._fogColor}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._resource&&(this._resource.type=e)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(e){this._fogDensity=e,this._resource&&(this._resource.fogDensity=e)}},{key:"fogStart",get:function(){return this._fogStart},set:function(e){this._fogStart=e,this._resource&&(this._resource.fogStart=e)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(e){this._fogEnd=e,this._resource&&(this._resource.fogEnd=e)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(e){this._fogAtten=e,this._resource&&(this._resource.fogAtten=e)}},{key:"fogTop",get:function(){return this._fogTop},set:function(e){this._fogTop=e,this._resource&&(this._resource.fogTop=e)}},{key:"fogRange",get:function(){return this._fogRange},set:function(e){this._fogRange=e,this._resource&&(this._resource.fogRange=e)}}]),e}(),yb.FogType=EE,ub=se((lb=xb).prototype,"_type",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return EE.LINEAR}}),hb=se(lb.prototype,"_fogColor",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Vn("#C8C8C8")}}),_b=se(lb.prototype,"_enabled",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fb=se(lb.prototype,"_fogDensity",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),db=se(lb.prototype,"_fogStart",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),mb=se(lb.prototype,"_fogEnd",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),pb=se(lb.prototype,"_fogAtten",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),vb=se(lb.prototype,"_fogTop",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),gb=se(lb.prototype,"_fogRange",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),se(lb.prototype,"enabled",[Hh],Object.getOwnPropertyDescriptor(lb.prototype,"enabled"),lb.prototype),se(lb.prototype,"fogColor",[Hh],Object.getOwnPropertyDescriptor(lb.prototype,"fogColor"),lb.prototype),se(lb.prototype,"type",[Hh,Lw],Object.getOwnPropertyDescriptor(lb.prototype,"type"),lb.prototype),se(lb.prototype,"fogDensity",[Fw,zw,Bw,Uw,Kh,Gw],Object.getOwnPropertyDescriptor(lb.prototype,"fogDensity"),lb.prototype),se(lb.prototype,"fogStart",[Hw,kw,Vw,jw],Object.getOwnPropertyDescriptor(lb.prototype,"fogStart"),lb.prototype),se(lb.prototype,"fogEnd",[Ww,qw,Yw,Xw],Object.getOwnPropertyDescriptor(lb.prototype,"fogEnd"),lb.prototype),se(lb.prototype,"fogAtten",[Kw,Qw,Zw,Jw,$w],Object.getOwnPropertyDescriptor(lb.prototype,"fogAtten"),lb.prototype),se(lb.prototype,"fogTop",[eb,tb,nb,ib],Object.getOwnPropertyDescriptor(lb.prototype,"fogTop"),lb.prototype),se(lb.prototype,"fogRange",[rb,ob,ab,sb],Object.getOwnPropertyDescriptor(lb.prototype,"fogRange"),lb.prototype),cb=lb))||cb),TI=(Eb=bh("cc.ShadowsInfo"),Tb=n_(Ip),Sb=kh(),Ab=n_(Zt),Cb=kh(),wb=n_(Rp),bb=kh(),Ib=n_(Jt),Rb=kh(),Ob=n_(Zt),Nb=kh(),Pb=n_(Zt),Mb=kh(),Db=n_(Zt),Lb=kh(),Fb=n_(Qt),zb=kh(),Bb=kh(),Ub=n_(Zt),Gb=kh(),Hb=n_(Zt),kb=kh(),Eb((oI=function(){function e(){ae(this,"_type",Wb,this),ae(this,"_enabled",qb,this),ae(this,"_normal",Yb,this),ae(this,"_distance",Xb,this),ae(this,"_shadowColor",Kb,this),ae(this,"_autoAdapt",Qb,this),ae(this,"_pcf",Zb,this),ae(this,"_bias",Jb,this),ae(this,"_near",$b,this),ae(this,"_far",eI,this),ae(this,"_aspect",tI,this),ae(this,"_orthoSize",nI,this),ae(this,"_maxReceived",iI,this),ae(this,"_size",rI,this),this._resource=null}var t=e.prototype;return t.setPlaneFromNode=function(e){e.getWorldRotation(gI),this.normal=Wn.transformQuat(vI,pI,gI),e.getWorldPosition(vI),this.distance=Wn.dot(this._normal,vI)},t.activate=function(e){this._resource=e,this._resource.initialize(this),this._resource.activate()},Z(e,[{key:"enabled",set:function(e){this._enabled!==e&&(this._enabled=e,this._resource&&(this._resource.enabled=e,e&&(this._resource.type=this._type)))},get:function(){return this._enabled}},{key:"type",set:function(e){this._type=e,this._resource&&(this._resource.type=e)},get:function(){return this._type}},{key:"shadowColor",set:function(e){this._shadowColor.set(e),this._resource&&(this._resource.shadowColor=e)},get:function(){return this._shadowColor}},{key:"normal",set:function(e){Wn.copy(this._normal,e),this._resource&&(this._resource.normal=e)},get:function(){return this._normal}},{key:"distance",set:function(e){this._distance=e,this._resource&&(this._resource.distance=e)},get:function(){return this._distance}},{key:"pcf",set:function(e){this._pcf=e,this._resource&&(this._resource.pcf=e)},get:function(){return this._pcf}},{key:"autoAdapt",set:function(e){this._autoAdapt=e,this._resource&&(this._resource.autoAdapt=e)},get:function(){return this._autoAdapt}},{key:"near",set:function(e){this._near=e,this._resource&&(this._resource.near=e)},get:function(){return this._near}},{key:"far",set:function(e){this._far=e,this._resource&&(this._resource.far=e)},get:function(){return this._far}},{key:"orthoSize",set:function(e){this._orthoSize=e,this._resource&&(this._resource.orthoSize=e)},get:function(){return this._orthoSize}},{key:"maxReceived",set:function(e){this._maxReceived=e,this._resource&&(this._resource.maxReceived=e)},get:function(){return this._maxReceived}},{key:"shadowMapSize",set:function(e){this._size.set(e),this._resource&&(this._resource.size=e,this._resource.shadowMapDirty=!0)},get:function(){return this._size}},{key:"aspect",set:function(e){this._aspect=e,this._resource&&(this._resource.aspect=e)},get:function(){return this._aspect}},{key:"bias",set:function(e){this._bias=e,this._resource&&(this._resource.bias=e)},get:function(){return this._bias}}]),e}(),Wb=se((jb=oI).prototype,"_type",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ip.Planar}}),qb=se(jb.prototype,"_enabled",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Yb=se(jb.prototype,"_normal",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Wn(0,1,0)}}),Xb=se(jb.prototype,"_distance",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Kb=se(jb.prototype,"_shadowColor",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Vn(0,0,0,76)}}),Qb=se(jb.prototype,"_autoAdapt",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Zb=se(jb.prototype,"_pcf",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rp.HARD}}),Jb=se(jb.prototype,"_bias",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e-5}}),$b=se(jb.prototype,"_near",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),eI=se(jb.prototype,"_far",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),tI=se(jb.prototype,"_aspect",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),nI=se(jb.prototype,"_orthoSize",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),iI=se(jb.prototype,"_maxReceived",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),rI=se(jb.prototype,"_size",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ui(512,512)}}),se(jb.prototype,"enabled",[Hh],Object.getOwnPropertyDescriptor(jb.prototype,"enabled"),jb.prototype),se(jb.prototype,"type",[Hh,Tb],Object.getOwnPropertyDescriptor(jb.prototype,"type"),jb.prototype),se(jb.prototype,"shadowColor",[Hh],Object.getOwnPropertyDescriptor(jb.prototype,"shadowColor"),jb.prototype),se(jb.prototype,"normal",[Sb],Object.getOwnPropertyDescriptor(jb.prototype,"normal"),jb.prototype),se(jb.prototype,"distance",[Ab,Cb],Object.getOwnPropertyDescriptor(jb.prototype,"distance"),jb.prototype),se(jb.prototype,"pcf",[wb,bb],Object.getOwnPropertyDescriptor(jb.prototype,"pcf"),jb.prototype),se(jb.prototype,"autoAdapt",[Ib,Rb],Object.getOwnPropertyDescriptor(jb.prototype,"autoAdapt"),jb.prototype),se(jb.prototype,"near",[Ob,Nb],Object.getOwnPropertyDescriptor(jb.prototype,"near"),jb.prototype),se(jb.prototype,"far",[Pb,Mb],Object.getOwnPropertyDescriptor(jb.prototype,"far"),jb.prototype),se(jb.prototype,"orthoSize",[Db,Lb],Object.getOwnPropertyDescriptor(jb.prototype,"orthoSize"),jb.prototype),se(jb.prototype,"maxReceived",[Fb,zb],Object.getOwnPropertyDescriptor(jb.prototype,"maxReceived"),jb.prototype),se(jb.prototype,"shadowMapSize",[Bb],Object.getOwnPropertyDescriptor(jb.prototype,"shadowMapSize"),jb.prototype),se(jb.prototype,"aspect",[Ub,Gb],Object.getOwnPropertyDescriptor(jb.prototype,"aspect"),jb.prototype),se(jb.prototype,"bias",[Hb,kb],Object.getOwnPropertyDescriptor(jb.prototype,"bias"),jb.prototype),Vb=jb))||Vb);c.ShadowsInfo=TI;var SI,AI,CI,wI,bI=(aI=bh("cc.SceneGlobals"),sI=n_(xI),aI((dI=function(){function e(){ae(this,"ambient",uI,this),ae(this,"shadows",hI,this),ae(this,"_skybox",_I,this),ae(this,"fog",fI,this)}return e.prototype.activate=function(){var e=c.director.root.pipeline;this.ambient.activate(e.ambient),this.skybox.activate(e.skybox),this.shadows.activate(e.shadows),this.fog.activate(e.fog)},Z(e,[{key:"skybox",get:function(){return this._skybox},set:function(e){this._skybox=e}}]),e}(),uI=se((lI=dI).prototype,"ambient",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new yI}}),hI=se(lI.prototype,"shadows",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new TI}}),_I=se(lI.prototype,"_skybox",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new xI}}),fI=se(lI.prototype,"fog",[Hh,Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new EI}}),se(lI.prototype,"skybox",[Hh,sI],Object.getOwnPropertyDescriptor(lI.prototype,"skybox"),lI.prototype),cI=lI))||cI);c.SceneGlobals=bI;var II,RI=e("cP",bh("cc.Scene")((se((AI=function(e){$(n,e);var t=n.prototype;function n(t){var n;return ae(n=e.call(this,t)||this,"autoReleaseAssets",CI,ie(n)),ae(n,"_globals",wI,ie(n)),n._renderScene=null,n.dependAssets=null,n._inited=void 0,n._prefabSyncedInLiveReload=!1,n._pos=Wn.ZERO,n._rot=Jn.IDENTITY,n._scale=Wn.ONE,n._mat=ai.IDENTITY,n._dirtyFlags=0,n._activeInHierarchy=!1,c.director&&c.director.root&&(n._renderScene=c.director.root.createScene({})),n._inited=!c.game||!c.game._isCloning,n}return t._updateScene=function(){this._scene=this},Z(n,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]),t.destroy=function(){var e=D_.prototype.destroy.call(this);if(e)for(var t=this._children,n=0;n<t.length;++n)t[n].active=!1;return c.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,e},t.addComponent=function(){throw new Error(M(3822))},t._onHierarchyChanged=function(){},t._onBatchCreated=function(t){e.prototype._onBatchCreated.call(this,t);for(var n=this._children.length,i=0;i<n;++i)this._children[i]._onBatchCreated(t);RS(this)},t.getPosition=function(e){return Wn.copy(e||new Wn,Wn.ZERO)},t.getRotation=function(e){return Jn.copy(e||new Jn,Jn.IDENTITY)},t.getScale=function(e){return Wn.copy(e||new Wn,Wn.ONE)},t.getWorldPosition=function(e){return Wn.copy(e||new Wn,Wn.ZERO)},t.getWorldRotation=function(e){return Jn.copy(e||new Jn,Jn.IDENTITY)},t.getWorldScale=function(e){return Wn.copy(e||new Wn,Wn.ONE)},t.getWorldMatrix=function(e){return ai.copy(e||new ai,ai.IDENTITY)},t.getWorldRS=function(e){return ai.copy(e||new ai,ai.IDENTITY)},t.getWorldRT=function(e){return ai.copy(e||new ai,ai.IDENTITY)},t.updateWorldTransform=function(){},t._instantiate=function(){},t._load=function(){this._inited||(this._onBatchCreated(i),this._inited=!0),this.walk(jC._setScene)},t._activate=function(e){e=!1!==e,c.director._nodeActivator.activateNode(this,e),this._globals.activate()},Z(n,[{key:"position",get:function(){return Wn.ZERO}},{key:"worldPosition",get:function(){return Wn.ZERO}},{key:"rotation",get:function(){return Jn.IDENTITY}},{key:"worldRotation",get:function(){return Jn.IDENTITY}},{key:"scale",get:function(){return Wn.ONE}},{key:"worldScale",get:function(){return Wn.ONE}},{key:"eulerAngles",get:function(){return Wn.ZERO}},{key:"worldMatrix",get:function(){return ai.IDENTITY}}]),n}(jC)).prototype,"globals",[Hh],Object.getOwnPropertyDescriptor(AI.prototype,"globals"),AI.prototype),CI=se(AI.prototype,"autoReleaseAssets",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wI=se(AI.prototype,"_globals",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new bI}}),SI=AI))||SI);function OI(e,t){if(!t){var n=c.director.getScene();if(!n)return null;t=n}return t.getChildByPath(e)}c.Scene=RI,c.find=OI,D_.Flags.HideInHierarchy;var NI=e("ci",bh("cc.PrivateNode")(II=function(e){function t(t){return e.call(this,t)||this}return $(t,e),t}(ew))||II);c.PrivateNode=NI;var PI=gt.fastRemoveAt,MI=D_.Flags.IsStartCalled,DI=D_.Flags.IsOnEnableCalled;function LI(e,t){for(var n=t.constructor._executionOrder,i=t._id,r=0,o=e.length-1,a=o>>>1;r<=o;a=r+o>>>1){var s=e[a],c=s.constructor._executionOrder;if(c>n)o=a-1;else if(c<n)r=a+1;else{var l=s._id;if(l>i)o=a-1;else{if(!(l<i))return a;r=a+1}}}return~r}function FI(e,t){for(var n=e.array,i=e.i+1;i<n.length;){var r=n[i];r._enabled&&r.node._activeInHierarchy?++i:(e.removeAt(i),t&&(r._objFlags&=~t))}}D_.Flags.IsEditorOnEnableCalled;var zI=function(e){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var t=Ce;this._zero=new t([]),this._neg=new t([]),this._pos=new t([]),this._invoke=e};function BI(e,t){return e.constructor._executionOrder-t.constructor._executionOrder}zI.stableRemoveInactive=FI;var UI=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.add=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).array.push(e)},n.remove=function(e){var t=e.constructor._executionOrder;(0===t?this._zero:t<0?this._neg:this._pos).fastRemove(e)},n.cancelInactive=function(e){FI(this._zero,e),FI(this._neg,e),FI(this._pos,e)},n.invoke=function(){var e=this._neg;e.array.length>0&&(e.array.sort(BI),this._invoke(e),e.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var t=this._pos;t.array.length>0&&(t.array.sort(BI),this._invoke(t),t.array.length=0)},t}(zI),GI=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.add=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.array.push(e);else{var n=t<0?this._neg.array:this._pos.array,i=LI(n,e);i<0&&n.splice(~i,0,e)}},n.remove=function(e){var t=e.constructor._executionOrder;if(0===t)this._zero.fastRemove(e);else{var n=t<0?this._neg:this._pos,i=LI(n.array,e);i>=0&&n.removeAt(i)}},n.invoke=function(e){this._neg.array.length>0&&this._invoke(this._neg,e),this._invoke(this._zero,e),this._pos.array.length>0&&this._invoke(this._pos,e)},t}(zI);function HI(e,t,n){var i="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+e+"}",r=t?Function("it","dt",i):Function("it",i);return function(e,t,n){return function(i,r){try{t(i,r)}catch(t){c._throw(t);var o=i.array;for(n&&(o[i.i]._objFlags|=n),++i.i;i.i<o.length;++i.i)try{e(o[i.i],r)}catch(e){c._throw(e),n&&(o[i.i]._objFlags|=n)}}}}(Function("c","dt",e),r,n)}var kI=HI("c.start();c._objFlags|="+MI,!1,MI),VI=HI("c.update(dt)",!0),jI=HI("c.lateUpdate(dt)",!0),WI=function(e){var t=c.director._compScheduler,n=e.array;for(e.i=0;e.i<n.length;++e.i){var i=n[e.i];i._enabled&&(i.onEnable(),!i.node._activeInHierarchy||t._onEnabled(i))}},qI=function(){function e(){this._deferredComps=[],this.unscheduleAll()}var t=e.prototype;return t.unscheduleAll=function(){this.startInvoker=new UI(kI),this.updateInvoker=new GI(VI),this.lateUpdateInvoker=new GI(jI),this._updating=!1},t._onEnabled=function(e){c.director.getScheduler().resumeTarget(e),e._objFlags|=DI,this._updating?this._deferredComps.push(e):this._scheduleImmediate(e)},t._onDisabled=function(e){c.director.getScheduler().pauseTarget(e),e._objFlags&=~DI;var t=this._deferredComps.indexOf(e);t>=0?PI(this._deferredComps,t):(!e.start||e._objFlags&MI||this.startInvoker.remove(e),e.update&&this.updateInvoker.remove(e),e.lateUpdate&&this.lateUpdateInvoker.remove(e))},t.enableComp=function(e,t){if(!(e._objFlags&DI)){if(e.onEnable){if(t)return void t.add(e);if(e.onEnable(),!e.node._activeInHierarchy)return}this._onEnabled(e)}},t.disableComp=function(e){e._objFlags&DI&&(e.onDisable&&e.onDisable(),this._onDisabled(e))},t.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},t.updatePhase=function(e){this.updateInvoker.invoke(e)},t.lateUpdatePhase=function(e){this.lateUpdateInvoker.invoke(e),this._updating=!1,this._startForNewComps()},t._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},t._scheduleImmediate=function(e){"function"!=typeof e.start||e._objFlags&MI||this.startInvoker.add(e),"function"==typeof e.update&&this.updateInvoker.add(e),"function"==typeof e.lateUpdate&&this.lateUpdateInvoker.add(e)},t._deferredSchedule=function(){for(var e=this._deferredComps,t=0,n=e.length;t<n;t++)this._scheduleImmediate(e[t]);e.length=0},e}(),YI=D_.Flags.IsPreloadStarted,XI=D_.Flags.IsOnLoadStarted,KI=D_.Flags.IsOnLoadCalled,QI=D_.Flags.Deactivating,ZI=function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.add=function(e){this._zero.array.push(e)},n.remove=function(e){this._zero.fastRemove(e)},n.cancelInactive=function(e){zI.stableRemoveInactive(this._zero,e)},n.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},t}(zI),JI=HI("c.__preload();"),$I=HI("c.onLoad();c._objFlags|="+KI,!1,KI),eR=new vt(4);function tR(e,t,n){t?e._removeComponent(t):gt.removeAt(e._components,n)}eR.get=function(){var e=this._get()||{preload:new ZI(JI),onLoad:new UI($I),onEnable:new UI(WI)};e.preload._zero.i=-1;var t=e.onLoad;return t._zero.i=-1,t._neg.i=-1,t._pos.i=-1,(t=e.onEnable)._zero.i=-1,t._neg.i=-1,t._pos.i=-1,e};var nR=e("fu",function(){function e(){this.resetComp=void 0,this.reset()}var t=e.prototype;return t.reset=function(){this._activatingStack=[]},t.activateNode=function(e,t){if(t){var n=eR.get();this._activatingStack.push(n),this._activateNodeRecursively(e,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),eR.put(n)}else{this._deactivateNodeRecursively(e);for(var i,r=oe(this._activatingStack);!(i=r()).done;){var o=i.value;o.preload.cancelInactive(YI),o.onLoad.cancelInactive(XI),o.onEnable.cancelInactive()}}e.emit("active-in-hierarchy-changed",e)},t.activateComp=function(e,t,n,i){if(F_(e,!0)&&(e._objFlags&YI||(e._objFlags|=YI,e.__preload&&(t?t.add(e):e.__preload())),e._objFlags&XI||(e._objFlags|=XI,e.onLoad?n?n.add(e):(e.onLoad(),e._objFlags|=KI):e._objFlags|=KI),e._enabled)){if(!e.node._activeInHierarchy)return;c.director._compScheduler.enableComp(e,i)}},t.destroyComp=function(e){c.director._compScheduler.disableComp(e),e.onDestroy&&e._objFlags&KI&&e.onDestroy()},t._activateNodeRecursively=function(e,t,n,i){if(e._objFlags&QI)R(3816,e.name);else{e._activeInHierarchy=!0;for(var r=e._components.length,o=0;o<r;++o){var a=e._components[o];a instanceof c.Component?this.activateComp(a,t,n,i):(tR(e,a,o),--o,--r)}e._childArrivalOrder=e._children.length;for(var s=0,l=e._children.length;s<l;++s){var u=e._children[s];u._active&&this._activateNodeRecursively(u,t,n,i)}e._onPostActivated(!0)}},t._deactivateNodeRecursively=function(e){e._objFlags|=QI,e._activeInHierarchy=!1;for(var t=e._components.length,n=0;n<t;++n){var i=e._components[n];if(i._enabled&&(c.director._compScheduler.disableComp(i),e._activeInHierarchy))return void(e._objFlags&=~QI)}for(var r=0,o=e._children.length;r<o;++r){var a=e._children[r];if(a._activeInHierarchy&&(this._deactivateNodeRecursively(a),e._activeInHierarchy))return void(e._objFlags&=~QI)}e._onPostActivated(!1),e._objFlags&=~QI},e}()),iR=e("bZ",function(e){function t(){var t;return(t=e.call(this)||this)._compScheduler=void 0,t._nodeActivator=void 0,t._invalid=void 0,t._paused=void 0,t._purgeDirectorInNextLoop=void 0,t._root=void 0,t._loadingScene=void 0,t._scene=void 0,t._totalFrames=void 0,t._lastUpdate=void 0,t._deltaTime=void 0,t._startTime=void 0,t._scheduler=void 0,t._systems=void 0,t._invalid=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._root=null,t._loadingScene="",t._scene=null,t._totalFrames=0,t._lastUpdate=0,t._deltaTime=0,t._startTime=0,t._scheduler=new WA,t._compScheduler=new qI,t._nodeActivator=new nR,t._systems=[],c.game.once(EA.EVENT_RENDERER_INITED,t._initOnRendererInitialized,ie(t)),t}$(t,e);var n=t.prototype;return n.calculateDeltaTime=function(e){e||(e=performance.now()),this._deltaTime=e>this._lastUpdate?(e-this._lastUpdate)/1e3:0,this._deltaTime>1&&(this._deltaTime=1/60),this._lastUpdate=e},n.convertToGL=function(e){var t=c.game.container,n=c.view,i=t.getBoundingClientRect(),r=i.left+window.pageXOffset-t.clientLeft,o=i.top+window.pageYOffset-t.clientTop,a=n._devicePixelRatio*(e.x-r),s=n._devicePixelRatio*(o+i.height-e.y);return n._isRotated?fi(n._viewportRect.width-s,a):fi(a,s)},n.convertToUI=function(e){var t=c.game.container,n=c.view,i=t.getBoundingClientRect(),r=i.left+window.pageXOffset-t.clientLeft,o=i.top+window.pageYOffset-t.clientTop,a=fi(0,0);return n._isRotated?(a.x=r+e.y/n._devicePixelRatio,a.y=o+i.height-(n._viewportRect.width-e.x)/n._devicePixelRatio):(a.x=r+e.x*n._devicePixelRatio,a.y=o+i.height-e.y*n._devicePixelRatio),a},n.end=function(){this._purgeDirectorInNextLoop=!0},n.getWinSize=function(){return gi(c.winSize)},n.getWinSizeInPixels=function(){return gi(c.winSize)},n.pause=function(){this._paused||(this._paused=!0)},n.purgeCachedData=function(){c.assetManager.releaseAll()},n.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),_A&&_A.setEnabled(!1),c.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),c.assetManager.releaseAll()},n.reset=function(){this.purgeDirector(),this.emit(t.EVENT_RESET),_A&&_A.setEnabled(!0),this.startAnimation()},n.runSceneImmediate=function(e,t,n){e instanceof hC&&(e=e.scene),P(e instanceof RI,1216),console.time("InitScene"),e._load(),console.timeEnd("InitScene"),console.time("AttachPersist");for(var i=Object.keys(c.game._persistRootNodes).map((function(e){return c.game._persistRootNodes[e]})),r=0;r<i.length;r++){var o=i[r];o.emit(c.Node.SCENE_CHANGED_FOR_PERSISTS,e.renderScene);var a=e.getChildByUuid(o.uuid);if(a){var s=a.getSiblingIndex();a._destroyImmediate(),e.insertChild(o,s)}else o.parent=e}console.timeEnd("AttachPersist");var l=this._scene;console.time("Destroy"),c.isValid(l)&&l.destroy(),console.time("AutoRelease"),c.assetManager._releaseManager._autoRelease(l,e,i),console.timeEnd("AutoRelease"),this._scene=null,D_._deferredDestroy(),console.timeEnd("Destroy"),t&&t(),this.emit(c.Director.EVENT_BEFORE_SCENE_LAUNCH,e),this._scene=e,console.time("Activate"),e._activate(),console.timeEnd("Activate"),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),n&&n(null,e),this.emit(c.Director.EVENT_AFTER_SCENE_LAUNCH,e)},n.runScene=function(e,t,n){var i=this;e instanceof hC&&(e=e.scene),P(e,1205),P(e instanceof RI,1216),e._load(),this.once(c.Director.EVENT_AFTER_DRAW,(function(){i.runSceneImmediate(e,t,n)}))},n.loadScene=function(e,t,n){var i=this;if(this._loadingScene)return b(1208,e,this._loadingScene),!1;var r=c.assetManager.bundles.find((function(t){return t.getSceneInfo(e)}));return r?(this.emit(c.Director.EVENT_BEFORE_SCENE_LOADING,e),this._loadingScene=e,console.time("LoadScene "+e),r.loadScene(e,(function(r,o){console.timeEnd("LoadScene "+e),i._loadingScene="",r?(y(r),t&&t(r)):i.runSceneImmediate(o,n,t)})),!0):(R(1209,e),!1)},n.preloadScene=function(e,t,n){var i=c.assetManager.bundles.find((function(t){return t.getSceneInfo(e)}));if(i)i.preloadScene(e,null,t,n);else{var r='Can not preload the scene "'+e+'" because it is not in the build settings.';n&&n(new Error(r)),y("preloadScene: "+r)}},n.resume=function(){this._paused&&(this._lastUpdate=performance.now(),this._lastUpdate||C(1200),this._paused=!1,this._deltaTime=0)},n.setDepthTest=function(e){c.Camera.main&&(c.Camera.main.depth=!!e)},n.setClearColor=function(e){c.Camera.main&&(c.Camera.main.backgroundColor=e)},n.getRunningScene=function(){return this._scene},n.getScene=function(){return this._scene},n.getAnimationInterval=function(){return 1e3/c.game.getFrameRate()},n.setAnimationInterval=function(e){c.game.setFrameRate(Math.round(1e3/e))},n.getDeltaTime=function(){return this._deltaTime},n.getTotalTime=function(){return performance.now()-this._startTime},n.getCurrentTime=function(){return this._lastUpdate},n.getTotalFrames=function(){return this._totalFrames},n.isPaused=function(){return this._paused},n.getScheduler=function(){return this._scheduler},n.setScheduler=function(e){this._scheduler!==e&&(this.unregisterSystem(this._scheduler),this._scheduler=e,this.registerSystem(WA.ID,e,200))},n.registerSystem=function(e,t,n){t.id=e,t.priority=n,t.init(),this._systems.push(t),this._systems.sort(UA.sortByPriority)},n.unregisterSystem=function(e){gt.fastRemove(this._systems,e),this._systems.sort(UA.sortByPriority)},n.getSystem=function(e){return this._systems.find((function(t){return t.id===e}))},n.getAnimationManager=function(){return this.getSystem(c.AnimationManager.ID)},n.startAnimation=function(){this._invalid=!1,this._lastUpdate=performance.now()},n.stopAnimation=function(){this._invalid=!0},n.mainLoop=function(e){if(this._purgeDirectorInNextLoop)this._purgeDirectorInNextLoop=!1,this.purgeDirector();else if(!this._invalid){this.calculateDeltaTime(e);var n=this._deltaTime;if(!this._paused){this.emit(t.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(n);for(var i=0;i<this._systems.length;++i)this._systems[i].update(n);this._compScheduler.lateUpdatePhase(n),this.emit(t.EVENT_AFTER_UPDATE),D_._deferredDestroy();for(var r=0;r<this._systems.length;++r)this._systems[r].postUpdate(n)}this.emit(t.EVENT_BEFORE_DRAW),this._root.frameMove(this._deltaTime),this.emit(t.EVENT_AFTER_DRAW),_A.frameUpdateListeners(),ew.bookOfChange.clear(),this._totalFrames++}},n._initOnRendererInitialized=function(){this._totalFrames=0,this._lastUpdate=performance.now(),this._startTime=this._lastUpdate,this._paused=!1,this._purgeDirectorInNextLoop=!1,_A&&_A.setEnabled(!0),this.registerSystem(WA.ID,this._scheduler,200),this.emit(t.EVENT_INIT)},n._init=function(){return this._root=new YA(c.game._gfxDevice),this._root.initialize({}).catch((function(e){return R(1217),Promise.reject(e)}))},Z(t,[{key:"root",get:function(){return this._root}}]),t}(Q_));iR.EVENT_INIT="director_init",iR.EVENT_RESET="director_reset",iR.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",iR.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",iR.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",iR.EVENT_BEFORE_UPDATE="director_before_update",iR.EVENT_AFTER_UPDATE="director_after_update",iR.EVENT_BEFORE_DRAW="director_before_draw",iR.EVENT_AFTER_DRAW="director_after_draw",iR.EVENT_BEFORE_COMMIT="director_before_commit",iR.EVENT_BEFORE_PHYSICS="director_before_physics",iR.EVENT_AFTER_PHYSICS="director_after_physics",iR.instance=void 0,c.Director=iR;var rR=e("bY",iR.instance=c.director=new iR),oR=function(){function e(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new r_,this.scenes=new r_,this.paths=new r_}var t=e.prototype;return t.init=function(e){!function(e){var t=e.uuids,n=e.paths,i=e.types,r=e.deps,o=e.paths=Object.create(null);if(!1===e.debug){for(var a=0,s=t.length;a<s;a++)t[a]=E_(t[a]);for(var c in n){var l=n[c],u=l[1];l[1]=i[u]}}else{for(var h=Object.create(null),_=0,f=t.length;_<f;_++){var d=t[_];t[_]=h[d]=E_(d)}t=h}for(var m in n){var p=n[m];o[t[m]]=p}var v=e.scenes;for(var g in v){var y=v[g];v[g]=t[y]}var x=e.packs;for(var E in x)for(var T=x[E],S=0;S<T.length;++S)T[S]=t[T[S]];var A=e.versions;if(A)for(var C in A)for(var w=A[C],b=0;b<w.length;b+=2){var I=w[b];w[b]=t[I]||I}var R=e.redirect;if(R)for(var O=0;O<R.length;O+=2)R[O]=t[R[O]],R[O+1]=r[R[O+1]]}(e),this.importBase=e.importBase||"",this.nativeBase=e.nativeBase||"",this.base=e.base||"",this.name=e.name||"",this.deps=e.deps||[],this._initUuid(e.uuids),this._initPath(e.paths),this._initScene(e.scenes),this._initPackage(e.packs),this._initVersion(e.versions),this._initRedirect(e.redirect)},t.getInfoWithPath=function(e,t){if(!e)return null;e=w_(e);var n=this.paths.get(e);if(n){if(!t)return n[0];for(var i=0,r=n.length;i<r;i++){var o=n[i];if(yt.isChildClassOf(o.ctor,t))return o}}return null},t.getDirWithPath=function(e,t,n){"/"===(e=w_(e))[e.length-1]&&(e=e.slice(0,-1));var i=n||[];return this.paths.forEach((function(n,r){if(r.startsWith(e)&&function(e,t){return!(e.length>t.length)||47===e.charCodeAt(t.length)}(r,e)||!e)for(var o=0,a=n.length;o<a;o++){var s=n[o];t&&!yt.isChildClassOf(s.ctor,t)||i.push(s)}})),i},t.getAssetInfo=function(e){return this.assetInfos.get(e)||null},t.getSceneInfo=function(e){return e.endsWith(".scene")||(e+=".scene"),"/"===e[0]||e.startsWith("db://")||(e="/"+e),this.scenes.find((function(t,n){return n.endsWith(e)}))},t.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},t._initUuid=function(e){if(e){this.assetInfos.clear();for(var t=0,n=e.length;t<n;t++){var i=e[t];this.assetInfos.add(i,{uuid:i})}}},t._initPath=function(e){if(e){var t=this.paths;for(var n in t.clear(),e){var i=e[n],r=i[0],o=i[1],a=3===i.length,s=this.assetInfos.get(n);s.path=r,s.ctor=yt._getClassById(o),t.has(r)?a?t.get(r).push(s):t.get(r).splice(0,0,s):t.add(r,[s])}}},t._initScene=function(e){if(e){var t=this.scenes;t.clear();var n=this.assetInfos;for(var i in e){var r=e[i],o=n.get(r);o.url=i,t.add(i,o)}}},t._initPackage=function(e){if(e){var t=this.assetInfos;for(var n in e){var i=e[n],r={uuid:n,packedUuids:i,ext:".json"};t.add(n,r);for(var o=0,a=i.length;o<a;o++){var s=i[o],c=t.get(s),l=c.packs;l?1===a?l.splice(0,0,r):l.push(r):c.packs=[r]}}}},t._initVersion=function(e){if(e){var t=this.assetInfos,n=e.import;if(n)for(var i=0,r=n.length;i<r;i+=2){var o=n[i];t.get(o).ver=n[i+1]}if(n=e.native)for(var a=0,s=n.length;a<s;a+=2){var c=n[a];t.get(c).nativeVer=n[a+1]}}},t._initRedirect=function(e){if(e)for(var t=this.assetInfos,n=0,i=e.length;n<i;n+=2){var r=e[n];t.get(r).redirect=e[n+1]}},e}();function aR(e,t){e._uuid&&t.push(e._uuid)}function sR(e,t){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var r=n[i];if("node"!==r&&"__eventTargets"!==r){var o=e[r];if("object"==typeof o&&o)if(Array.isArray(o))for(var a=0;a<o.length;a++){var s=o[a];s instanceof Z_&&aR(s,t)}else if(o.constructor&&o.constructor!==Object)o instanceof Z_&&aR(o,t);else for(var c=Object.getOwnPropertyNames(o),l=0;l<c.length;l++){var u=o[c[l]];u instanceof Z_&&aR(u,t)}}}}function cR(e,t){for(var n=0;n<e._components.length;n++)sR(e._components[n],t);for(var i=0;i<e._children.length;i++)cR(e._children[i],t)}function lR(e,t,n,i){n.push(e._uuid);for(var r=Sd.getDeps(e._uuid),o=0,a=r.length;o<a;o++){var s=s_.get(r[o]);if(s){var c=s._uuid;c in t?t[c]+=i:t[c]=s.refCount+i,n.includes(c)||lR(s,t,n,i)}}}var uR=[],hR=new(function(){function e(){this._persistNodeDeps=new r_,this._toDelete=new r_,this._eventListener=!1}var t=e.prototype;return t.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},t._addPersistNodeRef=function(e){var t=[];cR(e,t);for(var n=0,i=t.length;n<i;n++){var r=s_.get(t[n]);r&&r.addRef()}this._persistNodeDeps.add(e.uuid,t)},t._removePersistNodeRef=function(e){if(this._persistNodeDeps.has(e.uuid)){for(var t=this._persistNodeDeps.get(e.uuid),n=0,i=t.length;n<i;n++){var r=s_.get(t[n]);r&&r.decRef()}this._persistNodeDeps.remove(e.uuid)}},t._autoRelease=function(e,t,n){if(e){for(var i=Sd.getDeps(e.uuid),r=0,o=i.length;r<o;r++){var a=s_.get(i[r]);a&&a.decRef(e.autoReleaseAssets)}var s=Sd._depends.get(e.uuid);if(s&&s.persistDeps)for(var c=s.persistDeps,l=0,u=c.length;l<u;l++){var h=s_.get(c[l]);h&&h.decRef(e.autoReleaseAssets)}e.uuid!==t.uuid&&Sd.remove(e.uuid)}var _=Sd._depends.get(t.uuid);_&&(_.persistDeps=[]);for(var f=0,d=n.length;f<d;f++){for(var m,p,v=n[f],g=this._persistNodeDeps.get(v.uuid),y=oe(g);!(p=y()).done;){var x=p.value,E=s_.get(x);E&&E.addRef()}_&&(m=_.persistDeps).push.apply(m,g)}},t.tryRelease=function(e,t){void 0===t&&(t=!1),e instanceof Z_&&(t?this._free(e,t):(this._toDelete.add(e._uuid,e),this._eventListener||(this._eventListener=!0,Bt(this._freeAssets.bind(this)))))},t._freeAssets=function(){var e=this;this._eventListener=!1,this._toDelete.forEach((function(t){e._free(t)})),this._toDelete.clear()},t._free=function(e,t){void 0===t&&(t=!1);var n=e._uuid;if(this._toDelete.remove(n),F_(e,!0)&&!(!t&&e.refCount>0&&function(e){var t=Object.create(null);if(t[e._uuid]=e.refCount,lR(e,t,uR,-1),uR.length=0,0!==t[e._uuid])return t[e._uuid];for(var n in t)0!==t[n]&&lR(s_.get(n),t,uR,1);return uR.length=0,t[e._uuid]}(e)>0)){s_.remove(n);for(var i=Sd.getDeps(n),r=0,o=i.length;r<o;r++){var a=s_.get(i[r]);a&&(a.decRef(!1),this._free(a,!1))}e.destroy(),Sd.remove(n)}},e}()),_R=null;function fR(e,t){for(var n=0,i=e.input.length;n<i;n++){var r=e.input[n];t&&!r.isNative&&r.content instanceof Z_&&r.content.decRef(!1),r.recycle()}e.input=null}function dR(e,t){return t?/\?/.test(e)?e+"&_t="+Date.now():e+"?_t="+Date.now():e}function mR(e,t,n,i,r){void 0===r&&(r=0),e(r,(function(o,a){r++,!o||r>t?i&&i(o,a):setTimeout((function(){mR(e,t,n,i,r)}),n)}))}function pR(e,t,n,r,o,a,s){try{var c=Sd.parse(e,t),l=!0;if(t instanceof Z_&&!t.__nativeDepend__&&(l=!1),o){for(var u=0,h=c.deps.length;u<h;u++){var _=c.deps[u];_ in n||(n[_]=!0,r.push({uuid:_,bundle:s&&s.name}))}l&&c.nativeDep&&(s&&(c.nativeDep.bundle=s.name),r.push(J({},c.nativeDep)))}else{a=!i&&(!!t.asyncLoadAssets||a&&!c.preventDeferredLoadDependents);for(var f=0,d=c.deps.length;f<d;f++){var m=c.deps[f];m in n||(n[m]=!0,r.push({uuid:m,__asyncLoadAssets__:a,bundle:s&&s.name}))}l&&!a&&!c.preventPreloadNativeObject&&c.nativeDep&&(s&&(c.nativeDep.bundle=s.name),r.push(J({},c.nativeDep)))}}catch(e){y(e.message,e.stack)}}function vR(e,t,n){t&&(n=void 0!==n?n:c.assetManager.cacheAsset,!C_(t)&&n&&s_.add(e,t))}function gR(e,t,n){var i=!1,r=t.__depends__;if(r){for(var o=0,a=r.length;o<a;o++){var s=r[o],c=n[s.uuid+"@import"];c?s.owner[s.prop]=c.addRef():(y("The asset "+s.uuid+" is missing!"),i=!0)}t.__depends__=null}return t.__nativeDepend__&&(n[e+"@native"]?t._nativeAsset=n[e+"@native"]:i=!0,t.__nativeDepend__=!1),i}function yR(e,t,n){var i=0,r=[],o=e.length;0===o&&n&&n(r);for(var a=function(e){e&&r.push(e),++i===o&&n&&n(r)},s=0;s<o;s++)t(e[s],a)}function xR(e,t,n){var i=e,r=t,o=n;if(void 0===n){var a="function"==typeof e;t?(o=t,a||(r=null)):void 0===t&&a&&(o=e,i=null,r=null),void 0!==t&&a&&(r=e,i=null)}return{options:i||Object.create(null),onProgress:r,onComplete:o}}function ER(e,t,n){var i=e,r=t,o=n;if(void 0===n){var a=yt.isChildClassOf(e,Z_);t?(o=t,a&&(r=null)):void 0!==t||a||(o=e,r=null,i=null),void 0===t||a||(r=e,i=null)}return{type:i,onProgress:r||_R,onComplete:o}}function TR(e,t,n,i){if(void 0===i&&(i={}),!n[t]||i[t])return!1;i[t]=!0;var r=!1,o=Sd.getDeps(t);if(o)for(var a=0,s=o.length;a<s;a++){var c=o[a];if(c===e||TR(e,c,n,i)){r=!0;break}}return r}function SR(e){return function(t,n){if(e){var i=[];Array.isArray(n)?n.forEach((function(e){return e instanceof Z_&&i.push(e.addRef())})):n instanceof Z_&&i.push(n.addRef()),Bt((function(){i.forEach((function(e){return e.decRef(!1)})),e(t,n)}))}}}var AR=function(){function e(){this._config=new oR}var t=e.prototype;return t.getInfoWithPath=function(e,t){return this._config.getInfoWithPath(e,t)},t.getDirWithPath=function(e,t,n){return this._config.getDirWithPath(e,t,n)},t.getAssetInfo=function(e){return this._config.getAssetInfo(e)},t.getSceneInfo=function(e){return this._config.getSceneInfo(e)},t.init=function(e){this._config.init(e),u_.add(e.name,this)},t.load=function(e,t,n,i){var r=ER(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete,l={__requestType__:a_.PATH,type:o,bundle:this.name,__outputAsArray__:Array.isArray(e)};c.assetManager.loadAny(e,l,a,s)},t.preload=function(e,t,n,i){var r=ER(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;c.assetManager.preloadAny(e,{__requestType__:a_.PATH,type:o,bundle:this.name},a,s)},t.loadDir=function(e,t,n,i){var r=ER(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;c.assetManager.loadAny(e,{__requestType__:a_.DIR,type:o,bundle:this.name,__outputAsArray__:!0},a,s)},t.preloadDir=function(e,t,n,i){var r=ER(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;c.assetManager.preloadAny(e,{__requestType__:a_.DIR,type:o,bundle:this.name},a,s)},t.loadScene=function(e,t,n,i){var r=xR(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.preset=o.preset||"scene",o.bundle=this.name,c.assetManager.loadAny({scene:e},o,a,(function(e,t){if(e)y(e.message,e.stack);else if(t instanceof hC&&t.scene){var n=t.scene;n._id=t._uuid,n.name=t.name}else e=new Error("The asset "+t._uuid+" is not a scene");s&&s(e,t)}))},t.preloadScene=function(e,t,n,i){var r=xR(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.bundle=this.name,c.assetManager.preloadAny({scene:e},o,a,(function(t){t&&R(1210,e,t.message),s&&s(t)}))},t.get=function(e,t){var n=this.getInfoWithPath(e,t);return n&&s_.get(n.uuid)||null},t.release=function(e,t){var n=this.get(e,t);n&&hR.tryRelease(n,!0)},t.releaseUnusedAssets=function(){var e=this;s_.forEach((function(t){var n=e.getAssetInfo(t._uuid);n&&!n.redirect&&hR.tryRelease(t)}))},t.releaseAll=function(){var e=this;s_.forEach((function(t){var n=e.getAssetInfo(t._uuid);n&&!n.redirect&&hR.tryRelease(t,!0)}))},t._destroy=function(){this._config.destroy()},Z(e,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),e}(),CR=e("fo",new AR);function wR(e,t,n){var i=new Image;function r(){i.removeEventListener("load",r),i.removeEventListener("error",o),n&&n(null,i)}function o(){i.removeEventListener("load",r),i.removeEventListener("error",o),n&&n(new Error(M(4930,e)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.addEventListener("load",r),i.addEventListener("error",o),i.src=e,i}function bR(e,t,n,i){var r=new XMLHttpRequest,o="download failed: "+e+", status: ";if(r.open("GET",e,!0),void 0!==t.xhrResponseType&&(r.responseType=t.xhrResponseType),void 0!==t.xhrWithCredentials&&(r.withCredentials=t.xhrWithCredentials),void 0!==t.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(t.xhrMimeType),void 0!==t.xhrTimeout&&(r.timeout=t.xhrTimeout),t.xhrHeader)for(var a in t.xhrHeader)r.setRequestHeader(a,t.xhrHeader[a]);return r.onload=function(){200===r.status||0===r.status?i&&i(null,r.response):i&&i(new Error(""+o+r.status+"(no response)"))},n&&(r.onprogress=function(e){e.lengthComputable&&n(e.loaded,e.total)}),r.onerror=function(){i&&i(new Error(""+o+r.status+"(error)"))},r.ontimeout=function(){i&&i(new Error(""+o+r.status+"(time out)"))},r.onabort=function(){i&&i(new Error(""+o+r.status+"(abort)"))},r.send(null),r}c.resources=CR;var IR={};function RR(e,t,n){if(IR[e])return n&&n(null),null;var i=document.createElement("script");function r(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",o,!1),IR[e]=!0,n&&n(null)}function o(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",o,!1),n&&n(new Error(M(4928,e)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.async=t.scriptAsyncLoading||!1,i.src=e,i.addEventListener("load",r,!1),i.addEventListener("error",o,!1),document.body.appendChild(i),i}var OR=/^(?:\w+:\/\/|\.+\/).+/,NR=function(e,t,n){(Vv.capabilities.imageBitmap&&c.assetManager.allowImageBitmap?PR:wR)(e,t,n)},PR=function(e,t,n){t.xhrResponseType="blob",bR(e,t,t.onFileProgress,n)},MR=function(e,t,n){t.xhrResponseType="json",bR(e,t,t.onFileProgress,n)},DR=function(e,t,n){t.xhrResponseType="arraybuffer",bR(e,t,t.onFileProgress,n)},LR=function(e,t,n){t.xhrResponseType="text",bR(e,t,t.onFileProgress,n)},FR=function(e,t,n){var i=V(e),r=e;OR.test(r)||(r=-1!==BR.remoteBundles.indexOf(i)?BR.remoteServerAddress+"remote/"+i:"assets/"+i);var o=t.version||BR.bundleVers[i],a=0,s=null,c=null;MR(r+"/config."+(o?o+".":"")+"json",t,(function(e,t){e&&(c=e),(s=t)&&(s.base=r+"/"),2==++a&&n(c,s)})),RR(r+"/index."+(o?o+".":"")+"js",t,(function(e){e?(c=e,2==++a&&n(e)):BR.importBundleEntry(i).then((function(){2==++a&&n(c,s)})).catch((function(e){c=e,2==++a&&n(c)}))}))},zR=function(){function e(){this.maxConcurrency=16,this.maxRequestsPerFrame=16,this.maxRetryCount=3,this.appendTimeStamp=!!i,this.limited=!i,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=wR,this.downloadDomAudio=null,this.downloadFile=bR,this.downloadScript=RR,this._downloaders={".png":NR,".jpg":NR,".bmp":NR,".jpeg":NR,".gif":NR,".ico":NR,".tiff":NR,".webp":NR,".image":NR,".pvr":DR,".pkm":DR,".astc":DR,".txt":LR,".xml":LR,".vsh":LR,".fsh":LR,".atlas":LR,".tmx":LR,".tsx":LR,".json":MR,".ExportJson":MR,".plist":LR,".fnt":LR,".binary":DR,".bin":DR,".dbbin":DR,".skel":DR,".js":RR,bundle:FR,default:LR},this._downloading=new r_,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var n=e.prototype;return n.init=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t={}),void 0===n&&(n=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=e,this.bundleVers=t,this.remoteBundles=n},n.register=function(e,t){"object"==typeof e?et(this._downloaders,e):this._downloaders[e]=t},n.importBundleEntry=function(e){return t.import("virtual:///prerequisite-imports/"+e)},n.download=function(e,t,n,i,r){var o=this,a=c_.get(e);if(a)r(null,a);else{var s=this._downloading.get(e);if(s){s.push(r);var c=this._queue.find((function(t){return t.id===e}));if(!c)return;var l=i.priority||0;c.priority<l&&(c.priority=l,this._queueDirty=!0)}else{var u=void 0!==i.maxRetryCount?i.maxRetryCount:this.maxRetryCount,h=void 0!==i.maxConcurrency?i.maxConcurrency:this.maxConcurrency,_=void 0!==i.maxRequestsPerFrame?i.maxRequestsPerFrame:this.maxRequestsPerFrame,f=this._downloaders[n]||this._downloaders.default;mR((function(n,a){if(0===n&&o._downloading.add(e,[r]),o.limited){o._updateTime();var s=function(e,t){o._totalNum--,o._handleQueueInNextFrame(h,_),a(e,t)};o._totalNum<h&&o._totalNumThisPeriod<_?(f(dR(t,o.appendTimeStamp),i,s),o._totalNum++,o._totalNumThisPeriod++):(o._queue.push({id:e,priority:i.priority||0,url:t,options:i,done:s,handler:f}),o._queueDirty=!0,o._totalNum<h&&o._handleQueueInNextFrame(h,_))}else f(dR(t,o.appendTimeStamp),i,a)}),u,this.retryInterval,(function(t,n){t||c_.add(e,n);for(var i=o._downloading.remove(e),r=0,a=i.length;r<a;r++)i[r](t,n)}))}}},n.loadSubpackage=function(e,t){c.assetManager.loadBundle(e,null,t)},n._updateTime=function(){var e=Date.now(),t=c.director.getDeltaTime(),n=t>this._maxInterval?this._maxInterval:t;e-this._lastDate>1e3*n&&(this._totalNumThisPeriod=0,this._lastDate=e)},n._handleQueue=function(e,t){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<e&&this._totalNumThisPeriod<t;){this._queueDirty&&(this._queue.sort((function(e,t){return e.priority-t.priority})),this._queueDirty=!1);var n=this._queue.pop();if(!n)break;this._totalNum++,this._totalNumThisPeriod++,n.handler(dR(n.url,this.appendTimeStamp),n.options,n.done)}this._handleQueueInNextFrame(e,t)},n._handleQueueInNextFrame=function(e,t){!this._checkNextPeriod&&this._queue.length>0&&(Bt(this._handleQueue.bind(this),e,t),this._checkNextPeriod=!0)},Z(e,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),e}(),BR=e("cB",new zR);function UR(e,t,n,i){var r=null,o=null;try{(r=new lf)._nativeUrl=e,r._nativeAsset=t}catch(e){o=e}i(o,r)}function GR(e,t,n,i){var r=new vC;r.json=t,i(null,r)}function HR(e,t,n,i){var r=new pC;r.text=t,i(null,r)}function kR(e,t,n,i){var r=new JA;r._nativeUrl=e,r._nativeAsset=t,i(null,r)}function VR(e,t,n,i){var r=new Z_;r._nativeUrl=e,r._nativeAsset=t,i(null,r)}function jR(e,t,n,i){var r=u_.get(t.name);r||(r=t.name===d_.RESOURCES?CR:new AR,t.base=t.base||e+"/",r.init(t)),i(null,r)}var WR=function(){function e(){this._creating=new r_,this._producers={".png":UR,".jpg":UR,".bmp":UR,".jpeg":UR,".gif":UR,".ico":UR,".tiff":UR,".webp":UR,".image":UR,".pvr":UR,".pkm":UR,".txt":HR,".xml":HR,".vsh":HR,".fsh":HR,".atlas":HR,".tmx":HR,".tsx":HR,".fnt":HR,".json":GR,".ExportJson":GR,".binary":kR,".bin":kR,".dbbin":kR,".skel":kR,bundle:jR,default:VR}}var t=e.prototype;return t.register=function(e,t){"object"==typeof e?yt.mixin(this._producers,e):this._producers[e]=t},t.create=function(e,t,n,i,r){var o=this,a=this._producers[n]||this._producers.default,s=s_.get(e);if(i.reloadAsset||!s){var c=this._creating.get(e);c?c.push(r):(this._creating.add(e,[r]),a(e,t,i,(function(t,n){!t&&n instanceof Z_&&(n._uuid=e,vR(e,n,i.cacheAsset));for(var r=o._creating.remove(e),a=0,s=r.length;a<s;a++)r[a](t,n)})))}else r(null,s)},e}(),qR=e("cC",new WR),YR=new(function(){function e(){this._loading=new r_,this._unpackers={".json":this.unpackJson}}var t=e.prototype;return t.unpackJson=function(e,t,n,i){var r=yt.createMap(!0),o=null;if(Array.isArray(t)){(t=function(e,t){if(e[0]<1)throw new Error(M(5304,e[0]));jf(e,!0,void 0),Wf(e);for(var n=new Qf(e[0]),i=e[1],r=e[2],o=e[3],a=e[4],s=e[5],c=0;c<s.length;++c)s[c].unshift(n,i,r,o,a);return s}(t)).length!==e.length&&R(4915);for(var a=0;a<e.length;a++)r[e[a]+"@import"]=t[a]}else{var s=yt._getClassId(Ud);if(t.type===s&&t.data){var c=t.data;c.length!==e.length&&R(4915);for(var l=0;l<e.length;l++)r[e[l]+"@import"]=Zf(s,{base:c[l][0],mipmaps:c[l][1]})}else o=new Error("unmatched type pack!"),r=null}i(o,r)},t.init=function(){this._loading.clear()},t.register=function(e,t){"object"==typeof e?yt.mixin(this._unpackers,e):this._unpackers[e]=t},t.unpack=function(e,t,n,i,r){t?(0,this._unpackers[n])(e,t,i,r):r(new Error("package data is wrong!"))},t.load=function(e,t,n){var i=this;if(!e.isNative&&e.info&&e.info.packs)if(c_.has(e.id))n(null,c_.get(e.id));else{var r=e.info.packs,o=r.find((function(e){return i._loading.has(e.uuid)}));if(o)this._loading.get(o.uuid).push({onComplete:n,id:e.id});else{o=r[0],this._loading.add(o.uuid,[{onComplete:n,id:e.id}]);var a=b_(o.uuid,{ext:o.ext,bundle:e.config.name});BR.download(o.uuid,a,o.ext,e.options,(function(t,n){c_.remove(o.uuid),t&&y(t.message,t.stack),i.unpack(o.packedUuids,n,o.ext,e.options,(function(e,n){if(!e)for(var r in n)c_.add(r,n[r]);for(var a=i._loading.remove(o.uuid),s=0,c=a.length;s<c;s++){var l=a[s];if(t||e)l.onComplete(t||e);else{var u=n[l.id];u?l.onComplete(null,u):l.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else BR.download(e.id,e.url,e.ext,e.options,n)},e}());function XR(e,t){var n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);var i=e.options,r=e.progress,o=[],a=r.total;i.__exclude__=i.__exclude__||Object.create(null),e.output=[],yR(e.input,(function(i,s){if(!i.isNative&&s_.has(i.uuid)){var l=s_.get(i.uuid);return l.addRef(),QR(i,e,l,null,l.__asyncLoadAssets__,o,a),void s()}YR.load(i,e.options,(function(l,u){l?e.isFinish||(!c.assetManager.force||n?(y(l.message,l.stack),r.canInvoke=!1,t(l)):QR(i,e,null,null,!1,o,a)):e.isFinish||QR(i,e,null,u,!i.isNative,o,a),s()}))}),(function(){if(e.isFinish)return fR(e,!0),void e.dispatch("error");if(o.length>0){var a=p_.create({input:o,progress:r,options:i,onProgress:e.onProgress,onError:p_.prototype.recycle,onComplete:function(i){var r;i||((r=e.output).push.apply(r,a.output),a.recycle()),n&&KR(e),t(i)}});__.async(a)}else n&&KR(e),t()}))}function KR(e){for(var t=e.output,n=0,i=t.length;n<i;n++)t[n].content&&t[n].content.decRef(!1)}function QR(e,t,n,i,r,o,a){var s=t.options.__exclude__,c=t.progress;e.content=n,e.file=i,t.output.push(e),r&&(s[e.uuid]=!0,pR(e.uuid,i||n,s,o,!0,!1,e.config),c.total=a+o.length),c.canInvoke&&t.dispatch("progress",++c.finish,c.total,e)}var ZR=new(function(e){function t(){return e.apply(this,arguments)||this}$(t,e);var n=t.prototype;return n.parse=function(e){var t=this._parseXML(e).documentElement;if("plist"!==t.tagName)return b(5100),{};for(var n=null,i=0,r=t.childNodes.length;i<r&&1!==(n=t.childNodes[i]).nodeType;i++);return this._parseNode(n)},n._parseNode=function(e){var t=null,n=e.tagName;if("dict"===n)t=this._parseDict(e);else if("array"===n)t=this._parseArray(e);else if("string"===n)if(1===e.childNodes.length)t=e.firstChild.nodeValue;else{t="";for(var i=0;i<e.childNodes.length;i++)t+=e.childNodes[i].nodeValue}else"false"===n?t=!1:"true"===n?t=!0:"real"===n?t=parseFloat(e.firstChild.nodeValue):"integer"===n&&(t=parseInt(e.firstChild.nodeValue,10));return t},n._parseArray=function(e){for(var t=[],n=0,i=e.childNodes.length;n<i;n++){var r=e.childNodes[n];1===r.nodeType&&t.push(this._parseNode(r))}return t},n._parseDict=function(e){for(var t={},n="",i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];1===o.nodeType&&("key"===o.tagName?n=o.firstChild.nodeValue:t[n]=this._parseNode(o))}return t},t}(e("dx",function(){function e(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var t=e.prototype;return t.parse=function(e){return this._parseXML(e)},t._parseXML=function(e){if(this._parser)return this._parser.parseFromString(e,"text/xml");throw new Error("Dom parser is not supported in this platform!")},e}())));function JR(e,t){return e[t]<<8|e[t+1]}var $R=new(function(){function e(){this._parsing=new r_,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".mp3":this.parseAudio,".ogg":this.parseAudio,".wav":this.parseAudio,".m4a":this.parseAudio,".plist":this.parsePlist,import:this.parseImport}}var t=e.prototype;return t.parseImage=function(e,t,n){e instanceof HTMLImageElement?n(null,e):createImageBitmap(e,{premultiplyAlpha:"none"}).then((function(e){n(null,e)}),(function(e){n(e,null)}))},t.parseAudio=function(e,t,n){e instanceof ArrayBuffer?Vv.__audioSupport.context.decodeAudioData(e,(function(e){n(null,e)}),(function(e){n(new Error("Error with decoding audio data"+e.err),null)})):n(null,e)},t.parsePVRTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Int32Array(o,0,13);if(55727696===a[0]){var s=a[7],c=a[6],l=a[12]+52;r={_data:new Uint8Array(o,l),_compressed:!0,width:s,height:c,format:0}}else{if(559044176!==a[11])throw new Error("Invalid magic number in PVR header");var u=a[0],h=a[1],_=a[2];r={_data:new Uint8Array(o,u),_compressed:!0,width:_,height:h,format:0}}}catch(e){i=e}n(i,r)},t.parsePKMTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(o),s=JR(a,6);if(0!==s&&1!==s&&3!==s)throw new Error("Invalid magic number in ETC header");var c=JR(a,12),l=JR(a,14);JR(a,8),JR(a,10),r={_data:new Uint8Array(o,16),_compressed:!0,width:c,height:l,format:0}}catch(e){i=e}n(i,r)},t.parseASTCTex=function(e,t,n){var i=null,r=null;try{var o=e instanceof ArrayBuffer?e:e.buffer,a=new Uint8Array(o);if(1554098963!==a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24))throw new Error("Invalid magic number in ASTC header");var s=a[4],c=a[5],l=a[6];if((s<3||s>6||c<3||c>6||l<3||l>6)&&(s<4||7===s||9===s||11===s||s>12||c<4||7===c||9===c||11===c||c>12||1!==l))throw new Error("Invalid block number in ASTC header");var u=function(e,t){return 4===e?J_.RGBA_ASTC_4x4:5===e?4===t?J_.RGBA_ASTC_5x4:J_.RGBA_ASTC_5x5:6===e?5===t?J_.RGBA_ASTC_6x5:J_.RGBA_ASTC_6x6:8===e?5===t?J_.RGBA_ASTC_8x5:6===t?J_.RGBA_ASTC_8x6:J_.RGBA_ASTC_8x8:10===e?5===t?J_.RGBA_ASTC_10x5:6===t?J_.RGBA_ASTC_10x6:8===t?J_.RGBA_ASTC_10x8:J_.RGBA_ASTC_10x10:10===t?J_.RGBA_ASTC_12x10:J_.RGBA_ASTC_12x12}(s,c),h=a[7]+(a[8]<<8)+(a[9]<<16),_=a[10]+(a[11]<<8)+(a[12]<<16);a[13],a[14],a[15],r={_data:new Uint8Array(o,16),_compressed:!0,width:h,height:_,format:u}}catch(e){i=e}n(i,r)},t.parsePlist=function(e,t,n){var i=null,r=ZR.parse(e);r||(i=new Error("parse failed")),n(i,r)},t.parseImport=function(e,t,n){if(e){var i=null,r=null;try{i=Ed(e,t)}catch(e){r=e}n(r,i)}else n(new Error("The json file of asset "+t.__uuid__+" is empty or missing"))},t.init=function(){this._parsing.clear()},t.register=function(e,t){"object"==typeof e?et(this._parsers,e):this._parsers[e]=t},t.parse=function(e,t,n,i,r){var o=this,a=l_.get(e);if(a)r(null,a);else{var s=this._parsing.get(e);if(s)s.push(r);else{var c=this._parsers[n];c?(this._parsing.add(e,[r]),c(t,i,(function(t,n){t?c_.remove(e):C_(n)||l_.add(e,n);for(var i=o._parsing.remove(e),r=0,a=i.length;r<a;r++)i[r](t,n)}))):r(null,t)}}},e}());function eO(e,t){var n=!1;e.progress||(e.progress={finish:0,total:e.input.length,canInvoke:!0},n=!0);var i=e.options,r=e.progress;i.__exclude__=i.__exclude__||Object.create(null),e.output=[],yR(e.input,(function(o,a){var s=p_.create({input:o,onProgress:e.onProgress,options:i,progress:r,onComplete:function(i,l){i&&!e.isFinish&&(!c.assetManager.force||n?(y(i.message,i.stack),r.canInvoke=!1,t(i)):r.canInvoke&&e.dispatch("progress",++r.finish,r.total,o)),e.output.push(l),s.recycle(),a(null)}});tO.async(s)}),(function(){if(i.__exclude__=null,e.isFinish)return fR(e,!0),void e.dispatch("error");!function(e){var t=e.source;if(e.options.__outputAsArray__||1!==t.length)for(var n=e.output=[],i=0,r=t.length;i<r;i++)n.push(t[i].content);else e.output=t[0].content}(e),fR(e,!0),t()}))}var tO=new o_("loadOneAsset",[function(e,t){var n=e.output=e.input,i=n.options,r=n.isNative,o=n.uuid,a=n.file,s=i.reloadAsset;a||!s&&!r&&s_.has(o)?t():YR.load(n,e.options,(function(e,i){n.file=i,t(e)}))},function(e,t){var n=e.output=e.input,i=e.progress,r=e.options.__exclude__,o=n.id,a=n.file,s=n.options;if(n.isNative)$R.parse(o,a,n.ext,s,(function(r,a){r?t(r):(n.content=a,i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),c_.remove(o),l_.remove(o),t())}));else{var c=n.uuid;if(c in r){var l=r[c],u=l.finish,h=l.content,_=l.err,f=l.callbacks;i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),u||TR(c,c,r)?(h&&h.addRef(),n.content=h,t(_)):f.push({done:t,item:n})}else if(!s.reloadAsset&&s_.has(c)){var d=s_.get(c);s.__asyncLoadAssets__||!d.__asyncLoadAssets__?(n.content=d.addRef(),i.canInvoke&&e.dispatch("progress",++i.finish,i.total,n),t()):nO(e,d,t,!1)}else s.__uuid__=c,$R.parse(o,a,"import",s,(function(n,i){n?t(n):nO(e,i,t,!0)}))}}]);function nO(e,t,n,i){var r=e.input,o=e.progress,a=r,s=a.uuid,c=a.id,l=a.options,u=a.config,h=l.__asyncLoadAssets__,_=l.cacheAsset,f=[];t.addRef&&t.addRef(),pR(s,t,Object.create(null),f,!1,h,u),o.canInvoke&&e.dispatch("progress",++o.finish,o.total+=f.length,r);var d=e.options.__exclude__[s]={content:t,finish:!1,callbacks:[{done:n,item:r}]},m=p_.create({input:f,options:e.options,onProgress:e.onProgress,onError:p_.prototype.recycle,progress:o,onComplete:function(e){if(t.decRef&&t.decRef(!1),t.__asyncLoadAssets__=h,d.finish=!0,d.err=e,!e){for(var n,r=Array.isArray(m.output)?m.output:[m.output],o=Object.create(null),a=oe(r);!(n=a()).done;){var l=n.value;l&&(o[l instanceof Z_?l._uuid+"@import":s+"@native"]=l)}if(i){gR(s,t,o);try{!t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){y(e.message,e.stack)}c_.remove(c),l_.remove(c),vR(s,t,_)}else if(t.__nativeDepend__){gR(s,t,o);try{!t.onLoaded||t.__onLoadedInvoked__||t.__nativeDepend__||(t.onLoaded(),t.__onLoadedInvoked__=!0)}catch(e){y(e.message,e.stack)}}m.recycle()}for(var u=d.callbacks,f=0,p=u.length;f<p;f++){var v=u[f];t.addRef&&t.addRef(),v.item.content=t,v.done(e)}u.length=0}});h_.async(m)}function iO(e,t){var n=e.options,i=Object.create(null),r=Object.create(null);for(var o in n)switch(o){case a_.PATH:case a_.UUID:case a_.DIR:case a_.SCENE:case a_.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":i[o]=n[o];break;case"__exclude__":case"__outputAsArray__":r[o]=n[o];break;default:i[o]=n[o],r[o]=n[o]}e.options=r;var a=p_.create({input:e.input,options:i}),s=null;try{e.output=e.source=f_.sync(a)}catch(e){s=e;for(var c=0,l=a.output.length;c<l;c++)a.output[c].recycle()}a.recycle(),t(s)}var rO=function(){function e(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return e.create=function(){return 0!==e._deadPool.length?e._deadPool.pop():new e},e.prototype.recycle=function(){e._deadPool.length!==e.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),e._deadPool.push(this))},Z(e,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),e}();rO.MAX_DEAD_NUM=500,rO._deadPool=[];var oO=[];function aO(e){var t=e.options,n=Array.isArray(e.input)?e.input:[e.input];e.output=[];for(var i=function(i){var r=n[i],o=rO.create(),a=null,s=null;if("string"==typeof r&&((r=Object.create(null))[t.__requestType__||a_.UUID]=n[i]),"object"==typeof r)for(var c in $e(r,t),r.preset&&$e(r,m_[r.preset]),r){switch(c){case a_.UUID:if("break"===function(){var e=o.uuid=E_(r.uuid);if(!r.bundle){var t=u_.find((function(t){return!!t.getAssetInfo(e)}));r.bundle=t&&t.name}if(u_.has(r.bundle)){if(a=u_.get(r.bundle).config,(s=a.getAssetInfo(e))&&s.redirect){if(!u_.has(s.redirect))throw new Error("Please load bundle "+s.redirect+" first");a=u_.get(s.redirect).config,s=a.getAssetInfo(e)}o.config=a,o.info=s}return o.ext=r.ext||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case a_.DIR:if(u_.has(r.bundle)){u_.get(r.bundle).config.getDirWithPath(r.dir,r.type,oO);for(var l,u=oe(oO);!(l=u()).done;){var h=l.value;n.push({uuid:h.uuid,__isNative__:!1,ext:".json",bundle:r.bundle})}oO.length=0}o.recycle(),o=null;break;case a_.PATH:if(u_.has(r.bundle)){if(a=u_.get(r.bundle).config,(s=a.getInfoWithPath(r.path,r.type))&&s.redirect){if(!u_.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");a=u_.get(s.redirect).config,s=a.getAssetInfo(s.uuid)}if(!s)throw o.recycle(),new Error("Bundle "+r.bundle+" doesn't contain "+r.path);o.config=a,o.uuid=s.uuid,o.info=s}o.ext=r.ext||".json";break;case a_.SCENE:if(!r.bundle){var _=u_.find((function(e){return!!e.getSceneInfo(r.scene)}));r.bundle=_&&_.name}if(u_.has(r.bundle)){if(a=u_.get(r.bundle).config,(s=a.getSceneInfo(r.scene))&&s.redirect){if(!u_.has(s.redirect))throw new Error("you need to load bundle "+s.redirect+" first");a=u_.get(s.redirect).config,s=a.getAssetInfo(s.uuid)}if(!s)throw o.recycle(),new Error("Bundle "+a.name+" doesn't contain scene "+r.scene);o.config=a,o.uuid=s.uuid,o.info=s}break;case"__isNative__":o.isNative=r.__isNative__;break;case a_.URL:o.url=r.url,o.uuid=r.uuid||r.url,o.ext=r.ext||H(r.url),o.isNative=void 0===r.__isNative__||r.__isNative__;break;default:o.options[c]=r[c]}if(!o)break}if(!o)return"continue";if(e.output.push(o),!o.uuid&&!o.url)throw new Error("Can not parse this input:"+JSON.stringify(r))},r=0;r<n.length;r++)i(r);return null}function sO(e){for(var t=e.output=e.input,n=0;n<t.length;n++){var i=t[n];if(!i.url){var r,o,a=i.config;o=i.isNative?a&&a.nativeBase?a.base+a.nativeBase:c.assetManager.generalNativeBase:a&&a.importBase?a.base+a.importBase:c.assetManager.generalImportBase;var s=i.uuid,l="";i.info&&(l=i.isNative?i.info.nativeVer?"."+i.info.nativeVer:"":i.info.ver?"."+i.info.ver:""),r=".ttf"===i.ext?o+"/"+s.slice(0,2)+"/"+s+l+"/"+i.options.__nativeName__:o+"/"+s.slice(0,2)+"/"+s+l+i.ext,i.url=r}}return null}var cO=e("fn",function(){function e(){this.pipeline=h_.append(iO).append(eO),this.fetchPipeline=__.append(iO).append(XR),this.transformPipeline=f_.append(aO).append(sO),this.bundles=u_,this.assets=s_,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=Sd,this.force=!!i,this.allowImageBitmap=!Vv.isMobile,this.utils=I_,this.downloader=BR,this.parser=$R,this.packManager=YR,this.cacheAsset=!0,this.cacheManager=null,this.presets=m_,this.factory=qR,this.preprocessPipe=iO,this.fetchPipe=XR,this.loadPipe=eO,this.references=null,this._releaseManager=hR,this._files=c_,this._parsed=l_,this._parsePipeline=null}var t=e.prototype;return t.init=function(e){void 0===e&&(e={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e.server,e.bundleVers,e.remoteBundles),this.parser.init(),this.dependUtil.init();var t=e.importBase||"";t&&t.endsWith("/")&&(t=t.substr(0,t.length-1));var n=e.nativeBase||"";n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),this.generalImportBase=t,this.generalNativeBase=n},t.getBundle=function(e){return u_.get(e)||null},t.removeBundle=function(e){e._destroy(),u_.remove(e.name)},t.loadAny=function(e,t,n,i){var r=xR(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.preset=o.preset||"default",e=Array.isArray(e)?e.slice():e;var c=new p_({input:e,onProgress:a,onComplete:SR(s),options:o});h_.async(c)},t.preloadAny=function(e,t,n,i){var r=xR(t,n,i),o=r.options,a=r.onProgress,s=r.onComplete;o.preset=o.preset||"preload",e=Array.isArray(e)?e.slice():e;var c=new p_({input:e,onProgress:a,onComplete:SR(s),options:o});__.async(c)},t.postLoadNative=function(e,t,n){var i=xR(t,void 0,n),r=i.options,o=i.onComplete;if(e._native&&e.__nativeDepend__){var a=Sd.getNativeDep(e._uuid);if(a){if(!u_.has(a.bundle)){var s=u_.find((function(t){return!!t.getAssetInfo(e._uuid)}));s&&(a.bundle=s.name)}this.loadAny(a,r,(function(t,n){t?y(t.message,t.stack):e.isValid&&e.__nativeDepend__&&(e._nativeAsset=n,e.__nativeDepend__=!1),o&&o(t)}))}}else SR(o)(null)},t.loadRemote=function(e,t,n){var i=xR(t,void 0,n),r=i.options,o=i.onComplete;r.reloadAsset||!this.assets.has(e)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:e},r,null,(function(t,n){t?(y(t.message,t.stack),o&&o(t,n)):qR.create(e,n,r.ext||H(e),r,(function(e,t){o&&o(e,t)}))}))):SR(o)(null,this.assets.get(e))},t.loadBundle=function(e,t,n){var i=xR(t,void 0,n),r=i.options,o=i.onComplete,a=V(e);this.bundles.has(a)?SR(o)(null,this.getBundle(a)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:e},r,null,(function(t,n){t?(y(t.message,t.stack),o&&o(t,n)):qR.create(e,n,"bundle",r,(function(e,t){o&&o(e,t)}))})))},t.releaseAsset=function(e){hR.tryRelease(e,!0)},t.releaseUnusedAssets=function(){s_.forEach((function(e){hR.tryRelease(e)}))},t.releaseAll=function(){s_.forEach((function(e){hR.tryRelease(e,!0)}))},t.loadWithJson=function(e,t,n,i){throw new Error("Only valid in Editor")},Z(e,[{key:"main",get:function(){return u_.get(d_.MAIN)||null}},{key:"resources",get:function(){return u_.get(d_.RESOURCES)||null}}]),e}());cO.Pipeline=o_,cO.Task=p_,cO.Cache=r_,cO.RequestItem=rO,cO.Bundle=AR,cO.BuiltinBundleName=d_;var lO=e("ch",c.assetManager=new cO);c.AssetManager=cO;var uO=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],hO=[".mp3",".ogg",".wav",".m4a"];function _O(){return!0}var fO={transformURL:function(e){var t=S_(e);if(!t)return e;var n=u_.find((function(e){return!!e.getAssetInfo(t)}));if(!n)return e;var i,r=n.getAssetInfo(t);if(!(i=e.startsWith(n.base+n.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==e.indexOf(i))return e;var o=!1;if(".ttf"===H(e)&&(o=!0),o){var a=j(e),s=V(e);e=a+"."+i+"/"+s}else e=e.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/,(function(e,t){return e+"."+i}));return e}},dO=e("fp",function(){function e(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=ER}var t=e.prototype;return t.load=function(e,t,n){void 0===n&&void 0!==t&&(n=t,t=null);for(var i=Array.isArray(e)?e:[e],r=0;r<i.length;r++){var o=i[r];"string"==typeof o?i[r]={url:o,__isNative__:!0}:(o.type&&(o.ext="."+o.type,o.type=void 0),o.url&&(o.__isNative__=!0))}var a=[],s=[];lO.loadAny(i,null,(function(e,n,i){i.content&&(uO.includes(i.ext)?a.push(i.content):hO.includes(i.ext)&&s.push(i.content)),t&&t(e,n,i)}),(function(e,t){var r=null;if(!e){t=Array.isArray(t)?t:[t];for(var o=function(e){var n=t[e];if(!(n instanceof Z_)){var r=n,o=i[e].url;a.includes(r)?qR.create(o,n,".png",{},(function(n,i){r=t[e]=i})):s.includes(r)&&qR.create(o,n,".mp3",{},(function(n,i){r=t[e]=i})),s_.add(o,r)}},c=0;c<t.length;c++)o(c);if(t.length>1){var l=Object.create(null);t.forEach((function(e){l[e._uuid]=e})),r={isCompleted:_O,_map:l}}else r=t[0]}n&&n(e,r)}))},t.getXMLHttpRequest=function(){return new XMLHttpRequest},t.getItem=function(e){return lO.assets.has(e)?{content:lO.assets.get(e)}:null},t.loadRes=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete,c=H(e);c&&!CR.getInfoWithPath(e,o)&&(e=e.slice(0,-c.length)),CR.load(e,o,a,s)},t.loadResArray=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;e.forEach((function(t,n){var i=H(t);i&&!CR.getInfoWithPath(t,o)&&(e[n]=t.slice(0,-i.length))})),CR.load(e,o,a,s)},t.loadResDir=function(e,t,n,i){var r=this._parseLoadResArgs(t,n,i),o=r.type,a=r.onProgress,s=r.onComplete;CR.loadDir(e,o,a,(function(t,n){var i=[];t||(i=CR.getDirWithPath(e,o).map((function(e){return e.path}))),s&&s(t,n,i)}))},t.getRes=function(e,t){return s_.has(e)?s_.get(e):CR.get(e,t)},t.getResCount=function(){return s_.count},t.getDependsRecursively=function(e){if(!e)return[];var t="string"==typeof e?e:e._uuid;return Sd.getDepsRecursively(t).concat([t])},t.addDownloadHandlers=function(e){var t=Object.create(null),n=function(n){var i=e[n];t["."+n]=function(e,t,n){i({url:e},n)}};for(var i in e)n(i);BR.register(t)},t.addLoadHandlers=function(e){var t=Object.create(null),n=function(n){var i=e[n];t["."+n]=function(e,t,n){i({content:e},n)}};for(var i in e)n(i);$R.register(t)},t.release=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t];"string"==typeof n&&(n=s_.get(n)),lO.releaseAsset(n)}else e&&("string"==typeof e&&(e=s_.get(e)),lO.releaseAsset(e))},t.releaseAsset=function(e){lO.releaseAsset(e)},t.releaseRes=function(e,t){CR.release(e,t)},t.releaseAll=function(){lO.releaseAll(),s_.clear()},t.removeItem=function(e){return!!s_.remove(e)},t.setAutoRelease=function(e,t){"object"==typeof e&&(e=e._uuid),this._autoReleaseSetting[e]=!!t},t.setAutoReleaseRecursively=function(e,t){"object"==typeof e&&(e=e._uuid),t=!!t,this._autoReleaseSetting[e]=t;for(var n=Sd.getDepsRecursively(e),i=0;i<n.length;i++)this._autoReleaseSetting[n[i]]=t},t.isAutoRelease=function(e){return"object"==typeof e&&(e=e._uuid),!!this._autoReleaseSetting[e]},Z(e,[{key:"onProgress",set:function(e){_R=e}},{key:"_cache",get:function(){return s_._map}},{key:"md5Pipe",get:function(){return fO}},{key:"downloader",get:function(){return BR}},{key:"loader",get:function(){return lO.parser}}]),e}()),mO=e("fq",new dO),pO=e("fr",{init:function(e){e.importBase=e.libraryPath,e.nativeBase=e.rawAssetsBase,lO.init(e),e.rawAssets&&CR.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:d_.RESOURCES,importBase:e.importBase,nativeBase:e.nativeBase,paths:e.rawAssets.assets,uuids:Object.keys(e.rawAssets.assets)})},loadAsset:function(e,t,n){lO.loadAny(e,t)}}),vO=e("fs",{});ve(vO,"url",[{name:"normalize",target:lO.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(e){return e.startsWith("resources/")?b_({path:W(e.substr(10)),bundle:d_.RESOURCES,__isNative__:!0,ext:H(e)}):""}}]),ge(pO,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use cc.assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),ge(mO,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"cc.loader.assetLoader was removed, assetLoader and md5Pipe were merged into cc.assetManager.transformPipeline"}]),ve(c,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return mO}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return pO}},{name:"Pipeline",target:cO,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return vO}}]),ge(c,"cc",[{name:"LoadingItems",suggest:M(1400,"cc.LoadingItems","cc.AssetManager.Task")}]),ve(It,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:BR,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),ve(rR,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(e){var t;return lO.main?null===(t=lO.main.getSceneInfo(e))||void 0===t?void 0:t.uuid:""}}]),ve(TA,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var e=[];return lO.main&&lO.main.config.scenes.forEach((function(t){e.push(t)})),e}}]);var gO,yO,xO,EO,TO,SO,AO,CO,wO,bO,IO=hR._autoRelease;hR._autoRelease=function(e,t,n){IO.call(hR,e,t,n);for(var i=mO._autoReleaseSetting,r=Object.keys(i),o=0;o<r.length;o++){var a=r[o];if(!0===i[a]){var s=s_.get(a);s&&hR.tryRelease(s)}}};var RO,OO,NO,PO,MO,DO,LO,FO,zO,BO,UO,GO,HO,kO,VO,jO,WO,qO,YO,XO,KO,QO,ZO,JO,$O,eN,tN,nN,iN,rN,oN,aN,sN,cN,lN,uN,hN,_N,fN,dN,mN,pN,vN,gN,yN,xN,EN,TN,SN,AN,CN,wN,bN,IN,RN,ON,NN,PN,MN,DN,LN,FN,zN,BN,UN,GN,HN,kN=e("cD",(gO=bh("cc.ClickEvent"),yO=n_(c.Node),gO((bO=function(){function e(){ae(this,"target",TO,this),ae(this,"component",SO,this),ae(this,"_componentId",AO,this),ae(this,"handler",CO,this),ae(this,"customEventData",wO,this)}e.emitEvents=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var o=0,a=t.length;o<a;o++){var s=t[o];s instanceof e&&s.emit(i)}};var t=e.prototype;return t.emit=function(e){var t=this.target;if(c.isValid(t)){this._genCompIdIfNeeded();var n=c.js._getClassById(this._componentId),i=t.getComponent(n);if(c.isValid(i)){var r=i[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(e=e.slice()).push(this.customEventData),r.apply(i,e))}}},t._compName2Id=function(e){var t=c.js.getClassByName(e);return c.js._getClassId(t)},t._compId2Name=function(e){var t=c.js._getClassById(e);return c.js.getClassName(t)},t._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},Z(e,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(e){this._componentId=this._compName2Id(e)}}]),e}(),TO=se((EO=bO).prototype,"target",[yO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SO=se(EO.prototype,"component",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),AO=se(EO.prototype,"_componentId",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),CO=se(EO.prototype,"handler",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),wO=se(EO.prototype,"customEventData",[Ph,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),xO=EO))||xO));c.Component.EventHandler=kN;var VN,jN,WN,qN,YN,XN,KN,QN,ZN,JN,$N=new Wn,eP=St(eh),tP=St($u),nP=St(th),iP=St(ih),rP=St(nh),oP=St({SKYBOX:mh|Da.DEPTH_STENCIL,SOLID_COLOR:Da.ALL,DEPTH_ONLY:Da.DEPTH_STENCIL,DONT_CLEAR:Da.NONE}),aP=e("cd",(RO=bh("cc.Camera"),OO=Gh(),NO=Fh(),PO=Qh(),MO=jh(),DO=n_($l.BitMask),LO=Qh(),FO=jh(),zO=n_(oP),BO=Qh(),UO=jh(),GO=Qh(),HO=jh(),kO=Qh(),VO=jh(),jO=Qh(),WO=jh(),qO=n_(eP),YO=Qh(),XO=jh(),KO=n_(tP),QO=Qh(),ZO=jh(),JO=Qh(),$O=jh(),eN=Qh(),tN=jh(),nN=Qh(),iN=jh(),rN=Qh(),oN=jh(),aN=n_(nP),sN=Qh(),cN=jh(),lN=n_(iP),uN=Qh(),hN=jh(),_N=n_(rP),fN=Qh(),dN=jh(),mN=Qh(),pN=jh(),vN=n_(wp),gN=Qh(),yN=jh(),RO(xN=OO(xN=NO(xN=Lh((HN=GN=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"_projection",TN,ie(t)),ae(t,"_priority",SN,ie(t)),ae(t,"_fov",AN,ie(t)),ae(t,"_fovAxis",CN,ie(t)),ae(t,"_orthoHeight",wN,ie(t)),ae(t,"_near",bN,ie(t)),ae(t,"_far",IN,ie(t)),ae(t,"_color",RN,ie(t)),ae(t,"_depth",ON,ie(t)),ae(t,"_stencil",NN,ie(t)),ae(t,"_clearFlags",PN,ie(t)),ae(t,"_rect",MN,ie(t)),ae(t,"_aperture",DN,ie(t)),ae(t,"_shutter",LN,ie(t)),ae(t,"_iso",FN,ie(t)),ae(t,"_screenScale",zN,ie(t)),ae(t,"_visibility",BN,ie(t)),ae(t,"_targetTexture",UN,ie(t)),t._camera=null,t._inEditorMode=!1,t._flows=void 0,t}$(t,e);var n=t.prototype;return n.onLoad=function(){this._createCamera()},n.onEnable=function(){this.node.hasChangedFlags|=ch.POSITION,this._camera&&this._attachToScene()},n.onDisable=function(){this._camera&&this._detachFromScene()},n.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},n.screenPointToRay=function(e,t,n){return n||(n=qo.create()),this._camera&&this._camera.screenPointToRay(n,e,t),n},n.worldToScreen=function(e,t){return t||(t=new Wn),this._camera&&this._camera.worldToScreen(t,e),t},n.screenToWorld=function(e,t){return t||(t=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(t,e),t},n.convertToUINode=function(e,t,n){if(n||(n=new Wn),!this._camera)return n;this.worldToScreen(e,$N);var i=t.getComponent("cc.UITransform"),r=OA.getVisibleSize(),o=$N.x-.5*this._camera.width,a=$N.y-.5*this._camera.height;return $N.x=o/c.view.getScaleX()+.5*r.width,$N.y=a/c.view.getScaleY()+.5*r.height,i&&i.convertToNodeSpaceAR($N,n),n},n._createCamera=function(){this._camera||(this._camera=c.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?c.director.root&&c.director.root.mainWindow:c.director.root&&c.director.root.tempWindow,priority:this._priority}),this._camera.viewport=this._rect,this._camera.fovAxis=this._fovAxis,this._camera.fov=In(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},n._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},n._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},n._chechTargetTextureEvent=function(e){var t=this;e&&e.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(e){t._camera&&t._camera.setFixedSize(e.width,e.height)}),this)},n._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var e=this._targetTexture.window;this._camera.changeTargetWindow(e),this._camera.setFixedSize(e.width,e.height)}},Z(t,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(e){this._priority=e,this._camera&&(this._camera.priority=e)}},{key:"visibility",get:function(){return this._visibility},set:function(e){this._visibility=e,this._camera&&(this._camera.visibility=e)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(e){this._clearFlags=e,this._camera&&(this._camera.clearFlag=e)}},{key:"clearColor",get:function(){return this._color},set:function(e){this._color.set(e),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(e){this._depth=e,this._camera&&(this._camera.clearDepth=e)}},{key:"clearStencil",get:function(){return this._stencil},set:function(e){this._stencil=e,this._camera&&(this._camera.clearStencil=e)}},{key:"projection",get:function(){return this._projection},set:function(e){this._projection=e,this._camera&&(this._camera.projectionType=e)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(e){e!==this._fovAxis&&(this._fovAxis=e,this._camera&&(this._camera.fovAxis=e,e===$u.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._camera&&(this._camera.fov=In(e))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(e){this._orthoHeight=e,this._camera&&(this._camera.orthoHeight=e)}},{key:"near",get:function(){return this._near},set:function(e){this._near=e,this._camera&&(this._camera.nearClip=e)}},{key:"far",get:function(){return this._far},set:function(e){this._far=e,this._camera&&(this._camera.farClip=e)}},{key:"aperture",get:function(){return this._aperture},set:function(e){this._aperture=e,this._camera&&(this._camera.aperture=e)}},{key:"shutter",get:function(){return this._shutter},set:function(e){this._shutter=e,this._camera&&(this._camera.shutter=e)}},{key:"iso",get:function(){return this._iso},set:function(e){this._iso=e,this._camera&&(this._camera.iso=e)}},{key:"rect",get:function(){return this._rect},set:function(e){this._rect=e,this._camera&&(this._camera.viewport=e)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(e){if(this._targetTexture!==e){var t=this._targetTexture;this._targetTexture=e,this._chechTargetTextureEvent(t),this._updateTargetTexture(),!e&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(e){this._screenScale=e,this._camera&&(this._camera.screenScale=e)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(e){this._inEditorMode=e,this._camera&&this._camera.changeTargetWindow(e?c.director.root&&c.director.root.mainWindow:c.director.root&&c.director.root.tempWindow)}}]),t}(gd),GN.ProjectionType=eP,GN.FOVAxis=tP,GN.ClearFlag=oP,GN.Aperture=nP,GN.Shutter=iP,GN.ISO=rP,TN=se((EN=HN).prototype,"_projection",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return eP.PERSPECTIVE}}),SN=se(EN.prototype,"_priority",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),AN=se(EN.prototype,"_fov",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),CN=se(EN.prototype,"_fovAxis",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tP.VERTICAL}}),wN=se(EN.prototype,"_orthoHeight",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),bN=se(EN.prototype,"_near",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),IN=se(EN.prototype,"_far",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),RN=se(EN.prototype,"_color",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Vn("#333333")}}),ON=se(EN.prototype,"_depth",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),NN=se(EN.prototype,"_stencil",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),PN=se(EN.prototype,"_clearFlags",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return oP.SOLID_COLOR}}),MN=se(EN.prototype,"_rect",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new yi(0,0,1,1)}}),DN=se(EN.prototype,"_aperture",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nP.F16_0}}),LN=se(EN.prototype,"_shutter",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iP.D125}}),FN=se(EN.prototype,"_iso",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rP.ISO100}}),zN=se(EN.prototype,"_screenScale",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),BN=se(EN.prototype,"_visibility",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rh}}),UN=se(EN.prototype,"_targetTexture",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),se(EN.prototype,"priority",[PO,MO],Object.getOwnPropertyDescriptor(EN.prototype,"priority"),EN.prototype),se(EN.prototype,"visibility",[DO,LO,FO],Object.getOwnPropertyDescriptor(EN.prototype,"visibility"),EN.prototype),se(EN.prototype,"clearFlags",[zO,BO,UO],Object.getOwnPropertyDescriptor(EN.prototype,"clearFlags"),EN.prototype),se(EN.prototype,"clearColor",[GO,HO],Object.getOwnPropertyDescriptor(EN.prototype,"clearColor"),EN.prototype),se(EN.prototype,"clearDepth",[kO,VO],Object.getOwnPropertyDescriptor(EN.prototype,"clearDepth"),EN.prototype),se(EN.prototype,"clearStencil",[jO,WO],Object.getOwnPropertyDescriptor(EN.prototype,"clearStencil"),EN.prototype),se(EN.prototype,"projection",[qO,YO,XO],Object.getOwnPropertyDescriptor(EN.prototype,"projection"),EN.prototype),se(EN.prototype,"fovAxis",[KO,QO,ZO],Object.getOwnPropertyDescriptor(EN.prototype,"fovAxis"),EN.prototype),se(EN.prototype,"fov",[JO,$O],Object.getOwnPropertyDescriptor(EN.prototype,"fov"),EN.prototype),se(EN.prototype,"orthoHeight",[eN,tN],Object.getOwnPropertyDescriptor(EN.prototype,"orthoHeight"),EN.prototype),se(EN.prototype,"near",[nN,iN],Object.getOwnPropertyDescriptor(EN.prototype,"near"),EN.prototype),se(EN.prototype,"far",[rN,oN],Object.getOwnPropertyDescriptor(EN.prototype,"far"),EN.prototype),se(EN.prototype,"aperture",[aN,sN,cN],Object.getOwnPropertyDescriptor(EN.prototype,"aperture"),EN.prototype),se(EN.prototype,"shutter",[lN,uN,hN],Object.getOwnPropertyDescriptor(EN.prototype,"shutter"),EN.prototype),se(EN.prototype,"iso",[_N,fN,dN],Object.getOwnPropertyDescriptor(EN.prototype,"iso"),EN.prototype),se(EN.prototype,"rect",[mN,pN],Object.getOwnPropertyDescriptor(EN.prototype,"rect"),EN.prototype),se(EN.prototype,"targetTexture",[vN,gN,yN],Object.getOwnPropertyDescriptor(EN.prototype,"targetTexture"),EN.prototype),xN=EN))||xN)||xN)||xN)||xN));c.Camera=aP;var sP,cP,lP,uP,hP,_P,fP,dP,mP={parent:null,owner:null,subModelIdx:0},pP=e("b4",(VN=bh("cc.RenderableComponent"),jN=n_([bp]),WN=n_(bp),qN=Qh(),YN=Vh(),VN((JN=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"_materials",QN,ie(t)),ae(t,"_visFlags",ZN,ie(t)),t._materialInstances=[],t._models=[],t}$(t,e);var n=t.prototype;return n.getMaterial=function(e){return e<0||e>=this._materials.length?null:this._materials[e]},n.setMaterial=function(e,t){e&&e instanceof Mp&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[t]=e;var n=this._materialInstances[t];n?n.parent!==this._materials[t]&&(n.destroy(),this._materialInstances[t]=null,this._onMaterialModified(t,this._materials[t])):this._onMaterialModified(t,this._materials[t])},n.getMaterialInstance=function(e){if(!this._materials[e])return null;if(!this._materialInstances[e]){mP.parent=this._materials[e],mP.owner=this,mP.subModelIdx=e;var t=new Mp(mP);this.setMaterialInstance(e,t)}return this._materialInstances[e]},n.setMaterialInstance=function(e,t){t&&t.parent?t!==this._materialInstances[e]&&(this._materialInstances[e]=t,this._onMaterialModified(e,t)):t!==this._materials[e]&&this.setMaterial(t,e)},n.getRenderMaterial=function(e){return this._materialInstances[e]||this._materials[e]},n._collectModels=function(){return this._models},n._attachToScene=function(){},n._detachFromScene=function(){},n._onMaterialModified=function(e,t){},n._onRebuildPSO=function(e,t){},n._clearMaterials=function(){},n._onVisibilityChange=function(e){},Z(t,[{key:"visibility",get:function(){return this._visFlags},set:function(e){this._visFlags=e,this._onVisibilityChange(e)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(e){for(var t=0;t<e.length;t++)e[t]!==this._materials[t]&&this.setMaterial(e[t],t);if(e.length<this._materials.length){for(var n=e.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(e.length)}}},{key:"materials",get:function(){for(var e=0;e<this._materials.length;e++)this._materialInstances[e]=this.getMaterialInstance(e);return this._materialInstances},set:function(e){var t=e.length-this._materials.length;if(t>0)this._materials.length=e.length,this._materialInstances.length=e.length;else if(t<0)for(var n=this._materials.length-t;n<this._materials.length;++n)this.setMaterialInstance(n,null);for(var i=0;i<this._materialInstances.length;i++)this._materialInstances[i]!=e[i]&&this.setMaterialInstance(i,e[i])}},{key:"sharedMaterial",get:function(){return this.getMaterial(0)}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(e){1===this._materials.length&&this._materials[0]===e||this.setMaterialInstance(0,e)}}]),t}(gd),QN=se((KN=JN).prototype,"_materials",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ZN=se(KN.prototype,"_visFlags",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $l.Enum.NONE}}),se(KN.prototype,"sharedMaterials",[WN,qN,YN],Object.getOwnPropertyDescriptor(KN.prototype,"sharedMaterials"),KN.prototype),XN=KN))||XN));function vP(e){return"string"==typeof e||"number"==typeof e}function gP(e,t){return e instanceof t}c.RenderableComponent=pP,ve(aP,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),ve(aP.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),c.CameraComponent=aP,yt.setClassAlias(aP,"cc.CameraComponent");var yP,xP,EP,TP,SP,AP,CP=e("H",bh("cc.animation.HierarchyPath")((uP=function(){function e(e){ae(this,"path",lP,this),this.path=e||""}return e.prototype.get=function(e){return e instanceof ew?e.getChildByPath(this.path)||(g('Node "'+e.name+'" has no path "'+this.path+'"'),null):(g("Target of hierarchy path should be of type Node."),null)},e}(),lP=se((cP=uP).prototype,"path",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),sP=cP))||sP),wP=e("c",bh("cc.animation.ComponentPath")((dP=function(){function e(e){ae(this,"component",fP,this),this.component=e||""}return e.prototype.get=function(e){return e instanceof ew?e.getComponent(this.component)||(g('Node "'+e.name+'" has no component "'+this.component+'"'),null):(g("Target of component path should be of type Node."),null)},e}(),fP=se((_P=dP).prototype,"component",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),hP=_P))||hP);function bP(e){for(var t=e,n=0;n<(arguments.length<=1?0:arguments.length-1);++n){var i=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];if(vP(i)){if(!(i in t))return g('Target object has no property "'+i+'"'),null;t=t[i]}else t=i.get(t);if(null===t)break}return t}var IP,RP,OP,NP,PP,MP,DP,LP,FP,zP,BP,UP=e("U",bh("cc.animation.UniformProxyFactory")((AP=function(){function e(e,t){ae(this,"passIndex",EP,this),ae(this,"uniformName",TP,this),ae(this,"channelIndex",SP,this),this.passIndex=t||0,this.uniformName=e||""}return e.prototype.forTarget=function(e){var t=e.passes[this.passIndex],n=t.getHandle(this.uniformName);if(!n)throw new Error('Material "'+e.name+'" has no uniform "'+this.uniformName+'"');var i=Cm.getPropertyTypeFromHandle(n);if(i===jd.UBO){var r=void 0===this.channelIndex?n:t.getHandle(this.uniformName,this.channelIndex,ia.FLOAT);if(!r)throw new Error('Uniform "'+this.uniformName+" (in material "+e.name+") has no channel "+this.channelIndex+'"');return function(e,t){for(var n,i=oe(e.shaderInfo.blocks);!(n=i()).done;)for(var r,o=oe(n.value.members);!(r=o()).done;){var a=r.value;if(a.name===t)return a.count>1}return!1}(t,this.uniformName)?{set:function(e){t.setUniformArray(r,e)}}:{set:function(e){t.setUniform(r,e)}}}if(i===jd.SAMPLER){var o=Cm.getBindingFromHandle(n),a=t.properties[this.uniformName],s=a&&a.value?a.value+"-texture":om(a.type),l=xm.get(s);return l||(g("Illegal texture default value: "+s+"."),l=xm.get("default-texture")),{set:function(e){e||(e=l);var n=e.getGFXTexture();n&&n.width&&n.height&&(t.bindTexture(o,n),e instanceof Of&&t.bindSampler(o,If.getSampler(c.game._gfxDevice,e.getSamplerHash())))}}}throw new Error("Animations are not available for uniforms with property type "+i+".")},e}(),EP=se((xP=AP).prototype,"passIndex",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),TP=se(xP.prototype,"uniformName",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),SP=se(xP.prototype,"channelIndex",[$h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),yP=xP))||yP);function GP(e,t,n,i){var r,o,a,s,c,l,u=new t,h=new t,_=new t,f=bh(e)((l=function(){function e(e,n,i){ae(this,"dataPoint",a,this),ae(this,"inTangent",s,this),ae(this,"outTangent",c,this),this.dataPoint=e||new t,this.inTangent=n||new t,this.outTangent=i||new t}var r=e.prototype;return r.lerp=function(e,t,r){var o=this.dataPoint,a=e.dataPoint;h=n(h,this.inTangent,r),_=n(_,e.outTangent,r);var s=t*t*t,c=t*t,l=s-2*c+t,f=-2*s+3*c,d=s-c;return u=n(u,o,2*s-3*c+1),u=i(u,u,h,l),u=i(u,u,a,f),u=i(u,u,_,d)},r.getNoLerp=function(){return this.dataPoint},e}(),a=se((o=l).prototype,"dataPoint",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),s=se(o.prototype,"inTangent",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),c=se(o.prototype,"outTangent",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new t}}),r=o))||r;if(t===Jn){var d=f.prototype.lerp;f.prototype.lerp=function(e,t,n){var i=d.call(this,e,t,n);return Jn.normalize(i,i),i}}return f}e("M",bh("cc.animation.MorphWeightsValueProxy")((NP=function(){function e(){ae(this,"subMeshIndex",OP,this)}return e.prototype.forTarget=function(e){var t=this;return{set:function(n){e.setWeights(n,t.subMeshIndex)}}},e}(),OP=se((RP=NP).prototype,"subMeshIndex",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),IP=RP))||IP),e("a",bh("cc.animation.MorphWeightsAllValueProxy")(PP=function(){function e(){}return e.prototype.forTarget=function(e){return{set:function(t){for(var n,i,r=null!==(n=null===(i=e.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0,o=0;o<r;++o)e.setWeights(t,o)}}},e}())||PP);var HP=e("d",GP("cc.CubicSplineVec2Value",ui,ui.multiplyScalar,ui.scaleAndAdd));c.CubicSplineVec2Value=HP;var kP=e("f",GP("cc.CubicSplineVec3Value",Wn,Wn.multiplyScalar,Wn.scaleAndAdd));c.CubicSplineVec3Value=kP;var VP=e("g",GP("cc.CubicSplineVec4Value",di,di.multiplyScalar,di.scaleAndAdd));c.CubicSplineVec4Value=VP;var jP=e("h",GP("cc.CubicSplineQuatValue",Jn,Jn.multiplyScalar,Jn.scaleAndAdd));c.CubicSplineQuatValue=jP;var WP=e("j",bh("cc.CubicSplineNumberValue")((BP=function(){function e(e,t,n){ae(this,"dataPoint",LP,this),ae(this,"inTangent",FP,this),ae(this,"outTangent",zP,this),this.dataPoint=e,this.inTangent=t,this.outTangent=n}var t=e.prototype;return t.lerp=function(e,t,n){var i=this.dataPoint,r=e.dataPoint,o=t*t*t,a=t*t;return i*(2*o-3*a+1)+this.outTangent*n*(o-2*a+t)+r*(-2*o+3*a)+e.inTangent*n*(o-a)},t.getNoLerp=function(){return this.dataPoint},e}(),LP=se((DP=BP).prototype,"dataPoint",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FP=se(DP.prototype,"inTangent",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zP=se(DP.prototype,"outTangent",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),MP=DP))||MP);function qP(e,t,n){void 0===n&&(n=1e-6);for(var i=0,r=e.length-1,o=r>>>1;i<=r;o=i+r>>>1){var a=e[o];if(a>t+n)r=o-1;else{if(!(a<t-n))return o;i=o+1}}return~i}function YP(e,t,n,i,r){var o=1-r;return o*(o*(e+(3*t-e)*r)+3*n*r*r)+i*r*r*r}c.CubicSplineNumberValue=WP,c.bezier=YP;var XP=Math.cos,KP=Math.acos,QP=Math.max,ZP=2*Math.PI,JP=Math.sqrt;function $P(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}function eM(e,t){var n=function(e,t){var n,i,r,o,a=t-0,s=t-e[0],c=3*a,l=3*s,u=3*(t-e[2]),h=1/(-a+l-u+(t-1)),_=1/3,f=(c-6*s+u)*h,d=f*_,m=(-c+l)*h,p=(3*m-f*f)*_,v=p*_,g=(2*f*f*f-9*f*m+a*h*27)/27,y=g/2,x=y*y+v*v*v;if(x<0){var E=-p*_,T=JP(E*E*E),S=-g/(2*T),A=KP(S<-1?-1:S>1?1:S),C=2*$P(T);return i=C*XP(A*_)-d,r=C*XP((A+ZP)*_)-d,o=C*XP((A+2*ZP)*_)-d,i>=0&&i<=1?r>=0&&r<=1?o>=0&&o<=1?QP(i,r,o):QP(i,r):o>=0&&o<=1?QP(i,o):i:r>=0&&r<=1?o>=0&&o<=1?QP(r,o):r:o}if(0===x)return r=-(n=y<0?$P(-y):-$P(y))-d,(i=2*n-d)>=0&&i<=1?r>=0&&r<=1?QP(i,r):i:r;var w=JP(x);return(n=$P(-y+w))-$P(y+w)-d}(e,t),i=e[1];return((1-n)*(i+(e[3]-i)*n)*3+n*n)*n}c.bezierByTime=eM;var tM=e("fG",function(){function e(e){var t,n;this.ratios=void 0,this._findRatio=void 0,this.ratios=e;for(var i=!0,r=1,o=e.length;r<o;r++)if(t=e[r]-e[r-1],1===r)n=t;else if(Math.abs(t-n)>1e-6){i=!1;break}this._findRatio=i?oM:qP}return e.prototype.sample=function(e){return this._findRatio(this.ratios,e)},e}());c.RatioSampler=tM;var nM=e("fH",function(){function e(t,n){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=n,this._values=t.values;var i=function(t){return"string"==typeof t?t:Array.isArray(t)?t[0]===t[1]&&t[2]===t[3]?e.Linear:e.Bezier(t):e.Linear};if(void 0!==t.easingMethod)this.type=i(t.easingMethod);else if(Array.isArray(t.easingMethods))this.types=t.easingMethods.map(i);else if(void 0!==t.easingMethods){this.types=new Array(this._values.length).fill(null);for(var r=0,o=Object.keys(t.easingMethods);r<o.length;r++){var a=o[r];this.types[a]=i(t.easingMethods[a])}}else this.type=null;var s=t.values[0];(void 0===t.interpolate||t.interpolate)&&(this._lerp=xM(s)),void 0!==t._arrayLength&&(this._array=new Array(t._arrayLength))}e.Bezier=function(e){return e};var t=e.prototype;return t.hasLerp=function(){return!!this._lerp},t.valueAt=function(e){if(void 0===this._array){var t=this._values[e];return t&&t.getNoLerp?t.getNoLerp():t}for(var n=0;n<this._array.length;++n)this._array[n]=this._values[this._array.length*e+n];return this._array},t.valueBetween=function(e,t,n,i,r){if(this._lerp){var o=this.types?this.types[t]:this.type,a=r-n,s=(e-n)/a;if(o&&(s=rM(s,o)),void 0===this._array){var c=this._values[t],l=this._values[i];return this._lerp(c,l,s,a*this._duration)}for(var u=0;u<this._array.length;++u){var h=this._values[this._array.length*t+u],_=this._values[this._array.length*i+u];this._array[u]=this._lerp(h,_,s,a*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(t);for(var f=0;f<this._array.length;++f)this._array[f]=this._values[this._array.length*t+f];return this._array},t.empty=function(){return 0===this._values.length},t.constant=function(){return 1===this._values.length},e}());function iM(e,t,n){var i=t.sample(n);if(i<0)if((i=~i)<=0)i=0;else{if(!(i>=t.ratios.length))return e.valueBetween(n,i-1,t.ratios[i-1],i,t.ratios[i]);i=t.ratios.length-1}return e.valueAt(i)}function rM(e,t){if("string"==typeof t){var n=Nv[t];n?e=n(e):R(3906,t)}else Array.isArray(t)&&(e=eM(t,e));return e}function oM(e,t){var n=e.length-1;if(0===n)return 0;var i=e[0];if(t<i)return 0;var r=e[n];if(t>r)return n;var o=(t=(t-i)/(r-i))/(1/n),a=0|o,s=1e-6;return o-a<s?a:a+1-o<s?a+1:~(a+1)}nM.Linear=null,c.AnimCurve=nM,e("fI",function(){function e(){this.events=[]}return e.prototype.add=function(e,t){this.events.push({func:e||"",params:t||[]})},e}()),c.sampleAnimationCurve=iM;var aM,sM,cM,lM,uM,hM,_M,fM,dM,mM,pM,vM,gM,yM,xM=function(){function e(e,t,n,i){return e.lerp(t,n,i)}return function(t){if(null!==t){if("number"==typeof t)return bn;if("object"==typeof t&&t.constructor){if(t instanceof Jn)return n=new Jn,function(e,t,i,r){return Jn.slerp(n,e,t,i)};if(t instanceof bt)return function(e){var t=new e;return function(n,i,r){return e.lerp(t,n,i,r),t}}(t.constructor);if(t.constructor===Number)return bn;if("function"==typeof t.lerp)return e}var n}}}(),EM=e("bx",function(){function e(){}return e.getOrExtract=function(t){var n=e.pool.get(t);return n&&n.info.sample===t.sample||(n&&c.director.root.dataPoolManager.releaseAnimationClip(t),n=function(e){var t={};e.curves.forEach((function(e){if(!e.valueAdapter&&gP(e.modifiers[0],CP)&&vP(e.modifiers[1])){var n=e.modifiers[0].path,i=t[n];i||(i=t[n]={}),i[e.modifiers[1]]={values:e.data.values,keys:e.data.keys}}}));for(var n=Math.ceil(e.sample*e.duration)+1,i=function(){var i=o[r],a=t[i];if(!a)return"continue";Object.defineProperty(a,"worldMatrix",{get:function(){if(!a._worldMatrix){var r=a.position,o=a.rotation,s=a.scale;TM(e,r,n),TM(e,o,n),TM(e,s,n),function(e,t,n){var i=n.position.values,r=n.rotation.values,o=n.scale.values,a=i.map((function(){return new ai})),s=t.lastIndexOf("/"),c=null;if(s>0){var l=e[t.substring(0,s)];if(!l)return void console.warn("no data for parent bone?");c=l.worldMatrix.values}for(var u=0;u<i.length;u++){var h=i[u],_=r[u],f=o[u],d=a[u];ai.fromRTS(d,_,h,f),c&&ai.multiply(d,c[u],d)}Object.keys(n).forEach((function(e){return delete n[e]})),n._worldMatrix={keys:0,interpolate:!1,values:a}}(t,i,a)}return a._worldMatrix}})},r=0,o=Object.keys(t);r<o.length;r++)i();return{info:{frames:n,sample:e.sample},data:t}}(t),e.pool.set(t,n)),n},e.destroy=function(t){e.pool.delete(t)},e}());function TM(e,t,n){var i=e.keys[t.keys],r=[];if(i&&1!==i.length)for(var o=t.values[0]instanceof Jn,a=0,s=0;a<n;a++){for(var c=a/e.sample;i[s]<=c;)s++;s>i.length-1?c=i[s=i.length-1]:0===s&&(s=1);var l=t.values[s-1].clone(),u=i[s]-i[s-1],h=u?wn((c-i[s-1])/u):1;o?l.slerp(t.values[s],h):l.lerp(t.values[s],h),r[a]=l}else for(var _=0;_<n;_++)r[_]=t.values[0].clone();t.values=r}EM.pool=new Map;var SM=e("fL",bh("cc.AnimationClip")((yM=gM=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"sample",cM,ie(t)),ae(t,"speed",lM,ie(t)),ae(t,"wrapMode",uM,ie(t)),ae(t,"events",hM,ie(t)),ae(t,"_duration",_M,ie(t)),ae(t,"_keys",fM,ie(t)),ae(t,"_stepness",dM,ie(t)),ae(t,"_curves",mM,ie(t)),ae(t,"_commonTargets",pM,ie(t)),ae(t,"_hash",vM,ie(t)),t.frameRate=0,t._ratioSamplers=[],t._runtimeCurves=void 0,t._runtimeEvents=void 0,t._data=null,t}$(t,e),t.createWithSpriteFrames=function(e,n){if(!Array.isArray(e))return R(3905),null;var i=new t;i.sample=n||i.sample,i.duration=e.length/i.sample;for(var r=1/i.sample,o=new Array(e.length),a=new Array(o.length),s=0;s<e.length;s++)o[s]=s*r,a[s]=e[s];return i.keys=[o],i.curves=[{modifiers:[new wP("cc.Sprite"),"spriteFrame"],data:{keys:0,values:a}}],i};var n=t.prototype;return n.onLoaded=function(){this.frameRate=this.sample,this._decodeCVTAs()},n.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},n.updateEventDatas=function(){delete this._runtimeEvents},n.getEventGroupIndexAtRatio=function(e){return this._runtimeEvents||this._createRuntimeEvents(),qP(this._runtimeEvents.ratios,e)},n.hasEvents=function(){return 0!==this.events.length},n.destroy=function(){return c.director.root.dataPoolManager&&c.director.root.dataPoolManager.releaseAnimationClip(this),EM.destroy(this),e.prototype.destroy.call(this)},n._createPropertyCurves=function(){var e=this;this._ratioSamplers=this._keys.map((function(t){return new tM(t.map((function(t){return t/e._duration})))})),this._runtimeCurves=this._curves.map((function(t){return{curve:new nM(t.data,e._duration),modifiers:t.modifiers,valueAdapter:t.valueAdapter,sampler:e._ratioSamplers[t.data.keys],commonTarget:t.commonTarget}})),this._applyStepness()},n._createRuntimeEvents=function(){for(var e,t=this,n=[],i=[],r=function(){var r=e.value,o=r.frame/t._duration,a=n.findIndex((function(e){return e===o}));a<0&&(a=n.length,n.push(o),i.push({events:[]})),i[a].events.push({functionName:r.func,parameters:r.params})},o=oe(this.events.sort((function(e,t){return e.frame-t.frame})));!(e=o()).done;)r();this._runtimeEvents={ratios:n,eventGroups:i}},n._applyStepness=function(){},n._decodeCVTAs=function(){var e=ArrayBuffer.isView(this._nativeAsset)?this._nativeAsset.buffer:this._nativeAsset;if(e){for(var t=this._keys,n=0;n<t.length;++n){var i=t[n];i instanceof hT&&(t[n]=i.decompress(e))}for(var r=0;r<this._curves.length;++r){var o=this._curves[r];o.data.values instanceof hT&&(o.data.values=o.data.values.decompress(e))}}},Z(t,[{key:"duration",get:function(){return this._duration},set:function(e){this._duration=e}},{key:"keys",get:function(){return this._keys},set:function(e){this._keys=e}},{key:"eventGroups",get:function(){return this._runtimeEvents||this._createRuntimeEvents(),this._runtimeEvents.eventGroups}},{key:"stepness",get:function(){return this._stepness},set:function(e){this._stepness=e,this._applyStepness()}},{key:"hash",get:function(){if(this._hash)return this._hash;var e=this._nativeAsset,t=new Uint8Array(ArrayBuffer.isView(e)?e.buffer:e);return this._hash=ls(t,666)}},{key:"curves",get:function(){return this._curves},set:function(e){this._curves=e,delete this._runtimeCurves}},{key:"data",get:function(){return this._data}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(e){this._commonTargets=e}}]),t}(Z_),gM.preventDeferredLoadDependents=!0,gM.WrapMode=Ml,cM=se((sM=yM).prototype,"sample",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),lM=se(sM.prototype,"speed",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),uM=se(sM.prototype,"wrapMode",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ml.Normal}}),hM=se(sM.prototype,"events",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_M=se(sM.prototype,"_duration",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fM=se(sM.prototype,"_keys",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dM=se(sM.prototype,"_stepness",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mM=se(sM.prototype,"_curves",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pM=se(sM.prototype,"_commonTargets",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vM=se(sM.prototype,"_hash",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),aM=sM))||aM);function AM(e,t,n){var i,r=t[t.length-1];if(0!==t.length&&vP(r)&&!n){var o=bP.apply(void 0,[e].concat(t.slice(0,t.length-1)));if(null===o)return null;i={isProxy:!1,object:o,property:r}}else{if(!n)return y("Empty animation curve."),null;var a=bP.apply(void 0,[e].concat(t));if(null===a)return null;i={isProxy:!0,proxy:n.forTarget(a)}}return{setValue:function(e){i.isProxy?i.proxy.set(e):i.object[i.property]=e},getValue:function(){return i.isProxy?i.proxy.get?i.proxy.get():(y("Target doesn't provide a get method."),null):i.object[i.property]}}}function CM(e,t,n){var i=AM(e,t,n);if(null===i)return null;var r=i.getValue(),o=bM(r);if(!o)return y("Value is not copyable!"),null;var a=o.createBuffer(),s=o.copy;return Object.assign(i,{peek:function(){return a},pull:function(){var e=i.getValue();s(a,e)},push:function(){i.setValue(a)}})}c.AnimationClip=SM;var wM,bM=((wM=new Map).set(ui,{createBuffer:function(){return new ui},copy:ui.copy}),wM.set(Wn,{createBuffer:function(){return new Wn},copy:Wn.copy}),wM.set(di,{createBuffer:function(){return new di},copy:di.copy}),wM.set(Vn,{createBuffer:function(){return new Vn},copy:Vn.copy}),wM.set(vi,{createBuffer:function(){return new vi},copy:function(e,t){return e.set(t)}}),function(e){return wM.get(null==e?void 0:e.constructor)}),IM=function(){function e(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var t=e.prototype;return t.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(M(3912)):(this._isPlaying=!0,this.onPlay())},t.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},t.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},t.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},t.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},t.update=function(e){},t.onPlay=function(){},t.onPause=function(){},t.onResume=function(){},t.onStop=function(){},t.onError=function(e){},Z(e,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),e}(),RM=function(){function e(){this._nodeBlendStates=new Map,this._states=new Set}var t=e.prototype;return t.ref=function(e,t){var n=this._nodeBlendStates.get(e);n||(n={dirty:!1,properties:{}},this._nodeBlendStates.set(e,n));var i=n.properties[t];return i||(i=n.properties[t]=new PM(n,OM(t)?new Wn:new Jn)),++i.refCount,i},t.deRef=function(e,t){var n=this._nodeBlendStates.get(e);if(n){var i=n.properties[t];i&&(--i.refCount,i.refCount>0||(delete n.properties[t],function(e){return!(e.properties.position||e.properties.rotation||e.properties.eulerAngles||e.properties.scale)}(n)&&this._nodeBlendStates.delete(e)))}},t.apply=function(){this._nodeBlendStates.forEach((function(e,t){if(e.dirty){e.dirty=!1;var n,i,r,o=e.properties,a=o.position,s=o.scale,c=o.rotation,l=o.eulerAngles,u=!1;a&&0!==a.weight&&(a.weight=0,n=a.value,u=!0),s&&0!==s.weight&&(s.weight=0,i=s.value,u=!0),c&&0!==c.weight&&(c.weight=0,r=c.value,u=!0),l&&0!==l.weight&&(l.weight=0,r=l.value,u=!0),u&&t.setRTS(r,n,i)}})),this._states.forEach((function(e){e.onBlendFinished()}))},t.bindState=function(e){this._states.add(e)},t.unbindState=function(e){this._states.delete(e)},e}();function OM(e){return!function(e){return"rotation"===e}(e)}var NM,PM=function(){function e(e,t){this.weight=0,this.value=void 0,this.refCount=0,this._node=void 0,this._node=e,this.value=t}return e.prototype.markAsDirty=function(){this._node.dirty=!0},e}();function MM(e,t,n){return 0===n.weight&&Wn.zero(n.value),0===t?n.value:1===t?Wn.copy(n.value,e):Wn.scaleAndAdd(n.value,n.value,e,t)}function DM(e,t,n){if(0===n.weight&&Jn.identity(n.value),0===t)return n.value;if(1===t)return Jn.copy(n.value,e);var i=t/(n.weight+t);return Jn.slerp(n.value,n.value,e,i)}!function(e){e.PLAY="play",e.STOP="stop",e.PAUSE="pause",e.RESUME="resume",e.LASTFRAME="lastframe",e.FINISHED="finished"}(NM||(NM={})),wt(NM);var LM=function(){function e(e,t,n){this.commonTargetIndex=void 0,this._curve=void 0,this._boundTarget=void 0,this._rootTargetProperty=void 0,this._curveDetail=void 0,this._curve=e.curve,this._curveDetail=e,this._boundTarget=n}var t=e.prototype;return t.applySample=function(e,t,n,i,r){var o;this._curve.empty()||(o=this._curve.hasLerp()&&n?this._curve.valueBetween(e,i.from,i.fromRatio,i.to,i.toRatio):this._curve.valueAt(t),this._setValue(o,r))},t._setValue=function(e,t){this._boundTarget.setValue(e)},Z(e,[{key:"propertyName",get:function(){return this._rootTargetProperty||""}},{key:"curveDetail",get:function(){return this._curveDetail}}]),e}(),FM=e("bP",function(e){function t(t,n){var i;return void 0===n&&(n=""),(i=e.call(this)||this).duration=1,i.speed=1,i.time=0,i.weight=0,i.frameRate=0,i._targetNode=null,i._curveLoaded=!1,i._clip=void 0,i._process=i.process,i._samplerSharedGroups=[],i._target=null,i._ignoreIndex=-1,i._commonTargetStatuses=[],i._wrapMode=Ml.Normal,i._repeatCount=1,i._delay=0,i._delayTime=0,i._currentFramePlayed=!1,i._name=void 0,i._lastIterations=void 0,i._lastWrapInfo=null,i._lastWrapInfoEvent=null,i._wrappedInfo=new Fl,i._blendStateBuffer=null,i._blendStateWriters=[],i._allowLastFrame=!1,i._blendStateWriterHost={weight:0,enabled:!1},i._clip=t,i._name=n||t&&t.name,i}$(t,e),Z(t,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(e){this._wrapMode=e,this.time=0,e&Pl.Loop?this.repeatCount=1/0:this.repeatCount=1}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(e){this._repeatCount=e;var t=this._wrapMode&Pl.ShouldWrap,n=(this.wrapMode&Pl.Reverse)===Pl.Reverse;this._process=e!==1/0||t||n?this.process:this.simpleProcess}},{key:"delay",get:function(){return this._delay},set:function(e){this._delayTime=this._delay=e}},{key:"current",get:function(){return this.getWrappedInfo(this.time).time}},{key:"ratio",get:function(){return this.current/this.duration}}]);var n=t.prototype;return n.initialize=function(e,t){var n,i,r=this;if(!this._curveLoaded){this._curveLoaded=!0,this._destroyBlendStateWriters(),this._samplerSharedGroups.length=0,this._blendStateBuffer=null!==(n=null===(i=c.director.getAnimationManager())||void 0===i?void 0:i.blendState)&&void 0!==n?n:null,this._blendStateBuffer&&this._blendStateBuffer.bindState(this),this._targetNode=e;var o=this._clip;this.duration=o.duration,this.speed=o.speed,this.wrapMode=o.wrapMode,this.frameRate=o.sample,(this.wrapMode&Pl.Loop)===Pl.Loop?this.repeatCount=1/0:this.repeatCount=1;var a=function(e,t,n,i,o){if(!function(e){var t;if(1===e.length&&"string"==typeof e[0])t=e[0];else if(e.length>1){for(var n=0;n<e.length-1;++n)if(!(e[n]instanceof CP))return!1;t=e[e.length-1]}switch(t){case"position":case"scale":case"rotation":case"eulerAngles":return!0;default:return!1}}(n)||!r._blendStateBuffer)return e(t,n,i);var a=bP.apply(void 0,[t].concat(n.slice(0,n.length-1)));if(null!==a&&a instanceof ew){var s=n[n.length-1],c=function(e,t,n,i,r){var o=OM(n)?MM:DM,a=e.ref(t,n),s=!1,c=-1;return{destroy:function(){Et(a),a&&(e.deRef(t,n),a=null)},forTarget:function(){return{get:function(){return t[n]},set:function(e){if(a&&i.enabled){var t=i.weight;if(r)if(1!==t||t!==c)s=!1;else if(s)return;o(e,t,a),a.weight+=t,a.markAsDirty(),s=!0,c=t}}}}}}(r._blendStateBuffer,a,s,r._blendStateWriterHost,o);return r._blendStateWriters.push(c),e(t,[],c)}return null};this._commonTargetStatuses=o.commonTargets.map((function(t,n){var i=a(CM,e,t.modifiers,t.valueAdapter,!1);return null===i?null:{target:i,changed:!1}})),t||(t=o.getPropertyCurves());for(var s=function(n){var i=t[n],o=r._samplerSharedGroups.find((function(e){return e.sampler===i.sampler}));o||(o={sampler:i.sampler,curves:[],samplerResultCache:{from:0,fromRatio:0,to:0,toRatio:0}},r._samplerSharedGroups.push(o));var s=void 0;if(void 0===i.commonTarget)s=e;else{var c=r._commonTargetStatuses[i.commonTarget];if(!c)return"continue";s=c.target.peek()}var l=a(AM,s,i.modifiers,i.valueAdapter,i.curve.constant());if(null===l);else{var u=new LM(i,s,l);u.commonTargetIndex=i.commonTarget,o.curves.push(u)}},l=0;l<t.length;++l)s(l)}},n.destroy=function(){this._destroyBlendStateWriters()},n.onBlendFinished=function(){this._blendStateWriterHost.enabled=!1},n.emit=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];c.director.getAnimationManager().pushDelayEvent(this._emit,this,t)},n.on=function(e,t,n){return this._target&&this._target.isValid?this._target.on(e,t,n):null},n.once=function(e,t,n){return this._target&&this._target.isValid?this._target.once(e,t,n):null},n.off=function(e,t,n){this._target&&this._target.isValid&&this._target.off(e,t,n)},n.allowLastFrameEvent=function(e){this._allowLastFrame=e},n._setEventTarget=function(e){this._target=e},n.setTime=function(e){this._currentFramePlayed=!1,this.time=e||0,this._lastWrapInfoEvent=null,this._ignoreIndex=-1;var t=this.getWrappedInfo(e,this._wrappedInfo),n=t.direction,i=this._clip.getEventGroupIndexAtRatio(t.ratio);i<0&&(i=~i-1,n<0&&(i+=1),this._ignoreIndex=i)},n.update=function(e){this._delayTime>0&&(this._delayTime-=e,this._delayTime>0)||(this._currentFramePlayed?this.time+=e*this.speed:this._currentFramePlayed=!0,this._process())},n.sample=function(){var e=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(e.ratio),this._sampleEvents(e),e},n.onPlay=function(){this.setTime(0),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(NM.PLAY,this)},n.onStop=function(){this.isPaused||this._onPauseOrStop(),this.emit(NM.STOP,this)},n.onResume=function(){this._onReplayOrResume(),this.emit(NM.RESUME,this)},n.onPause=function(){this._onPauseOrStop(),this.emit(NM.PAUSE,this)},n._sampleCurves=function(e){this._blendStateWriterHost.weight=this.weight,this._blendStateWriterHost.enabled=!0;for(var t=0;t<this._commonTargetStatuses.length;++t){var n=this._commonTargetStatuses[t];n&&(n.target.pull(),n.changed=!1)}for(var i=0,r=this._samplerSharedGroups.length;i<r;++i){var o=this._samplerSharedGroups[i],a=o.sampler,s=o.samplerResultCache,c=0,l=!1;a?(c=a.sample(e))<0&&((c=~c)<=0?c=0:c>=a.ratios.length?c=a.ratios.length-1:(l=!0,s.from=c-1,s.fromRatio=a.ratios[s.from],s.to=c,s.toRatio=a.ratios[s.to],c=s.from)):c=0;for(var u=0,h=o.curves.length;u<h;++u){var _=o.curves[u];if(_.applySample(e,c,l,s,this.weight),void 0!==_.commonTargetIndex){var f=this._commonTargetStatuses[_.commonTargetIndex];f&&(f.changed=!0)}}}for(var d=0;d<this._commonTargetStatuses.length;++d){var m=this._commonTargetStatuses[d];m&&m.changed&&m.target.push()}},n.process=function(){var e,t=this.sample();this._allowLastFrame&&(e=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new Fl(t),this.repeatCount>1&&(0|t.iterations)>(0|e.iterations)&&this.emit(NM.LASTFRAME,this),e.set(t)),t.stopped&&(this.stop(),this.emit(NM.FINISHED,this))},n.simpleProcess=function(){var e=this.duration,t=this.time%e;t<0&&(t+=e);var n=t/e;this._sampleCurves(n),this._clip.hasEvents()&&this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(void 0===this._lastIterations&&(this._lastIterations=n),(this.time>0&&this._lastIterations>n||this.time<0&&this._lastIterations<n)&&this.emit(NM.LASTFRAME,this),this._lastIterations=n)},n.cache=function(e){},n._needReverse=function(e){var t=this.wrapMode,n=!1;return(t&Pl.PingPong)===Pl.PingPong&&(e-(0|e)==0&&e>0&&(e-=1),1&e&&(n=!n)),(t&Pl.Reverse)===Pl.Reverse&&(n=!n),n},n.getWrappedInfo=function(e,t){t=t||new Fl;var n=!1,i=this.duration,r=this.repeatCount,o=e>0?e/i:-e/i;if(o>=r){o=r,n=!0;var a=r-(0|r);0===a&&(a=1),e=a*i*(e>0?1:-1)}if(e>i){var s=e%i;e=0===s?i:s}else e<0&&0!=(e%=i)&&(e+=i);var c=!1,l=this._wrapMode&Pl.ShouldWrap;l&&(c=this._needReverse(o));var u=c?-1:1;return this.speed<0&&(u*=-1),l&&c&&(e=i-e),t.ratio=e/i,t.time=e,t.direction=u,t.stopped=n,t.iterations=o,t},n._sampleEvents=function(e){var t=this._clip.eventGroups.length,n=e.direction,i=this._clip.getEventGroupIndexAtRatio(e.ratio);if(i<0&&(i=~i-1,n<0&&(i+=1)),this._ignoreIndex!==i&&(this._ignoreIndex=-1),e.frameIndex=i,!this._lastWrapInfoEvent)return this._fireEvent(i),void(this._lastWrapInfoEvent=new Fl(e));var r=this.wrapMode,o=zM(e.iterations),a=this._lastWrapInfoEvent,s=zM(a.iterations),l=a.frameIndex,u=a.direction,h=-1!==s&&o!==s;if(l===i&&h&&1===t)this._fireEvent(0);else if(l!==i||h){n=u;do{if(l!==i){if(-1===n&&0===l&&i>0?((r&Pl.PingPong)===Pl.PingPong?n*=-1:l=t,s++):1===n&&l===t-1&&i<t-1&&((r&Pl.PingPong)===Pl.PingPong?n*=-1:l=-1,s++),l===i)break;if(s>o)break}l+=n,c.director.getAnimationManager().pushDelayEvent(this._fireEvent,this,[l])}while(l!==i&&l>-1&&l<t)}this._lastWrapInfoEvent.set(e)},n._emit=function(e,t){this._target&&this._target.isValid&&this._target.emit(e,e,t)},n._fireEvent=function(e){if(this._targetNode&&this._targetNode.isValid){var t=this._clip.eventGroups;if(!(e<0||e>=t.length||this._ignoreIndex===e))for(var n,i=t[e],r=this._targetNode.components,o=oe(i.events);!(n=o()).done;)for(var a,s=n.value,c=s.functionName,l=oe(r);!(a=l()).done;){var u=a.value,h=u[c];"function"==typeof h&&h.apply(u,s.parameters)}}},n._onReplayOrResume=function(){c.director.getAnimationManager().addAnimation(this)},n._onPauseOrStop=function(){c.director.getAnimationManager().removeAnimation(this)},n._destroyBlendStateWriters=function(){for(var e=0;e<this._blendStateWriters.length;++e)this._blendStateWriters[e].destroy();this._blendStateWriters.length=0,this._blendStateBuffer&&(this._blendStateBuffer.unbindState(this),this._blendStateBuffer=null),this._blendStateWriterHost.enabled=!1},Z(t,[{key:"curveLoaded",get:function(){return this._curveLoaded}}]),t}(IM));function zM(e){return e-(0|e)==0&&(e-=1),0|e}c.AnimationState=FM;var BM,UM,GM,HM,kM,VM,jM,WM,qM,YM,XM,KM,QM,ZM,JM,$M,eD,tD=function(e){function t(){var t;return(t=e.call(this)||this)._managedStates=[],t._fadings=[],t}$(t,e);var n=t.prototype;return n.update=function(e){if(!this.isMotionless){for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&(n.weight=0)}for(var i=1,r=this._fadings.length,o=0;o<this._fadings.length;++o){var a=this._fadings[o];a.easeTime+=e;var s=0===a.easeDuration?1:wn(a.easeTime/a.easeDuration),c=s*i;if(i*=1-s,a.target.state&&(a.target.state.weight+=c),a.easeTime>=a.easeDuration){r=o+1,a.easeTime=a.easeDuration;break}}if(r!==this._fadings.length){for(var l=r;l<this._fadings.length;++l){var u=this._fadings[l];--u.target.reference,u.target.reference<=0&&(u.target.state&&u.target.state.stop(),Ie(this._managedStates,u.target))}this._fadings.splice(r)}for(var h=0;h<this._managedStates.length;++h){var _=this._managedStates[h].state;_&&_.isMotionless&&_.sample()}}},n.crossFade=function(e,t){var n;0===this._managedStates.length&&(t=0),0===t&&this.clear();var i=this._managedStates.find((function(t){return t.state===e}));i?(null===(n=i.state)||void 0===n?void 0:n.isMotionless)&&i.state.play():(i={state:e,reference:0},e&&e.play(),this._managedStates.push(i)),++i.reference,this._fadings.unshift({easeDuration:t,easeTime:0,target:i})},n.clear=function(){for(var e=0;e<this._managedStates.length;++e){var t=this._managedStates[e].state;t&&t.stop()}this._managedStates.length=0,this._fadings.length=0},n.onPlay=function(){e.prototype.onPlay.call(this),c.director.getAnimationManager().addCrossFade(this)},n.onPause=function(){e.prototype.onPause.call(this),c.director.getAnimationManager().removeCrossFade(this);for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&n.pause()}},n.onResume=function(){e.prototype.onResume.call(this),c.director.getAnimationManager().addCrossFade(this);for(var t=0;t<this._managedStates.length;++t){var n=this._managedStates[t].state;n&&n.resume()}},n.onStop=function(){e.prototype.onStop.call(this),c.director.getAnimationManager().removeCrossFade(this),this.clear()},t}(IM),nD=e("bQ",(BM=bh("cc.Animation"),UM=Gh(),GM=Rh(99),HM=Fh(),kM=n_([SM]),VM=jh(),jM=n_(SM),WM=jh(),qM=jh(),YM=n_([SM]),BM(XM=UM(XM=GM(XM=Lh(XM=HM((eD=$M=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ae(t=e.call.apply(e,[this].concat(i))||this,"playOnLoad",QM,ie(t)),t._crossFade=new tD,t._nameToState=Ve(!0),ae(t,"_clips",ZM,ie(t)),ae(t,"_defaultClip",JM,ie(t)),t._hasBeenPlayed=!1,t}$(t,e);var n=t.prototype;return n.onLoad=function(){for(var e in this.clips=this._clips,this._nameToState)this._nameToState[e].initialize(this.node)},n.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},n.onEnable=function(){this._crossFade.resume()},n.onDisable=function(){this._crossFade.pause()},n.onDestroy=function(){for(var e in this._crossFade.stop(),this._nameToState)this._nameToState[e].destroy();this._nameToState=Ve(!0)},n.play=function(e){if(this._hasBeenPlayed=!0,!e){if(!this._defaultClip)return;e=this._defaultClip.name}this.crossFade(e,0)},n.crossFade=function(e,t){void 0===t&&(t=.3),this._hasBeenPlayed=!0;var n=this._nameToState[e];n&&(this._crossFade.play(),this._crossFade.crossFade(n,t))},n.pause=function(){this._crossFade.pause()},n.resume=function(){this._crossFade.resume()},n.stop=function(){this._crossFade.stop()},n.getAnimationState=function(e){return this.getState(e)},n.getState=function(e){var t=this._nameToState[e];return t&&!t.curveLoaded&&t.initialize(this.node),t||null},n.createState=function(e,t){return t=t||e.name,this.removeState(t),this._doCreateState(e,t)},n.removeState=function(e){var t=this._nameToState[e];t&&(t.allowLastFrameEvent(!1),t.stop(),delete this._nameToState[e])},n.addClip=function(e,t){return Re(this._clips,e)||this._clips.push(e),this.createState(e,t)},n.removeClip=function(e,t){var n;for(var i in this._nameToState){var r=this._nameToState[i];if(r.clip===e){n=r;break}}if(e===this._defaultClip){if(!t)return void b(3902);this._defaultClip=null}if(n&&n.isPlaying){if(!t)return void b(3903);n.stop()}this._clips=this._clips.filter((function(t){return t!==e})),n&&delete this._nameToState[n.name]},n.on=function(t,n,i,r){var o=e.prototype.on.call(this,t,n,i,r);return t===NM.LASTFRAME&&this._syncAllowLastFrameEvent(),o},n.once=function(t,n,i){var r=e.prototype.once.call(this,t,n,i);return t===NM.LASTFRAME&&this._syncAllowLastFrameEvent(),r},n.off=function(t,n,i){e.prototype.off.call(this,t,n,i),t===NM.LASTFRAME&&this._syncDisallowLastFrameEvent()},n._createState=function(e,t){return new FM(e,t)},n._doCreateState=function(e,t){var n=this._createState(e,t);return n._setEventTarget(this),n.allowLastFrameEvent(this.hasEventListener(NM.LASTFRAME)),this.node&&n.initialize(this.node),this._nameToState[n.name]=n,n},n._getStateByNameOrDefaultClip=function(e){if(!e){if(!this._defaultClip)return null;e=this._defaultClip.name}return this._nameToState[e]||null},n._removeStateOfAutomaticClip=function(e){for(var t in this._nameToState){var n=this._nameToState[t];iD(e,n.clip)&&(n.stop(),delete this._nameToState[t])}},n._syncAllowLastFrameEvent=function(){if(this.hasEventListener(NM.LASTFRAME))for(var e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!0)},n._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(NM.LASTFRAME))for(var e in this._nameToState)this._nameToState[e].allowLastFrameEvent(!1)},Z(t,[{key:"clips",get:function(){return this._clips},set:function(e){var t=this;this._crossFade&&this._crossFade.clear();for(var n,i=oe(this._clips);!(n=i()).done;){var r=n.value;r&&this._removeStateOfAutomaticClip(r)}for(var o,a=oe(e);!(o=a()).done;){var s=o.value;s&&this.createState(s)}var c=e.find((function(e){return iD(e,t._defaultClip)}));this._defaultClip=c||null,this._clips=e}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(e){this._defaultClip=e,e&&(this._clips.findIndex((function(t){return iD(t,e)}))>=0||(this._clips.push(e),this.createState(e)))}}]),t}(j_(gd)),$M.EventType=NM,se((KM=eD).prototype,"clips",[kM,VM],Object.getOwnPropertyDescriptor(KM.prototype,"clips"),KM.prototype),se(KM.prototype,"defaultClip",[jM,WM],Object.getOwnPropertyDescriptor(KM.prototype,"defaultClip"),KM.prototype),QM=se(KM.prototype,"playOnLoad",[Ph,qM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ZM=se(KM.prototype,"_clips",[YM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JM=se(KM.prototype,"_defaultClip",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XM=KM))||XM)||XM)||XM)||XM)||XM));function iD(e,t){return e===t||!(!e||!t||e.name!==t.name&&e._uuid!==t._uuid)}ve(nD.prototype,"Animation",[{name:"getAnimationState",newName:"getState"},{name:"addClip",newName:"createState"},{name:"removeClip",newName:"removeState",customFunction:function(){var e=arguments.length<=0?void 0:arguments[0];return nD.prototype.removeState.call(this,e.name)}}]),c.AnimationComponent=nD,yt.setClassAlias(nD,"cc.AnimationComponent");var rD,oD,aD,sD=[],cD=new Map;function lD(e,t){for(var n=0,i=ai.IDENTITY;e;){if(e.stamp===t||e.stamp+1===t&&!e.node.hasChangedFlags){i=e.world,e.stamp=t;break}e.stamp=t,sD[n++]=e,e=e.parent}for(;n>0;){var r=(e=sD[--n]).node;ai.fromRTS(e.local,r.rotation,r.position,r.scale),i=ai.multiply(e.world,i,e.local)}return i}function uD(e,t){for(var n,i=null,r=0;e!==t;){var o=e.uuid;if(cD.has(o)){i=cD.get(o);break}i={node:e,local:new ai,world:new ai,stamp:-1,parent:null},cD.set(o,i),sD[r++]=i,e=e.parent,i=null}for(;r>0;)(n=sD[--r]).parent=i,i=n;return i}function hD(e){for(var t=cD.get(e.uuid)||null;t;)cD.delete(t.node.uuid),t=t.parent}var _D=e("fM",bh((aD=oD=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this)._anims=new Ce([]),t._delayEvents=[],t._blendStateBuffer=new RM,t._crossFades=[],t._sockets=[],t}$(t,e);var n=t.prototype;return n.addCrossFade=function(e){this._crossFades.push(e)},n.removeCrossFade=function(e){Ie(this._crossFades,e)},n.update=function(e){for(var t=this._delayEvents,n=this._crossFades,i=this._sockets,r=0,o=n.length;r<o;r++)n[r].update(e);var a=this._anims,s=a.array;for(a.i=0;a.i<s.length;++a.i){var l=s[a.i];l.isMotionless||l.update(e)}this._blendStateBuffer.apply();for(var u=c.director.getTotalFrames(),h=0,_=i.length;h<_;h++){var f=i[h],d=f.target,m=f.transform;d.matrix=lD(m,u)}for(var p=0,v=t.length;p<v;p++){var g=t[p];g.fn.apply(g.thisArg,g.args)}t.length=0},n.destruct=function(){},n.addAnimation=function(e){-1===this._anims.array.indexOf(e)&&this._anims.push(e)},n.removeAnimation=function(e){var t=this._anims.array.indexOf(e);t>=0?this._anims.fastRemoveAt(t):R(3907)},n.pushDelayEvent=function(e,t,n){this._delayEvents.push({fn:e,thisArg:t,args:n})},n.addSockets=function(e,t){for(var n=this,i=function(i){var r=t[i];if(n._sockets.find((function(e){return e.target===r.target})))return"continue";var o=e.getChildByPath(r.path),a=r.target&&o&&uD(o,e);a&&n._sockets.push({target:r.target,transform:a})},r=0;r<t.length;++r)i(r)},n.removeSockets=function(e,t){for(var n=0;n<t.length;++n)for(var i=t[n],r=0;r<this._sockets.length;++r){var o=this._sockets[r];if(o.target===i.target){hD(o.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},Z(t,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),t}(UA),oD.ID="animation",rD=aD))||rD);rR.on(iR.EVENT_INIT,(function(){var e=new _D;rR.registerSystem(_D.ID,e,WA.PRIORITY_SYSTEM)})),c.AnimationManager=_D;var fD,dD,mD,pD,vD=new ai;c.easing=Nv;var gD=e("fx",bh("cc.HierachyModifier")(fD=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(CP))||fD);c.HierachyModifier=gD;var yD=e("fy",bh("cc.ComponentModifier")(dD=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(wP))||dD);c.ComponentModifier=yD;var xD=e("fz",bh("cc.CurveValueAdapter")(mD=function(){function e(){}return e.prototype.forTarget=function(e){return{set:function(){}}},e}())||mD);c.CurveValueAdapter=xD;var ED=e("fA",bh("cc.UniformCurveValueAdapter")(pD=function(e){function t(){return e.apply(this,arguments)||this}return $(t,e),t}(UP))||pD);function TD(e){return"string"==typeof e}function SD(e){return"number"==typeof e}function AD(e,t){return e instanceof t}c.UniformCurveValueAdapter=ED,c.isPropertyModifier=TD,c.isElementModifier=SD,c.isCustomTargetModifier=AD,c.math=Ei,c.geometry=Zl;var CD=e("fO",function(){function e(e){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=e,this._pool=[]}var t=e.prototype;return t.size=function(){return this._pool.length},t.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy();this._pool.length=0},t.put=function(e){if(e&&-1===this._pool.indexOf(e)){e.removeFromParent();var t=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;t&&t.unuse&&t.unuse(),this._pool.push(e)}},t.get=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this._pool.length-1;if(i<0)return null;var r=this._pool[i];this._pool.length=i;var o=this.poolHandlerComp?r.getComponent(this.poolHandlerComp):null;return o&&o.reuse&&o.reuse(arguments),r},e}());c.NodePool=CD,c.renderer=Jp;var wD=new URL("assets/ammo.wasm-2f572f72.wasm",t.meta.url).href;let bD,ID=!1;"undefined"==typeof WebAssembly?bD=await t.import("./ammo-f0bdd709.js"):(bD=await t.import("./ammo.wasm-baa9669a.js"),ID=!0);var RD,OD=bD.default,ND=e("d6",{});function PD(e){var t={};return void 0!==e&&(ND.wasmBinary=e),new Promise((function(e,n){OD.call(t,ND).then((function(){e()}))}))}(RD=PD||(PD=e("fP",{}))).isWasm=ID,RD.wasmBinaryURL=wD}}}));